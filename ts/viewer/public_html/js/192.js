"use strict";(self.webpackChunkmonofy=self.webpackChunkmonofy||[]).push([[192],{192:(e,t,n)=>{n.r(t),n.d(t,{Viewer:()=>z});var i=n(3582),o=n(7699),s=n(1513),r=n(9859),a=n(6041),c=n(7524),d=n(9923),l=n(5487),h=n(9794),u=n(6240),m=n(660),p=n(8844),f=n(9537),b=(n(9406),n(6547)),_=n(2285),y=n(6632),E=function(){function e(e,t){var n=this;this.container=e,this.attachedElement=t,this._submenus=[],this.domElement=document.createElement("div"),this.domElement.classList.add("context-menu"),e&&e.appendChild(this.domElement),t&&(this.hide(),t.addEventListener("contextmenu",(function(e){e.preventDefault(),n.show(e.clientX+10,e.clientY-5)})))}return e.prototype.isVisible=function(){return"none"!==this.domElement.style.display},e.prototype.addItem=function(e,t){var n=this,i=document.createElement("div");i.classList.add("context-menu-item"),i.textContent=e,i.addEventListener("click",(function(){t(),n.hide()})),this.domElement.appendChild(i)},e.prototype.addSubmenu=function(e,t){var n=this,i=document.createElement("div");i.classList.add("context-menu-item"),i.textContent=e,i.addEventListener("click",(function(e){t.show(n.domElement.offsetLeft+n.domElement.offsetWidth-5,i.offsetTop),e.target.classList.contains("context-menu-item")&&n.hide()})),t.domElement.classList.add("context-menu-submenu"),this._submenus.push(t),i.appendChild(t.domElement),this.domElement.appendChild(i)},e.prototype.show=function(e,t){this.container&&(this.domElement.style.left="".concat(e,"px"),this.domElement.style.top="".concat(t,"px"),this.domElement.style.display="block")},e.prototype.hide=function(){if(this.isVisible()&&this.container){this.domElement.style.display="none";for(var e=0;e<this._submenus.length;e++)this._submenus[e].hide()}},e}(),v=function(){function e(e,t){var n=this;this.onOk=t,this.domElement=document.createElement("div"),this.domElement.classList.add("prompt-popup"),this._header=document.createElement("h1"),this.domElement.appendChild(this._header),this._text=document.createElement("p"),this.domElement.appendChild(this._text),this._input=document.createElement("input"),this._input.classList.add("prompt-input"),this.domElement.appendChild(this._input),this._input.addEventListener("keydown",(function(e){"Enter"===e.key&&(n.onOk(n.getValue()),n.hide())})),this._button=document.createElement("button"),this._button.classList.add("prompt-button"),this._button.textContent="OK",this._button.addEventListener("click",(function(){n.onOk(n.getValue()),n.hide()})),this.domElement.appendChild(this._button),e.appendChild(this.domElement),this.hide()}return e.prototype.isVisible=function(){return"none"!==this.domElement.style.display},e.prototype.show=function(e,t,n){void 0===t&&(t=""),this._header.textContent=e,this._text.textContent=t,this.domElement.style.display="block",n&&(this.domElement.style.left="".concat(n.x,"px"),this.domElement.style.top="".concat(n.y,"px")),this._input.focus()},e.prototype.hide=function(){this.domElement.style.display="none"},e.prototype.getValue=function(){return this._input.value},e}(),g=(n(4320),function(e,t,n,i){return new(n||(n=Promise))((function(o,s){function r(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((i=i.apply(e,t||[])).next())}))}),w=function(e,t){var n,i,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},M=window,z=function(){function e(e){var t=this;this._selectedMesh=null,this.cursorPosition=d.Pq.Zero(),void 0===e?(this._canvas=document.createElement("canvas"),document.body.appendChild(this._canvas)):this._canvas=e,this._canvas.width=M.innerWidth,this._canvas.height=M.innerHeight,M.addEventListener("resize",(function(){t._canvas.width=M.innerWidth,t._canvas.height=M.innerHeight})),this._contextMenu=new E(document.body,this._canvas);var n=new E;this._promptPopup=new v(document.body,(function(e){t.fetchModelFromText(e).then((function(e){return g(t,void 0,void 0,(function(){var t,n;return w(this,(function(i){switch(i.label){case 0:return[4,y.c.ImportMeshAsync(null,e,void 0,this._scene,void 0,".glb")];case 1:return t=i.sent(),(n=t.meshes[0]).position.copyFrom(this.cursorPosition),n.material=this._defaultMaterial,this.selectObject(n),[2]}}))}))}))})),n.addItem("Box",(function(){t.addPrimitive("box",t.cursorPosition,d.Pq.Zero(),new d.Pq(1,1,1))})),n.addItem("Sphere",(function(){t.addPrimitive("sphere",t.cursorPosition,d.Pq.Zero(),new d.Pq(1,1,1))})),n.addItem("Cylinder",(function(){t.addPrimitive("cylinder",t.cursorPosition,d.Pq.Zero(),new d.Pq(1,1,1))})),n.addItem("Torus",(function(){t.addPrimitive("torus",t.cursorPosition,d.Pq.Zero(),new d.Pq(1,1,1))})),this._contextMenu.addSubmenu("Add Primitive",n),this._contextMenu.addItem("Generate object with AI",(function(){t._promptPopup.show("Generate Object",'Enter an object description such as "blue couch".',{x:t._scene.pointerX,y:t._scene.pointerY})})),this._engine=new o.N(this._canvas,!0),this._scene=new h.Z(this._engine),this._cursor=l.P.CreateSphere("cursor",{diameter:.1,segments:16},this._scene);var u=new r.F("cursorMaterial",this._scene);u.diffuseColor=new a.v9(0,1,0),u.specularColor=new a.v9(0,0,0),this._cursor.material=u,this._cursor.material.alpha=.5,this._cursor.isVisible=!1,this._defaultMaterial=new r.F("defaultMaterial",this._scene),this._defaultMaterial.diffuseColor=new a.v9(.8,.8,.8),this._defaultMaterial.specularColor=new a.v9(0,0,0),this._camera=new i.L("camera",Math.PI/2,Math.PI/2,10,new d.Pq(0,1.65,0),this._scene),this._camera.attachControl(this._canvas,!0),new s.g("light",new d.Pq(0,1,0),this._scene).intensity=.7,new c.H("pointLight",new d.Pq(0,10,0),this._scene).intensity=.7,this.gizmoManager=this._createGizmos(),this.ground=this._createGround(),this._engine.runRenderLoop((function(){t._scene.render()}))}return Object.defineProperty(e.prototype,"domElement",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),e.prototype._createGround=function(e,t){void 0===e&&(e=10),void 0===t&&(t=10),this.ground&&this.ground.dispose();var n=l.P.CreateGround("ground",{width:e,height:t},this._scene);return n.material=this._defaultMaterial,n},e.prototype._createGizmos=function(){var e=this;if(this.gizmoManager)throw new Error("Gizmo manager already created");M.addEventListener("keydown",(function(n){n.target instanceof HTMLInputElement||("Delete"===n.key?e._selectedMesh&&(t.attachToMesh(null),e._selectedMesh.dispose()):"e"===n.key&&e._selectedMesh!==e._cursor?e._selectedMesh&&(t.rotationGizmoEnabled=!0,t.positionGizmoEnabled=!1,t.scaleGizmoEnabled=!1,t.boundingBoxGizmoEnabled=!1):"w"===n.key?e._selectedMesh&&(t.positionGizmoEnabled=!0,t.rotationGizmoEnabled=!1,t.scaleGizmoEnabled=!1,t.boundingBoxGizmoEnabled=!1):"q"===n.key&&e._selectedMesh!==e._cursor?e._selectedMesh&&(t.positionGizmoEnabled=!0,t.rotationGizmoEnabled=!0,t.boundingBoxGizmoEnabled=!0,t.scaleGizmoEnabled=!1):"s"===n.key&&e._selectedMesh!==e._cursor?e._selectedMesh&&(t.positionGizmoEnabled=!1,t.rotationGizmoEnabled=!1,t.scaleGizmoEnabled=!0,t.boundingBoxGizmoEnabled=!1):"r"===n.key&&e._selectedMesh!==e._cursor?e._selectedMesh&&(t.boundingBoxGizmoEnabled=!0,t.positionGizmoEnabled=!1,t.rotationGizmoEnabled=!1,t.scaleGizmoEnabled=!1):"c"===n.key?e._placeCursor():"Escape"==n.key&&(e._contextMenu.isVisible()?e._contextMenu.hide():e.deselectAll()))})),this._scene.onPointerObservable.add((function(t){var n,i;2!==t.event.button?0===t.event.button&&(t.type===u.Zp.POINTERDOUBLETAP?(null===(n=t.pickInfo)||void 0===n?void 0:n.hit)&&t.pickInfo.pickedMesh?e.selectObject(t.pickInfo.pickedMesh):e.deselectAll():t.type===u.Zp.POINTERDOWN&&((null===(i=t.pickInfo)||void 0===i?void 0:i.hit)&&t.pickInfo.pickedMesh?t.pickInfo.pickedMesh!==e._selectedMesh&&e.deselectAll():e.deselectAll())):e._selectedMesh!==e._cursor&&e._placeCursor()}));var t=new m.u(this._scene);return t.usePointerToAttachGizmos=!1,t.gizmos.positionGizmo=new p.E,t.gizmos.rotationGizmo=new f.n,t.gizmos.scaleGizmo=new b.t,t.gizmos.boundingBoxGizmo=new _.c,t.positionGizmoEnabled=!1,t.rotationGizmoEnabled=!1,t.scaleGizmoEnabled=!1,t.boundingBoxGizmoEnabled=!1,t},e.prototype._placeCursor=function(){var e=this._scene.pick(this._scene.pointerX,this._scene.pointerY);e.hit&&e.pickedPoint&&(this.cursorPosition.copyFrom(e.pickedPoint),this._cursor.position.copyFrom(this.cursorPosition),this._cursor.isVisible=!0,this.selectObject(this._cursor))},e.prototype.selectObject=function(e){e!==this._cursor&&(this._cursor.isVisible=!1),e!==this._selectedMesh&&(this._selectedMesh=e,this.gizmoManager.positionGizmoEnabled=!0,this.gizmoManager.rotationGizmoEnabled=!1,this.gizmoManager.scaleGizmoEnabled=!1,this.gizmoManager.boundingBoxGizmoEnabled=!1,this.gizmoManager.attachToMesh(this._selectedMesh))},e.prototype.deselectAll=function(){this._selectedMesh=null,this.gizmoManager.attachToMesh(null),this.gizmoManager.positionGizmoEnabled=!1,this.gizmoManager.rotationGizmoEnabled=!1,this.gizmoManager.scaleGizmoEnabled=!1,this.gizmoManager.boundingBoxGizmoEnabled=!1,this._cursor.isVisible=!1,this._contextMenu.hide(),this._promptPopup.hide()},e.prototype.addPrimitive=function(e,t,n,i){var o;switch(e){case"box":o=l.P.CreateBox("box",{size:1},this._scene);break;case"sphere":o=l.P.CreateSphere("sphere",{diameter:1},this._scene);break;case"cylinder":o=l.P.CreateCylinder("cylinder",{diameterTop:1,diameterBottom:1,height:1},this._scene);break;case"torus":o=l.P.CreateTorus("torus",{diameter:1,thickness:.5},this._scene);break;default:throw new Error("Invalid primitive type")}o.position.copyFrom(t),o.rotation.copyFrom(n),o.scaling.copyFrom(i),o.material=this._defaultMaterial,this.selectObject(o)},e.prototype.fetchModelFromText=function(e){return g(this,void 0,void 0,(function(){var t;return w(this,(function(n){return t={prompt:e,format:"glb"},[2,new Promise((function(e,n){fetch("/api/txt2model/shape",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((function(t){t.blob().then((function(t){e(URL.createObjectURL(t))})).catch((function(e){n(e)}))})).catch((function(e){n(e)}))}))]}))}))},e.prototype.enableXR=function(){var e=this._scene.getMeshByName("floor");if(!e)throw new Error("Floor not found");this._scene.createDefaultXRExperienceAsync({floorMeshes:[e]})},e}()}}]);
//# sourceMappingURL=192.js.map