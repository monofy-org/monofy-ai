"use strict";(self.webpackChunkmonofy=self.webpackChunkmonofy||[]).push([[22],{22:(e,t,i)=>{i.r(t),i.d(t,{Viewer:()=>v});var n=i(3582),o=i(7699),s=i(1513),a=i(9859),r=i(6041),c=i(2746),d=i(9923),l=i(5487),h=i(7698),m=i(6240),u=i(660),p=i(8844),_=i(9537),b=(i(6982),i(6547)),f=i(2285),E=function(){function e(e,t){var i=this;this.container=e,this.attachedElement=t,this._submenus=[],this.domElement=document.createElement("div"),this.domElement.classList.add("context-menu"),e&&e.appendChild(this.domElement),t&&(this.hide(),t.addEventListener("contextmenu",(function(e){e.preventDefault(),i.show(e.clientX+10,e.clientY-5)})))}return e.prototype.isVisible=function(){return"none"!==this.domElement.style.display},e.prototype.addItem=function(e,t){var i=this,n=document.createElement("div");n.classList.add("context-menu-item"),n.textContent=e,n.addEventListener("click",(function(){t(),i.hide()})),this.domElement.appendChild(n)},e.prototype.addSubmenu=function(e,t){var i=this,n=document.createElement("div");n.classList.add("context-menu-item"),n.textContent=e,n.addEventListener("click",(function(e){t.show(i.domElement.offsetLeft+i.domElement.offsetWidth-5,n.offsetTop),e.target.classList.contains("context-menu-item")&&i.hide()})),t.domElement.classList.add("context-menu-submenu"),this._submenus.push(t),n.appendChild(t.domElement),this.domElement.appendChild(n)},e.prototype.show=function(e,t){this.container&&(this.domElement.style.left="".concat(e,"px"),this.domElement.style.top="".concat(t,"px"),this.domElement.style.display="block")},e.prototype.hide=function(){if(this.isVisible()&&this.container){this.domElement.style.display="none";for(var e=0;e<this._submenus.length;e++)this._submenus[e].hide()}},e}(),g=window,v=function(){function e(e){var t=this;this._selectedMesh=null,this.cursorPosition=d.Pq.Zero(),void 0===e?(this._canvas=document.createElement("canvas"),document.body.appendChild(this._canvas)):this._canvas=e,this._canvas.width=g.innerWidth,this._canvas.height=g.innerHeight,g.addEventListener("resize",(function(){t._canvas.width=g.innerWidth,t._canvas.height=g.innerHeight})),this._contextMenu=new E(document.body,this._canvas);var i=new E;i.addItem("Box",(function(){t.addPrimitive("box",t.cursorPosition,d.Pq.Zero(),new d.Pq(1,1,1))})),i.addItem("Sphere",(function(){t.addPrimitive("sphere",t.cursorPosition,d.Pq.Zero(),new d.Pq(1,1,1))})),i.addItem("Cylinder",(function(){t.addPrimitive("cylinder",t.cursorPosition,d.Pq.Zero(),new d.Pq(1,1,1))})),i.addItem("Torus",(function(){t.addPrimitive("torus",t.cursorPosition,d.Pq.Zero(),new d.Pq(1,1,1))})),this._contextMenu.addSubmenu("Add Primitive",i),this._engine=new o.N(this._canvas,!0),this._scene=new h.Z(this._engine),this._cursor=l.P.CreateSphere("cursor",{diameter:.1,segments:16},this._scene);var m=new a.F("cursorMaterial",this._scene);m.diffuseColor=new r.v9(0,1,0),m.specularColor=new r.v9(0,0,0),this._cursor.material=m,this._cursor.material.alpha=.5,this._cursor.isVisible=!1,this._defaultMaterial=new a.F("defaultMaterial",this._scene),this._defaultMaterial.diffuseColor=new r.v9(.8,.8,.8),this._defaultMaterial.specularColor=new r.v9(0,0,0),this._camera=new n.L("camera",Math.PI/2,Math.PI/2,10,new d.Pq(0,1.65,0),this._scene),this._camera.attachControl(this._canvas,!0),new s.g("light",new d.Pq(0,1,0),this._scene).intensity=.7,new c.H("pointLight",new d.Pq(0,10,0),this._scene).intensity=.7,this.gizmoManager=this._createGizmos(),this.ground=this._createGround(),this._engine.runRenderLoop((function(){t._scene.render()}))}return Object.defineProperty(e.prototype,"domElement",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),e.prototype._createGround=function(e,t){void 0===e&&(e=10),void 0===t&&(t=10),this.ground&&this.ground.dispose();var i=l.P.CreateGround("ground",{width:e,height:t},this._scene);return i.material=this._defaultMaterial,i},e.prototype._createGizmos=function(){var e=this;if(this.gizmoManager)throw new Error("Gizmo manager already created");g.addEventListener("keydown",(function(i){"Delete"===i.key?e._selectedMesh&&(t.attachToMesh(null),e._selectedMesh.dispose()):"e"===i.key&&e._selectedMesh!==e._cursor?e._selectedMesh&&(t.rotationGizmoEnabled=!0,t.positionGizmoEnabled=!1,t.scaleGizmoEnabled=!1,t.boundingBoxGizmoEnabled=!1):"w"===i.key?e._selectedMesh&&(t.positionGizmoEnabled=!0,t.rotationGizmoEnabled=!1,t.scaleGizmoEnabled=!1,t.boundingBoxGizmoEnabled=!1):"q"===i.key&&e._selectedMesh!==e._cursor?e._selectedMesh&&(t.positionGizmoEnabled=!0,t.rotationGizmoEnabled=!0,t.boundingBoxGizmoEnabled=!0,t.scaleGizmoEnabled=!1):"s"===i.key&&e._selectedMesh!==e._cursor?e._selectedMesh&&(t.positionGizmoEnabled=!1,t.rotationGizmoEnabled=!1,t.scaleGizmoEnabled=!0,t.boundingBoxGizmoEnabled=!1):"r"===i.key&&e._selectedMesh!==e._cursor?e._selectedMesh&&(t.boundingBoxGizmoEnabled=!0,t.positionGizmoEnabled=!1,t.rotationGizmoEnabled=!1,t.scaleGizmoEnabled=!1):"c"===i.key?e._placeCursor():"Escape"==i.key&&(e._contextMenu.isVisible()?e._contextMenu.hide():e.deselectAll())})),this._scene.onPointerObservable.add((function(t){var i,n;2!==t.event.button?0===t.event.button&&(t.type===m.Zp.POINTERDOUBLETAP?(null===(i=t.pickInfo)||void 0===i?void 0:i.hit)&&t.pickInfo.pickedMesh?e.selectObject(t.pickInfo.pickedMesh):e.deselectAll():t.type===m.Zp.POINTERDOWN&&((null===(n=t.pickInfo)||void 0===n?void 0:n.hit)&&t.pickInfo.pickedMesh?t.pickInfo.pickedMesh!==e._selectedMesh&&e.deselectAll():e.deselectAll())):e._selectedMesh!==e._cursor&&e._placeCursor()}));var t=new u.u(this._scene);return t.usePointerToAttachGizmos=!1,t.gizmos.positionGizmo=new p.E,t.gizmos.rotationGizmo=new _.n,t.gizmos.scaleGizmo=new b.t,t.gizmos.boundingBoxGizmo=new f.c,t.positionGizmoEnabled=!1,t.rotationGizmoEnabled=!1,t.scaleGizmoEnabled=!1,t.boundingBoxGizmoEnabled=!1,t},e.prototype._placeCursor=function(){var e=this._scene.pick(this._scene.pointerX,this._scene.pointerY);e.hit&&e.pickedPoint&&(this.cursorPosition.copyFrom(e.pickedPoint),this._cursor.position.copyFrom(this.cursorPosition),this._cursor.isVisible=!0,this.selectObject(this._cursor))},e.prototype.selectObject=function(e){e!==this._cursor&&(this._cursor.isVisible=!1),e!==this._selectedMesh&&(this._selectedMesh=e,this.gizmoManager.positionGizmoEnabled=!0,this.gizmoManager.rotationGizmoEnabled=!1,this.gizmoManager.scaleGizmoEnabled=!1,this.gizmoManager.boundingBoxGizmoEnabled=!1,this.gizmoManager.attachToMesh(this._selectedMesh))},e.prototype.deselectAll=function(){this._selectedMesh=null,this.gizmoManager.attachToMesh(null),this.gizmoManager.positionGizmoEnabled=!1,this.gizmoManager.rotationGizmoEnabled=!1,this.gizmoManager.scaleGizmoEnabled=!1,this.gizmoManager.boundingBoxGizmoEnabled=!1,this._cursor.isVisible=!1,this._contextMenu.hide()},e.prototype.addPrimitive=function(e,t,i,n){var o;switch(e){case"box":o=l.P.CreateBox("box",{size:1},this._scene);break;case"sphere":o=l.P.CreateSphere("sphere",{diameter:1},this._scene);break;case"cylinder":o=l.P.CreateCylinder("cylinder",{diameterTop:1,diameterBottom:1,height:1},this._scene);break;case"torus":o=l.P.CreateTorus("torus",{diameter:1,thickness:.5},this._scene);break;default:throw new Error("Invalid primitive type")}o.position.copyFrom(t),o.rotation.copyFrom(i),o.scaling.copyFrom(n),o.material=this._defaultMaterial,this.selectObject(o)},e.prototype.enableXR=function(){var e=this._scene.getMeshByName("floor");if(!e)throw new Error("Floor not found");this._scene.createDefaultXRExperienceAsync({floorMeshes:[e]})},e}()}}]);
//# sourceMappingURL=22.js.map