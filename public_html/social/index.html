<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #drop_zone {
            border: 2px dashed #bbb;
            -moz-border-radius: 5px;
            -webkit-border-radius: 5px;
            border-radius: 5px;
            padding: 25px;
            text-align: center;
            color: #bbb;
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover;
            width: 200px;
            height: 200px;
        }
    </style>
</head>

<body>
    <div id="drop_zone">Drop file here</div>
    <input type="file" id="file_input" accept="image/*" style="display: none;" />
    <img id="uploaded_image" src="" alt="Uploaded Image" style="display:none;">
    <input type="text" id="post_title" placeholder="Post Title">
    <textarea id="post_text" placeholder="Post Text"></textarea>
    <button id="submit_post">Submit</button>

    <div id="comments"></div>

    <script>
        var dropZone = document.getElementById('drop_zone');
        var postTitle = document.getElementById('post_title');
        var postText = document.getElementById('post_text');
        var submitPost = document.getElementById('submit_post');
        var commentsDiv = document.getElementById('comments');
        var fileInput = document.getElementById('file_input');
        var data = {};

        dropZone.ondrop = function (e) {
            e.preventDefault();
            var file = e.dataTransfer.files[0];
            var reader = new FileReader();
            reader.onloadend = function () {
                dropZone.style.backgroundImage = 'url(' + reader.result + ')';
            }
            reader.readAsDataURL(file);
        };

        dropZone.ondragover = function (e) {
            e.preventDefault();
        };

        dropZone.onclick = function () {
            fileInput.click();
        };

        fileInput.onchange = function (e) {
            var file = e.target.files[0];
            var reader = new FileReader();
            reader.onloadend = function () {
                dropZone.style.backgroundImage = 'url(' + reader.result + ')';
            }
            reader.readAsDataURL(file);
        };

        submitPost.onclick = function () {
            var xhr = new XMLHttpRequest();
            xhr.open('POST', '../api/social', true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onload = function () {
                if (xhr.status === 200) {
                    var response = JSON.parse(xhr.responseText);
                    var comments = response.comments;
                    function addComments(comments, parentDiv) {
                        comments.forEach(function (comment) {
                            var commentDiv = document.createElement('div');
                            commentDiv.textContent = comment.username + ': ' + comment.comment;
                            parentDiv.appendChild(commentDiv);
                            if (comment.comments && comment.comments.length > 0) {
                                addComments(comment.comments, commentDiv);
                            }
                        });
                    }
                    addComments(comments, commentsDiv);
                }
            };
            data = {
                title: postTitle.value,
                text: postText.value,
                image: uploadedImage.src.split(',')[1] // remove the base64 header
            };
            xhr.send(JSON.stringify(data))
        };


    </script>
</body>

</html>