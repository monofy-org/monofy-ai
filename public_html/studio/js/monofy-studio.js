var monofy;(()=>{"use strict";var t={};(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);var e=null;function n(){if(!e){var t=window.AudioContext||window.webkitAudioContext;e=new t,console.log("Audio context created");var n=e.createBuffer(1,1,e.sampleRate),o=e.createBufferSource();o.buffer=n,o.connect(e.destination),o.start(0)}return e}var o,r=["white","black","white","white","black","white","black","white","white","black","white","black"],i=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],a=function(){function t(){var t=this;this.buffer=null,this.domElement=document.createElement("div"),this.domElement.classList.add("audio-canvas"),this.canvas=document.createElement("canvas"),this.canvas.width=800,this.canvas.height=200,this.domElement.appendChild(this.canvas),this.canvas.addEventListener("click",(function(){t.buffer&&t.playBuffer(t.buffer)})),this.ctx=this.canvas.getContext("2d")}return t.prototype.generateAudio=function(t){return e=this,o=arguments,i=function(t,e){var o,r=this;return void 0===e&&(e=!1),function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&l[0]?o.return:l[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,l[1])).done)return r;switch(o=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,o=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){a.label=l[1];break}if(6===l[0]&&a.label<r[1]){a.label=r[1],r=l;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(l);break}r[2]&&a.ops.pop(),a.trys.pop();continue}l=e.call(t,a)}catch(t){l=[6,t],o=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}}(this,(function(i){switch(i.label){case 0:return[4,new Promise((function(o,i){var a={text:t.label,pitch:t.pitch,rate:.9};fetch("/api/tts/edge",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((function(t){return t.arrayBuffer()})).then((function(t){console.log("Audio buffer downloaded",t),n().decodeAudioData(t,(function(t){r.buffer=t,e&&r.playBuffer(t),o(t)}))})).catch((function(t){console.error("Error downloading audio buffer",t),i(t)}))}))];case 1:return o=i.sent(),this.loadBuffer(o),[2,o]}}))},new((r=void 0)||(r=Promise))((function(t,n){function a(t){try{s(i.next(t))}catch(t){n(t)}}function l(t){try{s(i.throw(t))}catch(t){n(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(a,l)}s((i=i.apply(e,o||[])).next())}));var e,o,r,i},t.prototype.playBuffer=function(t){var e=n(),o=e.createBufferSource();o.buffer=t,o.connect(e.destination),o.start()},t.prototype.loadBuffer=function(t){this.buffer=t;var e=t.getChannelData(0),n=e.length,o=this.canvas.width/n;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.moveTo(0,this.canvas.height/2);for(var r=0;r<n;r++){var i=r*o,a=(e[r]+1)*this.canvas.height/2;this.ctx.lineTo(i,a)}this.ctx.lineTo(this.canvas.width,this.canvas.height/2),this.ctx.stroke()},t}(),l=(o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},o(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=function(t){function e(){return t.call(this)||this}return l(e,t),e.prototype.generateAudio=function(t){return e=this,o=arguments,i=function(t,e){var o,r=this;return void 0===e&&(e=!1),function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&l[0]?o.return:l[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,l[1])).done)return r;switch(o=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,o=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){a.label=l[1];break}if(6===l[0]&&a.label<r[1]){a.label=r[1],r=l;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(l);break}r[2]&&a.ops.pop(),a.trys.pop();continue}l=e.call(t,a)}catch(t){l=[6,t],o=0}finally{n=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}}(this,(function(i){switch(i.label){case 0:return[4,new Promise((function(o,i){var a={text:t.label,pitch:t.pitch,rate:.9};fetch("/api/tts/edge",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((function(t){return t.arrayBuffer()})).then((function(t){console.log("Audio buffer downloaded",t),n().decodeAudioData(t,(function(t){r.buffer=t,e&&r.playBuffer(t),o(t)}))})).catch((function(t){console.error("Error downloading audio buffer",t),i(t)}))}))];case 1:return o=i.sent(),this.loadBuffer(o),[2,o]}}))},new((r=void 0)||(r=Promise))((function(t,n){function a(t){try{s(i.next(t))}catch(t){n(t)}}function l(t){try{s(i.throw(t))}catch(t){n(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(a,l)}s((i=i.apply(e,o||[])).next())}));var e,o,r,i},e}(a);const c=function(){function t(){this._events={},this._onceEvents={}}return t.prototype.on=function(t,e){return this._events[t]||(this._events[t]=[]),this._events[t].push(e),this},t.prototype.once=function(t,e){return this._onceEvents[t]||(this._onceEvents[t]=[]),this._onceEvents[t].push(e),this},t.prototype.fireEvent=function(t,e){var n=this._onceEvents[t];if(n){for(var o=0,r=n;o<r.length;o++){var i=r[o];try{i(e)}catch(e){console.error("Error executing .once callback for event: ".concat(t),e)}}this._onceEvents[t]=void 0}var a=this._events[t];if(a)for(var l=0,s=a;l<s.length;l++){i=s[l];try{i(e)}catch(e){console.error("Error executing .on callback for event: ".concat(t),e)}}},t}();var d=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=function(t){function e(e,n){void 0===e&&(e="OK"),void 0===n&&(n="Cancel");var o=t.call(this)||this;return o.ok=e,o.cancel=n,o.domElement=document.createElement("div"),o.domElement.classList.add("dialog-popup"),o.closeButton=document.createElement("button"),o.closeButton.textContent="X",o.domElement.appendChild(o.closeButton),o.closeButton.addEventListener("click",(function(){o.domElement.style.display="none"})),e instanceof HTMLButtonElement?o.okButton=e:e&&(o.okButton=document.createElement("button"),o.okButton.textContent=e,o.domElement.appendChild(o.okButton)),o.okButton&&o.okButton.addEventListener("click",(function(){o.fireEvent("result",o)})),n instanceof HTMLButtonElement?o.cancelButton=n:n&&(o.cancelButton=document.createElement("button"),o.cancelButton.textContent=n,o.domElement.appendChild(o.cancelButton)),o.cancelButton&&o.cancelButton.addEventListener("click",(function(){o.fireEvent("cancel",o)})),o}return d(e,t),Object.defineProperty(e.prototype,"isVisibile",{get:function(){return"none"!==this.domElement.style.display},enumerable:!1,configurable:!0}),e.prototype.show=function(t,e,n){var o;this.domElement.style.display="block",this.domElement.style.left="".concat(t,"px"),this.domElement.style.top="".concat(e,"px"),null===(o=this.domElement.parentElement)||void 0===o||o.appendChild(this.domElement)},e.prototype.hide=function(){this.domElement.style.display="none"},e}(c),p=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=function(t){function e(e){var n=t.call(this,e)||this;return n.domElement.classList.add("piano-roll-note-editor"),n.domElement.style.display="none",n.textInput=document.createElement("input"),n.textInput.setAttribute("placeholder","Note lyric"),n.textInput.classList.add("lyric-editor-text"),n.textInput.type="text",n.domElement.appendChild(n.textInput),n.pitchSlider=document.createElement("input"),n.pitchSlider.classList.add("lyric-editor-pitch"),n.pitchSlider.type="range",n.pitchSlider.min="-0.5",n.pitchSlider.max="0.5",n.pitchSlider.step="0.01",n.pitchSlider.value="0",n.pitchSlider.addEventListener("input",(function(){n.note.pitch=parseFloat(n.pitchSlider.value)})),n.domElement.appendChild(n.pitchSlider),n.audioCanvas=new s,n.domElement.appendChild(n.audioCanvas.domElement),n.saveButton.addEventListener("click",(function(){n.audioCanvas.domElement.style.display="block",n.audioCanvas.generateAudio(n.note,!0).then((function(t){n.note.audio=t})),n.onsave(n.note)})),n}return p(e,t),e.prototype.show=function(e,n,o){var r,i;t.prototype.show.call(this,e,n,o),this.textInput.value=(null===(r=this.note)||void 0===r?void 0:r.label)||"",(null===(i=this.note)||void 0===i?void 0:i.audio)?(this.audioCanvas.loadBuffer(this.note.audio),this.audioCanvas.domElement.style.display="block"):this.audioCanvas.domElement.style.display="none"},e}(function(t){function e(e){var n=t.call(this)||this;return n.onsave=e,n.note=null,n.domElement=document.createElement("div"),n.domElement.classList.add("piano-roll-dialog"),n.closeButton=document.createElement("button"),n.closeButton.textContent="X",n.domElement.appendChild(n.closeButton),n.closeButton.addEventListener("click",(function(){n.domElement.style.display="none"})),n.saveButton=document.createElement("button"),n.saveButton.textContent="Save",n.domElement.appendChild(n.saveButton),n.saveButton.addEventListener("click",(function(){n.onsave(n.note)})),n}return p(e,t),e.prototype.show=function(e,n,o){var r;t.prototype.show.call(this,e,n,o),this.note=o,null===(r=this.domElement.parentElement)||void 0===r||r.appendChild(this.domElement)},e}(u));function m(t){return"".concat(i[t%i.length]).concat(Math.floor(t/i.length))}var f=function(){function t(t,e){this.grid=t,this.label="",this.audio=null,this.pitch=e.pitch,this.start=e.start,this.end=e.end,this.domElement=document.createElement("div"),this.domElement.classList.add("piano-roll-note"),this.domElement.style.height="".concat(t.noteHeight,"px"),this.noteLabel=document.createElement("div"),this.noteLabel.classList.add("piano-roll-note-label"),this.noteLabel.textContent=m(this.pitch),this.domElement.appendChild(this.noteLabel),this.lyricLabel=document.createElement("div"),this.lyricLabel.classList.add("piano-roll-note-lyric"),this.domElement.appendChild(this.lyricLabel),e.label&&(this.lyricLabel.textContent=e.label),this.update(),t.domElement.appendChild(this.domElement)}return t.prototype.update=function(){this.noteLabel.textContent=m(this.pitch),this.lyricLabel.textContent=this.label,this.domElement.style.top="".concat((87-this.pitch)*this.grid.noteHeight,"px"),this.domElement.style.left="".concat(this.start*this.grid.beatWidth,"px"),this.domElement.style.width="".concat(100*(this.end-this.start),"px")},t}(),y=function(){function t(){var t=this;this.notes=[],this.currentNote=null,this.noteHeight=20,this.beatWidth=100,this.dragMode=null,this.quantize=.25,this.dragOffset=0,this.domElement=document.createElement("div"),this.domElement.classList.add("piano-roll-grid-container"),this.gridElement=document.createElement("div"),this.gridElement.classList.add("piano-roll-grid");var e=document.createElement("canvas");e.width=4*this.beatWidth,e.height=this.noteHeight,console.log("debug",e.width,e.height);var n=e.getContext("2d");if(n){n.strokeStyle="#ddd",n.lineWidth=1;for(var o=1;o<4;o++)n.beginPath(),n.moveTo(o*this.beatWidth,0),n.lineTo(o*this.beatWidth,this.noteHeight),n.stroke();n.lineWidth=3,n.strokeStyle="#aaa",n.beginPath(),n.moveTo(0,0),n.lineTo(0,this.noteHeight),n.stroke()}for(var r=0;r<88;r++){var i=document.createElement("div");i.classList.add("piano-roll-grid-row"),i.style.height="".concat(this.noteHeight,"px"),this.gridElement.appendChild(i),i.style.backgroundImage="url(".concat(e.toDataURL(),")"),i.style.backgroundRepeat="repeat"}this.domElement.appendChild(this.gridElement),this.noteEditor=new h((function(e){var n=t.noteEditor.domElement.querySelector(".lyric-editor-text");e.label=(null==n?void 0:n.value)||"",e.update()})),document.body.appendChild(this.noteEditor.domElement),this.gridElement.addEventListener("pointerdown",(function(e){var n,o=e.layerX;if(t.dragOffset=o,e.preventDefault(),"block"!==t.noteEditor.domElement.style.display)if(e.target instanceof HTMLDivElement&&e.target.classList.contains("piano-roll-note")){t.gridElement.classList.add("dragging");var r=t.notes.find((function(t){return t.domElement===e.target}));(e.ctrlKey||1===e.button)&&(r?t.noteEditor.show(e.clientX+20,e.clientY-5,r):t.noteEditor.domElement.style.display="none"),r&&(t.currentNote=r,2===e.button?(t.remove(r),t.currentNote=null):(null===(n=t.currentNote.domElement.parentElement)||void 0===n||n.appendChild(t.currentNote.domElement),o<6?t.dragMode="start":t.currentNote.domElement.offsetWidth-o<6?t.dragMode="end":t.dragMode="move",console.log("drag mode",t.dragMode,o,t.currentNote.domElement.offsetWidth)))}else{if(0!==e.button)return;if(e.target===t.gridElement){t.gridElement.classList.add("dragging");var i=87-Math.floor(e.layerY/t.noteHeight),a=e.layerX/t.beatWidth;a=Math.round(a/t.quantize)*t.quantize,t.currentNote=new f(t,{pitch:i,start:a,end:(e.layerX+.125)/t.beatWidth,label:""}),t.add(t.currentNote),t.dragMode="end"}}else t.noteEditor.domElement.style.display="none"})),this.gridElement.addEventListener("pointerup",(function(){t.gridElement.classList.remove("dragging"),t.currentNote=null})),this.gridElement.addEventListener("pointerleave",(function(){t.gridElement.classList.remove("dragging"),t.currentNote&&(t.remove(t.currentNote),t.currentNote=null)})),this.gridElement.addEventListener("contextmenu",(function(t){t.preventDefault()})),this.gridElement.addEventListener("pointermove",(function(e){t.currentNote&&1===e.buttons&&("start"===t.dragMode?(t.currentNote.start=e.layerX/t.beatWidth,t.currentNote.start=Math.round(t.currentNote.start/t.quantize)*t.quantize,t.currentNote.domElement.style.left="".concat(t.currentNote.start*t.beatWidth,"px"),t.currentNote.domElement.style.width="".concat((t.currentNote.end-t.currentNote.start)*t.beatWidth,"px")):"end"===t.dragMode?(t.currentNote.end=e.layerX/t.beatWidth,t.currentNote.end=Math.round(t.currentNote.end/t.quantize)*t.quantize,t.currentNote.domElement.style.width="".concat((t.currentNote.end-t.currentNote.start)*t.beatWidth,"px")):"move"===t.dragMode&&(t.currentNote.start=(e.layerX-t.dragOffset)/t.beatWidth,t.currentNote.start=Math.round(t.currentNote.start/t.quantize)*t.quantize,t.currentNote.domElement.style.left="".concat(t.currentNote.start*t.beatWidth,"px")))})),this.gridElement.addEventListener("pointerup",(function(){t.gridElement.classList.remove("dragging"),t.currentNote&&(t.currentNote.domElement.style.pointerEvents="auto"),t.currentNote=null})),this.gridElement.addEventListener("pointerleave",(function(){t.gridElement.classList.remove("dragging"),t.currentNote&&(t.currentNote.domElement.style.pointerEvents="auto"),t.currentNote=null})),this.update()}return t.prototype.update=function(){this.notes.forEach((function(t){return t.update()}))},t.prototype.add=function(t){this.notes.push(t),this.gridElement.appendChild(t.domElement)},t.prototype.remove=function(t){this.notes=this.notes.filter((function(e){return e!==t})),this.gridElement.removeChild(t.domElement)},t.prototype.loadEvents=function(t){var e=this;this.notes=t.map((function(t){return new f(e,t)})),this.notes.forEach((function(t){return e.gridElement.appendChild(t.domElement)}))},t.prototype.createPreviewImage=function(){var t=this,e=document.createElement("canvas");e.width=4*this.beatWidth,e.height=88*this.noteHeight;var n=e.getContext("2d");return n&&(n.fillStyle="#fff",n.fillRect(0,0,e.width,e.height),this.notes.forEach((function(e){n.fillStyle="#000",n.fillRect(e.start*t.beatWidth,(87-e.pitch)*t.noteHeight,(e.end-e.start)*t.beatWidth,t.noteHeight)}))),e},t}(),v=function(){function t(){this.keys=[],this.noteHeight=20,this.domElement=document.createElement("div"),this.domElement.classList.add("piano-roll-keyboard"),this.redraw()}return t.prototype.redraw=function(){this.domElement.innerHTML="";for(var t=87;t>=0;t--){var e=document.createElement("div");e.classList.add("piano-roll-keyboard-key"),e.style.height="".concat(this.noteHeight,"px"),e.style.backgroundColor="white"===r[t%12]?"#fff":"#000",e.style.color="white"===r[t%12]?"#000":"#fff",e.textContent=i[t%12]+(t/12|0).toString(),this.domElement.appendChild(e)}},t}(),E=function(){function t(t){var e=this;this.clock=t,this.cursorUpdateInterval=null,this.scheduledSources=[],this.domElement=document.createElement("div"),this.domElement.classList.add("piano-roll"),this.sideKeyboard=new v,this.domElement.appendChild(this.sideKeyboard.domElement),this.grid=new y,this.domElement.appendChild(this.grid.domElement),this.cursor=document.createElement("div"),this.cursor.classList.add("piano-roll-cursor"),this.grid.domElement.appendChild(this.cursor),t.on("start",(function(){var t;e.cursorUpdateInterval&&clearInterval(e.cursorUpdateInterval),e.cursor.style.transform="translateX(0)",e.cursor.style.display="block",null===(t=e.cursor.parentElement)||void 0===t||t.appendChild(e.cursor),e.scheduleAudioEvents()})),t.on("update",(function(){e.updateCursor()})),t.on("stop",(function(){e.cursor.style.display="none",e.scheduledSources.forEach((function(t){return t.stop()})),e.scheduledSources=[]}))}return t.prototype.updateCursor=function(){this.clock.isPlaying&&(this.cursor.style.transform="translateX(".concat(this.clock.currentBeat*this.grid.beatWidth,"px)"))},t.prototype.scheduleAudioEvents=function(){var t=this,e=n();this.grid.notes.forEach((function(n){var o=e.createBufferSource();o.buffer=n.audio,o.connect(e.destination),o.start(e.currentTime+60*n.start/t.clock.bpm),t.scheduledSources.push(o)}))},t.prototype.loadEvents=function(t){this.grid.loadEvents(t)},t}(),g=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=function(t){function e(){var e=t.call(this)||this;return e._isPlaying=!1,e._bpm=100,e.startTime=null,e.domElement=document.createElement("div"),e.domElement.classList.add("audio-clock"),e.bpmInput=document.createElement("input"),e.bpmInput.classList.add("audio-clock-bpm"),e.bpmInput.type="number",e.bpmInput.value="120",e.bpmInput.addEventListener("input",(function(){e._bpm=parseFloat(e.bpmInput.value)})),e.domElement.appendChild(e.bpmInput),e.playPauseButton=document.createElement("button"),e.playPauseButton.classList.add("audio-clock-play-pause"),e.playPauseButton.textContent="Play",e.playPauseButton.addEventListener("click",(function(){e._isPlaying?e.stop():(n(),e.play())})),e.domElement.appendChild(e.playPauseButton),e.stopButton=document.createElement("button"),e.stopButton.classList.add("audio-clock-stop"),e.stopButton.textContent="Stop",e.stopButton.addEventListener("click",(function(){e.stop()})),e.domElement.appendChild(e.stopButton),e.currentTimeDisplay=document.createElement("span"),e.currentTimeDisplay.classList.add("audio-clock-time"),e.currentTimeDisplay.textContent="01:1",e.domElement.appendChild(e.currentTimeDisplay),e}return g(e,t),Object.defineProperty(e.prototype,"currentBeat",{get:function(){return(null!==this.startTime?n().currentTime-this.startTime:0)*(this._bpm/60)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return this._isPlaying},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bpm",{get:function(){return this._bpm},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.fireEvent("start"),this.startTime=n().currentTime,console.log("Started at",this.startTime),requestAnimationFrame(this.render.bind(this))},e.prototype.render=function(){this.updateCurrentTimeDisplay(this.currentBeat),this.fireEvent("update"),this._isPlaying&&requestAnimationFrame(this.render.bind(this))},e.prototype.stop=function(){this.fireEvent("stop"),this._isPlaying=!1,this.startTime=null,this.updateCurrentTimeDisplay(this.currentBeat),this.playPauseButton.textContent="Play"},e.prototype.play=function(){this._isPlaying?this.stop():this.start(),this._isPlaying=!this._isPlaying,this.playPauseButton.textContent=this._isPlaying?"Pause":"Play"},e.prototype.updateCurrentTimeDisplay=function(t){var e=Math.floor(t/4)+1,n=Math.floor(t%4)+1,o="".concat(e.toString().padStart(2,"0"),":").concat(n.toString());this.currentTimeDisplay.textContent=o},e}(c),_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),w=function(t){function e(e,n){var o=t.call(this)||this;return console.log("BaseElement constructor"),o.domElement=document.createElement(e),n&&o.domElement.classList.add(n),o}return _(e,t),e}(c),C=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),x=function(t){function e(e,n){var o=t.call(this,e,n)||this;o._resizing=!1,o._startX=0,o._startY=0,o._startWidth=0,o._startHeight=0,o._startTop=0,o._startLeft=0,o._resizeDirection=null,o.domElement.addEventListener("pointermove",(function(t){var e=o.getCurrentHandle(t);o.domElement.style.cursor="top"===e||"bottom"===e?"ns-resize":"left"===e||"right"===e?"ew-resize":"auto"}));var r=function(t){if(o._resizing){console.log(o._resizeDirection);var e=t.clientX-o._startX,n=t.clientY-o._startY;"right"===o._resizeDirection?o.domElement.style.width="".concat(o._startWidth+e,"px"):"bottom"===o._resizeDirection?o.domElement.style.height="".concat(o._startHeight+n,"px"):"left"===o._resizeDirection?(o.domElement.style.width="".concat(o._startWidth-e,"px"),o.domElement.style.left="".concat(o._startLeft+e,"px")):"top"===o._resizeDirection&&(o.domElement.style.height="".concat(o._startHeight-n,"px"),o.domElement.style.top="".concat(o._startTop+n,"px")),o.fireEvent("resize",{width:o.domElement.offsetWidth,height:o.domElement.offsetHeight})}};return o.domElement.addEventListener("pointerdown",(function(t){t.preventDefault();var e=o.getCurrentHandle(t);e&&(window.addEventListener("pointermove",r),o.startResize(t,e));var n=function(){o.stopResize(),window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",n)};window.addEventListener("pointerup",n)})),o}return C(e,t),e.prototype.startResize=function(t,e){console.log("startResize",e),this._resizing=!0,this._startX=t.clientX,this._startY=t.clientY,this._startWidth=this.domElement.offsetWidth,this._startHeight=this.domElement.offsetHeight,this._startTop=this.domElement.offsetTop,this._startLeft=this.domElement.offsetLeft,this._resizeDirection=e},e.prototype.stopResize=function(){console.log("stopResize"),this._resizing=!1,this._resizeDirection=null},e.prototype.getCurrentHandle=function(t){var e=this.domElement.getBoundingClientRect(),n=t.clientX-e.left,o=t.clientY-e.top;return n>0&&n<10?"left":e.width-n<10?"right":o>0&&o<10?"top":e.height-o<10?"bottom":null},e}(w),L=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),k=function(t){function e(e,n,o){void 0===n&&(n=!1);var r=t.call(this,"div","draggable-window")||this;return r.persistent=n,r.innerContent=o,r._isDragging=!1,r._dragOffsetX=0,r._dragOffsetY=0,r._top=0,r._left=0,r.domElement.addEventListener("pointerdown",(function(){r.domElement.parentElement.appendChild(r.domElement)})),r.titlebar=document.createElement("div"),r.titlebar.className="window-titlebar",r.domElement.appendChild(r.titlebar),r.titlebar.addEventListener("pointerdown",(function(t){r._isDragging=!0,r._dragOffsetX=t.clientX-r.domElement.getBoundingClientRect().left,r._dragOffsetY=t.clientY-r.domElement.getBoundingClientRect().top+r.domElement.parentElement.getBoundingClientRect().top+r.domElement.parentElement.scrollTop;var e=function(t){if(r._isDragging){console.log("Dragging");var e=t.clientY-r._dragOffsetY,n=t.clientX-r._dragOffsetX;e<0&&(e=0),n<0&&(n=0),r.domElement.style.top="".concat(e,"px"),r.domElement.style.left="".concat(n,"px"),r._top=e,r._left=n}},n=function(){r._isDragging=!1,document.body.removeEventListener("pointermove",e),document.body.removeEventListener("pointerup",n)};document.body.addEventListener("pointermove",e),document.body.addEventListener("pointerup",n)})),r._title=document.createElement("div"),r._title.className="title",r._title.textContent=e,r.titlebar.appendChild(r._title),r.content=document.createElement("div"),r.content.className="window-content",r.domElement.appendChild(r.content),r._closeButton=document.createElement("button"),r._closeButton.className="window-close-button",r._closeButton.innerHTML="X",r._closeButton.addEventListener("click",r.close.bind(r)),r.titlebar.appendChild(r._closeButton),r.content.appendChild(r.innerContent),r}return L(e,t),Object.defineProperty(e.prototype,"isVisible",{get:function(){return"none"!==this.domElement.style.display},enumerable:!1,configurable:!0}),e.prototype.show=function(t,e){this.domElement.style.display="flex",this.domElement.style.top="".concat(e,"px"),this.domElement.style.left="".concat(t,"px"),this.fireEvent("open")},e.prototype.close=function(){this.domElement.style.display="none",this.fireEvent("close"),this.persistent||this.domElement.remove()},e.prototype.setSize=function(t,e){this.domElement.style.width="".concat(t,"px"),this.domElement.style.height="".concat(e,"px")},e.prototype.setPosition=function(t,e){this.domElement.style.top="".concat(e,"px"),this.domElement.style.left="".concat(t,"px")},e}(x),O=function(){function t(){this.windows=[],this._draggingWindow=null,this.domElement=document.createElement("div"),this.domElement.className="window-container",this.domElement.addEventListener("pointerdown",(function(){}))}return t.prototype.addWindow=function(t){this.windows.push(t),this.domElement.appendChild(t.domElement)},t}(),B=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),P=function(t){function e(e,n){var o=t.call(this,"div","pattern-track")||this;o.pattern=n;var r=document.createElement("div");r.classList.add("pattern-track-panel");var i=document.createElement("div");r.appendChild(i),i.textContent=e;var a=document.createElement("div");a.classList.add("pattern-track-buttons"),r.appendChild(a);var l=document.createElement("button");l.textContent="M",a.appendChild(l);var s=document.createElement("button");s.textContent="S",a.appendChild(s);var c=document.createElement("div");c.classList.add("pattern-track-indicator"),a.appendChild(c),a.appendChild(l),a.appendChild(s);var d=document.createElement("div");return d.classList.add("pattern-track-pattern"),o.domElement.appendChild(r),o.domElement.appendChild(c),o.domElement.appendChild(d),o}return B(e,t),e}(w),T=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),S=function(t){function e(e){var n=this,o=document.createElement("div");return o.classList.add("pattern-track-container"),(n=t.call(this,"Pattern",!0,o)||this).composition=e,n.tracks=[],n._trackContainer=o,n.setSize(800,400),n.show(100,100),n}return T(e,t),e.prototype.addTrack=function(t,e){void 0===e&&(e=[]);var n=new P(t,e);this.tracks.push(n),this._trackContainer.appendChild(n.domElement)},e.prototype.removeTrack=function(t){var e=this.tracks.indexOf(t);-1!==e&&(this.tracks.splice(e,1),this._trackContainer.removeChild(t.domElement))},e}(k),N=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),j=function(t){function e(e){var n=t.call(this,"div","playlist-track")||this,o=document.createElement("div");o.classList.add("instrument-panel");var r=document.createElement("div");o.appendChild(r),r.textContent=e;var i=document.createElement("div");i.classList.add("playlist-track-selector"),o.appendChild(i);var a=document.createElement("button");a.textContent="M",i.appendChild(a);var l=document.createElement("button");l.textContent="S",i.appendChild(l);var s=document.createElement("div");return s.classList.add("pattern-panel"),n.domElement.appendChild(o),n.domElement.appendChild(s),n}return N(e,t),e}(w),z=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),W=function(t){function e(e){var n=this,o=document.createElement("div");return o.classList.add("playlist-track-container"),(n=t.call(this,"Playlist",!0,o)||this).composition=e,n._tracks=[],n._trackContainer=o,n.setSize(800,400),n.show(100,100),n}return z(e,t),e.prototype.addTrack=function(t){var e=new j(t);this._tracks.push(e),this._trackContainer.appendChild(e.domElement)},e}(k),D=document.createElement("div");D.style.display="flex",D.style.flexDirection="column",D.style.width="100%",D.style.height="100%";var A=new b;D.appendChild(A.domElement);var H=new O;D.appendChild(H.domElement);var M=new function(){this.patterns=[[]],this.title="Untitled",this.description="No description",this.tempo=120},X=new k("Piano Roll",!0,new E(A).domElement);H.addWindow(X),X.setSize(800,400);var I=new S(M);I.addTrack("Kick"),I.addTrack("Snare"),I.addTrack("Hats"),I.addTrack("Bass"),I.addTrack("Lead"),I.show(100,100),H.addWindow(I);for(var R=new W(M),Y=1;Y<=9;Y++)R.addTrack("Track ".concat(Y));H.addWindow(R),R.show(600,100),X.show(300,300),document.body.appendChild(D),monofy=t})();
//# sourceMappingURL=monofy-studio.js.map