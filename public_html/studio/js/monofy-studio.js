var monofy;(()=>{"use strict";var t={};(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);const e=function(){function t(){this._events={},this._onceEvents={}}return t.prototype.on=function(t,e){return this._events[t]||(this._events[t]=[]),this._events[t].push(e),this},t.prototype.once=function(t,e){return this._onceEvents[t]||(this._onceEvents[t]=[]),this._onceEvents[t].push(e),this},t.prototype.emit=function(t,e){var n=this._onceEvents[t];if(n){for(var o=0,r=n;o<r.length;o++){var i=r[o];try{i(e)}catch(e){console.error("Error executing .once callback for event: ".concat(t),e)}}this._onceEvents[t]=void 0}var a=this._events[t];if(a)for(var c=0,s=a;c<s.length;c++){i=s[c];try{i(e)}catch(e){console.error("Error executing .on callback for event: ".concat(t),e)}}},t}();var n=null,o=window.AudioContext||window.webkitAudioContext;function r(){return n||(n=new o({latencyHint:"interactive",sampleRate:44100}),function(){return t=this,e=void 0,r=function(){return function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(t){switch(t.label){case 0:return"setSinkId"in o.prototype?[4,navigator.mediaDevices.enumerateDevices()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,null]}}))},new((n=void 0)||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function c(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}));var t,e,n,r}().then((function(t){console.log("Audio devices",t)})),console.log("Audio context created"),n)}var i,a=(i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),c=function(t){function e(){var e=t.call(this)||this;return e._bpm=100,e._scheduledEvents=[],e._startTime=null,e.domElement=document.createElement("div"),e.domElement.classList.add("audio-clock"),e.playPauseButton=document.createElement("button"),e.playPauseButton.classList.add("audio-clock-play-pause"),e.playPauseButton.textContent="Play",e.playPauseButton.addEventListener("click",(function(){e.isPlaying?e.stop():(r(),e.playPause())})),e.domElement.appendChild(e.playPauseButton),e.stopButton=document.createElement("button"),e.stopButton.classList.add("audio-clock-stop"),e.stopButton.textContent="Stop",e.stopButton.addEventListener("click",(function(){e.stop()})),e.domElement.appendChild(e.stopButton),e.bpmInput=document.createElement("input"),e.bpmInput.classList.add("audio-clock-bpm"),e.bpmInput.type="number",e.bpmInput.value="120",e.bpmInput.addEventListener("input",(function(){e._bpm=parseFloat(e.bpmInput.value)})),e.domElement.appendChild(e.bpmInput),e.currentTimeDisplay=document.createElement("span"),e.currentTimeDisplay.classList.add("audio-clock-time"),e.currentTimeDisplay.textContent="01:1",e.domElement.appendChild(e.currentTimeDisplay),e}return a(e,t),Object.defineProperty(e.prototype,"startTime",{get:function(){return this._startTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentBeat",{get:function(){return(null!==this._startTime?r().currentTime-this._startTime:0)*(this._bpm/60)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPlaying",{get:function(){return null!=this._startTime&&this._startTime>=0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bpm",{get:function(){return this._bpm},enumerable:!1,configurable:!0}),e.prototype.start=function(){this._startTime=r().currentTime,console.log("Started at",this._startTime),requestAnimationFrame(this._render.bind(this)),this.emit("start")},e.prototype._render=function(){this._update(this.currentBeat),this.emit("update"),this.isPlaying&&requestAnimationFrame(this._render.bind(this))},e.prototype.stop=function(){this.emit("stop"),this._startTime=null;for(var t=0,e=this._scheduledEvents;t<e.length;t++){var n=e[t].source;n.stop(),n.disconnect()}this._scheduledEvents=[],this._update(this.currentBeat),this.playPauseButton.textContent="Play"},e.prototype.restart=function(){this.isPlaying&&(this._startTime=r().currentTime)},e.prototype.playPause=function(){if(this.isPlaying)this.stop();else{var t=r(),e=t.createBuffer(1,1,t.sampleRate),n=t.createBufferSource();n.buffer=e,n.connect(t.destination),n.start(),this.start()}this.playPauseButton.textContent=this.isPlaying?"Pause":"Play"},e.prototype._update=function(t){var e=Math.floor(t/4)+1,n=Math.floor(t%4)+1,o="".concat(e.toString().padStart(2,"0"),":").concat(n.toString());this.currentTimeDisplay.textContent=o},e.prototype.scheduleEventAtTime=function(t,e){var n=r(),o=n.createBuffer(1,1,n.sampleRate),i=n.createBufferSource();i.buffer=o,i.connect(n.destination),i.onended=function(){return t()},i.start(e),this._scheduledEvents.push({source:i,time:e,callback:t})},e.prototype.scheduleEventAtBeat=function(t,e){var n=this._startTime+e/this._bpm*60;this.scheduleEventAtTime(t,n)},e}(e),s=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=function(t){function e(e,n){var o=t.call(this)||this;return o.domElement=document.createElement(e),n&&o.domElement.classList.add(n),o}return s(e,t),e.prototype.appendChild=function(t){return this.domElement.appendChild(t.domElement),this},e.prototype.removeChild=function(t){return this.domElement.removeChild(t.domElement),this},e}(e),u=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=function(t){function e(e,n){var o=t.call(this,e,n)||this;o._resizing=!1,o._startX=0,o._startY=0,o._startWidth=0,o._startHeight=0,o._startTop=0,o._startLeft=0,o._resizeDirection=null,o.domElement.addEventListener("pointermove",(function(t){var e=o.getCurrentHandle(t);o.domElement.style.cursor="top"===e||"bottom"===e?"ns-resize":"left"===e||"right"===e?"ew-resize":"auto"}));var r=function(t){if(o._resizing){console.log(o._resizeDirection);var e=t.clientX-o._startX,n=t.clientY-o._startY;"right"===o._resizeDirection?o.domElement.style.width="".concat(o._startWidth+e,"px"):"bottom"===o._resizeDirection?o.domElement.style.height="".concat(o._startHeight+n,"px"):"left"===o._resizeDirection?(o.domElement.style.width="".concat(o._startWidth-e,"px"),o.domElement.style.left="".concat(o._startLeft+e,"px")):"top"===o._resizeDirection&&(o.domElement.style.height="".concat(o._startHeight-n,"px"),o.domElement.style.top="".concat(o._startTop+n,"px")),o.emit("resize",{width:o.domElement.offsetWidth,height:o.domElement.offsetHeight})}};return o.domElement.addEventListener("pointerdown",(function(t){t.preventDefault();var e=o.getCurrentHandle(t);e&&(window.addEventListener("pointermove",r),o.startResize(t,e));var n=function(){o.stopResize(),window.removeEventListener("pointermove",r),window.removeEventListener("pointerup",n)};window.addEventListener("pointerup",n)})),o}return u(e,t),e.prototype.startResize=function(t,e){console.log("startResize",e),this._resizing=!0,this._startX=t.clientX,this._startY=t.clientY,this._startWidth=this.domElement.offsetWidth,this._startHeight=this.domElement.offsetHeight,this._startTop=this.domElement.offsetTop,this._startLeft=this.domElement.offsetLeft,this._resizeDirection=e},e.prototype.stopResize=function(){this._resizing=!1,this._resizeDirection=null},e.prototype.getCurrentHandle=function(t){var e=this.domElement.getBoundingClientRect(),n=t.clientX-e.left,o=t.clientY-e.top;return n>0&&n<10?"left":e.width-n<10?"right":o>0&&o<10?"top":e.height-o<10?"bottom":null},e}(l),p=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=function(t){function e(e){var n=t.call(this,"div","draggable-window")||this;n._isDragging=!1,n._dragOffsetX=0,n._dragOffsetY=0,n._top=0,n._left=0,n.persistent=e.persistent||!1,n.domElement.addEventListener("pointerdown",(function(){n.domElement.parentElement.appendChild(n.domElement)})),n.titlebar=document.createElement("div"),n.titlebar.className="window-titlebar",n.domElement.appendChild(n.titlebar),n.titlebar.addEventListener("pointerdown",(function(t){n._isDragging=!0,n._dragOffsetX=t.clientX-n.domElement.getBoundingClientRect().left,n._dragOffsetY=t.clientY-n.domElement.getBoundingClientRect().top+n.domElement.parentElement.getBoundingClientRect().top+n.domElement.parentElement.scrollTop;var e=function(t){if(n._isDragging){console.log("Dragging");var e=t.clientY-n._dragOffsetY,o=t.clientX-n._dragOffsetX;e<0&&(e=0),o<0&&(o=0),n.domElement.style.top="".concat(e,"px"),n.domElement.style.left="".concat(o,"px"),n._top=e,n._left=o}},o=function(){n._isDragging=!1,document.body.removeEventListener("pointermove",e),document.body.removeEventListener("pointerup",o)};document.body.addEventListener("pointermove",e),document.body.addEventListener("pointerup",o)})),n._title=document.createElement("div"),n._title.className="window-titlebar-title",n._title.textContent=e.title,n.titlebar.appendChild(n._title),n.content=document.createElement("div"),n.content.className="window-content",n.domElement.appendChild(n.content),n._closeButton=document.createElement("button"),n._closeButton.className="window-close-button",n._closeButton.addEventListener("pointerdown",(function(t){0===t.button&&n.close()})),n.titlebar.appendChild(n._closeButton);var o=e.width||640,r=e.height||400;return n.setSize(o,r),e.content&&n.content.appendChild(e.content),n}return p(e,t),Object.defineProperty(e.prototype,"isVisible",{get:function(){return"none"!==this.domElement.style.display},enumerable:!1,configurable:!0}),e.prototype.show=function(t,e){var n=this;this.domElement.style.display="flex",e&&(this.domElement.style.top="".concat(e,"px")),t&&(this.domElement.style.left="".concat(t,"px")),setTimeout((function(){var t;null===(t=n.domElement.parentElement)||void 0===t||t.appendChild(n.domElement),n.emit("open")}),1)},e.prototype.close=function(){this.domElement.style.display="none",this.emit("close"),this.persistent||(console.log("Removing window",this),this.domElement.remove())},e.prototype.setSize=function(t,e){this.domElement.style.width="".concat(t,"px"),this.domElement.style.height="".concat(e,"px")},e.prototype.setPosition=function(t,e){this.domElement.style.top="".concat(e,"px"),this.domElement.style.left="".concat(t,"px")},e.prototype.setTitle=function(t){this._title.textContent=t},e}(d),h=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=function(t){function e(e){var n=t.call(this,"div","plugin-container")||this;return n.audioClock=e,n}return h(e,t),e}(l),y=function(){function t(){}return t.register=function(e){t.plugins.includes(e)?console.warn("Plugin already registered:",e):t.plugins.push(e)},t.get=function(t){return this.plugins.find((function(e){return e.name===t}))},t.plugins=[],t}(),v=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),g=function(t){function e(e){var n=t.call(this,e)||this;return n.audioClock=e,n}return v(e,t),e}(m),_=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),E=function(){return E=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},E.apply(this,arguments)},b=function(t){function e(e){var n=t.call(this,e)||this;return n.voices=[],n._nextVoice=0,n._held=[],n._ctx=r(),n._gain=n._ctx.createGain(),n}return _(e,t),Object.defineProperty(e.prototype,"gain",{get:function(){return this._gain},enumerable:!1,configurable:!0}),e.prototype.addVoice=function(t){this.voices.push(t)},e.prototype.handleEvent=function(t){"press"==t.type?(console.log(this.name+" triggered voice "+this._nextVoice),this._held.push(E(E({},t),{voice:this.voices[this._nextVoice]})),this._nextVoice++,this._nextVoice>=this.voices.length&&(this._nextVoice=0)):"release"==t.type?console.log(this.name+" released voice "+t):console.error(this.name+": Invalid event passed to trigger()",t)},e}(g),w=function(){function t(t){this.audioClock=t,this._settings=null,this._note=null,this._frequency=null;var e=r();this._gain=e.createGain()}return Object.defineProperty(t.prototype,"settings",{get:function(){if(!this.settings)throw new Error("Voice not initialized");return this.settings},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"gain",{get:function(){return this._gain.gain.value},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"note",{get:function(){return this._note},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lfoNumber",{get:function(){return this.settings.lfoNumber},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"envelopeNumber",{get:function(){return this.settings.envelopeNumber},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frequency",{get:function(){return this._frequency},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"detune",{get:function(){return this.settings.detune},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oscillators",{get:function(){return this.settings.oscillators},enumerable:!1,configurable:!0}),t.prototype.loadSettings=function(t){this._settings=t,this._gain.gain.value=t.gain},t.prototype.trigger=function(t,e,n){if(void 0===n&&(n=0),!this.settings)throw new Error("Voice not initialized");this._note=t,this._frequency=440*Math.pow(2,(t-69)/12),this._gain.gain.value=this.settings.gain*e},t.prototype.release=function(t){if(void 0===t&&(t=0),!this.settings)throw new Error("Voice not initialized");this._note=null,this._frequency=null},t}(),k=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),C=(function(t){function e(e){var n=t.call(this,e)||this;return n.audioClock=e,n}k(e,t),e.prototype.trigger=function(t,e,n){console.log("FMBassVoice triggered",t,e,n)},e.prototype.release=function(t){console.log("FMBassVoice released",t)}}(w),function(t){function e(e){var n=t.call(this,e)||this;return n.audioClock=e,n.name="FM Bass",n.id="fm_bass",n.version="0.0.1",n.description="A simple FM bass synthesizer",n.author="Johnny Street",n.controllerGroups=[],n.window=new f({title:"FM Bass",persistent:!0,content:n.domElement}),n}return k(e,t),e.prototype.trigger=function(t,e,n){console.log("FM Bass triggered",t,e,n)},e.prototype.release=function(t){console.log("FM Bass released",t)},e}(b));y.register(C);var O=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),x=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return O(e,t),e}(f);function P(t){return e=this,n=arguments,r=function(t,e){return void 0===e&&(e=100),function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(n){return t.classList.toggle("active",!0),setTimeout((function(){t.classList.toggle("active",!1)}),e),[2]}))},new((o=void 0)||(o=Promise))((function(t,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function c(t){try{s(r.throw(t))}catch(t){i(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,c)}s((r=r.apply(e,n||[])).next())}));var e,n,o,r}var j=function(){function t(t,e,n){void 0===t&&(t=800),void 0===e&&(e=200),void 0===n&&(n=!0);var o=this;this.buffer=null,this.domElement=document.createElement("div"),this.domElement.classList.add("audio-canvas"),this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.domElement.appendChild(this.canvas),n&&this.canvas.addEventListener("click",(function(){o.buffer&&o.playBuffer(o.buffer)})),this.ctx=this.canvas.getContext("2d")}return t.prototype.generateAudio=function(t){return e=this,n=arguments,i=function(t,e){var n,o=this;return void 0===e&&(e=!1),function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(i){switch(i.label){case 0:return[4,new Promise((function(n,i){var a={text:t.label,pitch:t.note,rate:.9};fetch("/api/tts/edge",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((function(t){return t.arrayBuffer()})).then((function(t){console.log("Audio buffer downloaded",t),r().decodeAudioData(t,(function(t){o.buffer=t,e&&o.playBuffer(t),n(t)}))})).catch((function(t){console.error("Error downloading audio buffer",t),i(t)}))}))];case 1:return n=i.sent(),this.loadBuffer(n),[2,n]}}))},new((o=void 0)||(o=Promise))((function(t,r){function a(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,c)}s((i=i.apply(e,n||[])).next())}));var e,n,o,i},t.prototype.playBuffer=function(t){var e=r(),n=e.createBufferSource();n.buffer=t,n.connect(e.destination),n.start()},t.prototype.loadBuffer=function(t){this.buffer=t;var e=t.getChannelData(0),n=e.length,o=this.canvas.width/n;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.ctx.moveTo(0,this.canvas.height/2);for(var r=0;r<n;r++){var i=r*o,a=(e[r]+1)*this.canvas.height/2;this.ctx.lineTo(i,a)}this.ctx.lineTo(this.canvas.width,this.canvas.height/2),this.ctx.stroke()},t}(),L=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),T=function(t){function e(e,n,o,r,i){void 0===n&&(n=""),void 0===o&&(o=null),void 0===r&&(r=-1),void 0===i&&(i=[]);var a=t.call(this,"div","sampler-slot")||this;return a.audioClock=e,a.name=n,a.keyBinding=o,a.cutGroup=r,a.cutByGroups=i,a.type="sampler",a.controllerGroups=[],a.buffer=null,a._sources=[],a.name=n,a.buffer=null,a.keyBinding=o||null,a.velocity=1,a.pan=1,a.pitch=1,a.randomPitch=0,a.randomVelocity=.05,a.startPosition=0,a.endPosition=0,a.loop=!1,a.loopStart=0,a.loopEnd=0,a.cutGroup=r,a.cutByGroups=i,a._previewCanvas=new j(200,60),a.domElement.appendChild(a._previewCanvas.domElement),a._nameElement=document.createElement("div"),a._nameElement.classList.add("sampler-slot-name"),a.domElement.appendChild(a._nameElement),a.domElement.addEventListener("pointerdown",(function(){return a.trigger()})),a}return L(e,t),e.prototype.loadSample=function(t,e){return n=this,o=void 0,a=function(){var n,o,i=this;return function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(a){switch(a.label){case 0:return n=r(),this._nameElement.textContent="(Loading)",[4,fetch(e)];case 1:return(o=a.sent()).ok?(o.arrayBuffer().then((function(t){return n.decodeAudioData(t)})).then((function(e){i._nameElement.textContent=t,i.buffer=e,i.emit("update"),setTimeout((function(){i._previewCanvas.loadBuffer(e)}),1)})).catch((function(t){i._nameElement.textContent="(Empty)",console.error("Error loading sample: ".concat(e),t)})),[2]):(this._nameElement.textContent="(Empty)",console.error("Error loading sample: ".concat(e),o.statusText),[2])}}))},new((i=void 0)||(i=Promise))((function(t,e){function r(t){try{s(a.next(t))}catch(t){e(t)}}function c(t){try{s(a.throw(t))}catch(t){e(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(r,c)}s((a=a.apply(n,o||[])).next())}));var n,o,i,a},e.prototype.trigger=function(t){var e=this;if(void 0===t&&(t=0),this.buffer){var n=r(),o=n.createBufferSource();o.buffer=this.buffer,o.playbackRate.value=this.pitch+Math.random()*this.randomPitch,o.connect(n.destination);var i=n.createGain();if(i.gain.value=this.velocity+Math.random()*this.randomVelocity,i.connect(n.destination),o.connect(i),1!==this.pan){var a=n.createStereoPanner();a.pan.value=this.pan,o.connect(a),a.connect(i)}var c=(this.audioClock.startTime||n.currentTime)+60*t/this.audioClock.bpm,s={source:o,gain:i,cutByGroups:this.cutByGroups,time:c};return this._sources.push(s),o.onended=function(){o.disconnect(),i.disconnect();var t=e._sources.indexOf(s);t>=0&&e._sources.splice(t,1)},console.log(t,n.currentTime,c),this.startPosition>=0?o.start(c,this.startPosition,(this.endPosition||this.buffer.duration)-this.startPosition):o.start(c),0!==c&&this.audioClock.isPlaying?this.audioClock.scheduleEventAtTime((function(){return P(e.domElement)}),c):P(this.domElement),this.loop&&(o.loop=!0,o.loopStart=this.loopStart,o.loopEnd=this.loopEnd||this.buffer.duration),s}console.error("No buffer loaded for sample",this.name)},e.prototype.release=function(t){for(var e=0,n=this._sources;e<n.length;e++){var o=n[e];t>=o.time&&this.cut(o,t)}},e.prototype.cut=function(t,e){void 0===e&&(e=0);var n=t.gain.gain.value;t.gain.gain.cancelScheduledValues(e),t.gain.gain.setValueAtTime(n,e),t.gain.gain.exponentialRampToValueAtTime(1e-4,e+.1),t.source.stop(e+.1)},e}(l),B=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),S=function(t){function e(e){var n=t.call(this,e)||this;n.audioClock=e,n.name="Sampler",n.version="0.0.1",n.description="A simple sampler",n.author="Johnny Street",n.id="sampler",n.slots=[],n.controllerGroups=[],window.addEventListener("keydown",(function(t){return n.onKeyDown(t)}));var o=document.createElement("div");o.classList.add("sampler-slots-container"),n._slotsContainer=o;for(var r=[{keyBinding:96,name:"0"},{keyBinding:97,name:"1"},{keyBinding:98,name:"2"},{keyBinding:99,name:"3"},{keyBinding:100,name:"4"},{keyBinding:101,name:"5"},{keyBinding:102,name:"6",cutByGroups:[3,6]},{keyBinding:103,name:"7"},{keyBinding:104,name:"8"},{keyBinding:105,name:"9"},{keyBinding:111,name:"/",cutByGroups:[0,10]},{keyBinding:106,name:"*"},{keyBinding:109,name:"-"},{keyBinding:107,name:"+"},{keyBinding:13,name:"Enter"}],i=0;i<14;i++){var a=new T(n.audioClock,r[i].name,r[i].keyBinding,i,r[i].cutByGroups);n.slots.push(a),o.appendChild(a.domElement),a.loadSample("Sample","./data/samples/kit1/".concat(i,".wav"))}return e.on("stop",(function(){for(var t=0,e=n.slots;t<e.length;t++)e[t].release(0)})),n.domElement.appendChild(o),n.window=new x({title:"Sampler",persistent:!0,content:n.domElement}),n}return B(e,t),e.prototype.trigger=function(t,e,n){void 0===n&&(n=0),console.log("Sampler trigger",t);var o=this.slots[t];if(o){for(var r=0,i=this.slots;r<i.length;r++){var a=i[r];a.cutByGroups.includes(o.cutGroup)&&a.release(n)}return o.trigger(n)}},e.prototype.release=function(t,e){void 0===e&&(e=0),this.slots[t]&&this.slots[t].release(e)},e.prototype.onKeyDown=function(t){var e=this.slots.find((function(e){return e.keyBinding===t.keyCode}));if(e){t.preventDefault();var n=this.slots.indexOf(e);this.trigger(n,null)}},e}(g);y.register(S);var N=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),A=function(t){function e(e,n){var o=t.call(this)||this;return o.audioClock=e,o.title="Untitled",o.description="",o.tempo=120,o.instruments=[],o.patterns=[],o.sequences=[],o.timeline=[],n&&setTimeout((function(){o.load(n)}),0),o}return N(e,t),e.prototype.serialize=function(){return JSON.stringify({title:this.title,description:this.description,tempo:this.tempo,instruments:this.instruments.map((function(t){return{name:t.name,controllerGroups:t.controllerGroups}})),patterns:this.patterns,sequences:this.sequences,timeline:this.timeline})},e.prototype.deserialize=function(t){console.log("Project deserialize",t);var e=JSON.parse(t);this.load(e)},e.prototype.load=function(t){console.log("Project load",t),this.title=t.title,this.description=t.description,this.tempo=t.tempo,this.patterns=t.patterns,this.timeline=t.timeline,this.instruments=[];for(var e=0,n=t.instruments;e<n.length;e++){var o=n[e];console.log("debug",o),"sampler"===o.id?this.instruments.push(new S(this.audioClock)):"fm_bass"===o.id?this.instruments.push(new C(this.audioClock)):console.error("Unknown instrument",o)}console.log("emitting update..."),this.emit("update",{type:"project",value:this})},e}(e),z=function(){function t(){this.windows=[],this._draggingWindow=null,this.domElement=document.createElement("div"),this.domElement.className="window-container",this.domElement.addEventListener("pointerdown",(function(){}))}return t.prototype.addWindow=function(t){this.windows.includes(t)?console.warn("Window already added",t):(this.windows.push(t),this.domElement.appendChild(t.domElement))},t}(),W=[90,83,88,68,67,86,71,66,72,78,74,77,188,76,190,59,191],D=[81,50,87,51,69,82,53,84,54,89,55,85,73,57,79,48,80,219,61,221],M=["white","black","white","white","black","white","black","white","white","black","white","black"],G=["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"],H=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();function R(t){var e=-1;return W.includes(t)?e=W.indexOf(t):D.includes(t)&&(e=D.indexOf(t)+12),e}var q=function(t){function e(){var e=t.call(this,"div","keyboard")||this,n=[];return window.addEventListener("keydown",(function(t){if(!(t.ctrlKey||t.altKey||t.shiftKey)&&"INPUT"!=t.target.tagName){var o=R(t.keyCode);-1===o||n.includes(o)||(n.push(o),e.emit("update",{type:"press",note:o}))}})),window.addEventListener("keyup",(function(t){var o=R(t.keyCode);-1!==o&&n.includes(o)&&(n.splice(n.indexOf(o),1),e.emit("update",{type:"release",note:o}))})),e}return H(e,t),e}(l),I=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),X=function(t){function e(e){var n=t.call(this,"div","selectable-group")||this;return n.items=e,n.selected=[],n.items.forEach(n.add.bind(n)),n}return I(e,t),e.prototype.add=function(t){var e=this;-1!==this.selected.indexOf(t)?console.warn("Already added",t):(t.on("select",(function(){for(var n=0,o=e.selected;n<o.length;n++){var r=o[n];r.domElement.classList.toggle("selected",r===t)}t.selected&&e.selected.push(t),e.emit("select",e)})),this.domElement.appendChild(t.domElement))},e.prototype.remove=function(t){var e=this.items.indexOf(t);-1!==e&&(this.items.splice(e,1),this.domElement.removeChild(t.domElement))},e}(l),V=function(){function t(t){var e=this;this.timeline=t,this.domElement=document.createElement("div"),this.domElement.classList.add("audio-cursor");var n=t.audioClock;n.on("update",(function(){e.update()})),n.on("start",(function(){var t;e.domElement.style.transform="translateX(0)",e.domElement.style.display="block",null===(t=e.domElement.parentElement)||void 0===t||t.appendChild(e.domElement)})),n.on("stop",(function(){e.domElement.style.display="none"}))}return t.prototype.update=function(){this.domElement.style.transform="translateX(".concat(this.timeline.audioClock.currentBeat*this.timeline.beatWidth,"px)")},t.prototype.hide=function(){this.domElement.style.display="none"},t}(),Y=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),F=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.domElement.addEventListener("pointerdown",(function(){o.domElement.classList.toggle("selected"),o.emit("select",o)})),o}return Y(e,t),Object.defineProperty(e.prototype,"selected",{get:function(){return this.domElement.classList.contains("selected")},enumerable:!1,configurable:!0}),e}(l),K=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),J=function(t){function e(e,n){var o=t.call(this,"div","pattern-track")||this;o.project=e,o.instrument=n,o.port=null,o.channel=0,o.events=[],o._instrumentPanel=document.createElement("div"),o._instrumentPanel.classList.add("pattern-track-panel"),o._instrumentPanel.addEventListener("pointerdown",(function(){o.emit("select",o)}));var r=document.createElement("div");o._instrumentPanel.appendChild(r),r.textContent=n.name;var i=document.createElement("div");i.classList.add("pattern-track-buttons"),o._instrumentPanel.appendChild(i);var a=document.createElement("button");a.textContent="e",i.appendChild(a);var c=document.createElement("button");c.textContent="M",i.appendChild(c);var s=document.createElement("button");return s.textContent="S",i.appendChild(s),o._indicator=document.createElement("div"),o._indicator.classList.add("pattern-track-indicator"),i.appendChild(o._indicator),i.appendChild(c),i.appendChild(s),o._canvas=document.createElement("canvas"),o._canvas.height=100,o._canvas.width=1600,o._canvas.classList.add("pattern-track-pattern"),o._canvas.addEventListener("pointerdown",(function(){o.emit("edit",o)})),o.domElement.appendChild(o._instrumentPanel),o.domElement.appendChild(o._indicator),o.domElement.appendChild(o._canvas),o}return K(e,t),Object.defineProperty(e.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.instrument.name},enumerable:!1,configurable:!0}),e.prototype.trigger=function(t,e){var n=this;void 0===e&&(e=0);var o=this.instrument.trigger(t,this.channel,e);return e>0?this.project.audioClock.scheduleEventAtBeat((function(){P(n._indicator)}),e):P(this._indicator),o},e.prototype.release=function(t,e){void 0===e&&(e=0),console.warn("TODO: PatternTrack release",t,e)},e.prototype.load=function(t){this.events=t.events},e.prototype.playback=function(){var t=this;if(this.project.audioClock.isPlaying){for(var e=void 0,n=function(t){e=o.trigger(t.note,t.start),t.domElement&&(o.project.audioClock.scheduleEventAtBeat((function(){return t.domElement.classList.toggle("active",!0)}),t.start),o.project.audioClock.scheduleEventAtBeat((function(){return t.domElement.classList.toggle("active",!1)}),t.start+t.duration))},o=this,r=0,i=this.events;r<i.length;r++)n(i[r]);void 0!==e&&"source"in e&&(e.source.onended=function(){var e=t.project.audioClock.currentBeat+(4-t.project.audioClock.currentBeat%4);t.project.audioClock.scheduleEventAtBeat((function(){t.project.audioClock.restart(),t.playback()}),e)})}else console.warn("Playback cancelled")},e}(F),U=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Q=function(t){function e(e){var n=this,o=new X([]);o.domElement.classList.add("pattern-track-container"),(n=t.call(this,{title:"Pattern",persistent:!0,content:o.domElement,width:400,height:400})||this).project=e,n.beatWidth=20,n.patterns=[{name:"Pattern 1",sequences:[]}],n.trackContainer=o,n.setSize(800,400),e.patterns=n.patterns,n.timeline=document.createElement("div"),n.timeline.style.position="absolute",n.timeline.style.width="calc(100% - 88px)",n.timeline.style.height="100%",n.timeline.style.left="88px",n.timeline.style.pointerEvents="none",n.timeline.style.overflow="hidden",n.cursor=new V(n),n.timeline.appendChild(n.cursor.domElement);var r=n.domElement.querySelector("canvas");return r&&(n.beatWidth=r.width/16),n.on("resize",(function(){n.beatWidth=n.domElement.clientWidth/16})),e.audioClock.on("start",(function(){if(!e.audioClock.startTime)throw new Error("Audio clock start time is not set");for(var t=0,o=n.trackContainer.items;t<o.length;t++)o[t].playback()})),n.addPattern("Pattern 1"),n}return U(e,t),Object.defineProperty(e.prototype,"tracks",{get:function(){return this.trackContainer.items},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"audioClock",{get:function(){return this.project.audioClock},enumerable:!1,configurable:!0}),e.prototype.loadProject=function(t){var e=this;this.patterns=t.patterns,this.trackContainer.items.forEach((function(t){e.trackContainer.remove(t)})),this.trackContainer.items.length=0;for(var n=0;n<t.instruments.length;n++)this.addTrack(t.instruments[n]).load(t.patterns[0].sequences[n])},e.prototype.addPattern=function(t){console.log("Created pattern:",t);var e={name:t,sequences:[]};this.patterns.push(e)},e.prototype.addTrack=function(t){var e=this;console.log("Added track + instrument:",t);var n=new J(this.project,t);return 0===this.trackContainer.items.length&&n.domElement.appendChild(this.timeline),n.on("select",(function(t){e.emit("select",t)})),n.on("edit",(function(t){console.log("PatternWindow edit",t),e.emit("edit",t)})),this.trackContainer.add(n),n},e.prototype.removeTrack=function(t){var e=this.trackContainer.items.indexOf(t);-1!==e&&(this.trackContainer.items.splice(e,1),this.trackContainer.remove(t))},e.prototype.trigger=function(t){for(var e=0,n=this.trackContainer.items;e<n.length;e++){var o=n[e];o.selected&&o.trigger(t)}},e.prototype.play=function(){if(null==this.audioClock.startTime)throw new Error("Audio clock start time is not set");for(var t=0,e=this.trackContainer.items;t<e.length;t++)for(var n=e[t],o=0,r=n.events;o<r.length;o++){var i=r[o];n.trigger(i.note,this.audioClock.startTime+60*i.start/this.audioClock.bpm)}},e}(f),Z=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),$=function(t){function e(e){var n=t.call(this,"div","scroll-panel")||this;return n.scrollElement=e,n.sensitivity=50,n.linkedElements=[],n._scrollTop=0,e.classList.add("scroll-panel-content"),n.scrollElement.addEventListener("wheel",(function(t){t.preventDefault(),console.log(t.deltaY);var e=n._scrollTop+(t.deltaY>0?-n.sensitivity:n.sensitivity);e+n.scrollElement.offsetHeight<n.domElement.offsetHeight?e=n.domElement.offsetHeight-n.scrollElement.offsetHeight:e>0&&(e=0),n._scrollTop=e,n.scrollElement.style.transform="translateY(".concat(e,"px)");for(var o=0,r=n.linkedElements;o<r.length;o++)r[o].style.transform="translateY(".concat(e,"px)");n.emit("scroll",t)})),n}return Z(e,t),Object.defineProperty(e.prototype,"scrollTop",{get:function(){return this._scrollTop},set:function(t){var e=-t;this._scrollTop=e,this.scrollElement.style.transform="translateY(".concat(e,"px)");for(var n=0,o=this.linkedElements;n<o.length;n++)o[n].style.transform="translateY(".concat(e,"px)")},enumerable:!1,configurable:!0}),e.prototype.linkElement=function(t){this.linkedElements.push(t),t.classList.add("scroll-panel-content")},e}(l),tt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),et=function(t){function e(){return t.call(this)||this}return tt(e,t),e.prototype.generateAudio=function(t){return e=this,n=arguments,i=function(t,e){var n,o=this;return void 0===e&&(e=!1),function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((r=(r=a.trys).length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}}(this,(function(i){switch(i.label){case 0:return[4,new Promise((function(n,i){var a={text:t.label,pitch:t.note,rate:.9};fetch("/api/tts/edge",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((function(t){return t.arrayBuffer()})).then((function(t){console.log("Audio buffer downloaded",t),r().decodeAudioData(t,(function(t){o.buffer=t,e&&o.playBuffer(t),n(t)}))})).catch((function(t){console.error("Error downloading audio buffer",t),i(t)}))}))];case 1:return n=i.sent(),this.loadBuffer(n),[2,n]}}))},new((o=void 0)||(o=Promise))((function(t,r){function a(t){try{s(i.next(t))}catch(t){r(t)}}function c(t){try{s(i.throw(t))}catch(t){r(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof o?n:new o((function(t){t(n)}))).then(a,c)}s((i=i.apply(e,n||[])).next())}));var e,n,o,i},e}(j),nt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ot=function(t){function e(e,n){void 0===e&&(e="OK"),void 0===n&&(n="Cancel");var o=t.call(this,"div","dialog-popup")||this;return o.ok=e,o.cancel=n,o.closeButton=document.createElement("button"),o.closeButton.classList.add("window-close-button"),o.domElement.appendChild(o.closeButton),o.closeButton.addEventListener("pointerdown",(function(){o.domElement.style.display="none"})),e instanceof HTMLButtonElement?o.okButton=e:e&&(o.okButton=document.createElement("button"),o.okButton.textContent=e,o.domElement.appendChild(o.okButton)),o.okButton&&o.okButton.addEventListener("click",(function(){o.emit("result",o)})),n instanceof HTMLButtonElement?o.cancelButton=n:n&&(o.cancelButton=document.createElement("button"),o.cancelButton.textContent=n,o.domElement.appendChild(o.cancelButton)),o.cancelButton&&o.cancelButton.addEventListener("click",(function(){o.emit("cancel",o)})),o}return nt(e,t),Object.defineProperty(e.prototype,"isVisibile",{get:function(){return"none"!==this.domElement.style.display},enumerable:!1,configurable:!0}),e.prototype.show=function(t,e,n){var o;this.domElement.style.display="block",this.domElement.style.left="".concat(t,"px"),this.domElement.style.top="".concat(e,"px"),null===(o=this.domElement.parentElement)||void 0===o||o.appendChild(this.domElement)},e.prototype.hide=function(){this.domElement.style.display="none"},e}(l),rt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),it=function(t){function e(e){var n=t.call(this,e)||this;return n.domElement.classList.add("piano-roll-note-editor"),n.domElement.style.display="none",n.textInput=document.createElement("input"),n.textInput.setAttribute("placeholder","Note lyric"),n.textInput.classList.add("lyric-editor-text"),n.textInput.type="text",n.domElement.appendChild(n.textInput),n.pitchSlider=document.createElement("input"),n.pitchSlider.classList.add("lyric-editor-pitch"),n.pitchSlider.type="range",n.pitchSlider.min="-0.5",n.pitchSlider.max="0.5",n.pitchSlider.step="0.01",n.pitchSlider.value="0",n.pitchSlider.addEventListener("input",(function(){n.note.note=parseFloat(n.pitchSlider.value)})),n.domElement.appendChild(n.pitchSlider),n.audioCanvas=new et,n.domElement.appendChild(n.audioCanvas.domElement),n.saveButton.addEventListener("click",(function(){n.audioCanvas.domElement.style.display="block"})),n}return rt(e,t),e.prototype.show=function(e,n,o){var r;t.prototype.show.call(this,e,n,o),this.textInput.value=(null===(r=this.note)||void 0===r?void 0:r.label)||""},e}(function(t){function e(e){var n=t.call(this)||this;return n.onsave=e,n.note=null,n.domElement=document.createElement("div"),n.domElement.classList.add("piano-roll-dialog"),n.closeButton=document.createElement("button"),n.closeButton.classList.add("window-close-button"),n.domElement.appendChild(n.closeButton),n.closeButton.addEventListener("click",(function(){n.domElement.style.display="none"})),n.saveButton=document.createElement("button"),n.saveButton.textContent="Save",n.domElement.appendChild(n.saveButton),n.saveButton.addEventListener("click",(function(){n.onsave(n.note)})),n}return rt(e,t),e.prototype.show=function(e,n,o){var r;t.prototype.show.call(this,e,n,o),this.note=o,null===(r=this.domElement.parentElement)||void 0===r||r.appendChild(this.domElement)},e}(ot)),at=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ct=function(t,e){var n;this.grid=t,this.velocity=.8,this.label="",this.audio=null,this.note=e.note,this.start=e.start,this.duration=e.duration,this.domElement=document.createElement("div"),this.domElement.classList.add("piano-roll-note"),this.domElement.style.height="".concat(t.noteHeight,"px"),this.noteLabel=document.createElement("div"),this.noteLabel.classList.add("piano-roll-note-label"),this.noteLabel.textContent=(n=this.note,"".concat(G[n%G.length]).concat(Math.floor(n/G.length))),this.domElement.appendChild(this.noteLabel),this.lyricLabel=document.createElement("div"),this.lyricLabel.classList.add("piano-roll-note-lyric"),this.domElement.appendChild(this.lyricLabel),e.label&&(this.lyricLabel.textContent=e.label),console.log("GridItem",this),t.gridElement.appendChild(this.domElement)},st=function(t){function e(){var e=this,n=document.createElement("div");(e=t.call(this,n)||this).noteHeight=20,e.beatWidth=100,e._currentNote=null,e._dragMode=null,e._quantize=.25,e._dragOffset=0,e._track=null,e.scrollElement=n,e.domElement=document.createElement("div"),e.gridElement=n,e.domElement.classList.add("piano-roll-grid-container"),e.gridElement.classList.add("piano-roll-grid"),e.gridElement.addEventListener("dragstart",(function(t){t.preventDefault()})),e.previewCanvas=document.createElement("canvas"),e.previewCanvas.style.imageRendering="pixelated";var o=document.createElement("canvas");o.style.imageRendering="pixelated",o.width=4*e.beatWidth,o.height=e.noteHeight,console.log("debug",o.width,o.height);var r=o.getContext("2d");if(r){r.strokeStyle="#666",r.lineWidth=.5;for(var i=1;i<4;i++)r.beginPath(),r.moveTo(i*e.beatWidth,0),r.lineTo(i*e.beatWidth,e.noteHeight),r.stroke();r.lineWidth=1,r.strokeStyle="white",r.beginPath(),r.moveTo(0,0),r.lineTo(0,e.noteHeight),r.stroke()}for(var a=0;a<88;a++){var c=document.createElement("div");c.classList.add("piano-roll-grid-row"),c.style.height="".concat(e.noteHeight,"px"),e.gridElement.appendChild(c);var s=o.toDataURL();c.style.backgroundImage="url(".concat(s,")"),c.style.backgroundRepeat="repeat"}return e.domElement.appendChild(e.gridElement),e.noteEditor=new it((function(t){var n=e.noteEditor.domElement.querySelector(".lyric-editor-text");t.label=(null==n?void 0:n.value)||""})),document.body.appendChild(e.noteEditor.domElement),e.gridElement.addEventListener("pointerdown",(function(t){var n;if(!e._track)throw new Error("No track");if(!e._track.events)throw new Error("No events");if(t.preventDefault(),e._dragOffset=t.layerX,"block"!==e.noteEditor.domElement.style.display){if(t.target instanceof HTMLDivElement&&t.target.classList.contains("piano-roll-note")){e.gridElement.classList.add("dragging");var o=e._track.events.find((function(e){return e.domElement===t.target}));(t.ctrlKey||1===t.button)&&(o?e.noteEditor.show(t.clientX+20,t.clientY-5,o):e.noteEditor.domElement.style.display="none"),o&&(e._currentNote=o,2===t.button?(e.remove(o),e._currentNote=null):(null===(n=o.domElement.parentElement)||void 0===n||n.appendChild(o.domElement),e._dragOffset<6?e._dragMode="start":o.domElement.offsetWidth-e._dragOffset<6?e._dragMode="end":e._dragMode="move"))}else{if(0!==t.button)return;if(t.target===e.gridElement){e.gridElement.classList.add("dragging");var r=87-Math.floor(t.layerY/e.noteHeight),i=t.layerX/e.beatWidth;i=Math.round(i/e._quantize)*e._quantize,console.log("start",i,t.layerX);var a={note:r,start:i,velocity:100,duration:.25,label:"",domElement:void 0};e._currentNote=e.add(a),e._currentNote.domElement.style.top="".concat((87-e._currentNote.note)*e.noteHeight,"px"),e._currentNote.domElement.style.left="".concat(e._currentNote.start*e.beatWidth,"px"),e._dragMode="end",e.emit("select",e._currentNote)}}e.emit("update",e)}else e.noteEditor.domElement.style.display="none"})),e.gridElement.addEventListener("pointerup",(function(){e.gridElement.classList.remove("dragging"),e._currentNote=null,e.emit("update",e)})),e.gridElement.addEventListener("pointerleave",(function(){e.gridElement.classList.remove("dragging"),e._currentNote&&(e.remove(e._currentNote),e._currentNote=null)})),e.gridElement.addEventListener("contextmenu",(function(t){t.preventDefault()})),e.gridElement.addEventListener("pointermove",(function(t){if(e._currentNote&&1===t.buttons){if("start"===e._dragMode){var n=e._currentNote.start;e._currentNote.start=t.layerX/e.beatWidth,e._currentNote.start=Math.round(e._currentNote.start/e._quantize)*e._quantize,e._currentNote.duration=n-e._currentNote.start+e._currentNote.duration,e._currentNote.domElement.style.left="".concat(e._currentNote.start*e.beatWidth,"px"),e._currentNote.domElement.style.width="".concat(e._currentNote.duration*e.beatWidth,"px")}else if("end"===e._dragMode)e._currentNote.duration=t.layerX/e.beatWidth-e._currentNote.start,e._currentNote.duration=Math.round(e._currentNote.duration/e._quantize)*e._quantize,e._currentNote.domElement.style.width="".concat(e._currentNote.duration*e.beatWidth,"px");else{if("move"!==e._dragMode)return;e._currentNote.start=(t.layerX-e._dragOffset)/e.beatWidth,e._currentNote.start=Math.round(e._currentNote.start/e._quantize)*e._quantize,e._currentNote.domElement.style.left="".concat(e._currentNote.start*e.beatWidth,"px")}e.emit("update",e)}})),e.gridElement.addEventListener("pointerup",(function(){e.gridElement.classList.remove("dragging"),e._currentNote&&(e._currentNote.domElement.style.pointerEvents="auto"),e._currentNote=null})),e.gridElement.addEventListener("pointerleave",(function(){e.gridElement.classList.remove("dragging"),e._currentNote&&(e._currentNote.domElement.style.pointerEvents="auto"),e._currentNote=null})),e}return at(e,t),e.prototype.add=function(t){if(!this._track)throw new Error("add() No track!");var e=new ct(this,t);return this._track.events.push(e),console.log("Grid: add",t),e},e.prototype.remove=function(t){if(!this._track)throw new Error("remove() No track!");this._track.events.splice(this._track.events.indexOf(t),1),this.gridElement.removeChild(t.domElement)},e.prototype.load=function(t){var e,n=this;console.log("Grid: load",t.events),null===(e=this._track)||void 0===e||e.events.forEach((function(t){return t.domElement.remove()})),this._track=t,t.events.forEach((function(t){n.gridElement.appendChild(t.domElement)}))},e.prototype.renderToCanvas=function(t,e){var n=this;if(!this._track)throw new Error("renderToCanvas() No track!");var o=88;this._track.events.forEach((function(t){t.note<o&&(o=t.note)}));var r=0;this._track.events.forEach((function(t){t.note>r&&(r=t.note)})),r+=12,o-=12;var i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);var a=t.height/(r-o+1);a>2&&(a=2),this._track.events.forEach((function(r){var c=t.height-(r.note-o+1)*a,s=r.start*n.beatWidth,l=r.duration*n.beatWidth;i.fillStyle=e,i.fillRect(s,c,l,a)}))},e}($),lt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ut=function(t){function e(){var e=t.call(this,"div","piano-roll-keyboard")||this;return e.keys=[],e.noteHeight=20,e.redraw(),e.domElement.addEventListener("pointerdown",(function(t){t.preventDefault();var n=t.target;if(n.classList.contains("piano-roll-keyboard-key")){var o=e.keys.indexOf(n);console.log("key",n.textContent,o),n.classList.add("active"),e.emit("update",{type:"press",note:o});var r=function(){n.classList.remove("active"),e.emit("update",{type:"release",note:o}),window.removeEventListener("pointerup",r)};window.addEventListener("pointerup",(function(){return r()}))}})),e}return lt(e,t),e.prototype.redraw=function(){this.domElement.innerHTML="";for(var t=87;t>=0;t--){var e=document.createElement("div");e.classList.add("piano-roll-keyboard-key"),e.style.height="".concat(this.noteHeight,"px"),e.style.backgroundColor="white"===M[t%12]?"#fff":"#000",e.style.color="white"===M[t%12]?"#000":"#fff",e.textContent=G[t%12]+(t/12|0).toString(),this.domElement.appendChild(e),this.keys.push(e)}this.keys.reverse()},e}(l),dt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),pt=function(t){function e(e){var n=t.call(this)||this;return n.audioClock=e,n.cursorUpdateInterval=null,n.track=null,n.color="#7979ce",n.beatWidth=100,n.domElement=document.createElement("div"),n.domElement.classList.add("piano-roll"),n.sideKeyboard=new ut,n.domElement.appendChild(n.sideKeyboard.domElement),n.sideKeyboard.on("update",(function(t){var e=t;"press"==e.type?n.track.trigger(e.note):"release"==e.type&&n.track.release(e.note)})),n.grid=new st,n.domElement.appendChild(n.grid.domElement),n.grid.on("select",(function(t){var e=t;n.track.trigger(e.note),n.track&&n.grid.renderToCanvas(n.track.canvas,n.color)})),n.grid.on("update",(function(){n.track&&n.grid.renderToCanvas(n.track.canvas,n.color)})),n.grid.linkElement(n.sideKeyboard.domElement),n.timeline=n.grid.domElement,n.cursor=new V(n),n.cursor.domElement.classList.add("audio-cursor"),n.grid.domElement.appendChild(n.cursor.domElement),n.grid.scrollTop=1e3,n}return dt(e,t),e.prototype.load=function(t){this.track=t,this.grid.load(t)},e}(e),ft=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),ht=function(t){function e(e){var n=this,o=new pt(e);return(n=t.call(this,{title:"Piano Roll",persistent:!0,content:o.domElement,width:900,height:400})||this).clock=e,n.pianoRoll=o,n.setSize(800,400),n}return ft(e,t),e.prototype.loadTrack=function(t){this.pianoRoll.load(t),this.setTitle("Piano Roll (".concat(t.name,")"))},e}(f),mt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),yt=function(t){function e(e){var n=t.call(this,"div","playlist-track")||this;n.name="Track 1",n.items=[];var o=document.createElement("div");o.classList.add("instrument-panel");var r=document.createElement("div");o.appendChild(r),r.textContent=e;var i=document.createElement("div");i.classList.add("playlist-track-selector"),o.appendChild(i);var a=document.createElement("button");a.textContent="M",i.appendChild(a);var c=document.createElement("button");c.textContent="S",i.appendChild(c);var s=document.createElement("div");return s.classList.add("pattern-panel"),n.domElement.appendChild(o),n.domElement.appendChild(s),n}return mt(e,t),e}(l),vt=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),gt=function(t){function e(e){var n=this,o=document.createElement("div");return o.classList.add("playlist-track-container"),(n=t.call(this,{title:"Playlist",persistent:!0,content:o,width:800,height:400})||this).project=e,n._tracks=[],n.beatWidth=100,n.timeline=o,n.cursor=new V(n),n.project.audioClock.on("update",(function(){n.cursor.update()})),n}return vt(e,t),Object.defineProperty(e.prototype,"audioClock",{get:function(){return this.project.audioClock},enumerable:!1,configurable:!0}),e.prototype.addTrack=function(t){console.log("Add track",t);var e=new yt(t);this._tracks.push(e),this.timeline.appendChild(e.domElement),this.timeline.appendChild(this.cursor.domElement)},e}(f),_t=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),Et=function(t){function e(e){var n=t.call(this,"div","project-ui")||this;n.project=e,n.container=new z,n.domElement.appendChild(n.container.domElement);var o=new ht(e.audioClock);n.container.addWindow(o),o.setPosition(500,100);var r=new Q(e);r.show(35,100),n.container.addWindow(r);var i=new gt(e);r.show(200,200),n.container.addWindow(i),r.on("edit",(function(t){console.log("edit",t),o.loadTrack(t),o.show()})),r.on("select",(function(t){console.log("select",t),t.instrument.window.show()}));var a=new q;return n.domElement.appendChild(a.domElement),a.on("update",(function(t){var e=t;console.log("Keyboard",t),"press"===e.type?r.trigger(e.note):"release"===e.type&&console.log("Release",e.note)})),n.project.on("update",(function(t){if(console.log("ProjectUI project update",t),!(t instanceof Object))throw new Error("Invalid event");if(!("type"in t))throw new Error("Invalid event");var e=t;if("project"===e.type){var o=e.value;console.log("Project",o),r.loadProject(o);for(var i=0,a=o.instruments;i<a.length;i++){var c=a[i];n.container.addWindow(c.window)}}})),n}return _t(e,t),e}(l),bt=document.createElement("div");bt.classList.add("studio");var wt=new c,kt=new Et(new A(wt,{title:"Basic",description:"Basic project template with Sampler and Synthesizer",tempo:120,instruments:[{name:"Sampler",id:"sampler",controllerGroups:[]},{name:"FM Bass",id:"fm_bass",controllerGroups:[]}],patterns:[{name:"Pattern 1",sequences:[{events:[]},{events:[]}]}],timeline:[]}));bt.appendChild(wt.domElement),bt.appendChild(kt.domElement),document.body.appendChild(bt),monofy=t})();
//# sourceMappingURL=monofy-studio.js.map