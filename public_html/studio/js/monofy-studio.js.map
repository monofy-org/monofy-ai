{"version":3,"file":"monofy-studio.js","mappings":"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","sources":["webpack://monofy/webpack/bootstrap","webpack://monofy/webpack/runtime/make namespace object","webpack://monofy/../elements/src/EventObject.ts","webpack://monofy/../elements/src/managers/AudioManager.ts","webpack://monofy/../elements/src/constants/audioConstants.ts","webpack://monofy/../elements/src/elements/AudioCanvas.ts","webpack://monofy/./src/elements/LyricCanvas.ts","webpack://monofy/../elements/src/DialogPopup.ts","webpack://monofy/./src/elements/audioDialogs.ts","webpack://monofy/./src/elements/Grid.ts","webpack://monofy/./src/elements/SideKeyboard.ts","webpack://monofy/./src/elements/PianoRoll.ts","webpack://monofy/./src/elements/AudioClock.ts","webpack://monofy/../elements/src/elements/BaseElement.ts","webpack://monofy/../elements/src/elements/SizableElement.ts","webpack://monofy/../elements/src/elements/DraggableWindow.ts","webpack://monofy/../elements/src/elements/WindowContainer.ts","webpack://monofy/./src/elements/PatternTrack.ts","webpack://monofy/./src/elements/PatternWindow.ts","webpack://monofy/./src/elements/PlaylistTrack.ts","webpack://monofy/./src/elements/PlaylistWindow.ts","webpack://monofy/./src/index.ts","webpack://monofy/./src/elements/Composition.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export interface EventDataMap {\r\n  cancel: unknown;\r\n  start: unknown;\r\n  stop: unknown;\r\n  pause: unknown;\r\n  result: unknown;\r\n  update: unknown;\r\n  open: unknown;\r\n  close: unknown;\r\n  resize: unknown;\r\n  select: unknown;\r\n}\r\n\r\nexport type BaseEvent = keyof EventDataMap;\r\n\r\nexport default abstract class EventObject<E extends BaseEvent = BaseEvent> {\r\n  private _events: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n  private _onceEvents: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n\r\n  on(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._events[eventName]) {\r\n      this._events[eventName] = [];\r\n    }\r\n    this._events[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  once(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._onceEvents[eventName]) {\r\n      this._onceEvents[eventName] = [];\r\n    }\r\n    this._onceEvents[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  fireEvent(eventName: E, eventData?: EventDataMap[E]) {\r\n    const onceCallbacks = this._onceEvents[eventName];\r\n    if (onceCallbacks) {\r\n      for (const callback of onceCallbacks) {\r\n        try {\r\n          callback(eventData);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .once callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n      this._onceEvents[eventName] = undefined;\r\n    }\r\n\r\n    const callbacks = this._events[eventName];\r\n    if (callbacks) {\r\n      for (const callback of callbacks) {\r\n        try {\r\n          callback(eventData);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .on callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","let audioContext: AudioContext | null = null;\r\n\r\nexport function getAudioContext() {\r\n  if (!audioContext) {\r\n    const AudioContext =\r\n      window.AudioContext || (window as any).webkitAudioContext;\r\n    audioContext = new AudioContext();\r\n\r\n    console.log(\"Audio context created\");\r\n\r\n    // force audio context to start\r\n    const buffer = audioContext.createBuffer(1, 1, audioContext.sampleRate);\r\n    const source = audioContext.createBufferSource();\r\n    source.buffer = buffer;\r\n    source.connect(audioContext.destination);\r\n    source.start(0);\r\n  }\r\n  return audioContext;\r\n}\r\n","export const DEFAULT_NOTE_HEIGHT = 20;\r\n\r\nexport const KEY_COLORS = [\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n];\r\n\r\nexport const NOTE_NAMES = [\r\n  \"A\",\r\n  \"A#\",\r\n  \"B\",\r\n  \"C\",\r\n  \"C#\",\r\n  \"D\",\r\n  \"D#\",\r\n  \"E\",\r\n  \"F\",\r\n  \"F#\",\r\n  \"G\",\r\n  \"G#\",\r\n];\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\n\r\nexport class AudioCanvas {\r\n  domElement: HTMLDivElement;\r\n  canvas: HTMLCanvasElement;\r\n  ctx: CanvasRenderingContext2D;\r\n  buffer: AudioBuffer | null = null;\r\n\r\n  constructor() {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-canvas\");\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.canvas.width = 800;\r\n    this.canvas.height = 200;\r\n    this.domElement.appendChild(this.canvas);\r\n\r\n    this.canvas.addEventListener(\"click\", () => {\r\n      if (this.buffer) {\r\n        this.playBuffer(this.buffer);\r\n      }\r\n    });\r\n\r\n    this.ctx = this.canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; pitch: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.pitch,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n\r\n  playBuffer(audioBuffer: AudioBuffer) {\r\n    const ctx = getAudioContext();\r\n    const source = ctx.createBufferSource();\r\n    source.buffer = audioBuffer;\r\n    source.connect(ctx.destination);\r\n    source.start();\r\n  }\r\n\r\n  loadBuffer(audioBuffer: AudioBuffer) {\r\n    this.buffer = audioBuffer;\r\n\r\n    const channelData = audioBuffer.getChannelData(0);\r\n    const bufferLength = channelData.length;\r\n    const sliceWidth = this.canvas.width / bufferLength;\r\n\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.canvas.height / 2);\r\n\r\n    for (let i = 0; i < bufferLength; i++) {\r\n      const x = i * sliceWidth;\r\n      const y = ((channelData[i] + 1) * this.canvas.height) / 2;\r\n\r\n      this.ctx.lineTo(x, y);\r\n    }\r\n\r\n    this.ctx.lineTo(this.canvas.width, this.canvas.height / 2);\r\n    this.ctx.stroke();\r\n  }\r\n}\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\nimport { AudioCanvas } from \"../../../elements/src/elements/AudioCanvas\";\r\nimport { GridItem } from \"./Grid\";\r\n\r\nexport class LyricCanvas extends AudioCanvas {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  async generateAudio(\r\n    note: GridItem,\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.pitch,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n}\r\n","import EventObject from \"./EventObject\";\r\n\r\nexport class DialogPopup extends EventObject<\"result\" | \"cancel\"> {\r\n  domElement: HTMLDivElement;\r\n  closeButton: HTMLButtonElement;\r\n  okButton: HTMLButtonElement | undefined;\r\n  cancelButton: HTMLButtonElement | undefined;\r\n\r\n  get isVisibile() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    private readonly ok: string | HTMLButtonElement = \"OK\",\r\n    private readonly cancel: string | HTMLButtonElement = \"Cancel\"\r\n  ) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"dialog-popup\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.textContent = \"X\";\r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"click\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    if (ok instanceof HTMLButtonElement) {\r\n      this.okButton = ok;\r\n    } else if (ok) {\r\n      this.okButton = document.createElement(\"button\");\r\n      this.okButton.textContent = ok;\r\n      this.domElement.appendChild(this.okButton);\r\n    }\r\n\r\n    if (this.okButton) {\r\n      this.okButton.addEventListener(\"click\", () => {\r\n        this.fireEvent(\"result\", this);\r\n      });\r\n    }\r\n\r\n    if (cancel instanceof HTMLButtonElement) {\r\n      this.cancelButton = cancel;\r\n    } else if (cancel) {\r\n      this.cancelButton = document.createElement(\"button\");\r\n      this.cancelButton.textContent = cancel;\r\n      this.domElement.appendChild(this.cancelButton);\r\n    }\r\n\r\n    if (this.cancelButton) {\r\n      this.cancelButton.addEventListener(\"click\", () => {\r\n        this.fireEvent(\"cancel\", this);\r\n      });\r\n    }\r\n  }\r\n\r\n  show(x: number, y: number, targetObject?: unknown) { /* eslint-disable-line @typescript-eslint/no-unused-vars */\r\n    this.domElement.style.display = \"block\";\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","import { LyricCanvas } from \"./LyricCanvas\";\r\nimport { GridItem } from \"./Grid\";\r\nimport { DialogPopup } from \"../../../elements/src/DialogPopup\";\r\n\r\nexport class PianoRollDialog extends DialogPopup {\r\n  domElement: HTMLDivElement;\r\n  closeButton: HTMLButtonElement;\r\n  saveButton: HTMLButtonElement;\r\n  note: GridItem | null = null;\r\n\r\n  constructor(public onsave: (note: GridItem) => void) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-dialog\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.textContent = \"X\";\r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"click\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    this.saveButton = document.createElement(\"button\");\r\n    this.saveButton.textContent = \"Save\";\r\n    this.domElement.appendChild(this.saveButton);\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  override show(x: number, y: number, note: GridItem) {\r\n    super.show(x, y, note);\r\n    this.note = note;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class LyricEditorDialog extends PianoRollDialog {\r\n  textInput: HTMLInputElement;\r\n  audioCanvas: LyricCanvas;\r\n  pitchSlider: HTMLInputElement;\r\n  constructor(onsave: (note: GridItem) => void) {\r\n    super(onsave);\r\n    this.domElement.classList.add(\"piano-roll-note-editor\");\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this.textInput = document.createElement(\"input\");\r\n    this.textInput.setAttribute(\"placeholder\", \"Note lyric\");\r\n    this.textInput.classList.add(\"lyric-editor-text\");\r\n    this.textInput.type = \"text\";\r\n    this.domElement.appendChild(this.textInput);\r\n\r\n    this.pitchSlider = document.createElement(\"input\");\r\n    this.pitchSlider.classList.add(\"lyric-editor-pitch\");\r\n    this.pitchSlider.type = \"range\";\r\n    this.pitchSlider.min = \"-0.5\";\r\n    this.pitchSlider.max = \"0.5\";\r\n    this.pitchSlider.step = \"0.01\";\r\n    this.pitchSlider.value = \"0\";\r\n    this.pitchSlider.addEventListener(\"input\", () => {\r\n      this.note!.pitch = parseFloat(this.pitchSlider.value);\r\n    });\r\n    this.domElement.appendChild(this.pitchSlider);\r\n\r\n    this.audioCanvas = new LyricCanvas();\r\n    this.domElement.appendChild(this.audioCanvas.domElement);\r\n\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.audioCanvas.domElement.style.display = \"block\";\r\n      this.audioCanvas.generateAudio(this.note!, true).then((buffer) => {\r\n        this.note!.audio = buffer;\r\n      });\r\n      this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  show(x: number, y: number, note: GridItem) {\r\n    super.show(x, y, note);\r\n    this.textInput.value = this.note?.label || \"\";\r\n    if (this.note?.audio) {\r\n      this.audioCanvas.loadBuffer(this.note.audio);\r\n      this.audioCanvas.domElement.style.display = \"block\";\r\n    } else {\r\n      this.audioCanvas.domElement.style.display = \"none\";\r\n    }\r\n  }\r\n}\r\n","import EventObject from \"../../../elements/src/EventObject\";\r\nimport {\r\n  DEFAULT_NOTE_HEIGHT,\r\n  NOTE_NAMES,\r\n} from \"../../../elements/src/constants/audioConstants\";\r\nimport { PatternTrack } from \"./PatternTrack\";\r\nimport { LyricEditorDialog } from \"./audioDialogs\";\r\n\r\nfunction getNoteNameFromPitch(pitch: number): string {\r\n  const note = NOTE_NAMES[pitch % NOTE_NAMES.length];\r\n  return `${note}${Math.floor(pitch / NOTE_NAMES.length)}`;\r\n}\r\n\r\nconst NOTE_HANDLE_WIDTH = 6;\r\n\r\nexport interface IGridItem {\r\n  pitch: number;\r\n  start: number;\r\n  duration: number;\r\n  label: string;\r\n}\r\n\r\nexport class GridItem {\r\n  pitch: number;\r\n  start: number;\r\n  duration: number;\r\n  velocity: number = 100;\r\n  label: string | \"\" = \"\";\r\n  domElement: HTMLDivElement;\r\n  noteLabel: HTMLDivElement;\r\n  lyricLabel: HTMLDivElement;\r\n  audio: AudioBuffer | null = null;\r\n\r\n  constructor(\r\n    private readonly grid: Grid,\r\n    item: IGridItem\r\n  ) {\r\n    this.pitch = item.pitch;\r\n    this.start = item.start;\r\n    this.duration = item.duration;\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-note\");\r\n    this.domElement.style.height = `${grid.noteHeight}px`;\r\n\r\n    this.noteLabel = document.createElement(\"div\");\r\n    this.noteLabel.classList.add(\"piano-roll-note-label\");\r\n    this.noteLabel.textContent = getNoteNameFromPitch(this.pitch);\r\n    this.domElement.appendChild(this.noteLabel);\r\n\r\n    this.lyricLabel = document.createElement(\"div\");\r\n    this.lyricLabel.classList.add(\"piano-roll-note-lyric\");\r\n    this.domElement.appendChild(this.lyricLabel);\r\n\r\n    if (item.label) this.lyricLabel.textContent = item.label;\r\n    this.update();\r\n\r\n    console.log(\"GridItem\", this);\r\n\r\n    grid.gridElement.appendChild(this.domElement);\r\n  }\r\n\r\n  update() {\r\n    this.noteLabel.textContent = getNoteNameFromPitch(this.pitch);\r\n    this.lyricLabel.textContent = this.label;\r\n    this.domElement.style.top = `${(87 - this.pitch) * this.grid.noteHeight}px`;\r\n    this.domElement.style.left = `${this.start * this.grid.beatWidth}px`;\r\n    this.domElement.style.width = `${this.duration * 100}px`;\r\n  }\r\n}\r\n\r\nexport class Grid extends EventObject<\"update\"> {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly gridElement: HTMLDivElement;\r\n  readonly previewCanvas: HTMLCanvasElement;\r\n  readonly noteHeight = DEFAULT_NOTE_HEIGHT;\r\n  readonly beatWidth = 100;\r\n  readonly noteEditor: LyricEditorDialog;\r\n  private _currentNote: GridItem | null = null;\r\n  private _dragMode: string | null = null;\r\n  private _quantize: number = 0.25;\r\n  private _dragOffset: number = 0;\r\n  private _track: PatternTrack | null = null;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-grid-container\");\r\n\r\n    this.gridElement = document.createElement(\"div\");\r\n    this.gridElement.classList.add(\"piano-roll-grid\");\r\n\r\n    this.previewCanvas = document.createElement(\"canvas\");\r\n\r\n    const rowBackgroundCanvas = document.createElement(\"canvas\");\r\n    rowBackgroundCanvas.width = this.beatWidth * 4;\r\n    rowBackgroundCanvas.height = this.noteHeight;\r\n    console.log(\"debug\", rowBackgroundCanvas.width, rowBackgroundCanvas.height);\r\n    const ctx = rowBackgroundCanvas.getContext(\"2d\");\r\n    if (ctx) {\r\n      ctx.strokeStyle = \"#ddd\";\r\n      ctx.lineWidth = 1;\r\n      for (let j = 1; j < 4; j++) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(j * this.beatWidth, 0);\r\n        ctx.lineTo(j * this.beatWidth, this.noteHeight);\r\n        ctx.stroke();\r\n      }\r\n      ctx.lineWidth = 3;\r\n      ctx.strokeStyle = \"#aaa\";\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, 0);\r\n      ctx.lineTo(0, this.noteHeight);\r\n      ctx.stroke();\r\n    }\r\n    for (let i = 0; i < 88; i++) {\r\n      const row = document.createElement(\"div\");\r\n      row.classList.add(\"piano-roll-grid-row\");\r\n      row.style.height = `${this.noteHeight}px`;\r\n      this.gridElement.appendChild(row);\r\n      row.style.backgroundImage = `url(${rowBackgroundCanvas.toDataURL()})`;\r\n      row.style.backgroundRepeat = \"repeat\";\r\n    }\r\n    this.domElement.appendChild(this.gridElement);\r\n\r\n    this.noteEditor = new LyricEditorDialog((note) => {\r\n      const input = this.noteEditor.domElement.querySelector(\r\n        \".lyric-editor-text\"\r\n      ) as HTMLInputElement;\r\n      note.label = input?.value || \"\";\r\n      note.update();\r\n    });\r\n\r\n    document.body.appendChild(this.noteEditor.domElement);\r\n\r\n    this.gridElement.addEventListener(\"pointerdown\", (event) => {\r\n      if (!this._track) throw new Error(\"No track\");\r\n\r\n      if (!this._track.events) throw new Error(\"No events\");\r\n      \r\n      this._dragOffset = event.layerX;\r\n      event.preventDefault();\r\n      if (this.noteEditor.domElement.style.display === \"block\") {\r\n        this.noteEditor.domElement.style.display = \"none\";\r\n        return;\r\n      }\r\n\r\n      if (\r\n        event.target instanceof HTMLDivElement &&\r\n        event.target.classList.contains(\"piano-roll-note\")\r\n      ) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const note = this._track.events.find(\r\n          (n) => n.domElement === event.target\r\n        );\r\n\r\n        if (event.ctrlKey || event.button === 1) {\r\n          if (note)\r\n            this.noteEditor.show(event.clientX + 20, event.clientY - 5, note);\r\n          else this.noteEditor.domElement.style.display = \"none\";\r\n        }\r\n\r\n        if (note) {\r\n          this._currentNote = note;\r\n\r\n          if (event.button === 2) {\r\n            this.remove(note);\r\n            this._currentNote = null;\r\n          } else {\r\n            note.domElement.parentElement?.appendChild(note.domElement);\r\n            if (this._dragOffset < NOTE_HANDLE_WIDTH) {\r\n              this._dragMode = \"start\";\r\n            } else if (\r\n              note.domElement.offsetWidth - this._dragOffset <\r\n              NOTE_HANDLE_WIDTH\r\n            ) {\r\n              this._dragMode = \"end\";\r\n            } else {\r\n              this._dragMode = \"move\";\r\n            }\r\n            console.log(\r\n              \"drag mode\",\r\n              this._dragMode,\r\n              this._dragOffset,\r\n              note.domElement.offsetWidth\r\n            );\r\n          }\r\n        }\r\n      } else if (event.button !== 0) return;\r\n      else if (event.target === this.gridElement) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const pitch = 87 - Math.floor(event.layerY / this.noteHeight);\r\n\r\n        let start = event.layerX / this.beatWidth;\r\n        start = Math.round(start / this._quantize) * this._quantize;\r\n        console.log(\"start\", start, event.layerX);\r\n\r\n        const item = {\r\n          pitch: pitch,\r\n          start: start,\r\n          duration: 0.25,\r\n          label: \"\",\r\n        };\r\n\r\n        this._currentNote = this.add(new GridItem(this, item));\r\n        this._dragMode = \"end\";\r\n      }\r\n\r\n      this.fireEvent(\"update\", this);\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      this._currentNote = null;\r\n\r\n      this.fireEvent(\"update\", this);\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentNote) {\r\n        this.remove(this._currentNote);\r\n        this._currentNote = null;\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"contextmenu\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointermove\", (event) => {\r\n      if (this._currentNote && event.buttons === 1) {\r\n        if (this._dragMode === \"start\") {\r\n          const oldStart = this._currentNote.start;          \r\n          this._currentNote.start = event.layerX / this.beatWidth;\r\n          this._currentNote.start =\r\n            Math.round(this._currentNote.start / this._quantize) *\r\n            this._quantize;\r\n          this._currentNote.duration = oldStart - this._currentNote.start + this._currentNote.duration;\r\n          this._currentNote.domElement.style.left = `${\r\n            this._currentNote.start * this.beatWidth\r\n          }px`;\r\n          this._currentNote.domElement.style.width = `${\r\n            this._currentNote.duration * this.beatWidth\r\n          }px`;\r\n        } else if (this._dragMode === \"end\") {\r\n          this._currentNote.duration =\r\n            event.layerX / this.beatWidth - this._currentNote.start;\r\n            \r\n          // quantize\r\n          this._currentNote.duration =\r\n            Math.round(this._currentNote.duration / this._quantize) *\r\n            this._quantize;\r\n\r\n          this._currentNote.domElement.style.width = `${\r\n            this._currentNote.duration * this.beatWidth\r\n          }px`;\r\n        } else if (this._dragMode === \"move\") {\r\n          this._currentNote.start =\r\n            (event.layerX - this._dragOffset) / this.beatWidth;\r\n          this._currentNote.start =\r\n            Math.round(this._currentNote.start / this._quantize) *\r\n            this._quantize;\r\n          this._currentNote.domElement.style.left = `${\r\n            this._currentNote.start * this.beatWidth\r\n          }px`;\r\n        } else {\r\n          return;\r\n        }\r\n\r\n        this.fireEvent(\"update\", this);\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentNote) {\r\n        this._currentNote.domElement.style.pointerEvents = \"auto\";\r\n      }\r\n      this._currentNote = null;\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentNote) {\r\n        this._currentNote.domElement.style.pointerEvents = \"auto\";\r\n      }\r\n      this._currentNote = null;\r\n    });\r\n\r\n    this.update();\r\n  }\r\n\r\n  update() {\r\n    this._track?.events.forEach((note) => note.update());\r\n  }\r\n\r\n  add(event: GridItem) {\r\n    if (!this._track) throw new Error(\"add() No track!\");\r\n    this._track.events.push(event);\r\n    console.log(\"Grid: add\", event);\r\n    return event;\r\n  }\r\n\r\n  remove(event: GridItem) {\r\n    if (!this._track) throw new Error(\"remove() No track!\");\r\n    this._track.events.splice(this._track.events.indexOf(event), 1);\r\n    this.gridElement.removeChild(event.domElement);\r\n  }\r\n\r\n  load(track: PatternTrack) {\r\n    console.log(\"Grid: load\", track.events);\r\n    this._track?.events.forEach((event) => event.domElement.remove());\r\n    this._track = track;\r\n    track.events.forEach((event) => {\r\n      this.gridElement.appendChild(event.domElement);\r\n    });\r\n    this.update();\r\n  }\r\n\r\n  renderToCanvas(canvas: HTMLCanvasElement, color: string) {\r\n    if (!this._track) throw new Error(\"renderToCanvas() No track!\");\r\n\r\n    // find lowest note\r\n    let lowestNote = 88;\r\n    this._track.events.forEach((note) => {\r\n      if (note.pitch < lowestNote) lowestNote = note.pitch;\r\n    });\r\n\r\n    // find highest note\r\n    let highestNote = 0;\r\n    this._track.events.forEach((note) => {\r\n      if (note.pitch > highestNote) highestNote = note.pitch;\r\n    });\r\n\r\n    highestNote += 12;\r\n    lowestNote -= 12;\r\n\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    let padded_scale = canvas.height / (highestNote - lowestNote + 1);\r\n\r\n    if (padded_scale > 2) {\r\n      padded_scale = 2;\r\n    }\r\n\r\n    this._track.events.forEach((note) => {\r\n      const y = canvas.height - (note.pitch - lowestNote + 1) * padded_scale;\r\n      const x = note.start * this.beatWidth;\r\n      const width = note.duration * this.beatWidth;\r\n      ctx.fillStyle = color;\r\n      ctx.fillRect(x, y, width, padded_scale);\r\n    });\r\n  }\r\n}\r\n","import {\r\n  DEFAULT_NOTE_HEIGHT,\r\n  KEY_COLORS,\r\n  NOTE_NAMES,\r\n} from \"../../../elements/src/constants/audioConstants\";\r\n\r\nexport class SideKeyboard {\r\n  domElement: HTMLDivElement;\r\n  keys: HTMLDivElement[] = [];\r\n  noteHeight = DEFAULT_NOTE_HEIGHT;\r\n\r\n  constructor() {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-keyboard\");\r\n\r\n    this.redraw();\r\n  }\r\n\r\n  redraw() {\r\n    this.domElement.innerHTML = \"\";\r\n\r\n    for (let i = 87; i >= 0; i--) {\r\n      const key = document.createElement(\"div\");\r\n      key.classList.add(\"piano-roll-keyboard-key\");\r\n      key.style.height = `${this.noteHeight}px`;\r\n      // key.style.bottom = `${i * this.noteHeight}px`;\r\n      key.style.backgroundColor =\r\n        KEY_COLORS[i % 12] === \"white\" ? \"#fff\" : \"#000\";\r\n      key.style.color = KEY_COLORS[i % 12] === \"white\" ? \"#000\" : \"#fff\";\r\n      key.textContent = NOTE_NAMES[i % 12] + ((i / 12) | 0).toString();\r\n      this.domElement.appendChild(key);\r\n    }\r\n  }\r\n}\r\n","import EventObject from \"../../../elements/src/EventObject\";\r\nimport { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { Grid } from \"./Grid\";\r\nimport { PatternTrack } from \"./PatternTrack\";\r\nimport { SideKeyboard } from \"./SideKeyboard\";\r\n\r\nexport class PianoRoll extends EventObject<\"update\"> {\r\n  domElement: HTMLDivElement;\r\n  grid: Grid;\r\n  sideKeyboard: SideKeyboard;\r\n  cursor: HTMLDivElement;\r\n  cursorUpdateInterval: number | object | null = null;\r\n  scheduledSources: AudioBufferSourceNode[] = [];\r\n  track: PatternTrack | null = null;\r\n  color = \"#aaeeff\";\r\n\r\n  constructor(private readonly clock: AudioClock) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll\");\r\n\r\n    this.sideKeyboard = new SideKeyboard();\r\n    this.domElement.appendChild(this.sideKeyboard.domElement);\r\n\r\n    this.grid = new Grid();\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.on(\"update\", () => {\r\n      if (this.track) {\r\n        this.grid.renderToCanvas(this.track.canvas, this.color);\r\n      }\r\n      this.fireEvent(\"update\", this);\r\n    });\r\n\r\n    this.cursor = document.createElement(\"div\");\r\n    this.cursor.classList.add(\"piano-roll-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor);\r\n\r\n    clock.on(\"start\", () => {\r\n      if (this.cursorUpdateInterval) {\r\n        clearInterval(this.cursorUpdateInterval as number);\r\n      }\r\n      this.cursor.style.transform = \"translateX(0)\";\r\n      this.cursor.style.display = \"block\";\r\n      this.cursor.parentElement?.appendChild(this.cursor);\r\n      this.scheduleAudioEvents();\r\n    });\r\n\r\n    clock.on(\"update\", () => {\r\n      this.updateCursor();\r\n    });\r\n\r\n    clock.on(\"stop\", () => {\r\n      this.cursor.style.display = \"none\";\r\n      this.scheduledSources.forEach((source) => source.stop());\r\n      this.scheduledSources = [];\r\n    });\r\n  }\r\n\r\n  updateCursor() {\r\n    if (this.clock.isPlaying) {\r\n      this.cursor.style.transform = `translateX(${\r\n        this.clock.currentBeat * this.grid.beatWidth\r\n      }px)`;\r\n    }\r\n  }\r\n\r\n  scheduleAudioEvents() {\r\n    const ctx = getAudioContext();\r\n    this.track?.events.forEach((note) => {\r\n      const bufferSource = ctx.createBufferSource();\r\n      bufferSource.buffer = note.audio;\r\n      bufferSource.connect(ctx.destination);\r\n      bufferSource.start(ctx.currentTime + (note.start * 60) / this.clock.bpm);\r\n      this.scheduledSources.push(bufferSource);\r\n    });\r\n  }\r\n\r\n  load(track: PatternTrack) {\r\n    this.track = track;\r\n    this.grid.load(track);\r\n  }\r\n}\r\n","import EventObject from \"../../../elements/src/EventObject\";\r\nimport { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\n\r\nexport class AudioClock extends EventObject<\r\n  \"start\" | \"stop\" | \"pause\" | \"update\"\r\n> {\r\n  domElement: HTMLDivElement;\r\n  bpmInput: HTMLInputElement;\r\n  playPauseButton: HTMLButtonElement;\r\n  stopButton: HTMLButtonElement;\r\n  currentTimeDisplay: HTMLSpanElement;\r\n  private _isPlaying: boolean = false;\r\n  private _bpm: number = 100;\r\n  private startTime: number | null = null;\r\n\r\n  get currentBeat(): number {\r\n    const elapsedTime =\r\n      this.startTime !== null\r\n        ? getAudioContext().currentTime - this.startTime\r\n        : 0;\r\n    return elapsedTime * (this._bpm / 60);\r\n  }\r\n\r\n  get isPlaying(): boolean {\r\n    return this._isPlaying;\r\n  }\r\n\r\n  get bpm(): number {\r\n    return this._bpm;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-clock\");\r\n\r\n    this.playPauseButton = document.createElement(\"button\");\r\n    this.playPauseButton.classList.add(\"audio-clock-play-pause\");\r\n    this.playPauseButton.textContent = \"Play\";\r\n\r\n    this.playPauseButton.addEventListener(\"click\", () => {\r\n      if (this._isPlaying) {\r\n        this.stop();\r\n      } else {\r\n        getAudioContext();\r\n        this.play();\r\n      }\r\n    });\r\n    this.domElement.appendChild(this.playPauseButton);\r\n    this.stopButton = document.createElement(\"button\");\r\n    this.stopButton.classList.add(\"audio-clock-stop\");\r\n    this.stopButton.textContent = \"Stop\";\r\n\r\n    this.stopButton.addEventListener(\"click\", () => {\r\n      this.stop();\r\n    });\r\n    this.domElement.appendChild(this.stopButton);\r\n\r\n    this.bpmInput = document.createElement(\"input\");\r\n    this.bpmInput.classList.add(\"audio-clock-bpm\");\r\n    this.bpmInput.type = \"number\";\r\n    this.bpmInput.value = \"120\";\r\n\r\n    this.bpmInput.addEventListener(\"input\", () => {\r\n      this._bpm = parseFloat(this.bpmInput.value);\r\n    });\r\n    this.domElement.appendChild(this.bpmInput);\r\n\r\n    this.currentTimeDisplay = document.createElement(\"span\");\r\n    this.currentTimeDisplay.classList.add(\"audio-clock-time\");\r\n    this.currentTimeDisplay.textContent = \"01:1\";\r\n\r\n    this.domElement.appendChild(this.currentTimeDisplay);\r\n  }\r\n\r\n  private start(): void {\r\n    this.fireEvent(\"start\");\r\n    this.startTime = getAudioContext().currentTime;\r\n    console.log(\"Started at\", this.startTime);\r\n    requestAnimationFrame(this.render.bind(this));\r\n  }\r\n\r\n  private render(): void {\r\n    this.updateCurrentTimeDisplay(this.currentBeat);\r\n    this.fireEvent(\"update\");\r\n    if (this._isPlaying) requestAnimationFrame(this.render.bind(this));\r\n  }\r\n\r\n  private stop(): void {\r\n    this.fireEvent(\"stop\");\r\n    this._isPlaying = false;\r\n    this.startTime = null;\r\n    this.updateCurrentTimeDisplay(this.currentBeat);\r\n    this.playPauseButton.textContent = \"Play\";\r\n  }\r\n\r\n  private play(): void {\r\n    if (this._isPlaying) {\r\n      this.stop(); // TODO: This should be a pause\r\n    } else {\r\n      this.start();\r\n    }\r\n    this._isPlaying = !this._isPlaying;\r\n    this.playPauseButton.textContent = this._isPlaying ? \"Pause\" : \"Play\";\r\n  }\r\n\r\n  private updateCurrentTimeDisplay(beat: number): void {\r\n    const bars = Math.floor(beat / 4) + 1;\r\n    const beats = Math.floor(beat % 4) + 1;\r\n    const timeString = `${bars\r\n      .toString()\r\n      .padStart(2, \"0\")}:${beats.toString()}`;\r\n    this.currentTimeDisplay.textContent = timeString;\r\n  }\r\n}\r\n","import EventObject, { EventDataMap } from \"../EventObject\";\r\n\r\nexport abstract class BaseElement<\r\n  T extends keyof EventDataMap,\r\n> extends EventObject<T> {\r\n  domElement: HTMLElement;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super();\r\n    console.log(\"BaseElement constructor\");\r\n    this.domElement = document.createElement(tagName);\r\n    if (className) {\r\n      this.domElement.classList.add(className);\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class SizableElement<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"resize\" | T> {\r\n  private _resizing = false;\r\n  private _startX = 0;\r\n  private _startY = 0;\r\n  private _startWidth = 0;\r\n  private _startHeight = 0;\r\n  private _startTop = 0;\r\n  private _startLeft = 0;\r\n\r\n  private _resizeDirection: \"top\" | \"right\" | \"bottom\" | \"left\" | null = null;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super(tagName, className);\r\n\r\n    this.domElement.addEventListener(\"pointermove\", (e) => {\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle === \"top\" || handle === \"bottom\") {\r\n        this.domElement.style.cursor = \"ns-resize\";\r\n      } else if (handle === \"left\" || handle === \"right\") {\r\n        this.domElement.style.cursor = \"ew-resize\";\r\n      } else {\r\n        this.domElement.style.cursor = \"auto\";\r\n      }\r\n    });\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      if (this._resizing) {\r\n        console.log(this._resizeDirection);\r\n\r\n        const dx = e.clientX - this._startX;\r\n        const dy = e.clientY - this._startY;\r\n\r\n        if (this._resizeDirection === \"right\") {\r\n          this.domElement.style.width = `${this._startWidth + dx}px`;\r\n        } else if (this._resizeDirection === \"bottom\") {\r\n          this.domElement.style.height = `${this._startHeight + dy}px`;\r\n        } else if (this._resizeDirection === \"left\") {\r\n          this.domElement.style.width = `${this._startWidth - dx}px`;\r\n          this.domElement.style.left = `${this._startLeft + dx}px`;\r\n        } else if (this._resizeDirection === \"top\") {\r\n          this.domElement.style.height = `${this._startHeight - dy}px`;\r\n          this.domElement.style.top = `${this._startTop + dy}px`;\r\n        }\r\n\r\n        this.fireEvent(\"resize\", {\r\n          width: this.domElement.offsetWidth,\r\n          height: this.domElement.offsetHeight,\r\n        });\r\n      }\r\n    };\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle) {\r\n        window.addEventListener(\"pointermove\", onmove);\r\n        this.startResize(e, handle);\r\n      }\r\n      const onrelease = () => {\r\n        this.stopResize();\r\n        window.removeEventListener(\"pointermove\", onmove);\r\n        window.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      window.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n  }\r\n\r\n  protected startResize(\r\n    e: PointerEvent,\r\n    direction: \"top\" | \"right\" | \"bottom\" | \"left\"\r\n  ) {\r\n    console.log(\"startResize\", direction);\r\n    this._resizing = true;\r\n    this._startX = e.clientX;\r\n    this._startY = e.clientY;\r\n    this._startWidth = this.domElement.offsetWidth;\r\n    this._startHeight = this.domElement.offsetHeight;\r\n    this._startTop = this.domElement.offsetTop;\r\n    this._startLeft = this.domElement.offsetLeft;\r\n    this._resizeDirection = direction;\r\n  }\r\n\r\n  protected stopResize() {\r\n    console.log(\"stopResize\");\r\n    this._resizing = false;\r\n    this._resizeDirection = null;\r\n  }\r\n\r\n  getCurrentHandle(e: PointerEvent) {\r\n    const rect = this.domElement.getBoundingClientRect();\r\n    const offsetX = e.clientX - rect.left;\r\n    const offsetY = e.clientY - rect.top;\r\n\r\n    if (offsetX > 0 && offsetX < 10) {\r\n      return \"left\";\r\n    } else if (rect.width - offsetX < 10) {\r\n      return \"right\";\r\n    } else if (offsetY > 0 && offsetY < 10) {\r\n      return \"top\";\r\n    } else if (rect.height - offsetY < 10) {\r\n      return \"bottom\";\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { SizableElement } from \"./SizableElement\";\r\n\r\nexport class DraggableWindow<\r\n  T extends keyof EventDataMap,\r\n> extends SizableElement<\"update\" | \"resize\" | \"open\" | \"close\" | T> {\r\n  readonly titlebar: HTMLElement;\r\n  readonly content: HTMLElement;\r\n  private readonly _title: HTMLElement;\r\n  private readonly _closeButton: HTMLButtonElement;\r\n  private _isDragging = false;\r\n  private _dragOffsetX = 0;\r\n  private _dragOffsetY = 0;\r\n  private _top = 0;\r\n  private _left = 0;\r\n\r\n  get isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    title: string,\r\n    private readonly persistent = false,\r\n    private innerContent: HTMLElement\r\n  ) {\r\n    super(\"div\", \"draggable-window\");\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.domElement.parentElement!.appendChild(this.domElement);\r\n    });\r\n\r\n    this.titlebar = document.createElement(\"div\");\r\n    this.titlebar.className = \"window-titlebar\";\r\n    this.domElement.appendChild(this.titlebar);\r\n\r\n    this.titlebar.addEventListener(\"pointerdown\", (e) => {\r\n      this._isDragging = true;\r\n      this._dragOffsetX =\r\n        e.clientX - this.domElement.getBoundingClientRect().left;\r\n      this._dragOffsetY =\r\n        e.clientY -\r\n        this.domElement.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.scrollTop;\r\n\r\n      const ondrag = (e: PointerEvent) => {\r\n        if (this._isDragging) {\r\n          console.log(\"Dragging\");\r\n\r\n          let newTop = e.clientY - this._dragOffsetY;\r\n          let newLeft = e.clientX - this._dragOffsetX;\r\n\r\n          if (newTop < 0) {\r\n            newTop = 0;\r\n          }\r\n\r\n          if (newLeft < 0) {\r\n            newLeft = 0;\r\n          }\r\n\r\n          this.domElement.style.top = `${newTop}px`;\r\n          this.domElement.style.left = `${newLeft}px`;\r\n\r\n          this._top = newTop;\r\n          this._left = newLeft;\r\n        }\r\n      };\r\n\r\n      const onrelease = () => {\r\n        this._isDragging = false;\r\n        document.body.removeEventListener(\"pointermove\", ondrag);\r\n        document.body.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      document.body.addEventListener(\"pointermove\", ondrag);\r\n      document.body.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n\r\n    this._title = document.createElement(\"div\");\r\n    this._title.className = \"window-titlebar-title\";\r\n    this._title.textContent = title;\r\n    this.titlebar.appendChild(this._title);\r\n\r\n    this.content = document.createElement(\"div\");\r\n    this.content.className = \"window-content\";\r\n    this.domElement.appendChild(this.content);\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.className = \"window-close-button\";\r\n    this._closeButton.innerHTML = \"X\";\r\n    this._closeButton.addEventListener(\"pointerdown\", () => {\r\n      this.close();\r\n    });\r\n\r\n    this.titlebar.appendChild(this._closeButton);\r\n\r\n    this.content.appendChild(this.innerContent);\r\n  }\r\n\r\n  show(x?: number, y?: number) {\r\n    this.domElement.style.display = \"flex\";\r\n    if (y) this.domElement.style.top = `${y}px`;\r\n    if (x) this.domElement.style.left = `${x}px`;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n    this.fireEvent(\"open\");\r\n  }\r\n\r\n  close() {\r\n    this.domElement.style.display = \"none\";\r\n    this.fireEvent(\"close\");\r\n    if (!this.persistent) {\r\n      this.domElement.remove();\r\n    }\r\n  }\r\n\r\n  setSize(width: number, height: number) {\r\n    this.domElement.style.width = `${width}px`;\r\n    this.domElement.style.height = `${height}px`;\r\n  }\r\n\r\n  setPosition(x: number, y: number) {\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { DraggableWindow } from \"./DraggableWindow\";\r\n\r\nexport class WindowContainer {\r\n  readonly domElement: HTMLDivElement;\r\n\r\n  windows: DraggableWindow<keyof EventDataMap>[] = [];\r\n  _draggingWindow: DraggableWindow<keyof EventDataMap> | null = null;\r\n\r\n  constructor() {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.className = \"window-container\";\r\n    this.domElement.addEventListener(\"pointerdown\", () => {});\r\n  }\r\n\r\n  addWindow<T extends DraggableWindow<keyof EventDataMap>>(window: T) {\r\n    this.windows.push(window);\r\n    this.domElement.appendChild(window.domElement);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport { GridItem } from \"./Grid\";\r\n\r\nexport class PatternTrack extends BaseElement<\"update\" | \"select\"> {\r\n  private _canvas: HTMLCanvasElement;\r\n\r\n  get canvas() {\r\n    return this._canvas;\r\n  }\r\n\r\n  constructor(\r\n    name: string,\r\n    readonly events: GridItem[]\r\n  ) {\r\n    super(\"div\", \"pattern-track\");\r\n\r\n    const instrumentPanel = document.createElement(\"div\");\r\n    instrumentPanel.classList.add(\"pattern-track-panel\");\r\n\r\n    const label = document.createElement(\"div\");\r\n    instrumentPanel.appendChild(label);\r\n    label.textContent = name;\r\n\r\n    const buttons = document.createElement(\"div\");\r\n    buttons.classList.add(\"pattern-track-buttons\");\r\n    instrumentPanel.appendChild(buttons);\r\n\r\n    const mute = document.createElement(\"button\");\r\n    mute.textContent = \"M\";\r\n    buttons.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"button\");\r\n    solo.textContent = \"S\";\r\n    buttons.appendChild(solo);\r\n\r\n    const indicator = document.createElement(\"div\");\r\n    indicator.classList.add(\"pattern-track-indicator\");\r\n    buttons.appendChild(indicator);\r\n\r\n    buttons.appendChild(mute);\r\n    buttons.appendChild(solo);\r\n\r\n    this._canvas = document.createElement(\"canvas\");\r\n    this._canvas.height = 100;\r\n    this._canvas.width = 1600;\r\n    this._canvas.classList.add(\"pattern-track-pattern\");\r\n\r\n    this._canvas.addEventListener(\"pointerdown\", () => {\r\n      this.fireEvent(\"select\", this);\r\n    });\r\n\r\n    this.domElement.appendChild(instrumentPanel);\r\n    this.domElement.appendChild(indicator);\r\n    this.domElement.appendChild(this._canvas);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../elements/src/elements/DraggableWindow\";\r\nimport { Composition } from \"./Composition\";\r\nimport { GridItem } from \"./Grid\";\r\nimport { PatternTrack } from \"./PatternTrack\";\r\n\r\nexport class PatternWindow extends DraggableWindow<\"select\"> {\r\n  private _trackContainer: HTMLDivElement;\r\n  readonly tracks: PatternTrack[] = [];\r\n\r\n  constructor(readonly composition: Composition) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"pattern-track-container\");\r\n\r\n    super(\"Pattern\", true, container);\r\n    this._trackContainer = container;\r\n    this.setSize(800, 400);\r\n  }\r\n\r\n  addTrack(name: string, events: GridItem[] = []) {\r\n    const track = new PatternTrack(name, events);\r\n\r\n    track.on(\"select\", (selectedTrack) => {\r\n      this.fireEvent(\"select\", selectedTrack);\r\n    });\r\n    this.tracks.push(track);\r\n    this._trackContainer.appendChild(track.domElement);\r\n\r\n    return track;\r\n  }\r\n\r\n  removeTrack(track: PatternTrack) {\r\n    const index = this.tracks.indexOf(track);\r\n    if (index !== -1) {\r\n      this.tracks.splice(index, 1);\r\n      this._trackContainer.removeChild(track.domElement);\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\n\r\nexport class PlaylistTrack extends BaseElement<\"update\"> {\r\n  constructor(name: string) {\r\n    super(\"div\", \"playlist-track\");\r\n\r\n    const settings = document.createElement(\"div\");\r\n    settings.classList.add(\"instrument-panel\");\r\n\r\n    const label = document.createElement(\"div\");\r\n    settings.appendChild(label);\r\n    label.textContent = name;\r\n\r\n    const buttons = document.createElement(\"div\");\r\n    buttons.classList.add(\"playlist-track-selector\");\r\n    settings.appendChild(buttons);\r\n\r\n    const mute = document.createElement(\"button\");\r\n    mute.textContent = \"M\";\r\n    buttons.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"button\");\r\n    solo.textContent = \"S\";\r\n    buttons.appendChild(solo);\r\n\r\n    const track = document.createElement(\"div\");\r\n    track.classList.add(\"pattern-panel\");\r\n\r\n    this.domElement.appendChild(settings);\r\n    this.domElement.appendChild(track);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../elements/src/elements/DraggableWindow\";\r\nimport { Composition } from \"./Composition\";\r\nimport { PlaylistTrack } from \"./PlaylistTrack\";\r\nimport { AudioClock } from \"./AudioClock\";\r\n\r\nexport class PlaylistWindow extends DraggableWindow<\"update\" | \"select\"> {\r\n  private _trackContainer: HTMLDivElement;\r\n  private _tracks: PlaylistTrack[] = [];\r\n  private cursor: HTMLDivElement;\r\n\r\n  constructor(\r\n    readonly clock: AudioClock,\r\n    readonly composition: Composition\r\n  ) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"playlist-track-container\");\r\n\r\n    super(\"Playlist\", true, container);\r\n    this._trackContainer = container;\r\n    this.setSize(800, 400);\r\n\r\n    this.cursor = document.createElement(\"div\");\r\n    this.cursor.classList.add(\"piano-roll-cursor\");\r\n    this.cursor.style.display = \"none\";\r\n    this._trackContainer.appendChild(this.cursor);\r\n\r\n    clock.on(\"update\", () => {\r\n      this.updateCursor();\r\n    });\r\n  }\r\n\r\n  addTrack(name: string) {\r\n    const track = new PlaylistTrack(name);\r\n    this._tracks.push(track);\r\n    this._trackContainer.appendChild(track.domElement);\r\n    this._trackContainer.appendChild(this.cursor);\r\n  }\r\n\r\n  updateCursor() {\r\n    if (this.clock.isPlaying) {\r\n      this.cursor.style.transform = `translateX(${\r\n        (this.clock.currentBeat * this._trackContainer.offsetWidth) / 16\r\n      }px)`;\r\n    }\r\n  }\r\n}\r\n","import { PianoRoll } from \"./elements/PianoRoll\";\r\nimport { AudioClock } from \"./elements/AudioClock\";\r\nimport { DraggableWindow } from \"../../elements/src/elements/DraggableWindow\";\r\nimport { WindowContainer } from \"../../elements/src/elements/WindowContainer\";\r\nimport { PatternWindow } from \"./elements/PatternWindow\";\r\nimport { PlaylistWindow } from \"./elements/PlaylistWindow\";\r\nimport { Composition } from \"./elements/Composition\";\r\nimport { PatternTrack } from \"./elements/PatternTrack\";\r\n\r\n\r\nconst domElement = document.createElement(\"div\");\r\ndomElement.style.display = \"flex\";\r\ndomElement.style.flexDirection = \"column\";\r\ndomElement.style.width = \"100%\";\r\ndomElement.style.height = \"100%\";\r\n\r\nconst audioClock = new AudioClock();\r\ndomElement.appendChild(audioClock.domElement);\r\n\r\nconst container = new WindowContainer();\r\ndomElement.appendChild(container.domElement);\r\n\r\nconst composition = new Composition();\r\n\r\nconst pianoRoll = new PianoRoll(audioClock);\r\n\r\nconst pianoRollWindow = new DraggableWindow(\r\n  \"Piano Roll\",\r\n  true,\r\n  pianoRoll.domElement\r\n);\r\n\r\ncontainer.addWindow(pianoRollWindow);\r\npianoRollWindow.setSize(800, 400);\r\n\r\npianoRollWindow.setPosition(window.innerWidth / 2, 100);\r\n\r\nconst patternWindow = new PatternWindow(composition);\r\npianoRoll.load(patternWindow.addTrack(\"Kick\"));\r\npatternWindow.addTrack(\"Snare\");\r\npatternWindow.addTrack(\"Hats\");\r\npatternWindow.addTrack(\"Bass\");\r\npatternWindow.addTrack(\"Lead\");\r\npatternWindow.show(100, 100);\r\ncontainer.addWindow(patternWindow);\r\n\r\npatternWindow.on(\"select\", (selectedTrack) => {\r\n  console.log(\"select\", selectedTrack);\r\n  pianoRoll.load(selectedTrack as PatternTrack);\r\n  pianoRollWindow.show();\r\n});\r\n\r\nconst playlistWindow = new PlaylistWindow(audioClock, composition);\r\nfor (let i = 1; i <= 9; i++) {\r\n  playlistWindow.addTrack(`Pattern ${i}`);\r\n}\r\ncontainer.addWindow(playlistWindow);\r\n// playlistWindow.show(600, 100);\r\n\r\ndocument.body.appendChild(domElement);\r\n","import { GridItem } from \"./Grid\";\r\n\r\nexport class Composition {\r\n  title: string;\r\n  description: string;\r\n  tempo: number;\r\n  patterns: GridItem[][] = [[]];\r\n\r\n  constructor() {\r\n    this.title = \"Untitled\";\r\n    this.description = \"No description\";\r\n    this.tempo = 120;\r\n  }\r\n}\r\n"],"names":["exports","Symbol","toStringTag","Object","defineProperty","value","_events","_onceEvents","on","eventName","callback","this","push","once","fireEvent","eventData","onceCallbacks","error","console","undefined","callbacks","audioContext","getAudioContext","window","AudioContext","webkitAudioContext","log","buffer","createBuffer","sampleRate","source","createBufferSource","connect","destination","start","KEY_COLORS","NOTE_NAMES","domElement","document","createElement","classList","add","canvas","width","height","appendChild","addEventListener","playBuffer","ctx","getContext","generateAudio","note","preview","Promise","resolve","reject","req","text","label","pitch","rate","fetch","method","body","JSON","stringify","headers","then","res","arrayBuffer","data","decodeAudioData","audioBuffer","catch","loadBuffer","channelData","getChannelData","bufferLength","length","sliceWidth","clearRect","beginPath","moveTo","i","x","y","lineTo","stroke","AudioCanvas","ok","cancel","closeButton","textContent","style","display","HTMLButtonElement","okButton","cancelButton","show","targetObject","left","top","parentElement","hide","onsave","textInput","setAttribute","type","pitchSlider","min","max","step","parseFloat","audioCanvas","LyricCanvas","saveButton","audio","DialogPopup","getNoteNameFromPitch","Math","floor","grid","item","velocity","duration","noteHeight","noteLabel","lyricLabel","update","gridElement","beatWidth","_currentNote","_dragMode","_quantize","_dragOffset","_track","previewCanvas","rowBackgroundCanvas","strokeStyle","lineWidth","j","row","backgroundImage","toDataURL","backgroundRepeat","noteEditor","LyricEditorDialog","input","querySelector","event","Error","events","layerX","preventDefault","target","HTMLDivElement","contains","find","n","ctrlKey","button","clientX","clientY","remove","offsetWidth","layerY","round","GridItem","buttons","oldStart","pointerEvents","forEach","splice","indexOf","removeChild","load","track","renderToCanvas","color","lowestNote","highestNote","padded_scale","fillStyle","fillRect","keys","redraw","innerHTML","key","backgroundColor","toString","clock","cursorUpdateInterval","scheduledSources","sideKeyboard","SideKeyboard","Grid","cursor","clearInterval","transform","scheduleAudioEvents","updateCursor","stop","isPlaying","currentBeat","bufferSource","currentTime","bpm","_isPlaying","_bpm","startTime","playPauseButton","play","stopButton","bpmInput","currentTimeDisplay","requestAnimationFrame","render","bind","updateCurrentTimeDisplay","beat","bars","beats","timeString","padStart","tagName","className","_resizing","_startX","_startY","_startWidth","_startHeight","_startTop","_startLeft","_resizeDirection","e","handle","getCurrentHandle","onmove","dx","dy","offsetHeight","startResize","onrelease","stopResize","removeEventListener","direction","offsetTop","offsetLeft","rect","getBoundingClientRect","offsetX","offsetY","BaseElement","title","persistent","innerContent","_isDragging","_dragOffsetX","_dragOffsetY","_top","_left","titlebar","scrollTop","ondrag","newTop","newLeft","_title","content","_closeButton","close","setSize","setPosition","SizableElement","windows","_draggingWindow","addWindow","name","instrumentPanel","mute","solo","indicator","_canvas","composition","container","tracks","_trackContainer","addTrack","PatternTrack","selectedTrack","removeTrack","index","DraggableWindow","settings","_tracks","PlaylistTrack","flexDirection","audioClock","AudioClock","WindowContainer","patterns","description","tempo","pianoRoll","PianoRoll","pianoRollWindow","innerWidth","patternWindow","PatternWindow","playlistWindow","PlaylistWindow"],"sourceRoot":""}