{"version":3,"file":"monofy-studio.js","mappings":"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","sources":["webpack://monofy/webpack/bootstrap","webpack://monofy/webpack/runtime/make namespace object","webpack://monofy/../elements/src/EventObject.ts","webpack://monofy/../elements/src/managers/AudioManager.ts","webpack://monofy/./src/elements/components/AudioClock.ts","webpack://monofy/../elements/src/UUID.ts","webpack://monofy/../elements/src/elements/BaseElement.ts","webpack://monofy/../elements/src/elements/TreeView.ts","webpack://monofy/./src/plugins/plugins.ts","webpack://monofy/./src/abstracts/MathHelpers.ts","webpack://monofy/./src/elements/Mixer.ts","webpack://monofy/./src/elements/Project.ts","webpack://monofy/../elements/src/elements/WindowSnapPanel.ts","webpack://monofy/../elements/src/elements/WindowContainer.ts","webpack://monofy/../elements/src/elements/PopupNotification.ts","webpack://monofy/./src/constants.ts","webpack://monofy/./src/elements/components/Keyboard.ts","webpack://monofy/../elements/src/elements/SizableElement.ts","webpack://monofy/../elements/src/elements/DraggableWindow.ts","webpack://monofy/../elements/src/elements/SelectableGroup.ts","webpack://monofy/../elements/src/elements/SelectableElement.ts","webpack://monofy/./src/elements/components/MuteSoloButtons.ts","webpack://monofy/./src/elements/components/MixerChannelStrip.ts","webpack://monofy/./src/elements/windows/MixerWindow.ts","webpack://monofy/./src/elements/components/AudioCursor.ts","webpack://monofy/../elements/src/animation.ts","webpack://monofy/./src/abstracts/GraphicsHelpers.ts","webpack://monofy/./src/elements/components/PatternTrack.ts","webpack://monofy/./src/elements/windows/PatternWindow.ts","webpack://monofy/../elements/src/elements/ScrollPanel.ts","webpack://monofy/../elements/src/elements/DialogPopup.ts","webpack://monofy/./src/elements/audioDialogs.ts","webpack://monofy/./src/elements/components/Grid.ts","webpack://monofy/./src/elements/components/SideKeyboard.ts","webpack://monofy/./src/elements/components/PianoRoll.ts","webpack://monofy/./src/elements/windows/PianoRollWindow.ts","webpack://monofy/../elements/src/elements/ContextMenu.ts","webpack://monofy/./src/elements/components/PlaylistTrack.ts","webpack://monofy/./src/elements/components/Playlist.ts","webpack://monofy/../elements/src/importers/AudioImporter.ts","webpack://monofy/../elements/src/importers/FileImporter.ts","webpack://monofy/./src/elements/ProjectTreeView.ts","webpack://monofy/../elements/src/elements/ImagePreview.ts","webpack://monofy/./src/elements/windows/ImagePreviewWindow.ts","webpack://monofy/../elements/src/elements/DraggableNumber.ts","webpack://monofy/./src/elements/components/TimePositionInput.ts","webpack://monofy/./src/elements/components/WaveEditor.ts","webpack://monofy/./src/elements/windows/WaveEditorWindow.ts","webpack://monofy/./src/elements/windows/ProjectWindow.ts","webpack://monofy/./src/elements/ProjectUI.ts","webpack://monofy/./src/abstracts/Instrument.ts","webpack://monofy/./src/abstracts/SynthesizerVoice.ts","webpack://monofy/./src/abstracts/PluginControl.ts","webpack://monofy/./src/elements/components/Slider.ts","webpack://monofy/./src/elements/components/Envelope.ts","webpack://monofy/./src/abstracts/InstrumentWindow.ts","webpack://monofy/./src/elements/components/Knob.ts","webpack://monofy/./src/plugins/fmbass/FMBassWindow.ts","webpack://monofy/./src/plugins/fmbass/FMBass.ts","webpack://monofy/./src/abstracts/Synthesizer.ts","webpack://monofy/./src/plugins/fmpiano/FMPiano.ts","webpack://monofy/./src/plugins/sampler/Sampler.ts","webpack://monofy/./src/plugins/sampler/MultisamplerWindow.ts","webpack://monofy/./src/plugins/sampler/Multisampler.ts","webpack://monofy/./src/index.ts","webpack://monofy/./src/schema.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { BaseElement } from \"./elements/BaseElement\";\r\n\r\nexport interface IBaseEvent {\r\n  target: BaseElement;\r\n  event: PointerEvent;\r\n}\r\n\r\nexport interface IDragEvent extends IBaseEvent {\r\n  top: number;\r\n  left: number;\r\n  deltaX: number;\r\n  deltaY: number;\r\n}\r\n\r\nexport interface IResizeEvent extends IBaseEvent {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface EventDataMap {\r\n  cancel: unknown;\r\n  start: unknown;\r\n  stop: unknown;\r\n  pause: unknown;\r\n  result: unknown;\r\n  update: unknown;\r\n  open: unknown;\r\n  close: unknown;\r\n  edit: unknown;\r\n  keydown: KeyboardEvent;\r\n  keyup: KeyboardEvent;\r\n  release: unknown;\r\n  resize: IResizeEvent;\r\n  select: IBaseEvent;\r\n  scroll: WheelEvent;\r\n  add: unknown;\r\n  remove: unknown;\r\n  change: unknown;\r\n  drag: IDragEvent;\r\n  shown: void;\r\n}\r\n\r\nexport type BaseEvent = keyof EventDataMap;\r\n\r\nexport default abstract class EventObject<E extends BaseEvent = BaseEvent> {\r\n  private _events: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n  private _onceEvents: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n\r\n  on(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._events[eventName]) {\r\n      this._events[eventName] = [];\r\n    }\r\n    this._events[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  once(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._onceEvents[eventName]) {\r\n      this._onceEvents[eventName] = [];\r\n    }\r\n    this._onceEvents[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  emit(eventName: E, eventData?: unknown) {\r\n    const onceCallbacks = this._onceEvents[eventName];\r\n    if (onceCallbacks) {\r\n      for (const callback of onceCallbacks) {\r\n        try {\r\n          callback(eventData as EventDataMap[E]);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .once callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n      this._onceEvents[eventName] = undefined;\r\n    }\r\n\r\n    const callbacks = this._events[eventName];\r\n    if (callbacks) {\r\n      for (const callback of callbacks) {\r\n        try {\r\n          callback(eventData as EventDataMap[E]);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .on callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  removeAllListeners() {\r\n    this._events = {};\r\n    this._onceEvents = {};\r\n  }\r\n}\r\n","let audioContext: AudioContext | null = null;\r\n\r\nconst AudioContext = window.AudioContext || (window as any).webkitAudioContext;\r\n\r\nexport function getAudioContext() {\r\n  if (!audioContext) {\r\n    audioContext = new AudioContext({\r\n      latencyHint: \"interactive\",\r\n      sampleRate: 44100,\r\n    });\r\n    getAudioDevices().then((devices) => {\r\n      console.log(\"Audio devices\", devices);\r\n    });\r\n    console.log(\"Audio context created\");    \r\n\r\n    return audioContext;\r\n  }\r\n\r\n  if (audioContext.state === \"suspended\") {\r\n    audioContext.resume();\r\n  }\r\n\r\n  return audioContext;\r\n}\r\n\r\nexport async function getAudioDevices() {\r\n  if (\"setSinkId\" in AudioContext.prototype) {\r\n    const devices = await navigator.mediaDevices.enumerateDevices();\r\n    return devices;\r\n  }\r\n  return null;\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\n\r\n/**\r\n * Represents an audio clock that provides functionality for controlling audio playback and scheduling events.\r\n */\r\nexport class AudioClock extends EventObject<\"start\" | \"stop\" | \"pause\" | \"update\"> {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly bpmInput: HTMLInputElement;\r\n  readonly playPauseButton: HTMLButtonElement;\r\n  readonly stopButton: HTMLButtonElement;\r\n  readonly currentTimeDisplay: HTMLSpanElement;\r\n  private _playbackMode: \"pattern\" | \"playlist\" = \"pattern\";\r\n  private _audioContext: AudioContext | null = null;\r\n  private _bpm: number = 100;\r\n  private _scheduledEvents: {\r\n    source: AudioBufferSourceNode;\r\n    time: number;\r\n    callback: () => void;\r\n  }[] = [];\r\n  private _startTime: number | null = null;\r\n\r\n  get startTime(): number | null {\r\n    return this._startTime;\r\n  }\r\n\r\n  get currentTime(): number {\r\n    return this.audioContext.currentTime;\r\n  }\r\n\r\n  get audioContext(): AudioContext {\r\n    if (!this._audioContext) {\r\n      this._audioContext = getAudioContext();\r\n    }\r\n    return this._audioContext;\r\n  }\r\n\r\n  get currentBeat(): number {\r\n    const elapsedTime =\r\n      this._startTime !== null\r\n        ? this.audioContext.currentTime - this._startTime\r\n        : 0;\r\n    return elapsedTime * (this._bpm / 60);\r\n  }\r\n\r\n  get isPlaying(): boolean {\r\n    return this._startTime != null && this._startTime >= 0;\r\n  }\r\n\r\n  get bpm(): number {\r\n    return this._bpm;\r\n  }\r\n\r\n  get playbackMode(): \"pattern\" | \"playlist\" {\r\n    return this._playbackMode;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-clock\");\r\n\r\n    this.playPauseButton = document.createElement(\"button\");\r\n    this.playPauseButton.classList.add(\"audio-clock-play-pause\");\r\n\r\n    this.playPauseButton.addEventListener(\"click\", () => {\r\n      if (this.isPlaying) {\r\n        this.stop();\r\n      } else {\r\n        getAudioContext();\r\n        this.playPause();\r\n      }\r\n    });\r\n    this.domElement.appendChild(this.playPauseButton);\r\n    this.stopButton = document.createElement(\"button\");\r\n    this.stopButton.classList.add(\"audio-clock-stop\");\r\n    this.stopButton.textContent = \"\\u25A0\";\r\n\r\n    this.stopButton.addEventListener(\"click\", () => {\r\n      this.stop();\r\n    });\r\n    this.domElement.appendChild(this.stopButton);\r\n\r\n    this.bpmInput = document.createElement(\"input\");\r\n    this.bpmInput.classList.add(\"audio-clock-bpm\");\r\n    this.bpmInput.type = \"number\";\r\n    this.bpmInput.value = \"120\";\r\n\r\n    this.bpmInput.addEventListener(\"input\", () => {\r\n      this._bpm = parseFloat(this.bpmInput.value);\r\n    });\r\n    this.domElement.appendChild(this.bpmInput);\r\n\r\n    this.currentTimeDisplay = document.createElement(\"span\");\r\n    this.currentTimeDisplay.classList.add(\"audio-clock-time\");\r\n    this.currentTimeDisplay.textContent = \"01:1\";\r\n\r\n    this.domElement.appendChild(this.currentTimeDisplay);\r\n  }\r\n\r\n  getBeatTime(beat: number, reference_time = this.currentTime): number {\r\n    return reference_time + beat * (this.bpm / 60);\r\n  }\r\n\r\n  start(): void {\r\n    this._startTime = this.audioContext.currentTime;\r\n    console.log(\"Started at\", this._startTime);\r\n    requestAnimationFrame(this._render.bind(this));\r\n    this.emit(\"start\");\r\n  }\r\n\r\n  private _render(): void {\r\n    this._update(this.currentBeat);\r\n    this.emit(\"update\");\r\n    if (this.isPlaying) requestAnimationFrame(this._render.bind(this));\r\n  }\r\n\r\n  stop(): void {\r\n    this.emit(\"stop\");\r\n    this._startTime = null;\r\n\r\n    for (const { source } of this._scheduledEvents) {\r\n      source.stop();\r\n      source.disconnect();\r\n    }\r\n    this._scheduledEvents = [];\r\n\r\n    this.playPauseButton.classList.remove(\"active\");\r\n\r\n    this._update(this.currentBeat);\r\n  }\r\n\r\n  restart() {\r\n    if (this.isPlaying) {\r\n      this._startTime = this.audioContext.currentTime;\r\n    }\r\n  }\r\n\r\n  playPause(): void {\r\n    if (this.isPlaying) {\r\n      this.stop(); // TODO: This should be a pause\r\n    } else {\r\n      const buffer = this.audioContext.createBuffer(\r\n        1,\r\n        1,\r\n        this.audioContext.sampleRate\r\n      );\r\n      const source = this.audioContext.createBufferSource();\r\n      source.buffer = buffer;\r\n      source.connect(this.audioContext.destination);\r\n      source.start();\r\n\r\n      this.start();\r\n    }\r\n    this.playPauseButton.classList.toggle(\"active\", this.isPlaying);\r\n  }\r\n\r\n  private _update(beat: number): void {\r\n    const bars = Math.floor(beat / 4) + 1;\r\n    const beats = Math.floor(beat % 4) + 1;\r\n    const timeString = `${bars\r\n      .toString()\r\n      .padStart(2, \"0\")}:${beats.toString()}`;\r\n    this.currentTimeDisplay.textContent = timeString;\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtTime(callback: () => void, time: number): void {\r\n    const emptyBuffer = this.audioContext.createBuffer(\r\n      1,\r\n      1,\r\n      this.audioContext.sampleRate\r\n    );\r\n    const source = this.audioContext.createBufferSource();\r\n    source.buffer = emptyBuffer;\r\n    source.connect(this.audioContext.destination);\r\n    source.onended = () => callback();\r\n    source.start(time);\r\n    this._scheduledEvents.push({ source, time, callback });\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtBeat(callback: () => void, beat: number): void {\r\n    const time = this._startTime! + (beat / this._bpm) * 60;\r\n    this.scheduleEventAtTime(callback, time);\r\n  }\r\n}\r\n","export abstract class UUID {\r\n  static random(): string {\r\n    return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (c) => {\r\n      const r = Math.random() * 16 | 0;\r\n      const v = c === \"x\" ? r : (r & 0x3 | 0x8);\r\n      return v.toString(16);\r\n    });\r\n  }\r\n\r\n  static zero() {\r\n    return \"00000000-0000-0000-0000-000000000000\";\r\n  }\r\n}\r\n","import EventObject, { EventDataMap } from \"../EventObject\";\r\n\r\nexport abstract class BaseElement<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n  E extends HTMLElement = HTMLElement,\r\n> extends EventObject<T> {\r\n  readonly domElement: E;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super();\r\n    this.domElement = document.createElement(tagName) as E;\r\n    if (className) {\r\n      this.domElement.classList.add(className);\r\n    }\r\n  }\r\n\r\n  dispose() {    \r\n    this.removeAllListeners();\r\n    this.domElement.remove();\r\n  }  \r\n\r\n  appendChild(child: BaseElement<keyof EventDataMap>) {\r\n    this.domElement.appendChild(child.domElement);\r\n    return this;\r\n  }\r\n\r\n  removeChild(child: BaseElement<keyof EventDataMap>) {\r\n    this.domElement.removeChild(child.domElement);\r\n    return this;\r\n  }\r\n}\r\n","import { UUID } from \"../UUID\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\ntype TreeViewItemType = \"file\" | \"folder\" | string;\r\n\r\ninterface ITreeViewItem {\r\n  type: TreeViewItemType;\r\n  name: string;\r\n  id: string;\r\n  parentId: string | null;\r\n  data?: unknown;\r\n  thumbnail?: string;\r\n}\r\n\r\nexport class TreeViewItem\r\n  extends BaseElement<\"add\" | \"change\">\r\n  implements ITreeViewItem\r\n{\r\n  protected _content: HTMLDivElement;\r\n  protected _label: HTMLDivElement;\r\n  protected _icon: HTMLDivElement;\r\n\r\n  get name() {\r\n    return this.item.name;\r\n  }\r\n\r\n  get id() {\r\n    return this.item.id;\r\n  }\r\n\r\n  get parentId() {\r\n    return this.item.parentId;\r\n  }\r\n\r\n  get type() {\r\n    return this.item.type;\r\n  }\r\n\r\n  get data() {\r\n    return this.item.data;\r\n  }\r\n\r\n  constructor(readonly item: ITreeViewItem) {\r\n    super(\"div\", \"treeview-item\");\r\n\r\n    this._content = document.createElement(\"div\");\r\n    this._content.classList.add(\"treeview-item-content\");\r\n\r\n    this._icon = document.createElement(\"div\");\r\n    this._icon.classList.add(\"treeview-icon\");\r\n    this._content.appendChild(this._icon);\r\n\r\n    this._label = document.createElement(\"div\");\r\n    this._label.textContent = item.name;\r\n    this._label.classList.add(\"treeview-item-label\");\r\n    this._content.appendChild(this._label);\r\n    this.domElement.id = item.id;\r\n    this.domElement.classList.add(item.type);\r\n\r\n    this.domElement.appendChild(this._content);\r\n  }\r\n\r\n  rename() {\r\n    const newName = prompt(\"Enter new name\", this.name);\r\n    if (newName) {\r\n      this.item.name = newName;\r\n      const data = this.item.data as object;\r\n      if (data && \"name\" in data) {\r\n        data.name = newName;\r\n      }\r\n      this._label.textContent = newName;\r\n      this.emit(\"change\", this);\r\n    }\r\n  }\r\n}\r\n\r\nexport class TreeViewFolder extends TreeViewItem {\r\n  private readonly _expander: HTMLDivElement;\r\n  private _childContainer?: HTMLDivElement;\r\n\r\n  get expanded() {\r\n    return this.domElement.classList.contains(\"expanded\");\r\n  }\r\n\r\n  constructor(readonly item: ITreeViewItem) {\r\n    super({ ...item, type: \"folder\" });\r\n\r\n    this._expander = document.createElement(\"div\");\r\n    this._expander.classList.add(\"treeview-expander\");\r\n    this._expander.textContent = \"+\";\r\n    this._content.insertBefore(this._expander, this._label);\r\n\r\n    this._expander.addEventListener(\"pointerdown\", () => this.toggle());\r\n\r\n    this.domElement.addEventListener(\"dragover\", (e) => {\r\n      e.preventDefault();\r\n    });\r\n\r\n    this.domElement.addEventListener(\"drop\", (e) => {\r\n      e.preventDefault();\r\n      const id = e.dataTransfer?.getData(\"text/plain\");\r\n      this.emit(\"change\", { id, parentId: this.id });\r\n    });\r\n\r\n    this._content.addEventListener(\"dblclick\", (e) => {\r\n      if (e.target != this._content) return;\r\n      this.toggle();\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    });\r\n  }\r\n\r\n  clear() {\r\n    this._childContainer?.remove();\r\n    this._childContainer = undefined;\r\n  }\r\n\r\n  toggle(expanded?: boolean) {\r\n    this.domElement.classList.toggle(\"expanded\", expanded);\r\n\r\n    if (this.domElement.classList.contains(\"expanded\")) {\r\n      this._expander.textContent = \"-\";\r\n    } else {\r\n      this._expander.textContent = \"+\";\r\n    }\r\n  }\r\n\r\n  add<T extends TreeViewItem>(\r\n    type: TreeViewItemType,\r\n    name: string,\r\n    id?: string,\r\n    data?: unknown\r\n  ): T {\r\n    const item = new (type == \"folder\" ? TreeViewFolder : TreeViewItem)({\r\n      type,\r\n      name,\r\n      id: id || UUID.random(),\r\n      parentId: this.id,\r\n    });\r\n    if (data) item.item.data = data;\r\n\r\n    if (id) {\r\n      console.log(\"Special item\", id);\r\n      item.domElement.classList.toggle(\"special\", true);\r\n    }\r\n\r\n    if (!this._childContainer) {\r\n      this._childContainer = document.createElement(\"div\");\r\n      this._childContainer.classList.add(\"treeview-children\");\r\n      this.domElement.appendChild(this._childContainer);\r\n    }\r\n\r\n    this._childContainer.appendChild(item.domElement);\r\n    this.emit(\"add\", item);\r\n    item.on(\"add\", (item) => this.emit(\"add\", item));\r\n    return item as T;\r\n  }\r\n\r\n  addItem(item: TreeViewItem) {\r\n    if (item.domElement.contains(this.domElement)) {\r\n      console.error(\"Cannot add parent to child\");\r\n      return;\r\n    }\r\n\r\n    if (!this._childContainer) {\r\n      this._childContainer = document.createElement(\"div\");\r\n      this._childContainer.classList.add(\"treeview-children\");\r\n      this.domElement.appendChild(this._childContainer);\r\n    }\r\n\r\n    this._childContainer.appendChild(item.domElement);\r\n  }\r\n}\r\n\r\nexport class TreeView extends BaseElement<\"select\" | \"change\" | \"open\"> {\r\n  readonly root: TreeViewFolder;\r\n  private readonly _items: Map<string, TreeViewItem> = new Map();\r\n  private _selectedItem: TreeViewItem | null = null;\r\n\r\n  get selectedItem() {\r\n    return this._selectedItem;\r\n  }\r\n\r\n  set selectedItem(value: TreeViewItem | null) {\r\n    this._selectedItem?.domElement.classList.toggle(\"selected\", false);\r\n    if (value) {\r\n      if (value.parentId) {\r\n        const parent = this.get(value.parentId);\r\n        if (parent instanceof TreeViewFolder) {\r\n          parent.toggle(true);\r\n        }\r\n      }\r\n      this._selectedItem = value;\r\n      value.domElement.classList.toggle(\"selected\", true);\r\n      this.emit(\"select\", value);\r\n    } else {\r\n      this._selectedItem = null;\r\n    }\r\n  }\r\n\r\n  constructor(rootName = \"/\") {\r\n    super(\"div\", \"treeview\");\r\n    this.root = new TreeViewFolder({\r\n      type: \"folder\",\r\n      name: rootName,\r\n      id: \"root\",\r\n      parentId: null,\r\n    });\r\n    this.root.domElement.classList.toggle(\"special\", true);\r\n    this._items.set(this.root.id, this.root);\r\n    this.root.toggle(true);\r\n    this.domElement.appendChild(this.root.domElement);\r\n\r\n    this.root.on(\"add\", (item) => {\r\n      const newItem = item as TreeViewItem;\r\n      this._items.set(newItem.id, newItem);\r\n      newItem.on(\"change\", (e) => {\r\n        const evt = e as { id: string; parentId: string };\r\n        const item = this._items.get(evt.id);\r\n        const parent = this._items.get(evt.parentId);\r\n        if (!item) {\r\n          throw new Error(\"Item not found: \" + evt.id);\r\n        }\r\n        if (!parent) {\r\n          throw new Error(\"Parent not found: \" + evt.parentId);\r\n        }\r\n        item.item.parentId = evt.parentId;\r\n        parent.domElement.appendChild(item.domElement);\r\n        this.emit(\"change\", e);\r\n      });\r\n    });\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      const target = e.target as HTMLElement;\r\n\r\n      if (!this.domElement.classList.contains(\"active\")) {\r\n        const onpointerdown = (p: PointerEvent) => {\r\n          if (\r\n            p.target &&\r\n            !this.domElement.contains(p.target as HTMLElement) &&\r\n            this.domElement.classList.contains(\"active\")\r\n          ) {\r\n            this.domElement.classList.toggle(\"active\", false);\r\n            window.removeEventListener(\"pointerdown\", onpointerdown);\r\n            window.removeEventListener(\"keydown\", onkeydown);\r\n            console.log(\"Treeview inactive\");\r\n          }\r\n        };\r\n\r\n        const onkeydown = (e: Event) => {\r\n          const event = e as KeyboardEvent;\r\n          console.log(\"Keydown\", event.key);\r\n\r\n          if (\r\n            event.key === \"ArrowRight\" &&\r\n            this._selectedItem instanceof TreeViewFolder\r\n          ) {\r\n            this._selectedItem.toggle(true);\r\n          } else if (\r\n            event.key === \"ArrowLeft\" &&\r\n            this._selectedItem instanceof TreeViewFolder\r\n          ) {\r\n            this._selectedItem.toggle(false);\r\n          }\r\n        };\r\n\r\n        this.domElement.classList.toggle(\"active\", true);\r\n        window.addEventListener(\"pointerdown\", onpointerdown);\r\n        window.addEventListener(\"keydown\", onkeydown);\r\n        console.log(\"Treeview active\");\r\n      }\r\n\r\n      if (target == this.domElement) {\r\n        this.deselect();\r\n        return;\r\n      }\r\n\r\n      if (!target.classList.contains(\"treeview-item-content\")) {\r\n        return;\r\n      }\r\n\r\n      const item = this._items.get(target.parentElement!.id);\r\n\r\n      if (!item) {\r\n        throw new Error(\"Item not found: \" + target.parentElement!.id);\r\n      }\r\n\r\n      if (item != this._selectedItem) {\r\n        this._selectedItem?.domElement.classList.toggle(\"selected\", false);\r\n        this._selectedItem = item;\r\n        item.domElement.classList.toggle(\"selected\", true);\r\n        this.emit(\"select\", item);\r\n      }\r\n\r\n      if (!item.domElement.classList.contains(\"special\")) {\r\n        console.log(\"TreeView: Drag started\");\r\n        this.domElement.classList.toggle(\"dragging\", true);\r\n      }\r\n    });\r\n\r\n    this.domElement.addEventListener(\"pointerup\", (e) => {\r\n      if (!this.domElement.classList.contains(\"dragging\")) {\r\n        return;\r\n      }\r\n\r\n      this.domElement.classList.toggle(\"dragging\", false);\r\n\r\n      console.log(\"Selected Element\", this._selectedItem?.name);\r\n\r\n      const elt = (e.target as HTMLElement)?.parentElement; // we are actually dropping it on _content\r\n\r\n      if (this._selectedItem?.domElement.contains(elt)) {\r\n        console.log(\"Dropped on self\");\r\n        return;\r\n      }\r\n\r\n      if (!elt) {\r\n        console.error(\"No target element\");\r\n        return;\r\n      }\r\n\r\n      const target: TreeViewFolder = this.get(elt.id);\r\n\r\n      if (!(target instanceof TreeViewFolder)) {\r\n        console.error(\"Target is not a folder\");\r\n        return;\r\n      }\r\n\r\n      if (!target) {\r\n        console.error(\"Target item not found\");\r\n        return;\r\n      }\r\n\r\n      if (this._selectedItem) {\r\n        target.addItem(this._selectedItem);\r\n        target.toggle(true);\r\n\r\n        this.selectedItem = this._selectedItem;\r\n      }\r\n    });\r\n\r\n    this.domElement.addEventListener(\"dblclick\", (e) => {\r\n      if (!this.selectedItem?.domElement.contains(e.target as HTMLElement))\r\n        return;\r\n      this.emit(\"open\", this.selectedItem);\r\n    });\r\n  }\r\n\r\n  get<T extends TreeViewItem>(id: string): T {\r\n    return this._items.get(id) as T;\r\n  }\r\n\r\n  select(id: string) {\r\n    const item = this._items.get(id);\r\n    if (!item) return;\r\n    this.selectedItem = item;\r\n  }\r\n\r\n  deselect() {\r\n    this._selectedItem?.domElement.classList.toggle(\"selected\", false);\r\n    this._selectedItem = null;\r\n  }\r\n\r\n  clear() {\r\n    this.root.clear();\r\n    this._items.clear();\r\n    this._items.set(this.root.id, this.root);\r\n  }\r\n\r\n  duplicateSelected() {\r\n    if (!this.selectedItem) {\r\n      throw new Error(\"No item selected\");\r\n    }\r\n\r\n    const parentId = this.selectedItem?.parentId;\r\n    if (!parentId) {\r\n      throw new Error(\"Selected item has no parent\");\r\n    }\r\n\r\n    const parent = this.get(parentId);\r\n\r\n    if (!parent) {\r\n      throw new Error(\"Parent not found\");\r\n    }\r\n    if (parent instanceof TreeViewFolder) {\r\n      const newItem = parent.add(\r\n        this.selectedItem.type,\r\n        this.selectedItem.name + \" Copy\",\r\n        undefined,\r\n        this.selectedItem.data\r\n          ? JSON.parse(JSON.stringify(this.selectedItem.data))\r\n          : undefined\r\n      );\r\n      const data = newItem.data as object;\r\n      if (\"name\" in data) {\r\n        data.name = newItem.name;\r\n      }\r\n      this.selectedItem = newItem;\r\n      return newItem;\r\n    }\r\n\r\n    throw new Error(\"Selected item is not a folder\");\r\n  }\r\n\r\n  newFolderInSelected() {\r\n    let folder: TreeViewFolder;\r\n    if (this.selectedItem) {\r\n      if (this.selectedItem instanceof TreeViewFolder) {\r\n        folder = this.selectedItem.add(\"folder\", \"New Folder\");\r\n        this.selectedItem.toggle(true);\r\n      } else if (this.selectedItem.parentId) {\r\n        const parent = this.get(this.selectedItem.parentId);\r\n        if (parent && parent instanceof TreeViewFolder) {\r\n          folder = parent.add(\"folder\", \"New Folder\");\r\n          parent.toggle(true);\r\n          this.selectedItem = folder;\r\n        } else {\r\n          throw new Error(\"Parent is not a folder\");\r\n        }\r\n      } else {\r\n        throw new Error(\"Parent is not a folder\");\r\n      }\r\n    } else {\r\n      folder = this.root.add(\"folder\", \"New Folder\");\r\n    }\r\n    folder.toggle(true);\r\n    return folder;\r\n  }\r\n}\r\n","import { InstrumentWindow } from \"../abstracts/InstrumentWindow\";\r\nimport type { Project } from \"../elements/Project\";\r\n\r\nexport abstract class Plugin {\r\n  abstract id: string;\r\n  abstract name: string;\r\n  abstract version: string;\r\n  abstract description: string;\r\n  abstract author: string;  \r\n  private readonly _project;\r\n\r\n  abstract Window: typeof InstrumentWindow;\r\n\r\n  get project() {\r\n    return this._project;\r\n  }\r\n\r\n  constructor(project: Project) {        \r\n    console.assert(project.audioClock, \"audioClock is required\");\r\n    console.assert(project.mixer, \"mixer is required\");\r\n    this._project = project;\r\n  }\r\n}\r\n\r\nexport class Plugins {\r\n  private static readonly _plugins: { [key: string]: typeof Plugin } = {};\r\n\r\n  static register(name: string, plugin: typeof Plugin) {\r\n    if (this._plugins[name]) {\r\n      console.warn(\"Plugin already registered:\", plugin);\r\n      return;\r\n    }\r\n    this._plugins[name] = plugin;\r\n  }\r\n\r\n  static get<T extends Plugin>(name: string): T {\r\n    return this._plugins[name] as any as T;\r\n  }\r\n\r\n  static instantiate<T extends Plugin>(project: Project, id: string) {\r\n    return new (this.get(id) as any)(project) as T;\r\n  }\r\n}\r\n","export abstract class MathHelpers {\r\n  static linearToGain(linearValue: number): number {\r\n    const clampedValue = Math.max(0, Math.min(1, linearValue));\r\n    const dBValue = clampedValue * 80 - 80;\r\n    const gain = Math.pow(10, dBValue / 20);\r\n\r\n    return gain;\r\n  }\r\n\r\n  static lerp(a: number, b: number, t: number): number {\r\n    return a + (b - a) * t;\r\n  }\r\n}\r\n","import { MathHelpers } from \"../abstracts/MathHelpers\";\r\nimport { IMixer, IMixerChannel } from \"../schema\";\r\nimport { Effect } from \"./components/Effect\";\r\n\r\nexport class MixerChannel implements IMixerChannel {\r\n  gainNode: GainNode;\r\n  mute = false;\r\n  solo = false;\r\n  effects: Effect[] = [];\r\n\r\n  get gain() {\r\n    return this.gainNode.gain.value;\r\n  }\r\n\r\n  constructor(\r\n    readonly audioContext: AudioContext,\r\n    public label: string,\r\n    gain = 1,\r\n    readonly outputs: number[] = [0]\r\n  ) {\r\n    this.gainNode = audioContext.createGain();\r\n    this.gainNode.gain.value = MathHelpers.linearToGain(gain);\r\n  }\r\n}\r\n\r\nexport class Mixer implements IMixer {\r\n  channels: MixerChannel[] = [];\r\n\r\n  constructor(readonly audioContext: AudioContext) {\r\n    const master = new MixerChannel(audioContext, \"Master\", 1);\r\n    master.gainNode.connect(audioContext.destination);\r\n    this.channels.push(master);\r\n    for (let i = 1; i <= 16; i++) {\r\n      const channel = new MixerChannel(audioContext, i.toString());\r\n      channel.gainNode.connect(master.gainNode);\r\n      this.channels.push(channel);\r\n    }\r\n  }\r\n}\r\n","import EventObject from \"../../../elements/src/EventObject\";\r\nimport { TreeViewItem } from \"../../../elements/src/elements/TreeView\";\r\nimport type { IInstrument, Instrument } from \"../abstracts/Instrument\";\r\nimport { Plugins } from \"../plugins/plugins\";\r\nimport { IAudioItem, IEvent, IPattern, IPlaylist, IProject } from \"../schema\";\r\nimport { Mixer } from \"./Mixer\";\r\nimport { AudioClock } from \"./components/AudioClock\";\r\n\r\nexport interface IProjectUpdateEvent {\r\n  type: \"project\" | \"pattern\";\r\n  value: Project | IPattern;\r\n}\r\n\r\nexport class Project extends EventObject<\"update\"> implements IProject {\r\n  title = \"Untitled\";\r\n  description = \"\";\r\n  tempo = 120;\r\n  instruments: Instrument[] = [];\r\n  patterns: IPattern[] = [];\r\n  playlist: IPlaylist = { tracks: [], events: [] };\r\n  audioClock: AudioClock;\r\n  private readonly _sources: AudioBufferSourceNode[] = [];\r\n  readonly mixer: Mixer;\r\n\r\n  constructor(audioClock: AudioClock, project?: IProject) {\r\n    console.assert(audioClock, \"audioClock is required\");\r\n\r\n    super();\r\n\r\n    this.audioClock = audioClock;\r\n\r\n    this.mixer = new Mixer(audioClock.audioContext);\r\n\r\n    audioClock.on(\"start\", () => {\r\n      console.log(\"DEBUG START\", this.playlist);\r\n      for (const e of this.playlist.events) {\r\n        if (!(e.value instanceof TreeViewItem)) {\r\n          throw new Error(\"Invalid event value\");\r\n        }\r\n\r\n        const event = e.value as TreeViewItem;\r\n\r\n        console.log(\"DEBUG ITEM\", event);\r\n\r\n        if (event.type === \"audio\") {\r\n          this._queueAudioEvent(e);\r\n        } else if (event.type === \"pattern\") {\r\n          console.log(\"DEBUG PATTERN\", event.item.data as IPattern);\r\n        } else {\r\n          console.error(\"UNKNOWN EVENT\", event);\r\n          console.error(\"EVENT DATA\", event.item.data);\r\n        }\r\n      }\r\n    });\r\n\r\n    audioClock.on(\"stop\", () => {\r\n      for (const source of this._sources) {\r\n        source.stop();\r\n      }\r\n      this._sources.length = 0;\r\n    });\r\n\r\n    if (project) {\r\n      setTimeout(() => {\r\n        this.load(project);\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  _queueAudioEvent(event: IEvent) {\r\n    const source = this.audioClock.audioContext.createBufferSource();\r\n    const item = event.value as TreeViewItem;\r\n    const audioItem = item.data as IAudioItem;\r\n    source.buffer = audioItem.buffer;\r\n    source.connect(this.mixer.channels[0].gainNode);\r\n    source.start(this.audioClock.getBeatTime(event.start));\r\n    source.stop(this.audioClock.getBeatTime(event.start + event.duration));\r\n    this._sources.push(source);\r\n    source.onended = () => {\r\n      const index = this._sources.indexOf(source);\r\n      if (index >= 0) {\r\n        this._sources.splice(index, 1);\r\n      }\r\n    };\r\n  }\r\n\r\n  serialize(): string {\r\n    return JSON.stringify({\r\n      title: this.title,\r\n      description: this.description,\r\n      tempo: this.tempo,\r\n      instruments: this.instruments.map((instrument) => {\r\n        return {\r\n          name: instrument.name,\r\n        };\r\n      }),\r\n      patterns: this.patterns,\r\n      timeline: this.playlist,\r\n    });\r\n  }\r\n\r\n  deserialize(data: string): void {\r\n    console.log(\"Project deserialize\", data);\r\n    const project = JSON.parse(data) as IProject;\r\n\r\n    // TODO error checking\r\n\r\n    this.load(project);\r\n  }\r\n\r\n  load(project: IProject): void {\r\n    console.log(\"Project load\", project);\r\n\r\n    this.title = project.title;\r\n    this.description = project.description;\r\n    this.tempo = project.tempo;\r\n    this.patterns = project.patterns;\r\n    this.playlist = project.playlist;\r\n    this.instruments = [];\r\n\r\n    for (const instrument of project.instruments as IInstrument[]) {\r\n      console.log(\"loading instrument\", instrument);\r\n      const T = Plugins.get(instrument.id);\r\n      const instance: typeof T = Plugins.instantiate<typeof T>(\r\n        this,\r\n        instrument.id\r\n      );\r\n      this.instruments.push(instance as Instrument);\r\n    }\r\n\r\n    console.log(\"emitting update...\");\r\n    this.emit(\"update\", { type: \"project\", value: this });\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\nimport type { WindowContainer } from \"./WindowContainer\";\r\n\r\nexport class WindowSnapPanel extends BaseElement<\"open\" | \"close\"> {\r\n  private _isOpen = false;\r\n\r\n  get isOpen() {\r\n    return this._isOpen;\r\n  }\r\n\r\n  constructor(readonly container: WindowContainer) {\r\n    super(\"div\", \"window-snap-panel\");\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.toggle();\r\n    });\r\n  }\r\n\r\n  open() {\r\n    if (!this._isOpen) {\r\n      this.domElement.classList.toggle(\"open\", true);\r\n      this._isOpen = true;\r\n      this.emit(\"open\");\r\n    }\r\n  }\r\n\r\n  close() {\r\n    if (this._isOpen) {\r\n      this.domElement.classList.toggle(\"open\", false);\r\n      this._isOpen = false;\r\n      this.emit(\"close\");\r\n    }\r\n  }\r\n\r\n  toggle() {\r\n    if (this._isOpen) {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap, IDragEvent, IResizeEvent } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\nimport { DraggableWindow } from \"./DraggableWindow\";\r\nimport { WindowSnapPanel } from \"./WindowSnapPanel\";\r\n\r\nexport class WindowContainer extends BaseElement<\"update\"> {\r\n  private _activeWindow: DraggableWindow | null = null;\r\n\r\n  readonly windows: DraggableWindow<keyof EventDataMap>[] = [];\r\n  private _draggingWindow: DraggableWindow | null = null;\r\n  private _bottomPanel: WindowSnapPanel;\r\n  private _leftPanel: WindowSnapPanel;\r\n  private _rightPanel: WindowSnapPanel;\r\n  private _workspace: HTMLElement;\r\n\r\n  constructor() {\r\n    super(\"div\", \"window-container\");\r\n    //this.domElement.addEventListener(\"pointerdown\", () => {});\r\n\r\n    const topRow = document.createElement(\"div\");\r\n    topRow.classList.add(\"window-snap-row\");\r\n    this.domElement.appendChild(topRow);\r\n\r\n    const bottomRow = document.createElement(\"div\");\r\n    bottomRow.classList.add(\"window-snap-row\");\r\n    bottomRow.classList.add(\"bottom-row\");\r\n    this.domElement.appendChild(bottomRow);\r\n\r\n    this._leftPanel = new WindowSnapPanel(this);\r\n    topRow.appendChild(this._leftPanel.domElement);\r\n\r\n    this._workspace = document.createElement(\"div\");\r\n    this._workspace.classList.add(\"window-container-workspace\");\r\n    topRow.appendChild(this._workspace);\r\n\r\n    this._rightPanel = new WindowSnapPanel(this);\r\n    topRow.appendChild(this._rightPanel.domElement);\r\n\r\n    this._bottomPanel = new WindowSnapPanel(this);\r\n    bottomRow.appendChild(this._bottomPanel.domElement);\r\n\r\n    window.addEventListener(\"keydown\", (e) => {\r\n      this._activeWindow?.emit(\"keydown\", e);\r\n    });\r\n\r\n    window.addEventListener(\"keyup\", (e) => {\r\n      this._activeWindow?.emit(\"keyup\", e);\r\n    });\r\n  }\r\n\r\n  private _handleWindowDrag(e: IDragEvent) {\r\n    // console.log(\"drag\", e);\r\n    const elt = e.target.domElement;\r\n    const workspaceWidth = this._workspace.getBoundingClientRect().width;\r\n    if (elt.parentElement === this._workspace) {\r\n      const leftPanelWidth =\r\n        this._leftPanel.domElement.getBoundingClientRect().width;\r\n      if (e.event.clientX <= Math.max(0, leftPanelWidth)) {\r\n        const panelWidth = leftPanelWidth || 300;\r\n        this._leftPanel.domElement.appendChild(elt);\r\n        elt.style.width = `${panelWidth}px`;\r\n        elt.style.height = \"unset\";\r\n        elt.classList.toggle(\"snap\", true);\r\n      } else {\r\n        const rightPanelWidth =\r\n          this._rightPanel.domElement.getBoundingClientRect().width;\r\n        if (\r\n          e.event.clientX + Math.max(250, rightPanelWidth) >\r\n          workspaceWidth + rightPanelWidth + leftPanelWidth\r\n        ) {\r\n          const panelWidth = rightPanelWidth || 300;\r\n          this._rightPanel.domElement.appendChild(elt);\r\n          elt.style.width = `${panelWidth}px`;\r\n          elt.style.height = \"unset\";\r\n          elt.classList.toggle(\"snap\", true);\r\n        }\r\n      }\r\n    } else {\r\n      if (\r\n        elt.parentElement === this._leftPanel.domElement &&\r\n        (e.event.target as HTMLElement) === this._workspace\r\n      ) {\r\n        this._workspace.appendChild(elt);\r\n        elt.classList.toggle(\"snap\", false);\r\n        elt.style.left = e.event.clientX + \"px\";\r\n        const win = e.target as DraggableWindow;\r\n        win.resetDragOffset();\r\n        win.setSize(win.options.width!, win.options.height!);\r\n      } else if (\r\n        elt.parentElement === this._rightPanel.domElement &&\r\n        (e.event.target as HTMLElement) === this._workspace\r\n      ) {\r\n        this._workspace.appendChild(elt);\r\n        elt.classList.toggle(\"snap\", false);\r\n        elt.style.left = workspaceWidth + \"px\";\r\n        const win = e.target as DraggableWindow;\r\n        win.resetDragOffset();\r\n        win.setSize(win.options.width!, win.options.height!);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _handleWindowResize(e: IResizeEvent) {\r\n    for (const win of this.windows) {\r\n      if (\r\n        win.domElement !== e.target.domElement &&\r\n        win.domElement.parentElement !== this._workspace &&\r\n        win.domElement.parentElement === e.target.domElement.parentElement\r\n      ) {\r\n        win.domElement.style.width = `${e.width}px`;\r\n      }\r\n    }\r\n  }\r\n\r\n  addWindow<T extends DraggableWindow>(draggableWindow: T) {\r\n    if (this.windows.includes(draggableWindow)) {\r\n      console.warn(\"Window already added\", draggableWindow);\r\n      return;\r\n    }\r\n    draggableWindow.on(\"drag\", (e) => this._handleWindowDrag(e as IDragEvent));\r\n    draggableWindow.on(\"resize\", (e) =>\r\n      this._handleWindowResize(e as IResizeEvent)\r\n    );\r\n    this.windows.push(draggableWindow);\r\n    this._workspace.appendChild(draggableWindow.domElement);\r\n    if (!this._activeWindow) {\r\n      this._activeWindow = draggableWindow;\r\n      this.activateWindow(draggableWindow);\r\n    }\r\n\r\n    draggableWindow.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.activateWindow(draggableWindow);\r\n    });\r\n\r\n    draggableWindow.on(\"open\", () => {\r\n      this.activateWindow(draggableWindow);\r\n    });\r\n\r\n    draggableWindow.on(\"close\", () => {\r\n      if (this._activeWindow === draggableWindow) {\r\n        this._activeWindow = null;\r\n      }\r\n    });\r\n  }\r\n\r\n  activateWindow(window: DraggableWindow) {\r\n    if (this._activeWindow === window) {\r\n      return;\r\n    }\r\n\r\n    this._activeWindow = window;\r\n\r\n    for (const w of this.windows) {\r\n      w.domElement.classList.toggle(\"active\", w === window);\r\n      w.domElement.style.zIndex = w === window ? \"1\" : \"0\";\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class PopupNotification extends BaseElement<\"close\"> {\r\n  private readonly _closeButton: HTMLButtonElement;\r\n\r\n  constructor(title: string, options?: NotificationOptions | undefined) {\r\n    super(\"div\", \"notification\");\r\n\r\n    this.domElement.style.display = \"hidden\";\r\n\r\n    const titleElt = document.createElement(\"h1\");\r\n    const messageElt = document.createElement(\"p\");\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.textContent = \"\";\r\n    const onclick = () => {\r\n      this._closeButton.removeEventListener(\"click\", onclick);\r\n      this.dispose();\r\n      this.emit(\"close\");\r\n    };\r\n    this._closeButton.addEventListener(\"click\", onclick);\r\n\r\n    if (options?.body) {\r\n      messageElt.textContent = options.body;\r\n    }\r\n\r\n    titleElt.textContent = title;\r\n\r\n    this.domElement.appendChild(titleElt);\r\n    this.domElement.appendChild(messageElt);\r\n    this.domElement.appendChild(this._closeButton);\r\n\r\n    document.body.appendChild(this.domElement);\r\n  }\r\n}\r\n","export const DEFAULT_NOTE_HEIGHT = 20;\r\n\r\nexport const BOTTOM_ROW = [\r\n  90, 83, 88, 68, 67, 86, 71, 66, 72, 78, 74, 77, 188, 76, 190, 59, 191,\r\n];\r\n\r\nexport const TOP_ROW = [\r\n  81, 50, 87, 51, 69, 82, 53, 84, 54, 89, 55, 85, 73, 57, 79, 48, 80, 219, 61,\r\n  221,\r\n];\r\n\r\nexport const KEY_COLORS = [\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n];\r\n\r\nexport const NOTE_NAMES = [\r\n  \"A\",\r\n  \"A#\",\r\n  \"B\",\r\n  \"C\",\r\n  \"C#\",\r\n  \"D\",\r\n  \"D#\",\r\n  \"E\",\r\n  \"F\",\r\n  \"F#\",\r\n  \"G\",\r\n  \"G#\",\r\n];\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { PopupNotification } from \"../../../../elements/src/elements/PopupNotification\";\r\nimport { BOTTOM_ROW, TOP_ROW } from \"../../constants\";\r\n\r\nlet midiAccess: MIDIAccess | null = null;\r\n\r\nexport interface IKeyboardEvent {\r\n  type: \"press\" | \"release\";\r\n  channel: number;\r\n  note: number;\r\n  velocity: number;\r\n}\r\n\r\nfunction keyToNote(keyCode: number) {\r\n  let note = -1;\r\n\r\n  if (BOTTOM_ROW.includes(keyCode)) {\r\n    note = BOTTOM_ROW.indexOf(keyCode);\r\n  } else if (TOP_ROW.includes(keyCode)) {\r\n    note = TOP_ROW.indexOf(keyCode) + 12;\r\n  }\r\n\r\n  return note;\r\n}\r\n\r\nexport class Keyboard extends BaseElement<\"update\"> {\r\n  constructor() {\r\n    super(\"div\", \"keyboard\");\r\n\r\n    if (!midiAccess) {\r\n      navigator\r\n        .requestMIDIAccess()\r\n        .then((midi) => {\r\n          console.log(\"MIDI Access\", midi);\r\n          midiAccess = midi;\r\n          midi.inputs.forEach((entry) => {\r\n            entry.onmidimessage = (e) => this.handleMIDI(e);\r\n          });\r\n        })\r\n        .catch((e) => {\r\n          console.error(\"MIDI Access error\", e);\r\n          new PopupNotification(\"MIDI Access error\", { body: e.message });\r\n        });\r\n    }\r\n\r\n    const pressedKeys: number[] = [];\r\n\r\n    window.addEventListener(\"keydown\", (event) => {\r\n      //console.log(event.key, event.keyCode);\r\n\r\n      if (event.ctrlKey || event.altKey || event.shiftKey) return;\r\n\r\n      const target = event.target as HTMLElement;\r\n      if (target.tagName == \"INPUT\") return;\r\n\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || pressedKeys.includes(note)) return;\r\n\r\n      pressedKeys.push(note);\r\n      const update: IKeyboardEvent = { type: \"press\", note, velocity: 0.98, channel: 0 };\r\n      this.emit(\"update\", update);\r\n    });\r\n\r\n    window.addEventListener(\"keyup\", (event) => {\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || !pressedKeys.includes(note)) return;\r\n\r\n      pressedKeys.splice(pressedKeys.indexOf(note), 1);\r\n      this.emit(\"update\", { type: \"release\", note });\r\n    });\r\n  }\r\n\r\n  private handleMIDI(event: MIDIMessageEvent) {\r\n    console.log(\"MIDI\", event.data?.length, \"bytes\", event.data);\r\n    if (event.data === null || event.data.length < 3) return;\r\n\r\n    // event.data is a uint8array\r\n\r\n    const statusByte = event.data[0];\r\n    const eventType = statusByte & 0xf0;\r\n    const channel = statusByte & 0x0f;\r\n\r\n    const dataByte1 = event.data[1];\r\n    const dataByte2 = event.data[2];\r\n\r\n    if (eventType === 0x90 && dataByte2 !== 0) {\r\n      // Note On event\r\n      const note = dataByte1 - 36;\r\n      const velocity = dataByte2 / 128;\r\n\r\n      const update: IKeyboardEvent = { type: \"press\", note, velocity, channel };\r\n\r\n      this.emit(\"update\", update);\r\n    } else if (eventType === 0x80 || (eventType === 0x90 && dataByte2 === 0)) {\r\n      // Note Off event\r\n      const note = dataByte1 - 36;\r\n      this.emit(\"update\", { type: \"release\", note });\r\n    } else if (eventType === 0xb0) {\r\n      // Control Change event\r\n      const control = dataByte1;\r\n      const value = dataByte2;\r\n      // Process the control change event\r\n      console.log(\"Control Change\", control, value);\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap, IResizeEvent } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class SizableElement<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"resize\" | T> {\r\n  private _resizing = false;\r\n  private _startX = 0;\r\n  private _startY = 0;\r\n  private _startWidth = 0;\r\n  private _startHeight = 0;\r\n  private _startTop = 0;\r\n  private _startLeft = 0;\r\n\r\n  private _resizeDirection: \"top\" | \"right\" | \"bottom\" | \"left\" | null = null;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super(tagName, className);\r\n\r\n    this.domElement.addEventListener(\"pointermove\", (e) => {\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle === \"top\" || handle === \"bottom\") {\r\n        this.domElement.style.cursor = \"ns-resize\";\r\n      } else if (handle === \"left\" || handle === \"right\") {\r\n        this.domElement.style.cursor = \"ew-resize\";\r\n      } else {\r\n        this.domElement.style.cursor = \"auto\";\r\n      }\r\n    });\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      if (this._resizing) {\r\n        console.log(this._resizeDirection);\r\n\r\n        const dx = e.clientX - this._startX;\r\n        const dy = e.clientY - this._startY;\r\n\r\n        if (this._resizeDirection === \"right\") {\r\n          this.domElement.style.width = `${this._startWidth + dx}px`;\r\n        } else if (this._resizeDirection === \"bottom\") {\r\n          this.domElement.style.height = `${this._startHeight + dy}px`;\r\n        } else if (this._resizeDirection === \"left\") {\r\n          this.domElement.style.width = `${this._startWidth - dx}px`;\r\n          this.domElement.style.left = `${this._startLeft + dx}px`;\r\n        } else if (this._resizeDirection === \"top\") {\r\n          this.domElement.style.height = `${this._startHeight - dy}px`;\r\n          this.domElement.style.top = `${this._startTop + dy}px`;\r\n        }\r\n\r\n        const event: IResizeEvent = {\r\n          target: this,\r\n          width: this.domElement.offsetWidth,\r\n          height: this.domElement.offsetHeight,\r\n          event: e,\r\n        };\r\n        this.emit(\"resize\", event);\r\n      }\r\n    };\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      if (e.button !== 0) return;\r\n      //if (e.target !== this.domElement) return;\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle) {\r\n        window.addEventListener(\"pointermove\", onmove);\r\n        this.startResize(e, handle);        \r\n        e.preventDefault();\r\n      }\r\n      const onrelease = () => {\r\n        this.stopResize();\r\n        window.removeEventListener(\"pointermove\", onmove);\r\n        window.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      window.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n  }\r\n\r\n  protected startResize(\r\n    e: PointerEvent,\r\n    direction: \"top\" | \"right\" | \"bottom\" | \"left\"\r\n  ) {\r\n    console.log(\"startResize\", direction);\r\n    this._resizing = true;\r\n    this._startX = e.clientX;\r\n    this._startY = e.clientY;\r\n    this._startWidth = this.domElement.offsetWidth;\r\n    this._startHeight = this.domElement.offsetHeight;\r\n    this._startTop = this.domElement.offsetTop;\r\n    this._startLeft = this.domElement.offsetLeft;\r\n    this._resizeDirection = direction;\r\n  }\r\n\r\n  protected stopResize() {\r\n    this._resizing = false;\r\n    this._resizeDirection = null;\r\n  }\r\n\r\n  getCurrentHandle(e: PointerEvent) {\r\n    const rect = this.domElement.getBoundingClientRect();\r\n    const offsetX = e.clientX - rect.left;\r\n    const offsetY = e.clientY - rect.top;\r\n\r\n    if (offsetX > 0 && offsetX < 6) {\r\n      return \"left\";\r\n    } else if (rect.width - offsetX < 6) {\r\n      return \"right\";\r\n    } else if (offsetY > 0 && offsetY < 6) {\r\n      return \"top\";\r\n    } else if (rect.height - offsetY < 6) {\r\n      return \"bottom\";\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { EventDataMap, IDragEvent, IResizeEvent } from \"../EventObject\";\r\nimport { SizableElement } from \"./SizableElement\";\r\nimport type { WindowContainer } from \"./WindowContainer\";\r\n\r\nexport interface IWindowOptions {\r\n  title: string;\r\n  content?: HTMLElement;\r\n  persistent?: boolean;\r\n  width?: number;\r\n  height?: number;\r\n  top?: number;\r\n  left?: number;\r\n}\r\n\r\ntype WindowEvents = \"resize\" | \"open\" | \"close\" | \"drag\" | \"keydown\" | \"keyup\";\r\n\r\nexport class DraggableWindow<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n> extends SizableElement<WindowEvents | T> {\r\n  readonly titlebar: HTMLElement;\r\n  readonly content: HTMLElement;\r\n  private readonly persistent;\r\n  private readonly _title: HTMLElement;\r\n  private readonly _closeButton: HTMLButtonElement;\r\n  private _isDragging = false;\r\n  private _dragOffsetX = 0;\r\n  private _dragOffsetY = 0;\r\n  private _top = 0;\r\n  private _left = 0;\r\n\r\n  get isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    readonly container: WindowContainer,\r\n    readonly options: IWindowOptions\r\n  ) {\r\n    super(\"div\", \"draggable-window\");\r\n\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this._top = options.top || 0;\r\n    this._left = options.left || 0;\r\n\r\n    this.persistent = options.persistent || false;\r\n\r\n    this.titlebar = document.createElement(\"div\");\r\n    this.titlebar.className = \"window-titlebar\";\r\n    this.domElement.appendChild(this.titlebar);\r\n\r\n    this.on(\"resize\", (e) => {\r\n      const event = e as IResizeEvent;\r\n      this.options.width = event.width;\r\n      this.options.height = event.height;\r\n    });\r\n\r\n    this.titlebar.addEventListener(\"pointerdown\", (e) => {\r\n      if (e.target !== this.titlebar) {\r\n        console.log(e.target);\r\n        return;\r\n      }\r\n\r\n      this._isDragging = true;\r\n      this._dragOffsetX =\r\n        e.clientX -\r\n        this.domElement.getBoundingClientRect().left +\r\n        this.domElement.parentElement!.getBoundingClientRect().left;\r\n      this._dragOffsetY =\r\n        e.clientY -\r\n        this.domElement.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.getBoundingClientRect().top;\r\n\r\n      const ondrag = (e: PointerEvent) => {\r\n        if (this._isDragging) {\r\n          let newTop = e.clientY - this._dragOffsetY;\r\n          const newLeft = e.clientX - this._dragOffsetX;\r\n\r\n          const deltaX = newLeft - this._left;\r\n          const deltaY = newTop - this._top;\r\n\r\n          if (newTop < 0) {\r\n            newTop = 0;\r\n          }\r\n\r\n          // if (newLeft < 0) {\r\n          //   newLeft = 0;\r\n          // }\r\n\r\n          this.domElement.style.top = `${newTop}px`;\r\n          this.domElement.style.left = `${newLeft}px`;\r\n\r\n          this._top = newTop;\r\n          this._left = newLeft;\r\n\r\n          const event: IDragEvent = {\r\n            target: this,\r\n            event: e,\r\n            top: newTop,\r\n            left: newLeft,\r\n            deltaX: deltaX,\r\n            deltaY: deltaY,\r\n          };\r\n\r\n          this.emit(\"drag\", event);\r\n        }\r\n      };\r\n\r\n      const onrelease = () => {\r\n        this._isDragging = false;\r\n        document.body.removeEventListener(\"pointermove\", ondrag);\r\n        document.body.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      document.body.addEventListener(\"pointermove\", ondrag);\r\n      document.body.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n\r\n    this._title = document.createElement(\"div\");\r\n    this._title.className = \"window-titlebar-title\";\r\n    this._title.textContent = options.title;\r\n    this.titlebar.appendChild(this._title);\r\n\r\n    this.content = document.createElement(\"div\");\r\n    this.content.className = \"window-content\";\r\n    this.domElement.appendChild(this.content);\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.className = \"window-close-button\";\r\n    this._closeButton.addEventListener(\"click\", (e) => {\r\n      if (e.button === 0) this.close();\r\n    });\r\n\r\n    this.titlebar.appendChild(this._closeButton);\r\n\r\n    const width = options.width || 640;\r\n    const height = options.height || 400;\r\n    this.setSize(width, height);\r\n\r\n    if (options.content) this.content.appendChild(options.content);\r\n\r\n    container.addWindow(this);\r\n  }\r\n\r\n  resetDragOffset() {\r\n    const rect = this.domElement.parentElement!.getBoundingClientRect();\r\n    this._dragOffsetX = rect.left + 100;\r\n    this._dragOffsetY = rect.top + 10;\r\n\r\n    return this;\r\n  }\r\n\r\n  show(x?: number, y?: number) {\r\n    if (x === undefined) x = this._left;\r\n    if (y === undefined) y = this._top;\r\n\r\n    this._top = y;\r\n    this._left = x;\r\n\r\n    if (this._top === 0 && this._left === 0) {\r\n      x = window.innerWidth / 2 - 200;\r\n      y = window.innerHeight / 4;\r\n    }\r\n\r\n    this.domElement.style.display = \"flex\";\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n\r\n    setTimeout(() => {\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n      this.emit(\"open\");\r\n    }, 1);\r\n\r\n    return this;\r\n  }\r\n\r\n  close() {\r\n    this.domElement.style.display = \"none\";\r\n    this.emit(\"close\");\r\n    if (!this.persistent) {\r\n      console.log(\"Removing window\", this);\r\n      this.domElement.remove();\r\n    }\r\n\r\n    return this;\r\n  }\r\n\r\n  setSize(width: number, height: number) {\r\n    this.options.width = width;\r\n    this.options.height = height;\r\n    this.domElement.style.width = `${width}px`;\r\n    this.domElement.style.height = `${height}px`;\r\n\r\n    return this;\r\n  }\r\n\r\n  setPosition(x: number, y: number) {\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n\r\n    return this;\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this._title.textContent = title;\r\n\r\n    return this;\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\nimport { SelectableElement } from \"./SelectableElement\";\r\n\r\nexport class SelectableGroup<\r\n  T extends SelectableElement = SelectableElement,\r\n> extends BaseElement<\"select\", HTMLDivElement> {\r\n  get selectedItems(): T[] {\r\n    return this.items.filter((item) => item.selected);\r\n  }\r\n\r\n  set selectedItems(items: T[]) {\r\n    for (const item of this.items) {\r\n      item.selected = items.indexOf(item) !== -1;\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    domElement?: HTMLElement,\r\n    readonly items: T[] = []\r\n  ) {\r\n    super(\"div\", \"selectable-group\");\r\n    for (const item of items) {\r\n      this.addSelectable(item, false);\r\n    }\r\n  }\r\n\r\n  addSelectable(selectable: T, addToDom = true) {\r\n    if (this.items.indexOf(selectable) !== -1) {\r\n      console.warn(\"Already added\", selectable);\r\n    } else {\r\n      this.items.push(selectable);\r\n      selectable.on(\"select\", () => {\r\n        this.emit(\"select\", this);\r\n      });\r\n      if (addToDom) this.domElement.appendChild(selectable.domElement);\r\n\r\n      selectable.domElement.addEventListener(\"pointerdown\", (e) => {\r\n        if (!e.ctrlKey && !e.shiftKey) {\r\n          for (const item of this.items) {\r\n            item.selected = item === selectable;\r\n          }\r\n        } else if (e.ctrlKey) {\r\n          selectable.selected = !selectable.selected;\r\n        } else if (e.shiftKey) {\r\n          const f = this.items.find((t) => t.selected);\r\n          if (!f) {\r\n            selectable.selected = true;\r\n            return;\r\n          }\r\n          const start = this.items.indexOf(f);\r\n          const end = this.items.indexOf(selectable);\r\n          const min = Math.min(start, end);\r\n          const max = Math.max(start, end);\r\n          for (let i = min; i <= max; i++) {\r\n            this.items[i].selected = true;\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  removeSelectable(selectable: T) {\r\n    const index = this.items.indexOf(selectable);\r\n    if (index !== -1) {\r\n      this.items.splice(index, 1);\r\n      if (this.domElement.contains(selectable.domElement))\r\n        this.domElement.removeChild(selectable.domElement);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    for (const item of this.items) {\r\n      this.domElement.removeChild(item.domElement);\r\n    }\r\n    this.items.length = 0;\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport class SelectableElement<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n> extends BaseElement<\"select\" | T> {\r\n  get selected() {\r\n    return this.domElement.classList.contains(\"selected\");\r\n  }\r\n\r\n  set selected(value: boolean) {\r\n    if (value === this.selected) return;\r\n    this.domElement.classList.toggle(\"selected\", value);\r\n    this.emit(\"select\", this);\r\n  }\r\n\r\n  constructor(    \r\n    tagName: string,\r\n    className?: string\r\n  ) {\r\n    super(tagName, className);    \r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\n\r\nexport class MuteSoloButtons extends BaseElement<\"change\"> {\r\n  private _mute: boolean = false;\r\n  private _solo: boolean = false;\r\n  private _muteButton: HTMLDivElement;\r\n  private _soloButton: HTMLDivElement;\r\n\r\n  get mute() {\r\n    return this._mute;\r\n  }\r\n\r\n  set mute(value: boolean) {\r\n    this._mute = value;\r\n    this._muteButton.classList.toggle(\"active\", this._mute);\r\n  }\r\n\r\n  get solo() {\r\n    return this._solo;\r\n  }\r\n\r\n  set solo(value: boolean) {\r\n    this._solo = value;\r\n    this._soloButton.classList.toggle(\"active\", this._solo);\r\n  }\r\n\r\n  constructor() {\r\n    super(\"div\", \"track-buttons\");\r\n\r\n    const mute = document.createElement(\"div\");\r\n    this._muteButton = mute;\r\n    mute.classList.add(\"track-button\");\r\n    mute.classList.add(\"track-mute-button\");\r\n    mute.textContent = \"M\";\r\n    mute.addEventListener(\"pointerdown\", () => {\r\n      this._mute = !this._mute;\r\n      mute.classList.toggle(\"active\", this._mute);\r\n      this.emit(\"change\");\r\n    });\r\n    this.domElement.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"div\");\r\n    this._soloButton = solo;\r\n    solo.classList.add(\"track-button\");\r\n    solo.classList.add(\"track-solo-button\");\r\n    solo.textContent = \"S\";\r\n    solo.addEventListener(\"pointerdown\", () => {\r\n      this._solo = !this._solo;\r\n      solo.classList.toggle(\"active\", this._solo);\r\n      this.emit(\"change\");\r\n    });\r\n    this.domElement.appendChild(solo);\r\n  }\r\n}\r\n","import { SelectableElement } from \"../../../../elements/src/elements/SelectableElement\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { IMixerChannel } from \"../../schema\";\r\nimport { Effect } from \"./Effect\";\r\nimport { MuteSoloButtons } from \"./MuteSoloButtons\";\r\n\r\nexport class MixerChannelStrip extends SelectableElement<\"change\"> {\r\n  private readonly _channel: IMixerChannel;\r\n  private readonly _volume: HTMLInputElement;\r\n  private readonly _label: HTMLSpanElement;\r\n  readonly muteSoloButtons: MuteSoloButtons;\r\n  readonly effects: Effect[] = [];\r\n\r\n  get channel() {\r\n    return this._channel;\r\n  }\r\n\r\n  get volume() {\r\n    return this._volume.valueAsNumber;\r\n  }\r\n\r\n  set volume(value: number) {\r\n    this._volume.value = value.toString();\r\n  }\r\n\r\n  get mute() {\r\n    return this.muteSoloButtons.mute;\r\n  }\r\n\r\n  set mute(value: boolean) {\r\n    if (value !== this.muteSoloButtons.mute) {\r\n      this.muteSoloButtons.mute = value;\r\n      this.channel.mute = value;\r\n    }\r\n  }\r\n\r\n  get solo() {\r\n    return this.muteSoloButtons.solo;\r\n  }\r\n\r\n  set solo(value: boolean) {\r\n    if (value !== this.muteSoloButtons.solo) {\r\n      this.muteSoloButtons.solo = value;\r\n      this.channel.solo = value;\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    group: SelectableGroup,\r\n    channel: IMixerChannel,\r\n    readonly isMaster = false\r\n  ) {\r\n    super(\"div\", \"mixer-channel\");\r\n\r\n    this._channel = channel;\r\n\r\n    this._label = document.createElement(\"span\");\r\n    this._label.textContent = channel.label;\r\n    this.domElement.appendChild(this._label);\r\n\r\n    const volume = document.createElement(\"input\");\r\n    volume.type = \"range\";\r\n    volume.min = \"0\";\r\n    volume.max = \"1.2\";\r\n    volume.step = \"0.01\";\r\n    volume.value = \"1\";\r\n\r\n    this._volume = volume;\r\n\r\n    this.domElement.appendChild(volume);\r\n\r\n    this.muteSoloButtons = new MuteSoloButtons();\r\n    this.domElement.appendChild(this.muteSoloButtons.domElement);\r\n\r\n    volume.addEventListener(\"input\", () => {\r\n      this.emit(\"change\");\r\n    });\r\n\r\n    this.muteSoloButtons.on(\"change\", () => {\r\n      this.emit(\"change\");\r\n    });\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport type { ProjectUI } from \"../ProjectUI\";\r\nimport { MixerChannelStrip } from \"../components/MixerChannelStrip\";\r\n\r\nexport class MixerWindow extends DraggableWindow {\r\n\r\n  readonly channels: SelectableGroup<MixerChannelStrip> = new SelectableGroup();\r\n\r\n  get mixer() {\r\n    return this.ui.project.mixer;\r\n  }\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    super(ui.container, {\r\n      title: \"Mixer\",\r\n      persistent: true,\r\n      content: document.createElement(\"div\"),\r\n      width: 500,\r\n      height: 300,\r\n    });\r\n\r\n    this.domElement.classList.add(\"mixer-window\");\r\n\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"mixer-container\");\r\n\r\n    const channelsContainer = document.createElement(\"div\");\r\n    channelsContainer.classList.add(\"mixer-channels-container\");\r\n\r\n    const effectsContainer = document.createElement(\"div\");\r\n    effectsContainer.classList.add(\"mixer-effects-container\");\r\n\r\n    container.appendChild(channelsContainer);\r\n    container.appendChild(effectsContainer);\r\n\r\n    this.content.appendChild(container);\r\n\r\n    console.log(\"MIXER CHANNELS DEBUG\", this.mixer.channels);\r\n\r\n    for (let i = 0; i < this.mixer.channels.length; i++) {\r\n      const channel = new MixerChannelStrip(this.channels, this.mixer.channels[i], i === 0);\r\n      this.channels.addSelectable(channel);\r\n      this.mixer.channels[i].gainNode.gain.value = channel.volume;\r\n      channel.on(\"change\", () => {\r\n        this.mixer.channels[i].gainNode.gain.value = channel.volume;\r\n      });\r\n      channelsContainer.appendChild(channel.domElement);\r\n    }\r\n\r\n    this.channels.items[0].selected = true;\r\n  }\r\n}\r\n","import { AudioClock } from \"./AudioClock\";\r\n\r\nexport interface ICursorTimeline {\r\n  domElement: HTMLElement;\r\n  timeline: HTMLElement;\r\n  cursor: AudioCursor;\r\n  audioClock: AudioClock;\r\n  beatWidth: number;\r\n}\r\n\r\nexport class AudioCursor {\r\n  readonly domElement: HTMLDivElement;\r\n\r\n  constructor(readonly timeline: ICursorTimeline) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-cursor\");\r\n\r\n    const clock = timeline.audioClock;\r\n\r\n    clock.on(\"update\", () => {\r\n      this.update();\r\n    });\r\n\r\n    clock.on(\"start\", () => {\r\n      this.domElement.style.transform = \"translateX(0)\";\r\n      this.domElement.style.display = \"block\";\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n    });\r\n\r\n    clock.on(\"stop\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n  }\r\n\r\n  update() {\r\n    this.domElement.style.transform = `translateX(${\r\n      this.timeline.audioClock.currentBeat * this.timeline.beatWidth\r\n    }px)`;\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","export async function triggerActive(elt: HTMLElement, timeout = 100) {  \r\n  elt.classList.toggle(\"active\", true);\r\n  setTimeout(() => {\r\n    elt.classList.toggle(\"active\", false);\r\n  }, timeout);\r\n}\r\n","import { IEvent, IPattern } from \"../schema\";\r\n\r\nexport abstract class GraphicsHelpers {\r\n  static renderWaveform(\r\n    canvas: HTMLCanvasElement,\r\n    buffer: AudioBuffer,\r\n    color: string = \"#000000\"\r\n  ) {\r\n    const numChannels = buffer.numberOfChannels;    \r\n    const width = canvas.width;\r\n    const height = canvas.height;\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n    // Create ImageData object\r\n    const imgData = ctx.createImageData(width, height);\r\n    const pixels = imgData.data;\r\n\r\n    // Clear the canvas with a transparent background\r\n    for (let i = 0; i < pixels.length; i += 4) {\r\n      pixels[i] = 0; // R\r\n      pixels[i + 1] = 0; // G\r\n      pixels[i + 2] = 0; // B\r\n      pixels[i + 3] = 0; // A\r\n    }\r\n\r\n    // Parse the color to RGB\r\n    const r = parseInt(color.slice(1, 3), 16);\r\n    const g = parseInt(color.slice(3, 5), 16);\r\n    const b = parseInt(color.slice(5, 7), 16);\r\n\r\n    // Loop through each channel and draw its waveform\r\n    for (let channel = 0; channel < numChannels; channel++) {\r\n      const channelData = buffer.getChannelData(channel);\r\n      const bufferLength = channelData.length;\r\n      const samplesPerPixel = Math.floor(bufferLength / width);\r\n      const yOffset = (height / numChannels) * channel;\r\n      const yCenter = yOffset + height / numChannels / 2;\r\n\r\n      // Plot the waveform for the current channel\r\n      for (let x = 0; x < width; x++) {\r\n        let minSample = 1.0;\r\n        let maxSample = -1.0;\r\n\r\n        // Find min and max samples for this pixel\r\n        for (let j = 0; j < samplesPerPixel; j++) {\r\n          const sample = channelData[x * samplesPerPixel + j];\r\n          if (sample < minSample) minSample = sample;\r\n          if (sample > maxSample) maxSample = sample;\r\n        }\r\n\r\n        // Draw a vertical line from min to max\r\n        const yMin = Math.floor(\r\n          yCenter + minSample * (height / numChannels / 2)\r\n        );\r\n        const yMax = Math.floor(\r\n          yCenter + maxSample * (height / numChannels / 2)\r\n        );\r\n\r\n        for (let y = yMin; y <= yMax; y++) {\r\n          const index = (y * width + x) * 4;\r\n          pixels[index] = r; // R\r\n          pixels[index + 1] = g; // G\r\n          pixels[index + 2] = b; // B\r\n          pixels[index + 3] = 255; // A\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update the canvas with the new image data\r\n    ctx.putImageData(imgData, 0, 0);\r\n  }\r\n\r\n  static renderSequence(\r\n    canvas: HTMLCanvasElement,\r\n    events: IEvent[],\r\n    color: string,\r\n    beatWidth: number,\r\n    clearFirst = true\r\n  ) {\r\n    // find lowest note\r\n    let lowestNote = 88;\r\n    let highestNote = 0;\r\n    for (const event of events) {\r\n      if (!(event.note || event.note === 0)) {\r\n        console.log(\"event\", event);\r\n        throw new Error(\"renderToCanvas() No note!\");\r\n      }\r\n      if (event.note < lowestNote) lowestNote = event.note;\r\n      if (event.note > highestNote) highestNote = event.note;\r\n    }\r\n\r\n    highestNote += 12;\r\n    lowestNote -= 12;\r\n\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n    if (clearFirst) ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    const paddedScale = Math.min(\r\n      canvas.height / (highestNote - lowestNote + 1),\r\n      2\r\n    );\r\n\r\n    for (const note of events) {\r\n      const y = canvas.height - (note.note! - lowestNote + 1) * paddedScale;\r\n      const x = note.start * beatWidth;\r\n      const width = note.duration * beatWidth;\r\n      ctx.fillStyle = color;\r\n      ctx.fillRect(x, y, width, paddedScale);\r\n    }\r\n  }\r\n\r\n  static renderPattern(\r\n    canvas: HTMLCanvasElement,\r\n    pattern: IPattern,\r\n    color: string,\r\n    beatWidth: number\r\n  ) {\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    const concat: IEvent[] = [];\r\n\r\n    for (const sequence of pattern.tracks) {\r\n      if (!sequence.events || sequence.events.length === 0) continue;\r\n      concat.push(...sequence.events);\r\n    }\r\n\r\n    if (concat.length > 0) {\r\n      GraphicsHelpers.renderSequence(canvas, concat, color, beatWidth, false);\r\n    }\r\n  }\r\n}\r\n","import { triggerActive } from \"../../../../elements/src/animation\";\r\nimport { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { SelectableElement } from \"../../../../elements/src/elements/SelectableElement\";\r\nimport type { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { GraphicsHelpers } from \"../../abstracts/GraphicsHelpers\";\r\nimport type { Instrument } from \"../../abstracts/Instrument\";\r\nimport { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport type { IEvent, ISequence } from \"../../schema\";\r\nimport type { ProjectUI } from \"../ProjectUI\";\r\nimport { MuteSoloButtons } from \"./MuteSoloButtons\";\r\n\r\nexport class PatternTrackInstrument extends SelectableElement {\r\n  readonly indicator: HTMLDivElement;\r\n  readonly muteSoloButtons: MuteSoloButtons;\r\n\r\n  constructor(readonly track: PatternTrack) {\r\n    console.assert(track, \"PatternTrackInstrument track is null or undefined\");\r\n\r\n    super(\"div\", \"pattern-track-instrument\");\r\n\r\n    this.domElement.classList.add(\"pattern-track-panel\");\r\n\r\n    const labelAndButtons = document.createElement(\"div\");\r\n    labelAndButtons.classList.add(\"pattern-track-label-and-buttons\");\r\n\r\n    const textLabel = document.createElement(\"div\");\r\n    textLabel.textContent = track.name;\r\n    labelAndButtons.appendChild(textLabel);\r\n\r\n    this.muteSoloButtons = new MuteSoloButtons();\r\n    this.muteSoloButtons.on(\"change\", () => {\r\n      track.mute = this.muteSoloButtons.mute;\r\n      track.solo = this.muteSoloButtons.solo;\r\n    });\r\n\r\n    labelAndButtons.appendChild(this.muteSoloButtons.domElement);\r\n\r\n    this.domElement.appendChild(labelAndButtons);\r\n\r\n    const edit = document.createElement(\"div\");\r\n    edit.classList.add(\"track-button\");\r\n    edit.classList.add(\"track-edit-button\");\r\n    edit.textContent = \"e\";\r\n\r\n    const win = this.track.window;\r\n\r\n    edit.addEventListener(\"pointerdown\", () => {\r\n      if (win.isVisible) {\r\n        win.close();\r\n      } else {\r\n        win.show();\r\n      }\r\n    });\r\n    win.on(\"close\", () => {\r\n      edit.classList.toggle(\"active\", false);\r\n    });\r\n    win.on(\"open\", () => {\r\n      edit.classList.toggle(\"active\", true);\r\n    });\r\n    this.muteSoloButtons.domElement.appendChild(edit);\r\n\r\n    this.indicator = document.createElement(\"div\");\r\n    this.indicator.classList.add(\"pattern-track-indicator\");\r\n    this.domElement.appendChild(this.indicator);\r\n  }\r\n}\r\n\r\nexport class PatternTrackPreview extends BaseElement {\r\n  private _canvas: HTMLCanvasElement;\r\n\r\n  get canvas() {\r\n    return this._canvas;\r\n  }\r\n\r\n  constructor(readonly track: PatternTrack) {\r\n    console.assert(track, \"PatternTrackPreview track is null or undefined\");\r\n\r\n    super(\"div\", \"pattern-track-preview\");\r\n    this._canvas = document.createElement(\"canvas\");\r\n    this._canvas.height = 60;\r\n    this._canvas.width = 1280;\r\n    this._canvas.classList.add(\"pattern-track-pattern\");\r\n\r\n    this.domElement.append(this._canvas);\r\n  }\r\n\r\n  update() {\r\n    GraphicsHelpers.renderSequence(\r\n      this._canvas,\r\n      this.track.events,\r\n      \"#bbaaff\",\r\n      this._canvas.width / 16,\r\n    );\r\n  }\r\n}\r\n\r\nexport class PatternTrack extends BaseElement implements ISequence {\r\n  readonly button: PatternTrackInstrument;\r\n  readonly preview: PatternTrackPreview;\r\n  port: number | null = null;\r\n  channel: number = 0;\r\n  private readonly _window: InstrumentWindow;\r\n\r\n  get window() {\r\n    return this._window;\r\n  }\r\n\r\n  get mute() {\r\n    return this.button.muteSoloButtons.mute;\r\n  }\r\n\r\n  set mute(value: boolean) {\r\n    this.button.muteSoloButtons.mute = value;\r\n  }\r\n\r\n  get solo() {\r\n    return this.button.muteSoloButtons.solo;\r\n  }\r\n\r\n  set solo(value: boolean) {\r\n    this.button.muteSoloButtons.solo = value;\r\n  }\r\n\r\n  get name() {\r\n    return this.instrument.name;\r\n  }\r\n\r\n  constructor(\r\n    readonly ui: ProjectUI,\r\n    public instrument: Instrument,\r\n    public events: IEvent[],\r\n    readonly buttonGroup: SelectableGroup,\r\n    readonly previewGroup: SelectableGroup\r\n  ) {\r\n    super(\"div\", \"pattern-track\");\r\n\r\n    this._window = new instrument.Window(ui, instrument);\r\n\r\n    this.button = new PatternTrackInstrument(this);\r\n    this.buttonGroup.addSelectable(this.button, false);\r\n    this.preview = new PatternTrackPreview(this);\r\n\r\n    console.log(\"New window\", this.window);\r\n\r\n    this.domElement.appendChild(this.button.domElement);\r\n    this.domElement.appendChild(this.preview.domElement);\r\n  }\r\n\r\n  trigger(\r\n    note: number,\r\n    beat: number = this.ui.project.audioClock.currentBeat,\r\n    velocity = 1.0\r\n  ) {\r\n    const source = this.instrument.trigger(note, beat, velocity);\r\n    if (beat > 0) {\r\n      this.ui.project.audioClock.scheduleEventAtBeat(() => {\r\n        triggerActive(this.button.indicator);\r\n      }, beat);\r\n    } else {\r\n      triggerActive(this.button.indicator);\r\n    }\r\n    return source;\r\n  }\r\n\r\n  release(note: number, beat: number = this.ui.project.audioClock.currentBeat) {\r\n    this.instrument.release(note, beat);\r\n  }\r\n\r\n  load(sequence: ISequence) {\r\n    this.events = sequence.events;\r\n    this.preview.update();\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { Instrument } from \"../../abstracts/Instrument\";\r\nimport { IEvent, IPattern } from \"../../schema\";\r\nimport { IProjectUpdateEvent, Project } from \"../Project\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"../components/AudioCursor\";\r\nimport {\r\n  PatternTrack,\r\n  PatternTrackInstrument,\r\n  PatternTrackPreview,\r\n} from \"../components/PatternTrack\";\r\n\r\nexport class PatternWindow\r\n  extends DraggableWindow<\"select\" | \"edit\">\r\n  implements ICursorTimeline\r\n{\r\n\r\n  readonly trackContainer: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLDivElement;\r\n  readonly tracks: PatternTrack[] = [];\r\n  readonly patternPreviews: SelectableGroup;\r\n  readonly buttons: SelectableGroup;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.ui.project.audioClock;\r\n  }\r\n\r\n  beatWidth = 20;\r\n\r\n  constructor(public ui: ProjectUI) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"pattern-track-container\");\r\n\r\n    super(ui.container, {\r\n      title: \"Pattern\",\r\n      persistent: true,\r\n      content: container,\r\n      width: 400,\r\n      height: 400,\r\n    });\r\n    this.trackContainer = container;\r\n\r\n    this.timeline = this.trackContainer;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.style.marginLeft = \"150px\";\r\n    this.timeline.appendChild(this.cursor.domElement);\r\n\r\n    const canvas = this.domElement.querySelector(\"canvas\");\r\n    if (canvas) this.beatWidth = canvas.width / 16;\r\n\r\n    this.on(\"resize\", () => {\r\n      this.beatWidth = this.domElement.clientWidth / 16;\r\n    });\r\n\r\n    ui.project.on(\"update\", (e) => {\r\n      const update = e as IProjectUpdateEvent;\r\n\r\n      if (update.type === \"project\") {\r\n        const project = update.value as Project;\r\n\r\n        for (const track of this.tracks) {\r\n          this.trackContainer.removeChild(track.domElement);\r\n        }\r\n\r\n        this.tracks.length = 0;\r\n\r\n        if (this.ui.project.patterns.length === 0) {\r\n          this.ui.project.patterns.push({\r\n            name: \"Pattern 1\",\r\n            tracks: [],\r\n          });\r\n        }\r\n\r\n        for (let i = 0; i < project.instruments.length; i++) {\r\n          if (!project.patterns[0].tracks[i]) {\r\n            project.patterns[0].tracks[i] = { events: [] };\r\n          }\r\n          const track = this.addTrack(\r\n            project.instruments[i],\r\n            project.patterns[0].tracks[i].events || []\r\n          );\r\n          if (!project.patterns[0].tracks[i])\r\n            track.load(project.patterns[0].tracks[i]);\r\n          if (i === 0) {\r\n            track.button.selected = true;\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    this.patternPreviews = new SelectableGroup();\r\n    this.buttons = new SelectableGroup<PatternTrackInstrument>();\r\n  }\r\n\r\n  loadPattern(pattern: IPattern) {\r\n    this.setTitle(pattern.name);\r\n    for (let i = 0; i < this.ui.project.instruments.length; i++) {\r\n      pattern.tracks[i] = pattern.tracks[i] || [];\r\n      this.tracks[i].load(pattern.tracks[i]);\r\n    }\r\n    if (!this.isVisible) this.show();\r\n  }\r\n\r\n  addTrack(instrument: Instrument, events: IEvent[]) {\r\n    console.log(\"Add track + instrument:\", instrument);\r\n\r\n    const track = new PatternTrack(\r\n      this.ui,\r\n      instrument,\r\n      events,\r\n      this.buttons,\r\n      this.patternPreviews\r\n    );\r\n\r\n    instrument.output.connect(this.ui.mixerWindow.mixer.channels[0].gainNode);\r\n\r\n    console.assert(\r\n      track.button instanceof PatternTrackInstrument,\r\n      \"button is not an instance of PatternTrackInstrument\"\r\n    );\r\n    console.assert(\r\n      track.preview instanceof PatternTrackPreview,\r\n      \"preview is not an instance of PatternTrackPreview\"\r\n    );\r\n\r\n    track.preview.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.ui.pianoRollWindow.loadTrack(track);\r\n      this.ui.pianoRollWindow.show();\r\n    });\r\n\r\n    this.tracks.push(track);\r\n    this.trackContainer.appendChild(track.domElement);\r\n\r\n    return track;\r\n  }\r\n\r\n  removeTrack(track: PatternTrack) {\r\n    const index = this.tracks.indexOf(track);\r\n    if (index !== -1) {\r\n      this.tracks.splice(index, 1);\r\n      this.trackContainer.removeChild(track.domElement);\r\n      this.buttons.removeSelectable(track.button);\r\n    }\r\n  }\r\n\r\n  trigger(\r\n    note: number,\r\n    beat: number = this.audioClock.currentBeat,\r\n    velocity = 1.0\r\n  ) {\r\n    for (const track of this.tracks) {\r\n      if (track.button.selected) {\r\n        track.trigger(note, beat, velocity);\r\n      }\r\n    }\r\n  }\r\n\r\n  release(note: number, beat: number = this.audioClock.currentBeat) {\r\n    for (const track of this.tracks) {\r\n      if (track.button.selected) {\r\n        track.release(note, beat);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class ScrollPanel<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"scroll\" | T> {\r\n  sensitivity = 50;\r\n  private linkedElements: HTMLElement[] = [];\r\n  private _scrollTop = 0;\r\n\r\n  get scrollTop() {\r\n    return this._scrollTop;\r\n  }\r\n\r\n  set scrollTop(value: number) {\r\n    const top = -value;\r\n    this._scrollTop = top;\r\n    this.scrollElement.style.transform = `translateY(${top}px)`;\r\n    for (const linkedElement of this.linkedElements) {\r\n      linkedElement.style.transform = `translateY(${top}px)`;\r\n    }\r\n  }\r\n\r\n  constructor(readonly scrollElement: HTMLElement) {\r\n    super(\"div\", \"scroll-panel\");\r\n    scrollElement.classList.add(\"scroll-panel-content\");\r\n\r\n    this.scrollElement.addEventListener(\"wheel\", (e) => {\r\n      e.preventDefault();\r\n      let top =\r\n        this._scrollTop + (e.deltaY > 0 ? -this.sensitivity : this.sensitivity);\r\n      const bottom = top + this.scrollElement.offsetHeight;\r\n      if (bottom < this.domElement.offsetHeight) {\r\n        top = this.domElement.offsetHeight - this.scrollElement.offsetHeight;\r\n      } else if (top > 0) {\r\n        top = 0;\r\n      }\r\n      this._scrollTop = top;\r\n      this.scrollElement.style.transform = `translateY(${top}px)`;\r\n      for (const linkedElement of this.linkedElements) {\r\n        linkedElement.style.transform = `translateY(${top}px)`;\r\n      }\r\n\r\n      this.emit(\"scroll\", e);\r\n    });\r\n  }\r\n\r\n  linkElement(element: HTMLElement) {\r\n    this.linkedElements.push(element);\r\n    element.classList.add(\"scroll-panel-content\");\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class DialogPopup extends BaseElement<\"result\" | \"cancel\"> {  \r\n  closeButton: HTMLButtonElement;\r\n  okButton: HTMLButtonElement | undefined;\r\n  cancelButton: HTMLButtonElement | undefined;\r\n\r\n  get isVisibile() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    private readonly ok: string | HTMLButtonElement = \"OK\",\r\n    private readonly cancel: string | HTMLButtonElement = \"Cancel\"\r\n  ) {\r\n    super(\"div\", \"dialog-popup\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");    \r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"pointerdown\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    if (ok instanceof HTMLButtonElement) {\r\n      this.okButton = ok;\r\n    } else if (ok) {\r\n      this.okButton = document.createElement(\"button\");\r\n      this.okButton.textContent = ok;\r\n      this.domElement.appendChild(this.okButton);\r\n    }\r\n\r\n    if (this.okButton) {\r\n      this.okButton.addEventListener(\"click\", () => {\r\n        this.emit(\"result\", this);\r\n      });\r\n    }\r\n\r\n    if (cancel instanceof HTMLButtonElement) {\r\n      this.cancelButton = cancel;\r\n    } else if (cancel) {\r\n      this.cancelButton = document.createElement(\"button\");\r\n      this.cancelButton.textContent = cancel;\r\n      this.domElement.appendChild(this.cancelButton);\r\n    }\r\n\r\n    if (this.cancelButton) {\r\n      this.cancelButton.addEventListener(\"click\", () => {\r\n        this.emit(\"cancel\", this);\r\n      });\r\n    }\r\n  }\r\n\r\n  show(x: number, y: number, targetObject?: unknown) { /* eslint-disable-line @typescript-eslint/no-unused-vars */\r\n    this.domElement.style.display = \"block\";\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","import { DialogPopup } from \"../../../elements/src/elements/DialogPopup\";\r\nimport { IEvent } from \"../schema\";\r\n\r\nexport class PianoRollDialog extends DialogPopup {\r\n  domElement: HTMLDivElement;\r\n  note: IEvent | null = null;\r\n\r\n  constructor(public onsave: (note: IEvent) => void) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-dialog\");\r\n  }\r\n\r\n  override show(x: number, y: number, note: IEvent) {\r\n    super.show(x, y, note);\r\n    this.note = note;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class EventEditorDialog extends PianoRollDialog {\r\n  constructor(onsave: (note: IEvent) => void) {\r\n    super(onsave);\r\n    this.domElement.classList.add(\"grid-item-editor\");\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","import { ScrollPanel } from \"../../../../elements/src/elements/ScrollPanel\";\r\nimport { DEFAULT_NOTE_HEIGHT, NOTE_NAMES } from \"../../constants\";\r\nimport { EventEditorDialog } from \"../audioDialogs\";\r\nimport { IEvent, ISequence } from \"../../schema\";\r\nimport { SelectableElement } from \"../../../../elements/src/elements/SelectableElement\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\n\r\nfunction getNoteNameFromPitch(pitch: number): string {\r\n  const note = NOTE_NAMES[pitch % NOTE_NAMES.length];\r\n  return `${note}${Math.floor(pitch / NOTE_NAMES.length)}`;\r\n}\r\n\r\nconst NOTE_HANDLE_WIDTH = 6;\r\n\r\nexport class GridItem extends SelectableElement implements IEvent {\r\n  labelElement: HTMLDivElement;\r\n  label: string | \"\" = \"\";\r\n  image?: HTMLDivElement;\r\n\r\n  get text() {\r\n    return this.label;\r\n  }\r\n\r\n  get note() {\r\n    return this.event.note || 0;\r\n  }\r\n\r\n  set note(value: number) {\r\n    this.event.note = value;\r\n  }\r\n\r\n  get start() {\r\n    return this.event.start;\r\n  }\r\n\r\n  set start(value: number) {\r\n    this.event.start = value;\r\n  }\r\n\r\n  get duration() {\r\n    return this.event.duration;\r\n  }\r\n\r\n  set duration(value: number) {\r\n    this.event.duration = value;\r\n  }\r\n\r\n  get velocity() {\r\n    return this.event.velocity || 0;\r\n  }\r\n\r\n  set velocity(value: number) {\r\n    this.event.velocity = value;\r\n  }\r\n\r\n  set text(value: string) {\r\n    this.label = value;\r\n    this.labelElement.textContent = value;\r\n  }\r\n\r\n  constructor(\r\n    private readonly grid: Grid,\r\n    readonly event: IEvent,\r\n    label?: string,\r\n    src?: string,\r\n    readonly value?: unknown\r\n  ) {\r\n    super(\"div\", \"grid-item\");\r\n    const noteItem = event as IEvent;\r\n\r\n    this.domElement.style.height = `${grid.rowHeight}px`;\r\n\r\n    this.labelElement = document.createElement(\"div\");\r\n    this.labelElement.classList.add(\"grid-item-label\");\r\n    this.domElement.appendChild(this.labelElement);\r\n\r\n    if (src) {\r\n      this.image = document.createElement(\"div\");\r\n      this.image.classList.add(\"grid-item-image\");\r\n      console.log(\r\n        \"DEBUG Background image\",\r\n        src,\r\n        this.image.style.backgroundImage,\r\n        `url(${src})`\r\n      );\r\n      this.image.style.backgroundImage = `url(${src})`;\r\n      this.domElement.appendChild(this.image);\r\n      this.domElement.classList.add(\"has-image\");\r\n    }\r\n\r\n    if (noteItem.velocity) this.velocity = noteItem.velocity;\r\n    if (noteItem.note) {\r\n      this.note = noteItem.note;\r\n      this.label = label || getNoteNameFromPitch(this.note);\r\n      this.labelElement.textContent = this.label;\r\n    } else {\r\n      this.note = 0;\r\n    }\r\n\r\n    this.start = event.start;\r\n    this.duration = event.duration;\r\n\r\n    if (event.label) this.labelElement.textContent = event.label;\r\n\r\n    console.log(\"GridItem\", this);\r\n\r\n    grid.gridElement.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class Grid extends ScrollPanel<\r\n  \"select\" | \"update\" | \"release\" | \"add\" | \"remove\"\r\n> {\r\n  readonly gridElement: HTMLDivElement;\r\n  readonly previewCanvas: HTMLCanvasElement;\r\n  readonly noteEditor: EventEditorDialog;\r\n  private _currentItem: GridItem | null = null;\r\n  private _dragMode: string | null = null;\r\n  private _dragOffset: number = 0;\r\n  private _sequence: ISequence | null = null;\r\n  private _items: Map<IEvent, GridItem> = new Map();\r\n  readonly scrollElement: HTMLDivElement;\r\n\r\n  public quantize: number = 0.25;\r\n  public drawingEnabled: boolean = true;\r\n  public drawingLabel: string | undefined = undefined;\r\n  public drawingImage: string | undefined = undefined;\r\n  public drawingValue: unknown | undefined = undefined;\r\n  private _selectGroup: SelectableGroup<GridItem>;\r\n\r\n  constructor(\r\n    readonly rowCount = 88,\r\n    readonly beatWidth = 100,\r\n    readonly rowHeight = DEFAULT_NOTE_HEIGHT\r\n  ) {\r\n    const selectGroup = new SelectableGroup<GridItem>();\r\n\r\n    super(selectGroup.domElement);\r\n\r\n    this._selectGroup = selectGroup;\r\n\r\n    this.scrollElement = this._selectGroup.domElement;\r\n\r\n    this.gridElement = this._selectGroup.domElement;\r\n\r\n    this.domElement.classList.add(\"grid-container\");\r\n    this.gridElement.classList.add(\"grid\");\r\n\r\n    this.gridElement.addEventListener(\"dragstart\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.previewCanvas = document.createElement(\"canvas\");\r\n\r\n    const rowBackgroundCanvas = document.createElement(\"canvas\");\r\n    rowBackgroundCanvas.style.imageRendering = \"pixelated\";\r\n    rowBackgroundCanvas.width = this.beatWidth * 4;\r\n    rowBackgroundCanvas.height = this.rowHeight;    \r\n    const ctx = rowBackgroundCanvas.getContext(\r\n      \"2d\"\r\n    ) as CanvasRenderingContext2D;\r\n    ctx.imageSmoothingEnabled = false;\r\n    // disable anti-alias\r\n\r\n    if (ctx) {\r\n      ctx.clearRect(\r\n        0,\r\n        0,\r\n        rowBackgroundCanvas.width,\r\n        rowBackgroundCanvas.height\r\n      );\r\n      ctx.lineWidth = 0.75;\r\n      ctx.strokeStyle = \"#444\";\r\n      ctx.beginPath();\r\n      for (let j = 1; j < 4; j++) {\r\n        ctx.moveTo(j * this.beatWidth + 0.5, 0);\r\n        ctx.lineTo(j * this.beatWidth + 0.5, this.rowHeight);\r\n      }\r\n      ctx.stroke();\r\n      ctx.strokeStyle = \"#888\";\r\n      ctx.beginPath();\r\n      ctx.moveTo(0.5, 0);\r\n      ctx.lineTo(0.5, this.rowHeight);\r\n      ctx.stroke();\r\n    }\r\n    for (let i = 0; i < rowCount; i++) {\r\n      const row = document.createElement(\"div\");\r\n      row.classList.add(\"grid-row\");\r\n      row.style.height = `${this.rowHeight}px`;\r\n      this.gridElement.appendChild(row);\r\n      const base64 = rowBackgroundCanvas.toDataURL();\r\n      row.style.backgroundImage = `url(${base64})`;\r\n      row.style.backgroundRepeat = \"repeat\";\r\n    }\r\n    this.domElement.appendChild(this.gridElement);\r\n\r\n    this.noteEditor = new EventEditorDialog((note) => {\r\n      console.log(\"Grid: noteEditor saved\", note);\r\n    });\r\n\r\n    document.body.appendChild(this.noteEditor.domElement);\r\n\r\n    this.gridElement.addEventListener(\"dblclick\", (e) => {\r\n      const note = Array.from(this._items.values()).find(\r\n        (item: GridItem) => item.domElement === e.target\r\n      );\r\n\r\n      if (note) {\r\n        this.noteEditor.show(e.clientX + 20, e.clientY - 5, note);\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerdown\", (e) => {\r\n      if (!this._sequence) throw new Error(\"No track\");\r\n\r\n      if (!this._sequence.events) throw new Error(\"No events\");\r\n\r\n      if (!this.drawingEnabled) return;\r\n\r\n      e.preventDefault();\r\n\r\n      this._dragOffset = e.layerX;\r\n\r\n      if (this.noteEditor.isVisibile) {\r\n        this.noteEditor.hide();\r\n        return;\r\n      }\r\n\r\n      if (\r\n        e.target instanceof HTMLDivElement &&\r\n        e.target.classList.contains(\"grid-item\")\r\n      ) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const note = Array.from(this._items.values()).find(\r\n          (item: GridItem) => item.domElement === e.target\r\n        );\r\n\r\n        if (note) {\r\n          this._currentItem = note;\r\n\r\n          if (e.button === 2) {\r\n            this.remove(note.event);\r\n            this._currentItem = null;\r\n          } else {\r\n            note.domElement!.parentElement?.appendChild(note.domElement!);\r\n            note.domElement!.style.width =\r\n              note.duration * this.beatWidth + \"px\";\r\n            if (this._dragOffset < NOTE_HANDLE_WIDTH) {\r\n              this._dragMode = \"start\";\r\n            } else if (\r\n              note.domElement!.offsetWidth - this._dragOffset <\r\n              NOTE_HANDLE_WIDTH\r\n            ) {\r\n              this._dragMode = \"end\";\r\n            } else {\r\n              this._dragMode = \"move\";\r\n            }\r\n          }\r\n        }\r\n      } else if (e.button !== 0) return;\r\n      else if (e.target === this.gridElement) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const row = Math.floor(e.layerY / this.rowHeight);\r\n        const note = 87 - row;\r\n\r\n        let start = e.layerX / this.beatWidth;\r\n        start = Math.round(start / this.quantize) * this.quantize;\r\n        console.log(\"start\", start, e.layerX);\r\n\r\n        const item: IEvent = {\r\n          row: row,\r\n          note: note,\r\n          start: start,\r\n          velocity: 1,\r\n          duration: this.quantize,\r\n          label: \"\",\r\n          value: this.drawingValue,\r\n        };\r\n\r\n        this._currentItem = this.add(item);\r\n        this._currentItem.domElement!.style.top = `${\r\n          (87 - this._currentItem.note!) * this.rowHeight\r\n        }px`;\r\n        this._currentItem.domElement!.style.left = `${\r\n          this._currentItem.start * this.beatWidth\r\n        }px`;\r\n        this._dragMode = \"end\";\r\n\r\n        this.emit(\"select\", this._currentItem);\r\n      }\r\n\r\n      this.emit(\"update\", this);\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n\r\n      this.emit(\"update\", this);\r\n      this.emit(\"release\", this._currentItem);\r\n\r\n      this._currentItem = null;\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentItem) {\r\n        // this.remove(this._currentItem);\r\n        this._currentItem = null;\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"contextmenu\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointermove\", (event) => {\r\n      if (this._currentItem && event.buttons === 1) {\r\n        if (this._dragMode === \"start\") {\r\n          const start =\r\n            Math.round(event.layerX / this.beatWidth / this.quantize) *\r\n            this.quantize;\r\n\r\n          const oldStart = this._currentItem.start;\r\n\r\n          if (start >= this._currentItem.start + this._currentItem.duration) {\r\n            return;\r\n          }\r\n\r\n          this._currentItem.start = start;\r\n\r\n          this._currentItem.duration =\r\n            oldStart - this._currentItem.start + this._currentItem.duration;\r\n          this._currentItem.domElement!.style.left = `${\r\n            this._currentItem.start * this.beatWidth\r\n          }px`;\r\n          this._currentItem.domElement!.style.width = `${Math.max(\r\n            this.quantize,\r\n            this._currentItem.duration * this.beatWidth\r\n          )}px`;\r\n        } else if (this._dragMode === \"end\") {\r\n          this._currentItem.duration =\r\n            event.layerX / this.beatWidth - this._currentItem.start;\r\n\r\n          // quantize\r\n          this._currentItem.duration =\r\n            Math.round(this._currentItem.duration / this.quantize) *\r\n            this.quantize;\r\n\r\n          this._currentItem.domElement!.style.width = `${Math.max(\r\n            this.quantize,\r\n            this._currentItem.duration * this.beatWidth\r\n          )}px`;\r\n        } else if (this._dragMode === \"move\") {\r\n          this._currentItem.start =\r\n            Math.max(0, event.layerX - this._dragOffset) / this.beatWidth;\r\n          this._currentItem.start =\r\n            Math.round(this._currentItem.start / this.quantize) * this.quantize;\r\n          this._currentItem.domElement!.style.left = `${\r\n            this._currentItem.start * this.beatWidth\r\n          }px`;\r\n        } else {\r\n          return;\r\n        }\r\n\r\n        this.emit(\"update\", this);\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentItem) {\r\n        this._currentItem.domElement!.style.pointerEvents = \"auto\";\r\n      }\r\n      this._currentItem = null;\r\n    });\r\n\r\n    // this.gridElement.addEventListener(\"pointerleave\", () => {\r\n    //   this.gridElement.classList.remove(\"dragging\");\r\n    //   if (this._currentItem) {\r\n    //     this._currentItem.domElement!.style.pointerEvents = \"auto\";\r\n    //   }\r\n    //   this._currentItem = null;\r\n    // });\r\n  }\r\n\r\n  add(item: IEvent) {\r\n    if (!this._sequence) {\r\n      throw new Error(\"add() No sequence loaded!\");\r\n    }\r\n    if (this._sequence.events.includes(item)) {\r\n      throw new Error(\"add() Item already exists!\");\r\n    }\r\n    this._sequence.events.push(item);\r\n    const gridItem = new GridItem(\r\n      this,\r\n      item,\r\n      this.drawingLabel,\r\n      this.drawingImage,\r\n      this.drawingValue\r\n    );\r\n    this._selectGroup.addSelectable(gridItem, false);\r\n    this._selectGroup.selectedItems = [gridItem];\r\n    this._items.set(item, gridItem);\r\n    this.emit(\"add\", gridItem);\r\n    return gridItem;\r\n  }\r\n\r\n  remove(item: IEvent) {\r\n    if (!this._sequence) throw new Error(\"remove() No sequence loaded!\");\r\n    console.log(\"Grid: remove\", item);\r\n    const gridItem = this._items.get(item);\r\n    if (!gridItem) {\r\n      console.error(\"remove() Item not found!\", item, this._items);\r\n      return;\r\n    }\r\n    gridItem.domElement.remove();\r\n    this._items.delete(item);\r\n    this._selectGroup.removeSelectable(gridItem);\r\n    this._sequence.events.splice(this._sequence.events.indexOf(item), 1);\r\n    this.emit(\"remove\", item);\r\n  }\r\n\r\n  load(sequence: ISequence) {\r\n    if (!sequence) {\r\n      throw new Error(\"load() No track!\");\r\n    }\r\n    console.log(\"Grid: load\", sequence.events);\r\n\r\n    this._items.clear();\r\n    const items = this.gridElement.querySelectorAll(\".grid-item\");\r\n    items.forEach((item) => item.remove());\r\n\r\n    this._sequence = sequence;\r\n\r\n    for (const event of sequence.events) {\r\n      this.add(event);\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport {\r\n  DEFAULT_NOTE_HEIGHT,\r\n  KEY_COLORS,\r\n  NOTE_NAMES,\r\n} from \"../../constants\";\r\nimport { IKeyboardEvent } from \"./Keyboard\";\r\n\r\nexport class SideKeyboard extends BaseElement<\"update\"> {  \r\n  keys: HTMLDivElement[] = [];\r\n  noteHeight = DEFAULT_NOTE_HEIGHT;\r\n\r\n  constructor() {\r\n\r\n    super(\"div\", \"piano-roll-keyboard\");\r\n\r\n    this.redraw();\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const key = e.target as HTMLDivElement;\r\n\r\n      if (key.classList.contains(\"piano-roll-keyboard-key\")) {\r\n        const note_index = this.keys.indexOf(key);\r\n        console.log(\"key\", key.textContent, note_index);        \r\n        key.classList.add(\"active\");\r\n        this.emit(\"update\", { type: \"press\", note: note_index } as IKeyboardEvent);\r\n        const pointerup = () => {\r\n          window.removeEventListener(\"pointerup\", pointerup);\r\n          key.classList.remove(\"active\");\r\n          this.emit(\"update\", { type: \"release\", note: note_index } as IKeyboardEvent);          \r\n        };\r\n\r\n        window.addEventListener(\"pointerup\", () => pointerup());\r\n      }\r\n    });\r\n  }\r\n\r\n  redraw() {\r\n    this.domElement.innerHTML = \"\";\r\n\r\n    for (let i = 87; i >= 0; i--) {\r\n      const key = document.createElement(\"div\");\r\n      key.classList.add(\"piano-roll-keyboard-key\");\r\n      key.style.height = `${this.noteHeight}px`;\r\n      // key.style.bottom = `${i * this.noteHeight}px`;\r\n      key.style.backgroundColor =\r\n        KEY_COLORS[i % 12] === \"white\" ? \"#fff\" : \"#000\";\r\n      key.style.color = KEY_COLORS[i % 12] === \"white\" ? \"#000\" : \"#fff\";\r\n      key.textContent = NOTE_NAMES[i % 12] + ((i / 12) | 0).toString();\r\n      this.domElement.appendChild(key);\r\n      this.keys.push(key);\r\n    }\r\n\r\n    this.keys.reverse();\r\n  }\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"./AudioCursor\";\r\nimport type { GridItem } from \"./Grid\";\r\nimport { Grid } from \"./Grid\";\r\nimport type { IKeyboardEvent } from \"./Keyboard\";\r\nimport type { PatternTrack } from \"./PatternTrack\";\r\nimport { SideKeyboard } from \"./SideKeyboard\";\r\n\r\nexport class PianoRoll\r\n  extends EventObject<\"update\">\r\n  implements ICursorTimeline\r\n{\r\n  readonly domElement: HTMLDivElement;\r\n  readonly grid: Grid;\r\n  readonly sideKeyboard: SideKeyboard;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLElement;\r\n  cursorUpdateInterval: number | object | null = null;\r\n  track: PatternTrack | null = null;\r\n  color = \"#7979ce\";\r\n  beatWidth = 100;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll\");\r\n\r\n    this.sideKeyboard = new SideKeyboard();\r\n    this.domElement.appendChild(this.sideKeyboard.domElement);\r\n    this.sideKeyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      if (e.type == \"press\") this.track!.trigger(e.note);\r\n      else if (e.type == \"release\") this.track!.release(e.note);\r\n    });\r\n\r\n    this.grid = new Grid();\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.on(\"select\", (item) => {\r\n      const note = item as GridItem;\r\n      this.track!.trigger(note.note);\r\n      // this.track?.preview.update();\r\n    });\r\n    this.grid.on(\"update\", () => {\r\n      this.track?.preview.update();\r\n      this.emit(\"update\");\r\n    });\r\n    this.grid.on(\"release\", (item) => {\r\n      if (item) this.track!.release((item as GridItem).note);\r\n    });\r\n    this.grid.linkElement(this.sideKeyboard.domElement);\r\n\r\n    this.timeline = this.grid.domElement;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.classList.add(\"audio-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor.domElement);\r\n    this.cursor.domElement.style.marginLeft =\r\n      this.sideKeyboard.domElement.offsetWidth + \"px\";\r\n\r\n    this.grid.scrollTop = 1000;\r\n  }\r\n\r\n  load(track: PatternTrack) {\r\n    if (!track) {\r\n      console.warn(\"No track provided!\");\r\n      return;\r\n    }\r\n    this.track = track;\r\n    this.grid.load(track);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { PatternTrack } from \"../components/PatternTrack\";\r\nimport { PianoRoll } from \"../components/PianoRoll\";\r\n\r\nexport class PianoRollWindow extends DraggableWindow {\r\n  pianoRoll: PianoRoll;\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    const pianoRoll = new PianoRoll(ui.project.audioClock);\r\n\r\n    super(ui.container, {\r\n      title: \"Piano Roll\",\r\n      persistent: true,\r\n      content: pianoRoll.domElement,\r\n      width: 900,\r\n      height: 400,\r\n      left: 100,\r\n      top: 100,\r\n    });\r\n    this.pianoRoll = pianoRoll;\r\n\r\n    pianoRoll.on(\"update\", () => {\r\n      this.emit(\"update\");\r\n    });\r\n  }\r\n\r\n  loadTrack(track: PatternTrack) {\r\n    this.pianoRoll.load(track);\r\n    this.setTitle(`Piano Roll (${track.name})`);\r\n  }\r\n}\r\n","import EventObject from \"../EventObject\";\r\n\r\nexport class ContextMenu extends EventObject<\"shown\"> {\r\n  private readonly domElement: HTMLElement;\r\n  private readonly _submenus: ContextMenu[] = [];\r\n\r\n  constructor(\r\n    private readonly container?: HTMLElement,\r\n    private readonly attachedElement?: HTMLElement,\r\n    filter?: () => boolean\r\n  ) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"context-menu\");\r\n\r\n    if (container) container.appendChild(this.domElement);\r\n\r\n    if (this.attachedElement) {\r\n      this.hide();\r\n      this.attachedElement.addEventListener(\"contextmenu\", (event) => {\r\n        if (!event.ctrlKey) {\r\n          if (filter && !filter()) return;\r\n          event.preventDefault();\r\n          this.show(event.clientX + 10, event.clientY - 5);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private _handlePointerDown() {\r\n    // only hide the main menu (others will follow using css rules)\r\n    if (!this.domElement.classList.contains(\"submenu\")) this.hide();\r\n  }\r\n\r\n  public isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  public addItem(label: string, callback: (e: PointerEvent) => void, filter?: () => boolean) {\r\n    const item = document.createElement(\"div\");\r\n    item.classList.add(\"context-menu-item\");\r\n    item.textContent = label;\r\n    item.addEventListener(\"pointerdown\", (e) => {\r\n      callback(e);\r\n    });\r\n    this.domElement.appendChild(item);\r\n\r\n    this.on(\"shown\", () => {\r\n      if (filter && !filter()) item.style.display = \"none\";\r\n      else item.style.display = \"block\";\r\n    });\r\n\r\n    return item;\r\n  }\r\n\r\n  public addSubmenu(label: string, submenu: ContextMenu) {\r\n    const item = document.createElement(\"div\");\r\n    item.classList.add(\"context-menu-item\");\r\n    item.classList.add(\"submenu\");\r\n    item.textContent = label;\r\n    item.addEventListener(\"pointerdown\", () => {\r\n      submenu.show(\r\n        this.domElement.offsetLeft + this.domElement.offsetWidth - 5,\r\n        item.offsetTop\r\n      );\r\n      // const elt = e.target as HTMLElement;\r\n      // if (elt.classList.contains(\"context-menu-item\")) {\r\n      //   this.hide();\r\n      // }\r\n    });\r\n\r\n    submenu.domElement.classList.add(\"context-menu-submenu\");\r\n    this._submenus.push(submenu);\r\n\r\n    item.appendChild(submenu.domElement);\r\n    this.domElement.appendChild(item);\r\n  }\r\n\r\n  public show(x: number, y: number) {\r\n    if (!this.container) return;\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.display = \"flex\";\r\n    document.addEventListener(\"pointerup\", () => this._handlePointerDown());\r\n    this.emit(\"shown\");\r\n  }\r\n\r\n  public hide() {\r\n    if (!this.isVisible() || !this.container) return;\r\n    this.domElement.style.display = \"none\";\r\n    // for (let i = 0; i < this._submenus.length; i++) {\r\n    //   this._submenus[i].hide();\r\n    // }\r\n    document.removeEventListener(\"pointerup\", () => this._handlePointerDown());\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { ITrackOptions } from \"../../schema\";\r\nimport { MuteSoloButtons } from \"./MuteSoloButtons\";\r\n\r\nexport class PlaylistTrack\r\n  extends BaseElement<\"update\">\r\n  implements ITrackOptions\r\n{\r\n  private _track: ITrackOptions;\r\n  readonly muteSoloButtons: MuteSoloButtons;\r\n\r\n  get mute() {\r\n    return this._track.mute;\r\n  }\r\n\r\n  get solo() {\r\n    return this._track.solo;\r\n  }\r\n\r\n  get selected() {\r\n    return false;\r\n  }\r\n\r\n  get name() {\r\n    return this._track.name;\r\n  }\r\n\r\n  constructor(track: ITrackOptions) {\r\n    super(\"div\", \"playlist-track\");\r\n\r\n    this._track = track;\r\n\r\n    const settings = document.createElement(\"div\");\r\n    settings.classList.add(\"playlist-track-panel\");\r\n\r\n    const labelAndButtons = document.createElement(\"div\");\r\n    labelAndButtons.classList.add(\"playlist-track-label-and-buttons\");\r\n\r\n    const label = document.createElement(\"div\");    \r\n    label.textContent = track.name;\r\n\r\n    this.muteSoloButtons = new MuteSoloButtons();\r\n    this.muteSoloButtons.on(\"change\", () => {\r\n      this._track.mute = this.muteSoloButtons.mute;\r\n      this._track.solo = this.muteSoloButtons.solo;\r\n    });\r\n\r\n    labelAndButtons.appendChild(label);\r\n    labelAndButtons.appendChild(this.muteSoloButtons.domElement);\r\n    settings.appendChild(labelAndButtons);\r\n    this.domElement.appendChild(settings);\r\n  }\r\n\r\n  trigger(note: number, velocity: number) {\r\n    console.log(\"Trigger\", note, velocity);\r\n  }\r\n\r\n  release(note: number) {\r\n    console.log(\"Release\", note);\r\n  }\r\n}\r\n","import { TreeViewItem } from \"../../../../elements/src/elements/TreeView\";\r\nimport EventObject from \"../../../../elements/src/EventObject\";\r\nimport type { IAudioItem, IProject, ITrackOptions } from \"../../schema\";\r\nimport { IProjectUpdateEvent, Project } from \"../Project\";\r\nimport type { AudioClock } from \"./AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"./AudioCursor\";\r\nimport { Grid, GridItem } from \"./Grid\";\r\nimport { PlaylistTrack } from \"./PlaylistTrack\";\r\n\r\nexport class Playlist extends EventObject<\"update\"> implements ICursorTimeline {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly grid: Grid;\r\n  readonly _trackPanels: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLElement;\r\n  beatWidth = 20;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.project.audioClock;\r\n  }\r\n\r\n  constructor(readonly project: Project) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"playlist\");\r\n\r\n    this._trackPanels = document.createElement(\"div\");\r\n    this._trackPanels.classList.add(\"playlist-tracks\");\r\n    this.domElement.appendChild(this._trackPanels);\r\n\r\n    this.grid = new Grid(16, this.beatWidth, 60);\r\n\r\n    this.grid.on(\"add\", (e) => {\r\n      if (this.grid.drawingImage) {\r\n        const gridItem = e as GridItem;\r\n        const item = gridItem.value as TreeViewItem;\r\n        if (!item) throw new Error(\"Invalid grid item\");\r\n\r\n        console.log(\"Playlist.add\", item.type, item);\r\n\r\n        if (item.type === \"audio\") {\r\n          const audioItem = item.data as IAudioItem;\r\n          if (audioItem) {\r\n            const seconds = audioItem.buffer.duration;\r\n            const beats = this.audioClock.getBeatTime(seconds, 0);            \r\n            const backgroundSize = this.beatWidth * beats;\r\n\r\n            console.log(\r\n              \"Added audio\",\r\n              audioItem.buffer.duration,\r\n              backgroundSize\r\n            );\r\n\r\n            if (gridItem.image) {\r\n              gridItem.image.style.backgroundSize = `${backgroundSize}px 100%`;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    this.grid.quantize = 1;\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.linkElement(this._trackPanels);\r\n    this.grid.load(this.project.playlist);\r\n\r\n    this.timeline = this.grid.domElement;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.classList.add(\"audio-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor.domElement);\r\n    this.cursor.domElement.style.marginLeft =\r\n      this._trackPanels.offsetWidth + \"px\";\r\n    this.grid.scrollTop = 0;\r\n\r\n    this.project.on(\"update\", (e) => {\r\n      const update = e as IProjectUpdateEvent;\r\n      console.log(\"ProjectUI project update\", update);\r\n\r\n      if (update.type === \"project\") {\r\n        if (!(update.value instanceof Project)) {\r\n          throw new Error(\"Invalid project update\");\r\n        }\r\n        console.log(\"Playlist loaded new Project\", update.value);\r\n        this._loadProject(update.value);\r\n      }\r\n    });\r\n  }\r\n\r\n  private _loadProject(project: IProject) {\r\n    let i = 0;\r\n\r\n    for (let i = 0; i < project.playlist.tracks.length; i++) {\r\n      const track = project.playlist.tracks[i];\r\n      const playlistTrack = new PlaylistTrack(track);\r\n      this._trackPanels.appendChild(playlistTrack.domElement);\r\n      i++;\r\n    }\r\n\r\n    for (; i < 16; i++) {\r\n      const track: ITrackOptions = {\r\n        name: `Track ${i + 1}`,\r\n        mute: false,\r\n        solo: false,\r\n        selected: false,\r\n      };\r\n      const playlistTrack = new PlaylistTrack(track);\r\n      project.playlist.tracks.push(track);\r\n      this._trackPanels.appendChild(playlistTrack.domElement);\r\n    }\r\n\r\n    console.log(\"Updating grid with new project playlist\", project.playlist);\r\n\r\n    this.grid.load(project.playlist);\r\n  }\r\n}\r\n","export abstract class AudioImporter {\r\n  static decodeAudioData(\r\n    arrayBuffer: ArrayBuffer,\r\n    audioContext: AudioContext\r\n  ): Promise<AudioBuffer> {\r\n    return new Promise((resolve, reject) => {\r\n      audioContext.decodeAudioData(\r\n        arrayBuffer,\r\n        (buffer) => resolve(buffer),\r\n        (error) => reject(error)\r\n      );\r\n    });\r\n  }\r\n\r\n  static async loadUrl(url: string, audioContext: AudioContext) {\r\n    try {\r\n      const response = await fetch(url);\r\n      const arrayBuffer = await response.arrayBuffer();\r\n      return await AudioImporter.decodeAudioData(arrayBuffer, audioContext);\r\n    } catch (error) {\r\n      console.error(\"Error loading audio file:\", error);\r\n    }\r\n  }\r\n\r\n  static async loadFile(file: File, audioContext: AudioContext) {\r\n    try {\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      return await AudioImporter.decodeAudioData(arrayBuffer, audioContext);\r\n    } catch (error) {\r\n      console.error(\"Error loading audio file:\", error);\r\n    }\r\n  }\r\n\r\n  static loadBlob(\r\n    blob: Blob,\r\n    audioContext: AudioContext\r\n  ): Promise<AudioBuffer> {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.onload = () => {\r\n        const arrayBuffer = reader.result as ArrayBuffer;\r\n        AudioImporter.decodeAudioData(arrayBuffer, audioContext)\r\n          .then((audioBuffer) => {\r\n            resolve(audioBuffer);\r\n          })\r\n          .catch((error) => {\r\n            reject(error);\r\n          });\r\n      };\r\n      reader.onerror = (error) => {\r\n        reject(error);\r\n      };\r\n      reader.readAsArrayBuffer(blob);\r\n    });\r\n  }\r\n}\r\n","export abstract class FileImporter {\r\n  static importFile(accept = \"*/*\"): Promise<File> {\r\n    return new Promise((resolve, reject) => {\r\n      const fileInput = document.createElement(\"input\");\r\n      fileInput.type = \"file\";\r\n      fileInput.accept = accept;\r\n      fileInput.addEventListener(\"change\", () => {\r\n        const file = fileInput.files?.[0];\r\n        if (file) {\r\n          resolve(file);\r\n        } else {\r\n          reject(new Error(\"No file selected\"));\r\n        }\r\n      });\r\n      fileInput.click();\r\n    });\r\n  }\r\n}\r\n","import { ContextMenu } from \"../../../elements/src/elements/ContextMenu\";\r\nimport {\r\n  TreeView,\r\n  TreeViewFolder,\r\n} from \"../../../elements/src/elements/TreeView\";\r\nimport { GraphicsHelpers } from \"../abstracts/GraphicsHelpers\";\r\nimport { AudioImporter } from \"../../../elements/src/importers/AudioImporter\";\r\nimport { FileImporter } from \"../../../elements/src/importers/FileImporter\";\r\nimport { IPattern } from \"../schema\";\r\nimport { IProjectUpdateEvent } from \"./Project\";\r\nimport type { ProjectUI } from \"./ProjectUI\";\r\n\r\nexport class ProjectTreeView extends TreeView {\r\n  loadFile(file: File) {\r\n    if (file.type.startsWith(\"audio/\")) {\r\n      this.loadAudioFile(file);\r\n    } else if (file.type.startsWith(\"image/\")) {\r\n      this.loadImageFile(file);\r\n    } else if (file.type.startsWith(\"video/\")) {\r\n      this.loadVideoFile(file);\r\n    } else {\r\n      throw new Error(\"Unsupported file type\");\r\n    }\r\n  }\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    super(\"Project\");\r\n\r\n    const folderMenu = new ContextMenu(document.body, this.domElement, () => {\r\n      return (\r\n        this.selectedItem?.type === \"folder\" && this.selectedItem.id !== \"root\"\r\n      );\r\n    });\r\n\r\n    folderMenu.addItem(\"New Folder\", () => {\r\n      this.selectedItem = this.newFolderInSelected();\r\n    });\r\n\r\n    folderMenu.addItem(\r\n      \"Rename\",\r\n      () => {\r\n        this.selectedItem?.rename();\r\n      },\r\n      () => {\r\n        return this.selectedItem?.parentId !== this.root.id;\r\n      }\r\n    );\r\n\r\n    folderMenu.addItem(\r\n      \"Import Audio\",\r\n      () => {\r\n        folderMenu.hide();\r\n        FileImporter.importFile(\"audio/*\").then((file) => {\r\n          const folder = this.selectedItem! as TreeViewFolder;\r\n          this.loadAudioFile(file, folder);\r\n        });\r\n      },\r\n      () => {\r\n        return this.selectedItem?.id === \"audio\";\r\n      }\r\n    );\r\n\r\n    folderMenu.addItem(\r\n      \"Import Video\",\r\n      () => {\r\n        folderMenu.hide();\r\n        FileImporter.importFile(\"video/*\").then((file) => {\r\n          console.log(\"Imported file\", file);\r\n        });\r\n      },\r\n      () => {\r\n        return this.selectedItem?.id === \"video\";\r\n      }\r\n    );\r\n\r\n    folderMenu.addItem(\r\n      \"Import Image\",\r\n      () => {\r\n        folderMenu.hide();\r\n        FileImporter.importFile(\"image/*\").then((file) => {\r\n          const folder = this.selectedItem! as TreeViewFolder;\r\n          this.selectedItem = folder.add(\"image\", file.name, undefined, file);\r\n          this.emit(\"open\", this.selectedItem);\r\n        });\r\n      },\r\n      () => {\r\n        return this.selectedItem?.id === \"images\";\r\n      }\r\n    );\r\n\r\n    folderMenu.addItem(\r\n      \"New Pattern\",\r\n      () => {\r\n        const folder = this.selectedItem! as TreeViewFolder;\r\n        const pattern: IPattern = {\r\n          name: \"New Pattern\",\r\n          image: \"\",\r\n          tracks: [],\r\n        };\r\n        this.ui.project.patterns.push(pattern);\r\n        this.selectedItem = folder.add(\r\n          \"pattern\",\r\n          pattern.name,\r\n          undefined,\r\n          pattern\r\n        );\r\n      },\r\n      () => {\r\n        return this.selectedItem?.id === \"patterns\";\r\n      }\r\n    );\r\n\r\n    const fileMenu = new ContextMenu(document.body, this.domElement, () => {\r\n      return this.selectedItem?.type !== \"folder\";\r\n    });\r\n\r\n    fileMenu.addItem(\r\n      \"Open\",\r\n      () => {\r\n        if (this.selectedItem) this.emit(\"open\", this.selectedItem);\r\n      },\r\n      () => {\r\n        return Boolean(this.selectedItem);\r\n      }\r\n    );\r\n\r\n    fileMenu.addItem(\r\n      \"Duplicate\",\r\n      () => {\r\n        this.selectedItem = this.duplicateSelected();\r\n      },\r\n      () => {\r\n        return Boolean(this.selectedItem);\r\n      }\r\n    );\r\n\r\n    fileMenu.addItem(\r\n      \"Rename\",\r\n      () => {\r\n        this.selectedItem?.rename();\r\n      },\r\n      () => {\r\n        return Boolean(this.selectedItem);\r\n      }\r\n    );\r\n\r\n    ui.project.on(\"update\", (e) => {\r\n      const update = e as IProjectUpdateEvent;\r\n      if (update.type === \"project\") {\r\n        console.log(\"ProjectTreeView.update\");\r\n        this.clear();\r\n        this.root.add(\"folder\", \"Audio\", \"audio\");\r\n        this.root.add(\"folder\", \"Images\", \"images\");\r\n        const patternsFolder: TreeViewFolder = this.root.add(\r\n          \"folder\",\r\n          \"Patterns\",\r\n          \"patterns\"\r\n        );\r\n        patternsFolder.toggle(true);\r\n        const presetsFolder: TreeViewFolder = this.root.add(\r\n          \"folder\",\r\n          \"Presets\",\r\n          \"presets\"\r\n        );\r\n        presetsFolder.toggle(true);\r\n        presetsFolder.add(\"folder\", \"FM Bass\");\r\n        presetsFolder.add(\"folder\", \"FM Piano\");\r\n        presetsFolder.add(\"folder\", \"Mixer\");\r\n        presetsFolder.add(\"folder\", \"Multisampler\");\r\n        this.root.add(\"folder\", \"Samples\", \"samples\");\r\n        this.root.add(\"folder\", \"Video\", \"video\");\r\n        for (const pattern of ui.project.patterns) {\r\n          patternsFolder.add(\"pattern\", pattern.name, undefined, pattern);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  loadAudioFile(file: File, folder: TreeViewFolder = this.get(\"audio\")!) {\r\n    AudioImporter.loadFile(file, this.ui.audioContext)\r\n      .then((buffer) => {\r\n        if (!buffer) {\r\n          throw new Error(\"Error loading audio file\");\r\n        }\r\n\r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.width = 2048;\r\n        canvas.height = 100;\r\n\r\n        GraphicsHelpers.renderWaveform(canvas, buffer, \"#bbaaffaa\");\r\n\r\n        this.selectedItem = folder.add(\"audio\", file.name, undefined, {\r\n          buffer,\r\n          image: canvas.toDataURL(),\r\n          name: file.name,\r\n        });\r\n\r\n        this.emit(\"open\", this.selectedItem);\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error loading audio file\", error);\r\n        alert(\"Error loading audio file\");\r\n      });\r\n  }\r\n\r\n  loadImageFile(file: File, folder: TreeViewFolder = this.get(\"images\")!) {\r\n    this.selectedItem = folder.add(\"image\", file.name, undefined, file);\r\n    this.emit(\"open\", this.selectedItem);\r\n  }\r\n\r\n  loadVideoFile(file: File, folder: TreeViewFolder = this.get(\"video\")!) {\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      const url = reader.result as string;\r\n      this.selectedItem = folder.add(\"video\", file.name, undefined, url);\r\n    };\r\n\r\n    reader.readAsDataURL(file);\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class ImagePreview extends BaseElement<\"change\"> {\r\n  private _img: HTMLImageElement;\r\n  private zoom = 1;\r\n\r\n  constructor(src?: string | File) {\r\n    super(\"div\", \"image-preview\");\r\n\r\n    this._img = document.createElement(\"img\");\r\n    this._img.addEventListener(\"load\", () => {\r\n      this.emit(\"change\", this);\r\n    });\r\n\r\n    if (src instanceof File) {\r\n      this._img.src = URL.createObjectURL(src);\r\n    } else if (typeof src === \"string\") {\r\n      this._img.src = src;\r\n    }\r\n\r\n    this.domElement.appendChild(this._img);\r\n\r\n    // Add pinch-zoom and wheel zoom event listeners\r\n    this.domElement.addEventListener(\"wheel\", this.handleWheelZoom);\r\n    this.domElement.addEventListener(\"touchstart\", this.handlePinchZoom);\r\n    this.domElement.addEventListener(\"touchmove\", this.handlePinchZoom);\r\n  }\r\n\r\n  set src(value: string) {\r\n    this._img.src = value;\r\n  }\r\n\r\n  private handleWheelZoom = (e: WheelEvent) => {\r\n    e.preventDefault();\r\n    const dir = e.deltaY > 0 ? -1 : 1;\r\n    this.zoom *= 1 + dir * 0.1;\r\n    if (this.zoom < 0.1) {\r\n      this.zoom = 0.1;\r\n    }\r\n    this._img.style.transform = `scale(${this.zoom})`;\r\n  };\r\n\r\n  private handlePinchZoom = (event: TouchEvent) => {\r\n    const touch1 = event.touches[0];\r\n    const touch2 = event.touches[1];\r\n    if (!touch1 || !touch2) {\r\n      return;\r\n    }\r\n    const distance = Math.hypot(\r\n      touch1.clientX - touch2.clientX,\r\n      touch1.clientY - touch2.clientY\r\n    );\r\n    this._img.style.transform = `scale(${distance * 0.01})`;\r\n  };\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ImagePreview } from \"../../../../elements/src/elements/ImagePreview\";\r\nimport type { ProjectUI } from \"../ProjectUI\";\r\n\r\nexport class ImagePreviewWindow extends DraggableWindow {\r\n  imagePreview: ImagePreview;\r\n  constructor(ui: ProjectUI, file: File) {\r\n    super(ui.container, { title: file.name });\r\n\r\n    this.imagePreview = new ImagePreview(file);\r\n    this.content.appendChild(this.imagePreview.domElement);\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class DraggableNumber extends BaseElement<\"change\"> {\r\n  private _value: number;\r\n  private _step: number;\r\n  private _hideZero: string | null;\r\n  private _padZeros: number;\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(value: number) {\r\n    this._value = value;\r\n    if (value === 0 && this._hideZero !== null) {\r\n      this.domElement.textContent = this._hideZero;\r\n    } else {\r\n      if (this._padZeros > 0) {\r\n        this.domElement.textContent = value\r\n          .toString()\r\n          .padStart(this._padZeros, \"0\");\r\n      } else {\r\n        this.domElement.textContent = value.toString();\r\n      }\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    value: number,\r\n    min: number,\r\n    max: number,\r\n    step = 1,\r\n    sensitivity = 0.25,\r\n    hideZero: string | null = \"-\",\r\n    padZeros = 0\r\n  ) {\r\n    super(\"div\", \"draggable-number\");\r\n\r\n    this._hideZero = hideZero;\r\n    this._value = value;\r\n    this._step = step;\r\n    this._padZeros = padZeros;\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const startY = e.clientY;\r\n      const startValue = this.value;\r\n      const onMouseMove = (event: PointerEvent) => {\r\n        const oldValue = this.value;\r\n        const dy = Math.round(-(event.clientY - startY) * sensitivity);\r\n        const newValue = startValue + dy * this._step;\r\n        this.value = Math.max(min, Math.min(max, newValue));\r\n        if (oldValue !== this.value) this.emit(\"change\", this.value);\r\n      };\r\n      const onMouseUp = () => {\r\n        document.removeEventListener(\"pointermove\", onMouseMove);\r\n        document.removeEventListener(\"pointerup\", onMouseUp);\r\n      };\r\n      document.addEventListener(\"pointermove\", onMouseMove);\r\n      document.addEventListener(\"pointerup\", onMouseUp);\r\n    });\r\n\r\n    this.value = value || 0;\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { DraggableNumber } from \"../../../../elements/src/elements/DraggableNumber\";\r\n\r\nexport class TimePositionInput extends BaseElement<\"change\"> {\r\n  private _inputHours: DraggableNumber;\r\n  private _inputMinutes: DraggableNumber;\r\n  private _inputSeconds: DraggableNumber;\r\n  private _inputMillis: DraggableNumber;\r\n\r\n  get value() {\r\n    return (\r\n      this._inputHours.value * 3600 +\r\n      this._inputMinutes.value * 60 +\r\n      this._inputSeconds.value +\r\n      this._inputMillis.value / 1000\r\n    );\r\n  }\r\n\r\n  set value(value: number) {\r\n    const hours = Math.floor(value / 3600);\r\n    const minutes = Math.floor((value % 3600) / 60);\r\n    const seconds = Math.floor(value % 60);\r\n    const milliseconds = Math.floor((value % 1) * 1000);\r\n\r\n    this._inputHours.value = hours;\r\n    this._inputMinutes.value = minutes;\r\n    this._inputSeconds.value = seconds;\r\n    this._inputMillis.value = milliseconds;\r\n  }\r\n\r\n  constructor() {\r\n    super(\"div\", \"time-position-input\");\r\n\r\n    this._inputHours = new DraggableNumber(0, 0, 99, 1, undefined, null, 2);\r\n    this._inputHours.on(\"change\", () => this.emit(\"change\"));\r\n    this.domElement.appendChild(this._inputHours.domElement);\r\n\r\n    const hoursLabel = document.createElement(\"label\");\r\n    hoursLabel.textContent = \"h\";\r\n    this.domElement.appendChild(hoursLabel);\r\n\r\n    this._inputMinutes = new DraggableNumber(0, 0, 59, 1, undefined, null, 2);\r\n    this._inputMinutes.on(\"change\", () => this.emit(\"change\"));\r\n    this.domElement.appendChild(this._inputMinutes.domElement);\r\n\r\n    const minutesLabel = document.createElement(\"label\");\r\n    minutesLabel.textContent = \"m\";\r\n    this.domElement.appendChild(minutesLabel);\r\n\r\n    this._inputSeconds = new DraggableNumber(0, 0, 59, 1, undefined, null, 2);\r\n    this._inputSeconds.on(\"change\", () => this.emit(\"change\"));\r\n    this.domElement.appendChild(this._inputSeconds.domElement);\r\n\r\n    const millisecondsLabel = document.createElement(\"label\");\r\n    millisecondsLabel.textContent = \".\";\r\n    this.domElement.appendChild(millisecondsLabel);\r\n\r\n    this._inputMillis = new DraggableNumber(0, 0, 999, 1, undefined, null, 3);\r\n    this._inputMillis.on(\"change\", () => this.emit(\"change\"));\r\n    this.domElement.appendChild(this._inputMillis.domElement);\r\n\r\n    const secondsLabel = document.createElement(\"label\");\r\n    secondsLabel.textContent = \"s\";\r\n    this.domElement.appendChild(secondsLabel);\r\n\r\n    this.value = 0;\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { ContextMenu } from \"../../../../elements/src/elements/ContextMenu\";\r\nimport { GraphicsHelpers } from \"../../abstracts/GraphicsHelpers\";\r\nimport { TimePositionInput } from \"./TimePositionInput\";\r\n\r\nfunction pixelsToSeconds(\r\n  canvas: HTMLCanvasElement,\r\n  buffer: AudioBuffer,\r\n  x: number\r\n) {\r\n  return (x / canvas.width) * buffer.duration;\r\n}\r\n\r\nfunction secondsToPixels(\r\n  canvas: HTMLCanvasElement,\r\n  buffer: AudioBuffer,\r\n  seconds: number\r\n) {\r\n  return (seconds / buffer.duration) * canvas.width;\r\n}\r\n\r\nexport class WaveEditor extends BaseElement<\"change\" | \"add\"> {\r\n  _canvas: HTMLCanvasElement;\r\n  private _selection: HTMLDivElement;\r\n  private _dragStart?: number;\r\n  private _startTime: TimePositionInput;\r\n  private _endTime: TimePositionInput;\r\n  private _audioBuffer?: AudioBuffer;\r\n  private _previewSource?: AudioBufferSourceNode;\r\n\r\n  get audioBuffer() {\r\n    return this._audioBuffer;\r\n  }\r\n\r\n  constructor(\r\n    readonly audioContext: AudioContext,\r\n    name?: string,\r\n    audioBuffer?: AudioBuffer\r\n  ) {\r\n    super(\"div\", \"wave-editor\");\r\n\r\n    const buttonsContainer = document.createElement(\"div\");\r\n    buttonsContainer.classList.add(\"wave-editor-buttons\");\r\n    this.domElement.appendChild(buttonsContainer);\r\n\r\n    const toolButtons = document.createElement(\"div\");\r\n    buttonsContainer.appendChild(toolButtons);\r\n\r\n    const cropButton = document.createElement(\"button\");\r\n    cropButton.textContent = \"Crop\";\r\n    toolButtons.appendChild(cropButton);\r\n\r\n    const deleteButton = document.createElement(\"button\");\r\n    deleteButton.textContent = \"Delete\";\r\n    deleteButton.addEventListener(\"click\", () => this._deleteSelection());\r\n    toolButtons.appendChild(deleteButton);\r\n\r\n    const cropMenu = new ContextMenu(document.body, cropButton);\r\n    cropMenu.addItem(\"Crop\", () => this._crop());\r\n    cropMenu.addItem(\"Crop As New\", () => this._cropAsNew());\r\n\r\n    cropButton.addEventListener(\"click\", (e) =>\r\n      cropMenu.show(e.clientX, e.clientY)\r\n    );\r\n\r\n    const playStop = document.createElement(\"div\");\r\n    buttonsContainer.appendChild(playStop);\r\n\r\n    const playButton = document.createElement(\"button\");\r\n    playButton.textContent = \"Play\";\r\n    playButton.addEventListener(\"click\", () => this._play());\r\n    playStop.appendChild(playButton);\r\n\r\n    const stopButton = document.createElement(\"button\");\r\n    stopButton.textContent = \"Stop\";\r\n    stopButton.addEventListener(\"click\", () => this._stop());\r\n    playStop.appendChild(stopButton);\r\n\r\n    const unused = document.createElement(\"div\");\r\n    buttonsContainer.appendChild(unused);\r\n\r\n    const canvasContainer = document.createElement(\"div\");\r\n    canvasContainer.classList.add(\"wave-editor-canvas-container\");\r\n    this.domElement.appendChild(canvasContainer);\r\n\r\n    this._canvas = document.createElement(\"canvas\");\r\n    this._canvas.width = 2048;\r\n    this._canvas.height = 200;\r\n\r\n    canvasContainer.appendChild(this._canvas);\r\n\r\n    const timeContainer = document.createElement(\"div\");\r\n    timeContainer.classList.add(\"wave-editor-times\");\r\n    this.domElement.appendChild(timeContainer);\r\n\r\n    const startTimeLabel = document.createElement(\"label\");\r\n    startTimeLabel.textContent = \"START:\";\r\n    timeContainer.appendChild(startTimeLabel);\r\n\r\n    this._startTime = new TimePositionInput();\r\n    timeContainer.appendChild(this._startTime.domElement);\r\n    this._startTime.on(\"change\", () => {\r\n      this._updateSelection();\r\n      if (this._previewSource) {\r\n        this._previewSource.loopStart = this._startTime.value;\r\n      }\r\n    });\r\n\r\n    const endTimeLabel = document.createElement(\"label\");\r\n    endTimeLabel.textContent = \"END:\";\r\n    timeContainer.appendChild(endTimeLabel);\r\n\r\n    this._endTime = new TimePositionInput();\r\n    timeContainer.appendChild(this._endTime.domElement);\r\n    this._endTime.on(\"change\", () => {\r\n      this._updateSelection();\r\n      if (this._previewSource) {\r\n        this._previewSource.loopEnd = this._endTime.value;\r\n      }\r\n    });\r\n\r\n    this._selection = document.createElement(\"div\");\r\n    this._selection.classList.add(\"wave-editor-selection\");\r\n    canvasContainer.appendChild(this._selection);\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      if (this._dragStart !== undefined && this._audioBuffer) {\r\n        const delta = e.clientX - this._dragStart;\r\n        this._selection.style.width = `${delta}px`;\r\n\r\n        this._endTime.value = pixelsToSeconds(\r\n          this._canvas,\r\n          this._audioBuffer,\r\n          e.layerX\r\n        );\r\n      }\r\n    };\r\n\r\n    const onup = () => {\r\n      if (this._dragStart !== undefined) {\r\n        this._dragStart = undefined;\r\n        window.removeEventListener(\"pointermove\", onmove);\r\n        window.removeEventListener(\"pointerup\", onup);\r\n        if (this._previewSource) {\r\n          this._previewSource.loopStart = this._startTime.value;\r\n          this._previewSource.loopEnd = this._endTime.value;\r\n        }\r\n      }\r\n    };\r\n\r\n    this._canvas.addEventListener(\"pointerdown\", (e) => {\r\n      console.log(\"DEBUG\", e.layerX);\r\n\r\n      if (!this._audioBuffer) return;\r\n\r\n      if (e.button === 0) {\r\n        this._dragStart = e.clientX;\r\n        this._selection.style.left = `${e.layerX}px`;\r\n        this._selection.style.width = \"0px\";\r\n\r\n        this._startTime.value = pixelsToSeconds(\r\n          this._canvas,\r\n          this._audioBuffer,\r\n          e.layerX\r\n        );\r\n\r\n        this._endTime.value = this._startTime.value;\r\n\r\n        console.log(\"pointerdown\", e.button);\r\n\r\n        window.addEventListener(\"pointermove\", onmove);\r\n        window.addEventListener(\"pointerup\", onup);\r\n      }\r\n    });\r\n\r\n    this.on(\"change\", () => {});\r\n\r\n    if (audioBuffer) {\r\n      setTimeout(() => {\r\n        this.load(name || \"Untitled\", audioBuffer);\r\n      }, 1);\r\n    }\r\n  }\r\n\r\n  load(name: string, audioBuffer: AudioBuffer) {\r\n    this._audioBuffer = audioBuffer;\r\n    this._draw();\r\n  }\r\n\r\n  private _updateSelection() {\r\n    if (!this._audioBuffer) return;\r\n\r\n    const start = this._startTime.value;\r\n    const end = this._endTime.value;\r\n\r\n    this._selection.style.left = `${secondsToPixels(\r\n      this._canvas,\r\n      this._audioBuffer,\r\n      start\r\n    )}px`;\r\n\r\n    this._selection.style.width = `${\r\n      secondsToPixels(this._canvas, this._audioBuffer, end) -\r\n      parseFloat(this._selection.style.left)\r\n    }px`;\r\n  }\r\n\r\n  private _getSelectedBuffer(): AudioBuffer | undefined {\r\n    if (!this._audioBuffer) return;\r\n\r\n    const start = this._startTime.value;\r\n    const end = this._endTime.value;\r\n\r\n    const startFrame = Math.floor(start * this._audioBuffer.sampleRate);\r\n    const endFrame = Math.floor(end * this._audioBuffer.sampleRate);\r\n\r\n    const newBuffer = new AudioContext().createBuffer(\r\n      this._audioBuffer.numberOfChannels,\r\n      endFrame - startFrame,\r\n      this._audioBuffer.sampleRate\r\n    );\r\n\r\n    for (let i = 0; i < this._audioBuffer.numberOfChannels; i++) {\r\n      const channel = this._audioBuffer.getChannelData(i);\r\n      const newChannel = newBuffer.getChannelData(i);\r\n      let newFrame = 0;\r\n      for (let j = startFrame; j < endFrame; j++) {\r\n        newChannel[newFrame] = channel[j];\r\n        newFrame++;\r\n      }\r\n    }\r\n\r\n    return newBuffer;\r\n  }\r\n\r\n  private _draw() {\r\n    if (!this._audioBuffer) {\r\n      throw new Error(\"No audio buffer loaded\");\r\n    }\r\n    GraphicsHelpers.renderWaveform(\r\n      this._canvas,\r\n      this._audioBuffer,\r\n      this._canvas.parentElement?.style.color || \"#bbaaff\"\r\n    );\r\n  }\r\n\r\n  private _crop() {\r\n    const newBuffer = this._getSelectedBuffer();\r\n    if (!newBuffer) return;\r\n\r\n    this._audioBuffer = newBuffer;\r\n    this._draw();\r\n\r\n    this._startTime.value = 0;\r\n    this._endTime.value = 0;\r\n\r\n    this._selection.style.width = \"0px\";\r\n\r\n    this.emit(\"change\");\r\n  }\r\n\r\n  private _cropAsNew() {\r\n    const newBuffer = this._getSelectedBuffer();\r\n    if (!newBuffer) return;\r\n\r\n    this.emit(\"add\", newBuffer);\r\n  }\r\n\r\n  private _play() {\r\n    if (!this._audioBuffer) throw new Error(\"No audio buffer loaded\");\r\n\r\n    if (this._previewSource) {\r\n      this._previewSource.stop();\r\n      this._previewSource.disconnect();\r\n    }\r\n\r\n    const source = this.audioContext.createBufferSource();\r\n\r\n    const startTime = this._startTime.value;\r\n    const endTime = this._endTime.value;\r\n    if (endTime < startTime) {\r\n      console.error(endTime, \">\", startTime);\r\n      throw new Error(\"End time is before start time\");\r\n    } else if (endTime > startTime) {\r\n      source.loop = true;\r\n      source.loopStart = startTime;\r\n      source.loopEnd = endTime;\r\n    } else {\r\n      source.loop = false;\r\n    }\r\n\r\n    this._previewSource = source;\r\n    source.buffer = this._audioBuffer;\r\n    source.connect(this.audioContext.destination);\r\n    source.start(this.audioContext.currentTime, startTime);\r\n  }\r\n\r\n  private _stop() {\r\n    if (this._previewSource) {\r\n      this._previewSource.stop();\r\n      this._previewSource.disconnect();\r\n    }\r\n  }\r\n\r\n  _deleteSelection() {\r\n    if (!this._audioBuffer) throw new Error(\"No audio buffer loaded\");\r\n\r\n    const start = this._startTime.value;\r\n    const end = this._endTime.value;\r\n\r\n    const startFrame = Math.floor(start * this._audioBuffer.sampleRate);\r\n    const endFrame = Math.floor(end * this._audioBuffer.sampleRate);\r\n\r\n    const newLength = this._audioBuffer.length - (endFrame - startFrame);\r\n\r\n    const newBuffer = new AudioContext().createBuffer(\r\n      this._audioBuffer.numberOfChannels,\r\n      newLength,\r\n      this._audioBuffer.sampleRate\r\n    );\r\n\r\n    for (let i = 0; i < this._audioBuffer.numberOfChannels; i++) {\r\n      const channel = this._audioBuffer.getChannelData(i);\r\n      const newChannel = newBuffer.getChannelData(i);\r\n      let newFrame = 0;\r\n      for (let j = 0; j < this._audioBuffer.length; j++) {\r\n        if (j < startFrame || j >= endFrame) {\r\n          newChannel[newFrame] = channel[j];\r\n          newFrame++;\r\n        }\r\n      }\r\n    }\r\n\r\n    this._audioBuffer = newBuffer;\r\n    this._draw();\r\n\r\n    this._endTime.value = this._startTime.value;\r\n    this._updateSelection();\r\n\r\n    this.emit(\"change\");\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { WaveEditor } from \"../components/WaveEditor\";\r\n\r\nexport class WaveEditorWindow extends DraggableWindow {\r\n  waveEditor: WaveEditor;\r\n\r\n  constructor(ui: ProjectUI, item: { name: string; buffer: AudioBuffer }) {\r\n    const waveEditor = new WaveEditor(ui.audioContext, item.name, item.buffer);\r\n\r\n    super(ui.container, {\r\n      title: \"Wave Editor - \" + item.name,\r\n      persistent: false,\r\n      width: 640,\r\n      height: 300,\r\n      content: waveEditor.domElement,\r\n    });\r\n\r\n    this.waveEditor = waveEditor;\r\n\r\n    this.waveEditor.on(\"change\", () => {\r\n      if (!waveEditor.audioBuffer) throw new Error(\"No audio buffer\");\r\n      item.buffer = waveEditor.audioBuffer;\r\n    });\r\n\r\n    this.content.appendChild(waveEditor.domElement);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ContextMenu } from \"../../../../elements/src/elements/ContextMenu\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { IPattern } from \"../../schema\";\r\nimport { Playlist } from \"../components/Playlist\";\r\nimport { ProjectTreeView } from \"../ProjectTreeView\";\r\nimport { FileImporter } from \"../../../../elements/src/importers/FileImporter\";\r\nimport { ImagePreviewWindow } from \"./ImagePreviewWindow\";\r\nimport { GraphicsHelpers } from \"../../abstracts/GraphicsHelpers\";\r\nimport { WaveEditorWindow } from \"./WaveEditorWindow\";\r\nimport { TreeViewItem } from \"../../../../elements/src/elements/TreeView\";\r\n\r\nexport class ProjectWindow extends DraggableWindow {\r\n  readonly playlist: Playlist;\r\n\r\n  beatWidth = 10;\r\n  treeView: ProjectTreeView;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.ui.project.audioClock;\r\n  }\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"project-container\");\r\n\r\n    super(ui.container, {\r\n      title: \"Project Timeline\",\r\n      persistent: true,\r\n      content: container,\r\n      width: 800,\r\n      height: 400,\r\n    });\r\n\r\n    this.playlist = new Playlist(this.ui.project);\r\n    this.playlist.grid.drawingEnabled = false;\r\n\r\n    const sourceContainer = document.createElement(\"div\");\r\n    sourceContainer.classList.add(\"project-source-container\");\r\n\r\n    this.treeView = new ProjectTreeView(this.ui);\r\n    this.treeView.on(\"select\", () => {\r\n      const item = this.treeView.selectedItem;\r\n      if (!item) throw new Error(\"No item selected\");\r\n\r\n      console.log(\"ProjectTreeView.select\", item);\r\n\r\n      if (item.type === \"pattern\") {\r\n        const pattern = item.data as IPattern;\r\n\r\n        //if (!pattern.image) {\r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.width = 1024;\r\n        canvas.height = 100;\r\n        GraphicsHelpers.renderPattern(canvas, pattern, \"#bbaaff\", 25);\r\n        pattern.image = canvas.toDataURL();\r\n        //}\r\n\r\n        this.playlist.grid.drawingLabel = pattern.name;\r\n        this.playlist.grid.drawingValue = this.treeView.selectedItem;\r\n        this.playlist.grid.drawingEnabled = true;\r\n        this.playlist.grid.drawingImage = pattern.image;\r\n      } else if (item.type === \"image\") {\r\n        const file = item.data as File;\r\n        this.playlist.grid.drawingImage = URL.createObjectURL(file);\r\n        this.playlist.grid.drawingLabel = file.name;\r\n        this.playlist.grid.drawingValue = this.treeView.selectedItem;\r\n        this.playlist.grid.drawingEnabled = true;\r\n      } else if (item.type === \"audio\") {\r\n        const audioItem = item.data as {\r\n          buffer: AudioBuffer;\r\n          image: string;\r\n        };\r\n        this.playlist.grid.drawingImage = audioItem.image;\r\n        this.playlist.grid.drawingLabel = item.name;\r\n        this.playlist.grid.drawingValue = item;\r\n        this.playlist.grid.drawingEnabled = true;\r\n      } else {\r\n        this.playlist.grid.drawingEnabled = false;\r\n      }\r\n    });\r\n\r\n    this.treeView.on(\"open\", (item) => {\r\n      if (!(item instanceof TreeViewItem)) return;\r\n\r\n      console.log(\"ProjectTreeView.dblclick\", item);\r\n      if (item.type === \"audio\") {\r\n        const data = item.data as {\r\n          buffer: AudioBuffer;\r\n          image: string;\r\n          name: string;\r\n        };\r\n        const editor = new WaveEditorWindow(ui, data).show();\r\n        editor.on(\"change\", () => {\r\n          console.log(\"WaveEditorWindow.change\", editor.waveEditor.audioBuffer);\r\n          if (!editor.waveEditor.audioBuffer)\r\n            throw new Error(\"No audio buffer\");\r\n          data.buffer = editor.waveEditor.audioBuffer;\r\n        });\r\n      } else if (item.type === \"image\") {\r\n        const file = item.data as File;\r\n        new ImagePreviewWindow(ui, file).show();\r\n      } else if (item.type === \"pattern\") {\r\n        const pattern = item.data as IPattern;\r\n        this.ui.patternWindow.loadPattern(pattern);\r\n        this.ui.patternWindow.show();\r\n      }\r\n    });\r\n\r\n    this.treeView.on(\"change\", (e) => {\r\n      console.log(\"ProjectTreeView.change\", e);\r\n    });\r\n\r\n    this.on(\"keydown\", (e) => {\r\n      const event = e as KeyboardEvent;\r\n      console.log(\"ProjectWindow.keydown\", event.key, event.ctrlKey);      \r\n    });\r\n\r\n    const addMenu = new ContextMenu(document.body);\r\n\r\n    addMenu.addItem(\"Import Audio\", () => {\r\n      FileImporter.importFile(\"audio/*\").then((file) => {\r\n        console.log(\"Imported file\", file);\r\n      });\r\n    });\r\n\r\n    const generateMenu = new ContextMenu();\r\n    generateMenu.addItem(\"Stable Audio\", () => {\r\n      console.log(\"Stable Audio\");\r\n    });\r\n    generateMenu.addItem(\"MusicGen\", () => {\r\n      console.log(\"MusicGen\");\r\n    });\r\n\r\n    addMenu.addSubmenu(\"Generate\", generateMenu);\r\n\r\n    sourceContainer.appendChild(this.treeView.domElement);\r\n\r\n    container.appendChild(sourceContainer);\r\n    container.appendChild(this.playlist.domElement);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport { WindowContainer } from \"../../../elements/src/elements/WindowContainer\";\r\nimport { Project } from \"./Project\";\r\nimport { IKeyboardEvent, Keyboard } from \"./components/Keyboard\";\r\nimport { MixerWindow } from \"./windows/MixerWindow\";\r\nimport { PatternWindow } from \"./windows/PatternWindow\";\r\nimport { PianoRollWindow } from \"./windows/PianoRollWindow\";\r\nimport { ProjectWindow } from \"./windows/ProjectWindow\";\r\n\r\nexport class ProjectUI extends BaseElement<\"update\"> {\r\n  container: WindowContainer;\r\n  readonly pianoRollWindow: PianoRollWindow;\r\n  readonly mixerWindow: MixerWindow;\r\n  readonly playlistWindow: ProjectWindow;\r\n  patternWindow: PatternWindow;\r\n\r\n  get audioContext() {\r\n    return this.project.audioClock.audioContext;\r\n  }\r\n\r\n  constructor(readonly project: Project) {\r\n    super(\"div\", \"project-ui\");\r\n\r\n    this.container = new WindowContainer();\r\n    this.domElement.appendChild(this.container.domElement);\r\n\r\n    this.pianoRollWindow = new PianoRollWindow(this);\r\n\r\n    this.patternWindow = new PatternWindow(this);\r\n    this.patternWindow.show(35, 100);\r\n\r\n    this.playlistWindow = new ProjectWindow(this);\r\n    this.playlistWindow.show(1000, 50);\r\n\r\n    this.mixerWindow = new MixerWindow(this);\r\n    this.mixerWindow.show(1000, 470);\r\n\r\n    const keyboard = new Keyboard();\r\n    this.domElement.appendChild(keyboard.domElement);\r\n    keyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      console.log(\"Keyboard\", event);\r\n      if (e.type === \"press\") {\r\n        this.patternWindow.trigger(e.note + 24, 0, e.velocity);\r\n      } else if (e.type === \"release\") {\r\n        this.patternWindow.release(e.note + 24);\r\n      }\r\n    });\r\n\r\n    // handle file drop\r\n    this.domElement.addEventListener(\"dragover\", (e) => {\r\n      e.preventDefault();\r\n    });\r\n\r\n    this.domElement.addEventListener(\"drop\", async (e: DragEvent) => {\r\n      e.preventDefault();\r\n      const files = e.dataTransfer?.files;\r\n      if (files && files.length > 0) {\r\n        for (let i = 0; i < files.length; i++) {\r\n          this.playlistWindow.treeView.loadFile(files[i]);\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n","import type { Project } from \"../elements/Project\";\r\nimport type { ISourceEvent } from \"../elements/components/SamplerSlot\";\r\nimport { Plugin } from \"../plugins/plugins\";\r\nimport { IInstrumentSettings } from \"../schema\";\r\n\r\nexport interface IInstrument extends IInstrumentSettings {\r\n  trigger(note: number, when: number, velocity: number): ISourceEvent | void;\r\n\r\n  release(note: number, when: number): void;\r\n}\r\n\r\nexport abstract class Instrument extends Plugin implements IInstrument {\r\n  inputPort?: number | undefined;\r\n  inputChannel?: number | undefined;\r\n  transpose = 0;\r\n  output: GainNode;\r\n\r\n  constructor(\r\n    project: Project,\r\n    public mixerChannel = 0\r\n  ) {\r\n    super(project);\r\n    this.output = project.audioClock.audioContext.createGain();\r\n    this.output.connect(project.mixer.channels[mixerChannel].gainNode);\r\n  }\r\n\r\n  abstract trigger(\r\n    note: number,\r\n    when: number,\r\n    velocity?: number\r\n  ): ISourceEvent | void;\r\n\r\n  abstract release(note: number, when: number): void;\r\n}\r\n","import { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { ISourceEvent } from \"../elements/components/SamplerSlot\";\r\nimport { ISynthesizerVoiceSettings } from \"../schema\";\r\nimport { IInstrument } from \"./Instrument\";\r\n\r\nexport abstract class SynthesizerVoice implements ISynthesizerVoiceSettings, IInstrument {\r\n  _settings: ISynthesizerVoiceSettings | null = null;\r\n\r\n  abstract name: string;\r\n  abstract id: string;\r\n\r\n  get settings(): ISynthesizerVoiceSettings {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n    return this.settings;\r\n  }\r\n\r\n  private readonly _gain: GainNode;\r\n  private _note: number | null = null;\r\n  private _frequency: number | null = null;\r\n\r\n  get gain() {\r\n    return this._gain.gain.value;\r\n  }\r\n\r\n  get output() {\r\n    return this._gain;\r\n  }\r\n\r\n  get note() {\r\n    return this._note;\r\n  }\r\n\r\n  get lfoNumber() {\r\n    return this.settings.lfoNumber;\r\n  }\r\n\r\n  get envelopeNumber() {\r\n    return this.settings.envelopeNumber;\r\n  }\r\n\r\n  get frequency() {\r\n    return this._frequency;\r\n  }\r\n\r\n  get detune() {\r\n    return this.settings.detune;\r\n  }\r\n\r\n  get oscillators() {\r\n    return this.settings.oscillators;\r\n  }\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    this._gain = audioClock.audioContext.createGain();\r\n  }\r\n\r\n  loadSettings(settings: ISynthesizerVoiceSettings) {\r\n    this._settings = settings;\r\n  }\r\n\r\n  abstract trigger(\r\n    note: number,\r\n    velocity: number,\r\n    when: number\r\n  ): ISourceEvent | void;\r\n\r\n  abstract release(note: number, when: number): void;\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport { ControllerValue, IPluginControl } from \"../schema\";\r\n\r\nexport abstract class PluginControl\r\n  extends BaseElement<\"change\">\r\n{\r\n  protected _label: HTMLSpanElement;\r\n\r\n  abstract value: ControllerValue;\r\n\r\n  constructor(readonly settings: IPluginControl) {\r\n    super(\"div\", \"control\");\r\n    this._label = document.createElement(\"span\");\r\n    this._label.classList.add(\"label\");\r\n    this._label.textContent = settings.label;\r\n    this.domElement.appendChild(this._label);\r\n  }\r\n}\r\n","import { PluginControl } from \"../../abstracts/PluginControl\";\r\nimport { IPluginControl } from \"../../schema\";\r\n\r\nexport class Slider extends PluginControl {\r\n  private readonly _range: HTMLInputElement;\r\n\r\n  get value() {\r\n    return this.settings.value as number;\r\n  }\r\n\r\n  set value(value: number) {\r\n    this.settings.value = value;\r\n    this._range.value = value.toString();\r\n  }\r\n\r\n  get element() {\r\n    return this._range;\r\n  }\r\n\r\n  constructor(options: IPluginControl) {\r\n    super({ ...options, controlType: \"slider\" });\r\n\r\n    this._range = document.createElement(\"input\");\r\n    this._range.type = \"range\";\r\n    this._range.min = options.min.toString();\r\n    this._range.max = options.max.toString();\r\n    this._range.step = options.step.toString();\r\n    this._range.value = options.value.toString();\r\n\r\n    this._range.addEventListener(\"input\", () => {\r\n      this.settings.value = parseFloat(this._range.value);\r\n      this.emit(\"change\", this);\r\n    });\r\n\r\n    this._range.addEventListener(\"change\", () => {\r\n      this._range.blur();\r\n    });\r\n\r\n    this.domElement.appendChild(this._range);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { MathHelpers } from \"../../abstracts/MathHelpers\";\r\nimport { PluginControl } from \"../../abstracts/PluginControl\";\r\nimport { IEnvelope } from \"../../schema\";\r\nimport { Slider } from \"./Slider\";\r\n\r\nexport class Envelope extends BaseElement<\"update\"> {\r\n  readonly attack: PluginControl;\r\n  readonly hold: PluginControl;\r\n  readonly decay: PluginControl;\r\n  readonly sustain: PluginControl;\r\n  readonly release: PluginControl;\r\n  private _triggerTime: number = 0;\r\n\r\n  constructor(\r\n    readonly settings: IEnvelope = {\r\n      attack: 0.003,\r\n      hold: 0.0,\r\n      decay: 2.0,\r\n      sustain: 0.01,\r\n      release: 0.15,\r\n    }\r\n  ) {\r\n    super(\"div\", \"envelope\");\r\n\r\n    // \"attack\", \"A\", 0, 1, 0.01, attack\r\n    this.attack = new Slider({\r\n      controlType: \"slider\",\r\n      name: \"attack\",\r\n      label: \"A\",\r\n      min: 0,\r\n      max: 1,\r\n      step: 0.01,\r\n      value: settings.attack,\r\n      default: settings.attack,\r\n    });\r\n    this.hold = new Slider({\r\n      controlType: \"slider\",\r\n      name: \"hold\",\r\n      label: \"H\",\r\n      min: 0,\r\n      max: 1,\r\n      step: 0.01,\r\n      value: settings.hold,\r\n      default: settings.hold,\r\n    });\r\n    this.decay = new Slider({\r\n      controlType: \"slider\",\r\n      name: \"decay\",\r\n      label: \"D\",\r\n      min: 0,\r\n      max: 1,\r\n      step: 0.01,\r\n      value: settings.decay,\r\n      default: settings.decay,\r\n    });\r\n    this.sustain = new Slider({\r\n      controlType: \"slider\",\r\n      name: \"sustain\",\r\n      label: \"S\",\r\n      min: 0,\r\n      max: 1,\r\n      step: 0.01,\r\n      value: settings.sustain,\r\n      default: settings.sustain,\r\n    });\r\n    this.release = new Slider({\r\n      controlType: \"slider\",\r\n      name: \"release\",\r\n      label: \"R\",\r\n      min: 0,\r\n      max: 1,\r\n      step: 0.01,\r\n      value: settings.release,\r\n      default: settings.release,\r\n    });\r\n\r\n    this.domElement.appendChild(this.attack.domElement);\r\n    this.domElement.appendChild(this.decay.domElement);\r\n    this.domElement.appendChild(this.sustain.domElement);\r\n    this.domElement.appendChild(this.release.domElement);\r\n  }\r\n\r\n  trigger(param: AudioParam, when: number, target = 1.0, startValue = 0) {\r\n    console.log(\"trigger @ \" + when);\r\n    this._triggerTime = when;\r\n    const value = param.value;\r\n    param.cancelScheduledValues(when);\r\n    param.setValueAtTime(value, when);\r\n    param.exponentialRampToValueAtTime(Math.max(startValue, 0.015), when);\r\n    //param.setValueAtTime(0.015, when);\r\n    param.linearRampToValueAtTime(target, when + this.settings.attack);\r\n    //param.setValueAtTime(1, when + this.attack.value);\r\n    param.exponentialRampToValueAtTime(\r\n      this.settings.sustain || 0.01,\r\n      when + this.settings.attack + this.settings.decay\r\n    );\r\n  }\r\n\r\n  estimateValueAtTime(relativeWhen: number) {\r\n    const attack = this.settings.attack;\r\n    const decay = this.settings.decay;\r\n    const sustain = this.settings.sustain;\r\n    const release = this.settings.release;\r\n    const hold = this.settings.hold;\r\n\r\n    if (relativeWhen < attack) {\r\n      return MathHelpers.lerp(0, 1, relativeWhen / attack);\r\n    } else if (relativeWhen < attack + hold) {\r\n      return 1;\r\n    } else if (relativeWhen < attack + hold + decay) {\r\n      const timeSinceAttack = relativeWhen - attack - hold;\r\n      const decayValue = Math.exp(-timeSinceAttack / decay);\r\n      return 1 - (1 - sustain) * decayValue;\r\n    } else {\r\n      const timeSinceRelease = relativeWhen - attack - hold - decay;\r\n      const releaseValue = Math.exp(-timeSinceRelease / release);\r\n      return sustain * releaseValue;\r\n    }\r\n  }\r\n\r\n  triggerRelease(param: AudioParam, when: number) {\r\n    console.log(\"triggerRelease @ \" + when);\r\n    const value = param.value;\r\n    param.cancelScheduledValues(this._triggerTime);\r\n    param.setValueAtTime(value, when);\r\n    param.exponentialRampToValueAtTime(0.01, when + this.settings.release);\r\n    param.setValueAtTime(0, when + this.settings.release);\r\n  }\r\n}\r\n","import { DraggableNumber } from \"../../../elements/src/elements/DraggableNumber\";\r\n\r\nimport {\r\n  DraggableWindow,\r\n  IWindowOptions,\r\n} from \"../../../elements/src/elements/DraggableWindow\";\r\nimport type { ProjectUI } from \"../elements/ProjectUI\";\r\nimport { Instrument } from \"./Instrument\";\r\n\r\nexport interface IInstrumentWindowOptions extends IWindowOptions {\r\n  mixerChannel: number;\r\n  instrument: Instrument;\r\n}\r\n\r\nexport class InstrumentWindow extends DraggableWindow {\r\n  private _settingsBar: HTMLDivElement;\r\n\r\n  constructor(\r\n    ui: ProjectUI,\r\n    readonly instrument: Instrument\r\n  ) {\r\n    super(ui.container, {\r\n      title: instrument.name,\r\n      width: 400,\r\n      height: 300,\r\n      persistent: true,\r\n    });\r\n\r\n    const mixerChannelSelector = new DraggableNumber(\r\n      instrument.mixerChannel,\r\n      0,\r\n      16\r\n    );\r\n    mixerChannelSelector.on(\"change\", (value) => {\r\n      this.instrument.mixerChannel = value as number;\r\n      console.assert(ui.project.mixer, \"instrument.mixer is undefined!\");\r\n      instrument.output.disconnect();\r\n      instrument.output.connect(\r\n        ui.project.mixer.channels[this.instrument.mixerChannel].gainNode\r\n      );\r\n    });\r\n\r\n    this._settingsBar = document.createElement(\"div\");\r\n    this._settingsBar.classList.add(\"window-settings-bar\");\r\n    this._settingsBar.appendChild(mixerChannelSelector.domElement);\r\n\r\n    this.domElement.insertBefore(this._settingsBar, this.content);\r\n  }\r\n}\r\n","import { PluginControl } from \"../../abstracts/PluginControl\";\r\nimport { IPluginControl } from \"../../schema\";\r\n\r\nexport class Knob extends PluginControl {\r\n  private _value = 0;\r\n  private _handle: HTMLDivElement;\r\n  public sensitivity = 0.25;\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  constructor(readonly settings: IPluginControl) {\r\n    super({\r\n      ...settings,\r\n      controlType: \"knob\",\r\n    });\r\n\r\n    this.domElement.classList.add(\"knob\");\r\n\r\n    const indicator = document.createElement(\"div\");\r\n    indicator.classList.add(\"knob-indicator\");\r\n\r\n    this.sensitivity = (settings.max - settings.min / settings.step) * 0.01;\r\n\r\n    this._handle = document.createElement(\"div\");\r\n    this._handle.appendChild(indicator);\r\n    this._handle.classList.add(\"knob-handle\");\r\n    this._handle.addEventListener(\r\n      \"pointerdown\",\r\n      this._onPointerDown.bind(this)\r\n    );\r\n    this.domElement.insertBefore(this._handle, this._label);\r\n\r\n    this._setValue(settings.value as number);\r\n  }\r\n\r\n  private _onPointerDown(e: PointerEvent) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    const startValue = this._value;\r\n    const startPosition = { x: e.clientX, y: e.clientY };\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      const offset = -(e.clientY - startPosition.y);\r\n      const step = e.ctrlKey ? this.settings.step * 0.01 : 1;\r\n      let value = startValue + offset * this.sensitivity * step;\r\n      value -= value % step;\r\n      this._setValue(value);\r\n      this.emit(\"change\", this._value);\r\n      return false;\r\n    };\r\n\r\n    const onrelease = (e: PointerEvent) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      window.removeEventListener(\"pointermove\", onmove);\r\n      window.removeEventListener(\"pointerup\", onrelease);\r\n      this._handle.releasePointerCapture(e.pointerId);\r\n      this._handle.classList.remove(\"active\");\r\n      return false;\r\n    };\r\n\r\n    window.addEventListener(\"pointermove\", onmove);\r\n    window.addEventListener(\"pointerup\", onrelease);\r\n\r\n    // this._handle.setPointerCapture(event.pointerId);\r\n    // this._handle.focus();\r\n    this.emit(\"change\", this._value);\r\n    this._handle.classList.add(\"active\");\r\n    return false;\r\n  }\r\n\r\n  private _setValue(value: number) {\r\n    this._value = Math.min(\r\n      this.settings.max,\r\n      Math.max(this.settings.min, value)\r\n    );\r\n    this._handle.style.transform = `rotate(${\r\n      (this._value * 280) / (this.settings.max - this.settings.min) - 50\r\n    }deg)`;\r\n  }\r\n}\r\n","import {\r\n  InstrumentWindow,\r\n} from \"../../abstracts/InstrumentWindow\";\r\nimport type { ProjectUI } from \"../../elements/ProjectUI\";\r\nimport { Knob } from \"../../elements/components/Knob\";\r\nimport { FMBass } from \"./FMBass\";\r\n\r\n\r\nexport class FMBassWindow extends InstrumentWindow {\r\n\r\n  instrument: FMBass;\r\n\r\n  constructor(\r\n    readonly ui: ProjectUI,\r\n    readonly fmbass: FMBass\r\n  ) {\r\n    super(ui, fmbass);\r\n\r\n    this.instrument = fmbass;\r\n\r\n    const fmGainKnob = new Knob({\r\n      controlType: \"knob\",\r\n      name: \"FM Gain\",\r\n      label: \"FM Gain\",\r\n      min: 0,\r\n      max: 1000,\r\n      step: 1,\r\n      default: 100,\r\n      value: 100,\r\n    });\r\n\r\n    this.content.appendChild(fmGainKnob.domElement);\r\n    fmGainKnob.on(\"change\", () => {\r\n      console.log(\"FM Gain\", fmGainKnob.value);\r\n      this.instrument.modulatorGain.gain.value = fmGainKnob.value;\r\n    });\r\n\r\n    const fmRatioKnob = new Knob({\r\n      controlType: \"knob\",\r\n      name: \"FM Ratio\",\r\n      label: \"FM Ratio\",\r\n      min: 0,\r\n      max: 12,\r\n      step: 1,\r\n      default: this.instrument.fmRatio,\r\n      value: this.instrument.fmRatio,\r\n    });\r\n    fmRatioKnob.on(\"change\", () => {\r\n      console.log(\"FM Ratio\", fmRatioKnob.value);\r\n      this.instrument.fmRatio = fmRatioKnob.value;\r\n    });\r\n    this.content.appendChild(fmRatioKnob.domElement);\r\n  }\r\n}\r\n","import { Instrument } from \"../../abstracts/Instrument\";\r\nimport { SynthesizerVoice } from \"../../abstracts/SynthesizerVoice\";\r\nimport type { Project } from \"../../elements/Project\";\r\nimport type { AudioClock } from \"../../elements/components/AudioClock\";\r\nimport { Envelope } from \"../../elements/components/Envelope\";\r\nimport type { ControllerGroup } from \"../../schema\";\r\nimport { FMBassWindow } from \"./FMBassWindow\";\r\n\r\nfunction noteToFrequency(note: number) {\r\n  return 440 * Math.pow(2, (note - 69) / 12);\r\n}\r\n\r\nexport class FMBassVoice extends SynthesizerVoice {\r\n\r\n  readonly name = \"FM Bass Voice\";\r\n  readonly id = \"fm_bass_voice\";\r\n  \r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(audioClock);\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity?: number) {\r\n    console.log(\"FMBassVoice triggered\", note, when, velocity);\r\n  }\r\n\r\n  release(note: number) {\r\n    console.log(\"FMBassVoice released\", note);\r\n  }\r\n}\r\n\r\nexport class FMBass extends Instrument {\r\n  readonly name = \"FM Bass\";\r\n  readonly id = \"fm_bass\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple FM bass synthesizer\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly controllerGroups: ControllerGroup[] = [];\r\n  private _carrier?: OscillatorNode;\r\n  private _modulator?: OscillatorNode;\r\n  private readonly _gain: GainNode;\r\n  readonly modulatorGain: GainNode;\r\n  private readonly _filter: BiquadFilterNode;\r\n  readonly filterEnvelope: Envelope;\r\n  readonly gainEnvelope: Envelope;\r\n\r\n  readonly Window = FMBassWindow;\r\n\r\n  private _heldNote: number | undefined;\r\n\r\n  public fmRatio = 1;\r\n  private _window?: FMBassWindow;\r\n\r\n  constructor(project: Project, mixerChannel = 0) {\r\n    super(project, mixerChannel);\r\n\r\n    const audioContext = project.audioClock.audioContext;\r\n\r\n    this.modulatorGain = audioContext.createGain();\r\n    this.modulatorGain.gain.value = 100;\r\n\r\n    this._gain = audioContext.createGain();\r\n    this._gain.gain.value = 0;\r\n\r\n    const highpassFilter = audioContext.createBiquadFilter();\r\n    highpassFilter.type = \"highpass\";\r\n    highpassFilter.frequency.value = 20;\r\n    this._gain.connect(highpassFilter);\r\n    highpassFilter.connect(this.output);\r\n\r\n    this.output.gain.value = 0.5;\r\n\r\n    this._filter = audioContext.createBiquadFilter();\r\n    this._filter.type = \"lowpass\";\r\n    this._filter.frequency.value = 440;\r\n    this._filter.Q.value = 1;\r\n    this._filter.connect(this._gain);\r\n\r\n    this.filterEnvelope = new Envelope();\r\n    this.gainEnvelope = new Envelope();\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity = 1) {\r\n    console.log(\"FM Bass triggered\", when, \"velocity = \", velocity);\r\n\r\n    this._heldNote = note;\r\n\r\n    note += this.transpose;\r\n\r\n    if (this._carrier?.context.state === \"running\") {\r\n      const g = this._gain.gain.value;\r\n      this._gain.gain.cancelScheduledValues(when);\r\n      this._gain.gain.setValueAtTime(g, when);\r\n      this._gain.gain.exponentialRampToValueAtTime(velocity * 0.1, when + 0.01);\r\n\r\n      try {\r\n        this._carrier.stop(when + 0.02);\r\n        this._modulator?.stop(when + 0.02);\r\n      } catch (e) {\r\n        console.error(\"Error stopping carrier/modulator\", e);\r\n      }\r\n    }\r\n\r\n    const freq = noteToFrequency(note);\r\n\r\n    this._carrier = this.project.audioClock.audioContext.createOscillator();\r\n    this._carrier.frequency.value = freq;\r\n\r\n    this._modulator = this.project.audioClock.audioContext.createOscillator();\r\n    this._modulator.frequency.value = freq * this.fmRatio;\r\n\r\n    this._carrier.connect(this._gain);\r\n    this._modulator.connect(this.modulatorGain);\r\n    this.modulatorGain.connect(this._carrier.frequency);\r\n\r\n    this._carrier.type = \"sine\";\r\n\r\n    this._carrier.start(when);\r\n    this._modulator.start(when);\r\n\r\n    const time = when || this.project.audioClock.currentTime;\r\n\r\n    this.gainEnvelope.trigger(this._gain.gain, time);\r\n\r\n    //this.filterEnvelope.trigger(this.filter.frequency, time);\r\n\r\n    return undefined;\r\n  }\r\n\r\n  release(note: number, when: number) {\r\n    if (this._heldNote !== note) {\r\n      return;\r\n    }\r\n    console.log(\"FM Bass released\", note);\r\n    const time = when || this.project.audioClock.currentTime;\r\n    this.filterEnvelope.triggerRelease(this._filter.frequency, time);\r\n    this.gainEnvelope.triggerRelease(this._gain.gain, time);\r\n  }\r\n}\r\n","import { SynthesizerVoice } from \"./SynthesizerVoice\";\r\nimport { IKeyboardEvent } from \"../elements/components/Keyboard\";\r\nimport { Instrument } from \"./Instrument\";\r\nimport { Project } from \"../elements/Project\";\r\n\r\ninterface ISynthesizerEvent extends IKeyboardEvent {\r\n  voice: SynthesizerVoice;\r\n}\r\n\r\nexport abstract class Synthesizer\r\n  extends Instrument  \r\n{\r\n  readonly voices: SynthesizerVoice[] = [];\r\n  private _nextVoice = 0;\r\n  private _held: ISynthesizerEvent[] = [];\r\n\r\n  constructor(\r\n    project: Project,\r\n    voiceType: typeof SynthesizerVoice,\r\n    mixerChannel = 0,\r\n    maxPoly = 16\r\n  ) {\r\n    super(project, mixerChannel);\r\n\r\n    for (let i = 0; i < maxPoly; i++) {\r\n      const voice: SynthesizerVoice = new (voiceType as any)(\r\n        project.audioClock\r\n      );\r\n      this.voices.push(voice);\r\n      voice.output.connect(this.output);\r\n    }\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity = 1) {\r\n    console.log(this.name + \" triggered voice \" + this._nextVoice);\r\n\r\n    if (this._held.find((e) => e.note == note)) {\r\n      console.warn(this.name + \" already holding note \" + note);\r\n      return;\r\n    }\r\n\r\n    this._held.push({\r\n      note,\r\n      type: \"press\",\r\n      voice: this.voices[this._nextVoice],\r\n      channel: 0,\r\n      velocity: velocity || 1,\r\n    });\r\n\r\n    this.voices[this._nextVoice].trigger(note, when, velocity);\r\n\r\n    this._nextVoice++;\r\n    if (this._nextVoice >= this.voices.length) {\r\n      this._nextVoice = 0;\r\n    }\r\n  }\r\n\r\n  release(note: number, when: number) {\r\n    console.log(this.name + \" released voice \" + note);\r\n\r\n    const index = this._held.findIndex((e) => e.note == note);\r\n    if (index >= 0) {\r\n      this._held[index].voice.release(note, when);\r\n      this._held.splice(index, 1);\r\n    } else {\r\n      console.warn(this.name + \" not holding note \" + note);\r\n    }\r\n  }\r\n}\r\n","import { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport { Synthesizer } from \"../../abstracts/Synthesizer\";\r\nimport { SynthesizerVoice } from \"../../abstracts/SynthesizerVoice\";\r\nimport type { Project } from \"../../elements/Project\";\r\nimport type { AudioClock } from \"../../elements/components/AudioClock\";\r\nimport { Envelope } from \"../../elements/components/Envelope\";\r\nimport type { ControllerGroup } from \"../../schema\";\r\n\r\nfunction noteToFrequency(note: number) {\r\n  return 440 * Math.pow(2, (note - 69) / 12);\r\n}\r\n\r\nexport class FMPianoVoice extends SynthesizerVoice {\r\n  readonly name = \"FM Piano Voice\";\r\n  readonly id = \"fm_piano_voice\";\r\n\r\n  private _carrier1?: OscillatorNode;\r\n  private _modulator1?: OscillatorNode;\r\n  private readonly _gain1: GainNode;\r\n  readonly modulatorGain1: GainNode;\r\n  private readonly _filter: BiquadFilterNode;\r\n  readonly filterEnvelope: Envelope;\r\n  readonly gainEnvelope: Envelope;\r\n\r\n  public fmRatio = 1;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(audioClock);\r\n\r\n    const audioContext = audioClock.audioContext;\r\n\r\n    this.modulatorGain1 = audioContext.createGain();\r\n    this.modulatorGain1.gain.value = 100;\r\n\r\n    this._gain1 = audioContext.createGain();\r\n    this._gain1.gain.value = 0;\r\n\r\n    const highpassFilter = audioContext.createBiquadFilter();\r\n    highpassFilter.type = \"highpass\";\r\n    highpassFilter.frequency.value = 20;\r\n    this._gain1.connect(highpassFilter);\r\n    highpassFilter.connect(this.output);\r\n\r\n    this.output.gain.value = 0.5;\r\n\r\n    this._filter = audioContext.createBiquadFilter();\r\n    this._filter.type = \"lowpass\";\r\n    this._filter.frequency.value = 440;\r\n    this._filter.Q.value = 1;\r\n    this._filter.connect(this._gain1);\r\n\r\n    this.filterEnvelope = new Envelope();\r\n    this.gainEnvelope = new Envelope({\r\n      attack: 0,\r\n      hold: 0,\r\n      decay: 2,\r\n      sustain: 0,\r\n      release: 0.3,\r\n    });\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity: number) {\r\n    console.log(\"FMPianoVoice triggered\", note, when, velocity);\r\n\r\n    if (this._carrier1?.context.state === \"running\") {\r\n      const g = this._gain1.gain.value;\r\n      this._gain1.gain.cancelScheduledValues(when);\r\n      this._gain1.gain.setValueAtTime(g, when);\r\n      this._gain1.gain.exponentialRampToValueAtTime(1, when + 0.01);\r\n\r\n      try {\r\n        this._carrier1.stop(when + 0.02);\r\n        this._modulator1?.stop(when + 0.02);\r\n      } catch (e) {\r\n        console.error(\"Error stopping carrier/modulator\", e);\r\n      }\r\n    }\r\n\r\n    const freq = noteToFrequency(note);\r\n\r\n    this._carrier1 = this.audioClock.audioContext.createOscillator();\r\n    this._carrier1.frequency.value = freq;\r\n\r\n    this._modulator1 = this.audioClock.audioContext.createOscillator();\r\n    this._modulator1.frequency.value = freq * this.fmRatio;\r\n\r\n    this._carrier1.connect(this._gain1);\r\n    this._modulator1.connect(this.modulatorGain1);\r\n    this.modulatorGain1.connect(this._carrier1.frequency);\r\n\r\n    this._carrier1.type = \"sine\";\r\n\r\n    this.output.gain.cancelScheduledValues(when);\r\n    this.output.gain.setValueAtTime(velocity, when);\r\n    this._carrier1.start(when);\r\n    this._modulator1.start(when);\r\n\r\n    const time = when || this.audioClock.currentTime;\r\n\r\n    this.gainEnvelope.trigger(this._gain1.gain, time);\r\n\r\n    //this.filterEnvelope.trigger(this.filter.frequency, time);\r\n\r\n    return undefined;\r\n  }\r\n\r\n  release(note: number, when: number) {\r\n    const time = when || this.audioClock.currentTime;\r\n    //this.filterEnvelope.triggerRelease(this._filter.frequency, time);\r\n    this.gainEnvelope.triggerRelease(this.output.gain, time);\r\n  }\r\n}\r\n\r\nexport class FMPiano extends Synthesizer {\r\n  readonly Window = InstrumentWindow;\r\n\r\n  readonly name = \"FM Piano\";\r\n  readonly id = \"fm_piano\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple FM piano synthesizer\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly controllerGroups: ControllerGroup[] = [];\r\n\r\n  constructor(project: Project, mixerChannel = 0) {\r\n    super(project, FMPianoVoice, mixerChannel);\r\n  }\r\n}\r\n","import { Instrument } from \"../../abstracts/Instrument\";\r\nimport { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport { Project } from \"../../elements/Project\";\r\nimport { Envelope } from \"../../elements/components/Envelope\";\r\nimport { AudioImporter } from \"../../../../elements/src/importers/AudioImporter\";\r\nimport { ISamplerSettings } from \"../../schema\";\r\n\r\nexport class Sampler extends Instrument {\r\n  readonly name = \"Sampler\";\r\n  readonly id = \"sampler\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple sampler\";\r\n  private readonly _sources: {\r\n    source: AudioBufferSourceNode;\r\n    gain: GainNode;\r\n  }[] = [];\r\n  private readonly _gainEnvelope: Envelope;\r\n  private readonly _enableEnvelope = false;\r\n  private _cutBySelf = true;\r\n  private _volume = 0.9;\r\n  public cutGroup = 0;\r\n  public cutByGroups: number[] = [];\r\n  private _window?: InstrumentWindow;\r\n\r\n  readonly Window = InstrumentWindow;\r\n\r\n  constructor(\r\n    project: Project,\r\n    readonly settings: ISamplerSettings = {}\r\n  ) {\r\n    super(project, settings.mixerChannel);\r\n\r\n    this._gainEnvelope = new Envelope({\r\n      attack: settings.envelope?.attack ?? 0,\r\n      hold: settings.envelope?.hold ?? 0,\r\n      decay: settings.envelope?.decay ?? 0,\r\n      sustain: settings.envelope?.sustain ?? 1,\r\n      release: settings.envelope?.release ?? 0,\r\n    });\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity: number) {\r\n    if (!this.settings.buffer) {\r\n      console.warn(\"No buffer loaded\");\r\n      return;\r\n    }\r\n\r\n    if (this._cutBySelf) {\r\n      this.stop();\r\n    }\r\n\r\n    const gain = this.project.audioClock.audioContext.createGain();\r\n    gain.connect(this.output);\r\n    const source = this.project.audioClock.audioContext.createBufferSource();\r\n    source.buffer = this.settings.buffer;\r\n    source.connect(gain);\r\n    const item = { source, gain };\r\n    this._sources.push(item);\r\n    source.onended = () => {\r\n      item.gain.disconnect();\r\n      this._sources.splice(this._sources.indexOf(item), 1);\r\n    };\r\n    source.start(when);\r\n    if (this._enableEnvelope) {\r\n      this._gainEnvelope.trigger(gain.gain, when, velocity);\r\n    }\r\n  }\r\n\r\n  release(note: number, when: number): void {\r\n    if (this._enableEnvelope) {\r\n      for (const item of this._sources) {\r\n        this._gainEnvelope.triggerRelease(item.gain.gain, when);\r\n      }\r\n    }\r\n  }\r\n\r\n  stop(when = 0) {\r\n    for (const item of this._sources) {\r\n      item.source.stop(when);\r\n    }\r\n  }\r\n\r\n  loadUrl(url: string) {\r\n    AudioImporter.loadUrl(url, this.project.audioClock.audioContext).then(\r\n      (buffer) => {\r\n        this.settings.buffer = buffer;\r\n      }\r\n    );\r\n  }\r\n\r\n  loadFile(file: File) {\r\n    AudioImporter.loadFile(file, this.project.audioClock.audioContext).then(\r\n      (buffer) => {\r\n        this.settings.buffer = buffer;\r\n      }\r\n    );\r\n  }\r\n\r\n  loadBlob(blob: Blob) {\r\n    AudioImporter.loadBlob(blob, this.project.audioClock.audioContext).then(\r\n      (buffer) => {\r\n        this.settings.buffer = buffer;\r\n      }\r\n    );\r\n  }\r\n}\r\n","import {\r\n  IInstrumentWindowOptions,\r\n  InstrumentWindow,\r\n} from \"../../abstracts/InstrumentWindow\";\r\nimport type { ProjectUI } from \"../../elements/ProjectUI\";\r\nimport type { Multisampler } from \"./Multisampler\";\r\nimport { Sampler } from \"./Sampler\";\r\n\r\nexport interface IMultisamplerWindowOptions extends IInstrumentWindowOptions {\r\n  instrument: Multisampler;\r\n}\r\n\r\nexport class MultisamplerWindow extends InstrumentWindow {\r\n  private readonly _slotsContainer: HTMLDivElement;\r\n\r\n  constructor(\r\n    readonly ui: ProjectUI,\r\n    readonly instrument: Multisampler\r\n  ) {\r\n    super(ui, instrument);\r\n\r\n    // window.addEventListener(\"keydown\", (event) => this.onKeyDown(event));\r\n\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"sampler-slots-container\");\r\n    this._slotsContainer = container;\r\n\r\n    //keypad numbers 0-9\r\n    // then . / * + - Enter\r\n    const defaultSlots = [\r\n      { keyBinding: 96, name: \"0\" },\r\n      { keyBinding: 97, name: \"1\" },\r\n      { keyBinding: 98, name: \"2\" },\r\n      { keyBinding: 99, name: \"3\" },\r\n      { keyBinding: 100, name: \"4\" },\r\n      { keyBinding: 101, name: \"5\" },\r\n      { keyBinding: 102, name: \"6\", cutByGroups: [3, 6] },\r\n      { keyBinding: 103, name: \"7\" },\r\n      { keyBinding: 104, name: \"8\" },\r\n      { keyBinding: 105, name: \"9\" },\r\n      { keyBinding: 111, name: \"/\", cutByGroups: [0, 10] },\r\n      { keyBinding: 106, name: \"*\" },\r\n      { keyBinding: 109, name: \"-\" },\r\n      { keyBinding: 107, name: \"+\" },\r\n      { keyBinding: 13, name: \"Enter\" },\r\n    ];\r\n\r\n    for (let i = 0; i < defaultSlots.length; i++) {\r\n      const slot = new Sampler(this.ui.project, { name: defaultSlots[i].name });\r\n      instrument.samplers.push(slot);\r\n      slot.loadUrl(`./data/samples/kit1/${i}.wav`);\r\n    }\r\n\r\n    ui.project.audioClock.on(\"stop\", () => {\r\n      for (const slot of instrument.samplers) {\r\n        slot.stop();\r\n      }\r\n    });\r\n\r\n    this.content.appendChild(container);\r\n  }\r\n\r\n  // onKeyDown(event: KeyboardEvent) {\r\n  //   //console.log(event.key, event.keyCode);\r\n  //   const slot = this.options.instrument.samplers.find(\r\n  //     (slot) => slot.keyBinding === event.keyCode\r\n  //   );\r\n  //   if (slot) {\r\n  //     event.preventDefault();\r\n  //     const note = this.instrument.samplers.indexOf(slot);\r\n  //     this.instrument.trigger(note, null);\r\n  //   }\r\n  // }\r\n}\r\n","import { Instrument } from \"../../abstracts/Instrument\";\r\nimport type { Project } from \"../../elements/Project\";\r\nimport { MultisamplerWindow } from \"./MultisamplerWindow\";\r\nimport { Sampler } from \"./Sampler\";\r\n\r\nexport class Multisampler extends Instrument {\r\n  readonly name = \"Multisampler\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple multisampler\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly id = \"multisampler\";\r\n\r\n  readonly Window = MultisamplerWindow;\r\n\r\n  samplers: Sampler[] = [];  \r\n\r\n  constructor(project: Project) {\r\n    super(project);\r\n\r\n    this.transpose = -24;\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity: number) {\r\n    note += this.transpose;\r\n    console.log(\"Sampler trigger\", note);\r\n    const slot = this.samplers[note];\r\n    if (slot) {\r\n      for (const sampler of this.samplers) {\r\n        if (sampler.cutByGroups.includes(slot.cutGroup)) {\r\n          sampler.release(note, when);\r\n        }\r\n      }\r\n      return slot.trigger(note, when, velocity);\r\n    }\r\n  }\r\n\r\n  release(note: number, when = 0): void {\r\n    note += this.transpose;\r\n    if (this.samplers[note]) {\r\n      this.samplers[note].release(note, when);\r\n    }\r\n  }\r\n}\r\n","import { AudioClock } from \"./elements/components/AudioClock\";\r\nimport { Project } from \"./elements/Project\";\r\nimport { ProjectUI } from \"./elements/ProjectUI\";\r\nimport { FMBass } from \"./plugins/fmbass/FMBass\";\r\nimport { FMPiano } from \"./plugins/fmpiano/FMPiano\";\r\nimport { Plugins } from \"./plugins/plugins\";\r\nimport { Multisampler } from \"./plugins/sampler/Multisampler\";\r\nimport { templates } from \"./schema\";\r\n\r\nPlugins.register(\"multisampler\", Multisampler);\r\nPlugins.register(\"fm_bass\", FMBass);\r\nPlugins.register(\"fm_piano\", FMPiano);\r\n\r\nconst domElement = document.createElement(\"div\");\r\ndomElement.classList.add(\"studio\");\r\n\r\nconst audioClock = new AudioClock();\r\nconst project = new Project(audioClock, templates.Basic);\r\nconst projectUI = new ProjectUI(project);\r\n\r\ndomElement.appendChild(audioClock.domElement);\r\ndomElement.appendChild(projectUI.domElement);\r\ndocument.body.appendChild(domElement);\r\n","export type ControllerGroup = { [key: string]: IPluginControl };\r\nexport type ControllerValue = number | string | boolean | AudioBuffer | object;\r\nexport type ControlType =\r\n  | \"knob\"\r\n  | \"slider\"\r\n  | \"string\"\r\n  | \"select\"\r\n  | \"audio\"\r\n  | \"object\";\r\n\r\nexport interface IEvent {\r\n  label: string;\r\n  start: number;\r\n  duration: number;\r\n  note?: number;\r\n  row?: number;\r\n  velocity?: number;  \r\n  value?: unknown;\r\n}\r\n\r\nexport interface IAudioItem {\r\n  buffer: AudioBuffer;\r\n  image: string;\r\n  name: string;\r\n}\r\n\r\nexport interface ISequence {\r\n  events: IEvent[];\r\n}\r\n\r\nexport interface IPattern {\r\n  name: string;\r\n  tracks: ISequence[];\r\n  image?: string;\r\n}\r\n\r\nexport interface ITrackOptions {\r\n  name: string;\r\n  mute: boolean;\r\n  solo: boolean;\r\n  selected: boolean;\r\n}\r\n\r\nexport interface IHasOwnEnvelope {\r\n  envelope: IEnvelope | null;\r\n}\r\n\r\nexport interface IHasOwnLFO {\r\n  lfo?: IOscillatorSettings;\r\n}\r\n\r\nexport interface IUseEnvelope {\r\n  envelopeNumber: number | null;\r\n}\r\n\r\nexport interface IUseLFO {\r\n  lfoNumber: number | null;\r\n}\r\n\r\nexport interface IInstrumentSettings {\r\n  name: string;\r\n  id: string;\r\n  inputPort?: number;\r\n  inputChannel?: number;\r\n}\r\n\r\nexport interface IPlaylist extends ISequence {\r\n  tracks: ITrackOptions[];  \r\n}\r\n\r\nexport interface IMixer {\r\n  channels: IMixerChannel[];\r\n}\r\n\r\nexport interface IEffect {\r\n  plugin: string;\r\n}\r\n\r\nexport interface IMixerChannel {\r\n  label: string;\r\n  gain: number;\r\n  mute: boolean;\r\n  solo: boolean;\r\n  outputs: number[];\r\n  effects: IEffect[];\r\n}\r\n\r\nexport interface IProject {\r\n  title: string;\r\n  description: string;\r\n  tempo: number;\r\n  instruments: IInstrumentSettings[];\r\n  patterns: IPattern[];\r\n  playlist: IPlaylist;\r\n  mixer: IMixer;\r\n}\r\n\r\nexport interface ISamplerSlot {\r\n  name: string;\r\n  buffer: AudioBuffer | null;\r\n  keyBinding: number | null;\r\n  velocity: number;\r\n  pan: number;\r\n  pitch: number;\r\n  randomPitch: number;\r\n  randomVelocity: number;\r\n  startPosition: number;\r\n  endPosition: number;\r\n  loop: boolean;\r\n  loopStart: number;\r\n  loopEnd: number;\r\n  cutGroup: number;\r\n  cutByGroups: number[];\r\n}\r\n\r\nexport interface ISamplerSettings {\r\n  name?: string;\r\n  buffer?: AudioBuffer;\r\n  envelope?: IEnvelope;\r\n  loop?: boolean;\r\n  loopStart?: number;\r\n  loopEnd?: number;\r\n  mixerChannel?: number;\r\n}\r\n\r\nexport interface IPluginControl {\r\n  controlType: ControlType;\r\n  name: string;\r\n  label: string;\r\n  default: ControllerValue;\r\n  value: ControllerValue;\r\n  min: number;\r\n  max: number;\r\n  step: number;\r\n}\r\n\r\nexport interface IEnvelope {\r\n  attack: number;\r\n  hold: number;\r\n  decay: number;\r\n  sustain: number;\r\n  release: number;\r\n}\r\n\r\nexport interface IOscillatorSettings extends IHasOwnEnvelope {\r\n  shape: \"sine\" | \"square\" | \"sawtooth\" | \"triangle\";\r\n  detune: number;\r\n  gain?: number;\r\n  route?: number;\r\n  feedback?: number;\r\n}\r\n\r\nexport interface IFilter extends IHasOwnEnvelope {\r\n  type:\r\n    | \"lowpass\"\r\n    | \"highpass\"\r\n    | \"bandpass\"\r\n    | \"lowshelf\"\r\n    | \"highshelf\"\r\n    | \"peaking\"\r\n    | \"notch\"\r\n    | \"allpass\";\r\n  frequency: number;\r\n  detune: number;\r\n  Q: number;\r\n  gain: number;\r\n}\r\n\r\nexport interface ISynthesizerVoiceSettings extends IUseEnvelope, IUseLFO {\r\n  gain: number;\r\n  frequency: number | null;\r\n  detune: number | null;\r\n  oscillators: IOscillatorSettings[];\r\n  note: number | null;\r\n}\r\n\r\nexport const templates: { [key: string]: IProject } = {\r\n  Basic: {\r\n    title: \"Basic\",\r\n    description: \"Basic project template with Sampler and Synthesizer\",\r\n    tempo: 120,\r\n    instruments: [\r\n      { name: \"Multisampler\", id: \"multisampler\" },\r\n      {\r\n        name: \"FM Bass\",\r\n        id: \"fm_bass\",\r\n      },\r\n      {\r\n        name: \"FM Piano\",\r\n        id: \"fm_piano\",\r\n      },\r\n    ],\r\n    patterns: [\r\n      {\r\n        name: \"Pattern 1\",\r\n        tracks: [],\r\n      },\r\n    ],\r\n\r\n    playlist: { tracks: [], events: [] },\r\n    mixer: {\r\n      channels: [\r\n        {\r\n          label: \"Master\",\r\n          gain: 1,\r\n          mute: false,\r\n          solo: false,\r\n          outputs: [],\r\n          effects: [],\r\n        },\r\n        {\r\n          label: \"Drums\",\r\n          gain: 1,\r\n          mute: false,\r\n          solo: false,\r\n          outputs: [0],\r\n          effects: [],\r\n        },\r\n        {\r\n          label: \"Bass\",\r\n          gain: 1,\r\n          mute: false,\r\n          solo: false,\r\n          outputs: [0],\r\n          effects: [],\r\n        },\r\n      ],\r\n    },\r\n  },\r\n};\r\n"],"names":["exports","Symbol","toStringTag","Object","defineProperty","value","_events","_onceEvents","on","eventName","callback","this","push","once","emit","eventData","onceCallbacks","error","console","undefined","callbacks","removeAllListeners","audioContext","window","AudioContext","webkitAudioContext","getAudioContext","state","resume","latencyHint","sampleRate","prototype","navigator","mediaDevices","enumerateDevices","getAudioDevices","then","devices","log","_playbackMode","_audioContext","_bpm","_scheduledEvents","_startTime","domElement","document","createElement","classList","add","playPauseButton","addEventListener","isPlaying","stop","playPause","appendChild","stopButton","textContent","bpmInput","type","parseFloat","currentTimeDisplay","currentTime","getBeatTime","beat","reference_time","bpm","start","requestAnimationFrame","_render","bind","_update","currentBeat","source","disconnect","remove","restart","buffer","createBuffer","createBufferSource","connect","destination","toggle","bars","Math","floor","beats","timeString","toString","padStart","scheduleEventAtTime","time","emptyBuffer","onended","scheduleEventAtBeat","random","replace","c","r","zero","tagName","className","dispose","child","removeChild","item","_content","_icon","_label","name","id","parentId","data","rename","newName","prompt","BaseElement","_expander","insertBefore","e","preventDefault","dataTransfer","getData","target","stopPropagation","contains","clear","_childContainer","expanded","TreeViewFolder","TreeViewItem","UUID","addItem","rootName","_items","Map","_selectedItem","root","set","newItem","evt","get","parent","Error","p","removeEventListener","event","key","parentElement","deselect","elt","selectedItem","select","duplicateSelected","JSON","parse","stringify","newFolderInSelected","folder","project","assert","audioClock","mixer","_project","register","plugin","_plugins","warn","instantiate","linearToGain","linearValue","dBValue","max","min","pow","lerp","a","b","t","label","gain","outputs","mute","solo","effects","gainNode","createGain","MathHelpers","channels","master","MixerChannel","i","channel","title","description","tempo","instruments","patterns","playlist","tracks","events","_sources","Mixer","_queueAudioEvent","length","setTimeout","load","audioItem","duration","index","indexOf","splice","serialize","map","instrument","timeline","deserialize","Plugins","instance","container","_isOpen","open","close","_activeWindow","windows","_draggingWindow","topRow","bottomRow","_leftPanel","WindowSnapPanel","_workspace","_rightPanel","_bottomPanel","_handleWindowDrag","workspaceWidth","getBoundingClientRect","width","leftPanelWidth","clientX","panelWidth","style","height","rightPanelWidth","left","win","resetDragOffset","setSize","options","_handleWindowResize","addWindow","draggableWindow","includes","activateWindow","w","zIndex","display","titleElt","messageElt","_closeButton","onclick","body","BOTTOM_ROW","TOP_ROW","KEY_COLORS","NOTE_NAMES","midiAccess","keyToNote","keyCode","note","requestMIDIAccess","midi","inputs","forEach","entry","onmidimessage","handleMIDI","catch","PopupNotification","message","pressedKeys","ctrlKey","altKey","shiftKey","update","velocity","statusByte","eventType","dataByte1","dataByte2","control","_resizing","_startX","_startY","_startWidth","_startHeight","_startTop","_startLeft","_resizeDirection","handle","getCurrentHandle","cursor","onmove","dx","dy","clientY","top","offsetWidth","offsetHeight","button","startResize","onrelease","stopResize","direction","offsetTop","offsetLeft","rect","offsetX","offsetY","_isDragging","_dragOffsetX","_dragOffsetY","_top","_left","persistent","titlebar","ondrag","newTop","newLeft","deltaX","deltaY","_title","content","show","x","y","innerWidth","innerHeight","setPosition","setTitle","SizableElement","items","addSelectable","filter","selected","selectable","addToDom","f","find","end","removeSelectable","_mute","_solo","_muteButton","_soloButton","group","isMaster","_channel","volume","step","_volume","muteSoloButtons","MuteSoloButtons","valueAsNumber","SelectableElement","ui","SelectableGroup","channelsContainer","effectsContainer","MixerChannelStrip","DraggableWindow","clock","transform","beatWidth","hide","triggerActive","timeout","renderWaveform","canvas","color","numChannels","numberOfChannels","ctx","getContext","imgData","createImageData","pixels","parseInt","slice","g","channelData","getChannelData","bufferLength","samplesPerPixel","yCenter","minSample","maxSample","j","sample","yMin","yMax","putImageData","renderSequence","clearFirst","lowestNote","highestNote","clearRect","paddedScale","fillStyle","fillRect","renderPattern","pattern","concat","sequence","GraphicsHelpers","track","labelAndButtons","textLabel","edit","isVisible","indicator","_canvas","append","buttonGroup","previewGroup","port","_window","Window","PatternTrackInstrument","preview","PatternTrackPreview","trigger","release","trackContainer","AudioCursor","marginLeft","querySelector","clientWidth","addTrack","patternPreviews","buttons","loadPattern","PatternTrack","output","mixerWindow","pianoRollWindow","loadTrack","removeTrack","scrollElement","sensitivity","linkedElements","_scrollTop","linkElement","element","ok","cancel","closeButton","HTMLButtonElement","okButton","cancelButton","targetObject","onsave","DialogPopup","grid","src","pitch","noteItem","rowHeight","labelElement","image","backgroundImage","gridElement","rowCount","selectGroup","_currentItem","_dragMode","_dragOffset","_sequence","quantize","drawingEnabled","drawingLabel","drawingImage","drawingValue","_selectGroup","previewCanvas","rowBackgroundCanvas","imageRendering","imageSmoothingEnabled","lineWidth","strokeStyle","beginPath","moveTo","lineTo","stroke","row","base64","toDataURL","backgroundRepeat","noteEditor","EventEditorDialog","Array","from","values","layerX","isVisibile","HTMLDivElement","layerY","round","oldStart","pointerEvents","gridItem","GridItem","selectedItems","delete","querySelectorAll","ScrollPanel","keys","noteHeight","redraw","innerHTML","backgroundColor","reverse","cursorUpdateInterval","sideKeyboard","SideKeyboard","Grid","scrollTop","pianoRoll","PianoRoll","attachedElement","_submenus","_handlePointerDown","addSubmenu","submenu","_track","settings","_trackPanels","seconds","backgroundSize","Project","_loadProject","playlistTrack","PlaylistTrack","decodeAudioData","arrayBuffer","Promise","resolve","reject","loadUrl","url","fetch","AudioImporter","loadFile","file","loadBlob","blob","reader","FileReader","onload","result","audioBuffer","onerror","readAsArrayBuffer","importFile","accept","fileInput","files","click","folderMenu","ContextMenu","FileImporter","loadAudioFile","fileMenu","Boolean","patternsFolder","presetsFolder","startsWith","loadImageFile","loadVideoFile","alert","readAsDataURL","TreeView","zoom","handleWheelZoom","dir","_img","handlePinchZoom","touch1","touches","touch2","distance","hypot","File","URL","createObjectURL","imagePreview","ImagePreview","hideZero","padZeros","_hideZero","_value","_step","_padZeros","startY","startValue","onMouseMove","oldValue","newValue","onMouseUp","_inputHours","DraggableNumber","hoursLabel","_inputMinutes","minutesLabel","_inputSeconds","millisecondsLabel","_inputMillis","secondsLabel","hours","minutes","milliseconds","pixelsToSeconds","secondsToPixels","buttonsContainer","toolButtons","cropButton","deleteButton","_deleteSelection","cropMenu","_crop","_cropAsNew","playStop","playButton","_play","_stop","unused","canvasContainer","timeContainer","startTimeLabel","TimePositionInput","_updateSelection","_previewSource","loopStart","endTimeLabel","_endTime","loopEnd","_selection","_dragStart","_audioBuffer","delta","onup","_draw","_getSelectedBuffer","startFrame","endFrame","newBuffer","newChannel","newFrame","startTime","endTime","loop","newLength","waveEditor","WaveEditor","Playlist","sourceContainer","treeView","ProjectTreeView","WaveEditorWindow","ImagePreviewWindow","patternWindow","addMenu","generateMenu","WindowContainer","PianoRollWindow","PatternWindow","playlistWindow","ProjectWindow","MixerWindow","keyboard","Keyboard","mixerChannel","transpose","Plugin","_settings","_note","_frequency","_gain","lfoNumber","envelopeNumber","detune","oscillators","loadSettings","controlType","_range","blur","PluginControl","attack","hold","decay","sustain","_triggerTime","Slider","default","param","when","cancelScheduledValues","setValueAtTime","exponentialRampToValueAtTime","linearRampToValueAtTime","estimateValueAtTime","relativeWhen","timeSinceAttack","exp","timeSinceRelease","triggerRelease","mixerChannelSelector","_settingsBar","_handle","_onPointerDown","_setValue","startPosition","offset","releasePointerCapture","pointerId","fmbass","fmGainKnob","Knob","modulatorGain","fmRatioKnob","fmRatio","InstrumentWindow","SynthesizerVoice","version","author","controllerGroups","FMBassWindow","highpassFilter","createBiquadFilter","frequency","_filter","Q","filterEnvelope","Envelope","gainEnvelope","_heldNote","_carrier","context","_modulator","freq","noteToFrequency","createOscillator","Instrument","voiceType","maxPoly","voices","_nextVoice","_held","voice","findIndex","modulatorGain1","_gain1","_carrier1","_modulator1","FMPianoVoice","Synthesizer","_enableEnvelope","_cutBySelf","cutGroup","cutByGroups","_gainEnvelope","envelope","_slotsContainer","defaultSlots","keyBinding","slot","Sampler","samplers","MultisamplerWindow","sampler","Multisampler","FMBass","FMPiano","AudioClock","projectUI","ProjectUI"],"sourceRoot":""}