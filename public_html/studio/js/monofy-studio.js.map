{"version":3,"file":"monofy-studio.js","mappings":"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","sources":["webpack://monofy/webpack/bootstrap","webpack://monofy/webpack/runtime/make namespace object","webpack://monofy/../elements/src/EventObject.ts","webpack://monofy/../elements/src/managers/AudioManager.ts","webpack://monofy/./src/elements/components/AudioClock.ts","webpack://monofy/../elements/src/elements/BaseElement.ts","webpack://monofy/../elements/src/elements/SizableElement.ts","webpack://monofy/../elements/src/elements/DraggableWindow.ts","webpack://monofy/./src/plugins/plugins.ts","webpack://monofy/./src/abstracts/Instrument.ts","webpack://monofy/./src/abstracts/Synthesizer.ts","webpack://monofy/./src/abstracts/SynthesizerVoice.ts","webpack://monofy/./src/plugins/fmbass/FMBass.ts","webpack://monofy/./src/abstracts/InstrumentWindow.ts","webpack://monofy/../elements/src/animation.ts","webpack://monofy/../elements/src/elements/AudioCanvas.ts","webpack://monofy/./src/elements/components/SamplerSlot.ts","webpack://monofy/./src/plugins/sampler/Sampler.ts","webpack://monofy/./src/elements/Project.ts","webpack://monofy/../elements/src/elements/WindowContainer.ts","webpack://monofy/./src/constants.ts","webpack://monofy/./src/elements/components/Keyboard.ts","webpack://monofy/./src/elements/components/AudioCursor.ts","webpack://monofy/./src/elements/components/PatternTrack.ts","webpack://monofy/./src/elements/windows/PatternWindow.ts","webpack://monofy/../elements/src/elements/ScrollPanel.ts","webpack://monofy/./src/elements/components/LyricCanvas.ts","webpack://monofy/../elements/src/DialogPopup.ts","webpack://monofy/./src/elements/audioDialogs.ts","webpack://monofy/./src/elements/components/Grid.ts","webpack://monofy/./src/elements/components/SideKeyboard.ts","webpack://monofy/./src/elements/components/PianoRoll.ts","webpack://monofy/./src/elements/windows/PianoRollWindow.ts","webpack://monofy/./src/elements/components/PlaylistTrack.ts","webpack://monofy/./src/elements/windows/PlaylistWindow.ts","webpack://monofy/./src/elements/ProjectUI.ts","webpack://monofy/./src/index.ts","webpack://monofy/./src/schema.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export interface EventDataMap {\r\n  cancel: unknown;\r\n  start: unknown;\r\n  stop: unknown;\r\n  pause: unknown;\r\n  result: unknown;\r\n  update: unknown;\r\n  open: unknown;\r\n  close: unknown;\r\n  edit: unknown;\r\n  resize: unknown;\r\n  select: unknown;\r\n  scroll: unknown;\r\n}\r\n\r\nexport type BaseEvent = keyof EventDataMap;\r\n\r\nexport default abstract class EventObject<E extends BaseEvent = BaseEvent> {\r\n  private _events: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n  private _onceEvents: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n\r\n  on(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._events[eventName]) {\r\n      this._events[eventName] = [];\r\n    }\r\n    this._events[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  once(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._onceEvents[eventName]) {\r\n      this._onceEvents[eventName] = [];\r\n    }\r\n    this._onceEvents[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  emit(eventName: E, eventData?: EventDataMap[E]) {\r\n    const onceCallbacks = this._onceEvents[eventName];\r\n    if (onceCallbacks) {\r\n      for (const callback of onceCallbacks) {\r\n        try {\r\n          callback(eventData);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .once callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n      this._onceEvents[eventName] = undefined;\r\n    }\r\n\r\n    const callbacks = this._events[eventName];\r\n    if (callbacks) {\r\n      for (const callback of callbacks) {\r\n        try {\r\n          callback(eventData);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .on callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","let audioContext: AudioContext | null = null;\r\n\r\nconst AudioContext = window.AudioContext || (window as any).webkitAudioContext;\r\n\r\nexport function getAudioContext() {\r\n  if (!audioContext) {\r\n    audioContext = new AudioContext({\r\n      latencyHint: \"interactive\",\r\n      sampleRate: 44100,\r\n    });\r\n    getAudioDevices().then((devices) => {\r\n      console.log(\"Audio devices\", devices);\r\n    });\r\n    console.log(\"Audio context created\");\r\n    return audioContext;\r\n  }\r\n  return audioContext;\r\n}\r\n\r\nexport async function getAudioDevices() {\r\n  if (\"setSinkId\" in AudioContext.prototype) {\r\n    const devices = await navigator.mediaDevices.enumerateDevices();\r\n    return devices;\r\n  }\r\n  return null;\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\n\r\n/**\r\n * Represents an audio clock that provides functionality for controlling audio playback and scheduling events.\r\n */\r\nexport class AudioClock extends EventObject<\r\n  \"start\" | \"stop\" | \"pause\" | \"update\"\r\n> {\r\n  domElement: HTMLDivElement;\r\n  bpmInput: HTMLInputElement;\r\n  playPauseButton: HTMLButtonElement;\r\n  stopButton: HTMLButtonElement;\r\n  currentTimeDisplay: HTMLSpanElement;\r\n  private _bpm: number = 100;\r\n  private _scheduledEvents: {\r\n    source: AudioBufferSourceNode;\r\n    time: number;\r\n    callback: () => void;\r\n  }[] = [];\r\n  private _startTime: number | null = null;\r\n\r\n  get startTime(): number | null {\r\n    return this._startTime;\r\n  }\r\n\r\n  get currentBeat(): number {\r\n    const elapsedTime =\r\n      this._startTime !== null\r\n        ? getAudioContext().currentTime - this._startTime\r\n        : 0;\r\n    return elapsedTime * (this._bpm / 60);\r\n  }\r\n\r\n  get isPlaying(): boolean {\r\n    return this._startTime != null && this._startTime >= 0;\r\n  }\r\n\r\n  get bpm(): number {\r\n    return this._bpm;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-clock\");\r\n\r\n    this.playPauseButton = document.createElement(\"button\");\r\n    this.playPauseButton.classList.add(\"audio-clock-play-pause\");\r\n    this.playPauseButton.textContent = \"Play\";\r\n\r\n    this.playPauseButton.addEventListener(\"click\", () => {\r\n      if (this.isPlaying) {\r\n        this.stop();\r\n      } else {\r\n        getAudioContext();\r\n        this.playPause();\r\n      }\r\n    });\r\n    this.domElement.appendChild(this.playPauseButton);\r\n    this.stopButton = document.createElement(\"button\");\r\n    this.stopButton.classList.add(\"audio-clock-stop\");\r\n    this.stopButton.textContent = \"Stop\";\r\n\r\n    this.stopButton.addEventListener(\"click\", () => {\r\n      this.stop();\r\n    });\r\n    this.domElement.appendChild(this.stopButton);\r\n\r\n    this.bpmInput = document.createElement(\"input\");\r\n    this.bpmInput.classList.add(\"audio-clock-bpm\");\r\n    this.bpmInput.type = \"number\";\r\n    this.bpmInput.value = \"120\";\r\n\r\n    this.bpmInput.addEventListener(\"input\", () => {\r\n      this._bpm = parseFloat(this.bpmInput.value);\r\n    });\r\n    this.domElement.appendChild(this.bpmInput);\r\n\r\n    this.currentTimeDisplay = document.createElement(\"span\");\r\n    this.currentTimeDisplay.classList.add(\"audio-clock-time\");\r\n    this.currentTimeDisplay.textContent = \"01:1\";\r\n\r\n    this.domElement.appendChild(this.currentTimeDisplay);\r\n  }\r\n\r\n  start(): void {\r\n    this._startTime = getAudioContext().currentTime;\r\n    console.log(\"Started at\", this._startTime);\r\n    requestAnimationFrame(this._render.bind(this));\r\n    this.emit(\"start\");\r\n  }\r\n\r\n  private _render(): void {\r\n    this._update(this.currentBeat);\r\n    this.emit(\"update\");\r\n    if (this.isPlaying) requestAnimationFrame(this._render.bind(this));\r\n  }\r\n\r\n  stop(): void {\r\n    this.emit(\"stop\");\r\n    this._startTime = null;\r\n\r\n    for (const { source } of this._scheduledEvents) {\r\n      source.stop();\r\n      source.disconnect();\r\n    }\r\n    this._scheduledEvents = [];\r\n\r\n    this._update(this.currentBeat);\r\n    this.playPauseButton.textContent = \"Play\";\r\n  }\r\n\r\n  restart() {\r\n    if (this.isPlaying) {\r\n      this._startTime = getAudioContext().currentTime;\r\n    }\r\n  }\r\n\r\n  playPause(): void {\r\n    if (this.isPlaying) {\r\n      this.stop(); // TODO: This should be a pause\r\n    } else {\r\n      const audioContext = getAudioContext();\r\n\r\n      const buffer = audioContext.createBuffer(1, 1, audioContext.sampleRate);\r\n      const source = audioContext.createBufferSource();\r\n      source.buffer = buffer;\r\n      source.connect(audioContext.destination);\r\n      source.start();\r\n\r\n      this.start();\r\n    }\r\n    this.playPauseButton.textContent = this.isPlaying ? \"Pause\" : \"Play\";\r\n  }\r\n\r\n  private _update(beat: number): void {\r\n    const bars = Math.floor(beat / 4) + 1;\r\n    const beats = Math.floor(beat % 4) + 1;\r\n    const timeString = `${bars\r\n      .toString()\r\n      .padStart(2, \"0\")}:${beats.toString()}`;\r\n    this.currentTimeDisplay.textContent = timeString;\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtTime(callback: () => void, time: number): void {\r\n    const audioContext = getAudioContext();\r\n    const emptyBuffer = audioContext.createBuffer(\r\n      1,\r\n      1,\r\n      audioContext.sampleRate\r\n    );\r\n    const source = audioContext.createBufferSource();\r\n    source.buffer = emptyBuffer;\r\n    source.connect(audioContext.destination);\r\n    source.onended = () => callback();\r\n    source.start(time);\r\n    this._scheduledEvents.push({ source, time, callback });\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtBeat(callback: () => void, beat: number): void {\r\n    const time = this._startTime! + (beat / this._bpm) * 60;\r\n    this.scheduleEventAtTime(callback, time);\r\n  }\r\n}\r\n","import EventObject, { EventDataMap } from \"../EventObject\";\r\n\r\nexport abstract class BaseElement<\r\n  T extends keyof EventDataMap,\r\n> extends EventObject<T> {\r\n  readonly domElement: HTMLElement;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super();\r\n    this.domElement = document.createElement(tagName);\r\n    if (className) {\r\n      this.domElement.classList.add(className);\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class SizableElement<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"resize\" | T> {\r\n  private _resizing = false;\r\n  private _startX = 0;\r\n  private _startY = 0;\r\n  private _startWidth = 0;\r\n  private _startHeight = 0;\r\n  private _startTop = 0;\r\n  private _startLeft = 0;\r\n\r\n  private _resizeDirection: \"top\" | \"right\" | \"bottom\" | \"left\" | null = null;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super(tagName, className);\r\n\r\n    this.domElement.addEventListener(\"pointermove\", (e) => {\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle === \"top\" || handle === \"bottom\") {\r\n        this.domElement.style.cursor = \"ns-resize\";\r\n      } else if (handle === \"left\" || handle === \"right\") {\r\n        this.domElement.style.cursor = \"ew-resize\";\r\n      } else {\r\n        this.domElement.style.cursor = \"auto\";\r\n      }\r\n    });\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      if (this._resizing) {\r\n        console.log(this._resizeDirection);\r\n\r\n        const dx = e.clientX - this._startX;\r\n        const dy = e.clientY - this._startY;\r\n\r\n        if (this._resizeDirection === \"right\") {\r\n          this.domElement.style.width = `${this._startWidth + dx}px`;\r\n        } else if (this._resizeDirection === \"bottom\") {\r\n          this.domElement.style.height = `${this._startHeight + dy}px`;\r\n        } else if (this._resizeDirection === \"left\") {\r\n          this.domElement.style.width = `${this._startWidth - dx}px`;\r\n          this.domElement.style.left = `${this._startLeft + dx}px`;\r\n        } else if (this._resizeDirection === \"top\") {\r\n          this.domElement.style.height = `${this._startHeight - dy}px`;\r\n          this.domElement.style.top = `${this._startTop + dy}px`;\r\n        }\r\n\r\n        this.emit(\"resize\", {\r\n          width: this.domElement.offsetWidth,\r\n          height: this.domElement.offsetHeight,\r\n        });\r\n      }\r\n    };\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle) {\r\n        window.addEventListener(\"pointermove\", onmove);\r\n        this.startResize(e, handle);\r\n      }\r\n      const onrelease = () => {\r\n        this.stopResize();\r\n        window.removeEventListener(\"pointermove\", onmove);\r\n        window.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      window.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n  }\r\n\r\n  protected startResize(\r\n    e: PointerEvent,\r\n    direction: \"top\" | \"right\" | \"bottom\" | \"left\"\r\n  ) {\r\n    console.log(\"startResize\", direction);\r\n    this._resizing = true;\r\n    this._startX = e.clientX;\r\n    this._startY = e.clientY;\r\n    this._startWidth = this.domElement.offsetWidth;\r\n    this._startHeight = this.domElement.offsetHeight;\r\n    this._startTop = this.domElement.offsetTop;\r\n    this._startLeft = this.domElement.offsetLeft;\r\n    this._resizeDirection = direction;\r\n  }\r\n\r\n  protected stopResize() {\r\n    this._resizing = false;\r\n    this._resizeDirection = null;\r\n  }\r\n\r\n  getCurrentHandle(e: PointerEvent) {\r\n    const rect = this.domElement.getBoundingClientRect();\r\n    const offsetX = e.clientX - rect.left;\r\n    const offsetY = e.clientY - rect.top;\r\n\r\n    if (offsetX > 0 && offsetX < 10) {\r\n      return \"left\";\r\n    } else if (rect.width - offsetX < 10) {\r\n      return \"right\";\r\n    } else if (offsetY > 0 && offsetY < 10) {\r\n      return \"top\";\r\n    } else if (rect.height - offsetY < 10) {\r\n      return \"bottom\";\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { SizableElement } from \"./SizableElement\";\r\n\r\nexport class DraggableWindow<\r\n  T extends keyof EventDataMap,\r\n> extends SizableElement<\"update\" | \"resize\" | \"open\" | \"close\" | T> {\r\n  readonly titlebar: HTMLElement;\r\n  readonly content: HTMLElement;\r\n  private readonly _title: HTMLElement;\r\n  private readonly _closeButton: HTMLButtonElement;\r\n  private _isDragging = false;\r\n  private _dragOffsetX = 0;\r\n  private _dragOffsetY = 0;\r\n  private _top = 0;\r\n  private _left = 0;\r\n\r\n  get isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    title: string,\r\n    private readonly persistent = false,\r\n    private innerContent: HTMLElement\r\n  ) {\r\n    super(\"div\", \"draggable-window\");\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.domElement.parentElement!.appendChild(this.domElement);\r\n    });\r\n\r\n    this.titlebar = document.createElement(\"div\");\r\n    this.titlebar.className = \"window-titlebar\";\r\n    this.domElement.appendChild(this.titlebar);\r\n\r\n    this.titlebar.addEventListener(\"pointerdown\", (e) => {\r\n      this._isDragging = true;\r\n      this._dragOffsetX =\r\n        e.clientX - this.domElement.getBoundingClientRect().left;\r\n      this._dragOffsetY =\r\n        e.clientY -\r\n        this.domElement.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.scrollTop;\r\n\r\n      const ondrag = (e: PointerEvent) => {\r\n        if (this._isDragging) {\r\n          console.log(\"Dragging\");\r\n\r\n          let newTop = e.clientY - this._dragOffsetY;\r\n          let newLeft = e.clientX - this._dragOffsetX;\r\n\r\n          if (newTop < 0) {\r\n            newTop = 0;\r\n          }\r\n\r\n          if (newLeft < 0) {\r\n            newLeft = 0;\r\n          }\r\n\r\n          this.domElement.style.top = `${newTop}px`;\r\n          this.domElement.style.left = `${newLeft}px`;\r\n\r\n          this._top = newTop;\r\n          this._left = newLeft;\r\n        }\r\n      };\r\n\r\n      const onrelease = () => {\r\n        this._isDragging = false;\r\n        document.body.removeEventListener(\"pointermove\", ondrag);\r\n        document.body.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      document.body.addEventListener(\"pointermove\", ondrag);\r\n      document.body.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n\r\n    this._title = document.createElement(\"div\");\r\n    this._title.className = \"window-titlebar-title\";\r\n    this._title.textContent = title;\r\n    this.titlebar.appendChild(this._title);\r\n\r\n    this.content = document.createElement(\"div\");\r\n    this.content.className = \"window-content\";\r\n    this.domElement.appendChild(this.content);\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.className = \"window-close-button\";    \r\n    this._closeButton.addEventListener(\"pointerdown\", (e) => {\r\n      if (e.button === 0) this.close();\r\n    });\r\n\r\n    this.titlebar.appendChild(this._closeButton);\r\n\r\n    this.content.appendChild(this.innerContent);\r\n  }\r\n\r\n  show(x?: number, y?: number) {\r\n    this.domElement.style.display = \"flex\";\r\n    if (y) this.domElement.style.top = `${y}px`;\r\n    if (x) this.domElement.style.left = `${x}px`;\r\n    setTimeout(() => {\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n      this.emit(\"open\");\r\n    }, 1);    \r\n  }\r\n\r\n  close() {\r\n    this.domElement.style.display = \"none\";\r\n    this.emit(\"close\");\r\n    if (!this.persistent) {\r\n      this.domElement.remove();\r\n    }\r\n  }\r\n\r\n  setSize(width: number, height: number) {\r\n    this.domElement.style.width = `${width}px`;\r\n    this.domElement.style.height = `${height}px`;\r\n  }\r\n\r\n  setPosition(x: number, y: number) {\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this._title.textContent = title;\r\n  }\r\n}\r\n","import { EventDataMap } from \"../../../elements/src/EventObject\";\r\nimport { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport { DraggableWindow } from \"../../../elements/src/elements/DraggableWindow\";\r\nimport { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { ControllerGroup, IHasControls } from \"../schema\";\r\n\r\nexport abstract class Plugin\r\n  extends BaseElement<\"update\">\r\n  implements IHasControls\r\n{\r\n  abstract name: string;\r\n  abstract version: string;\r\n  abstract description: string;\r\n  abstract author: string;\r\n  abstract controllerGroups: ControllerGroup[];\r\n  abstract window: DraggableWindow<\"update\" | keyof EventDataMap>;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(\"div\", \"plugin-contianer\");\r\n  }\r\n}\r\n\r\nexport abstract class Plugins {\r\n  static readonly plugins: (typeof Plugin)[] = [];\r\n\r\n  static register(plugin: typeof Plugin) {\r\n    if (Plugins.plugins.includes(plugin)) {\r\n      console.warn(\"Plugin already registered:\", plugin);\r\n      return;\r\n    }\r\n    Plugins.plugins.push(plugin);\r\n  }\r\n\r\n  static get(name: string) {\r\n    return this.plugins.find((plugin) => plugin.name === name);\r\n  }\r\n}\r\n","import { IInstrument } from \"../elements/IInstrument\";\r\nimport { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { ISourceEvent } from \"../elements/components/SamplerSlot\";\r\nimport { Plugin } from \"../plugins/plugins\";\r\n\r\nexport abstract class Instrument extends Plugin implements IInstrument {\r\n\r\n  abstract id: string;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(audioClock);\r\n  }\r\n\r\n  abstract trigger(\r\n    note: number,\r\n    when: number,\r\n    velocity: number | undefined\r\n  ): ISourceEvent | undefined;\r\n  abstract release(note: number): void;\r\n}\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\nimport { SynthesizerVoice } from \"./SynthesizerVoice\";\r\nimport { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { IKeyboardEvent } from \"../elements/components/Keyboard\";\r\nimport { ISynthesizerSettings } from \"../schema\";\r\nimport { Instrument } from \"./Instrument\";\r\nimport { InstrumentWindow } from \"./InstrumentWindow\";\r\n\r\ninterface ISynthesizerEvent extends IKeyboardEvent {\r\n  voice: SynthesizerVoice;\r\n}\r\n\r\nexport abstract class Synthesizer<T extends SynthesizerVoice>\r\n  extends Instrument\r\n  implements ISynthesizerSettings\r\n{\r\n  abstract readonly window: InstrumentWindow;\r\n  readonly voices: SynthesizerVoice[] = [];\r\n  private _nextVoice = 0;\r\n  private _gain: GainNode;\r\n  private _ctx: AudioContext;\r\n  private _held: ISynthesizerEvent[] = [];\r\n\r\n  get gain() {\r\n    return this._gain;\r\n  }\r\n\r\n  constructor(audioClock: AudioClock) {\r\n    super(audioClock);\r\n    this._ctx = getAudioContext();\r\n    this._gain = this._ctx.createGain();\r\n  }\r\n\r\n  addVoice(voice: T) {\r\n    this.voices.push(voice);\r\n  }\r\n\r\n  handleEvent(event: IKeyboardEvent) {\r\n    if (event.type == \"press\") {\r\n      console.log(this.name + \" triggered voice \" + this._nextVoice);\r\n\r\n      this._held.push({ ...event, voice: this.voices[this._nextVoice] });\r\n\r\n      this._nextVoice++;\r\n      if (this._nextVoice >= this.voices.length) {\r\n        this._nextVoice = 0;\r\n      }\r\n    } else if (event.type == \"release\") {\r\n      console.log(this.name + \" released voice \" + event);\r\n    } else {\r\n      console.error(this.name + \": Invalid event passed to trigger()\", event);\r\n    }\r\n  }\r\n}\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\nimport { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { ISynthesizerVoiceSettings } from \"../schema\";\r\n\r\nexport abstract class SynthesizerVoice implements ISynthesizerVoiceSettings {\r\n  _settings: ISynthesizerVoiceSettings | null = null;\r\n\r\n  get settings(): ISynthesizerVoiceSettings {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n    return this.settings;\r\n  }\r\n\r\n  private readonly _gain: GainNode;\r\n  private _note: number | null = null;\r\n  private _frequency: number | null = null;  \r\n\r\n  get gain() {\r\n    return this._gain.gain.value;\r\n  }\r\n\r\n  get note() {\r\n    return this._note;\r\n  }\r\n\r\n  get lfoNumber() {\r\n    return this.settings.lfoNumber;\r\n  }\r\n\r\n  get envelopeNumber() {\r\n    return this.settings.envelopeNumber;\r\n  }\r\n\r\n  get frequency() {\r\n    return this._frequency;\r\n  }\r\n\r\n  get detune() {\r\n    return this.settings.detune;\r\n  }\r\n\r\n  get oscillators() {\r\n    return this.settings.oscillators;\r\n  }\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    const audioContext = getAudioContext();\r\n    this._gain = audioContext.createGain();\r\n  }\r\n\r\n  loadSettings(settings: ISynthesizerVoiceSettings) {\r\n    this._settings = settings;\r\n    this._gain.gain.value = settings.gain;\r\n  }\r\n\r\n  trigger(note: number, velocity: number, time = 0) {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n\r\n    this._note = note;\r\n    this._frequency = 440 * Math.pow(2, (note - 69) / 12);\r\n    this._gain.gain.value = this.settings.gain * velocity;\r\n\r\n    // TODO\r\n  }\r\n\r\n  release(time = 0) {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n\r\n    this._note = null;\r\n    this._frequency = null;\r\n\r\n    // TODO\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport { Synthesizer } from \"../../abstracts/Synthesizer\";\r\nimport { SynthesizerVoice } from \"../../abstracts/SynthesizerVoice\";\r\nimport { AudioClock } from \"../../elements/components/AudioClock\";\r\nimport { ISourceEvent } from \"../../elements/components/SamplerSlot\";\r\nimport { ControllerGroup } from \"../../schema\";\r\nimport { Plugins } from \"../plugins\";\r\n\r\nexport class FMBassVoice extends SynthesizerVoice {\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(audioClock);\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity: number | undefined) {\r\n    console.log(\"FMBassVoice triggered\", note, when, velocity);\r\n  }\r\n\r\n  release(note: number) {\r\n    console.log(\"FMBassVoice released\", note);\r\n  }\r\n}\r\n\r\nexport class FMBass extends Synthesizer<FMBassVoice> {\r\n  readonly name = \"FM Bass\";\r\n  readonly id = \"fm_bass\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple FM bass synthesizer\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly controllerGroups: ControllerGroup[] = [];\r\n  readonly window: InstrumentWindow;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(audioClock);\r\n\r\n    this.window = new DraggableWindow(\"FM Bass\", true, this.domElement);\r\n  }\r\n\r\n  trigger(\r\n    note: number,\r\n    when: number,\r\n    velocity: number | undefined\r\n  ): ISourceEvent | undefined {\r\n    console.log(\"FM Bass triggered\", note, when, velocity);\r\n    return undefined;\r\n  }\r\n\r\n  release(note: number) {\r\n    console.log(\"FM Bass released\", note);\r\n  }\r\n}\r\n\r\nPlugins.register(FMBass);\r\n","import { DraggableWindow } from \"../../../elements/src/elements/DraggableWindow\";\r\n\r\nexport class InstrumentWindow extends DraggableWindow<\"update\"> {}","export async function triggerActive(elt: HTMLElement, timeout = 100) {  \r\n  elt.classList.toggle(\"active\", true);\r\n  setTimeout(() => {\r\n    elt.classList.toggle(\"active\", false);\r\n  }, timeout);\r\n}\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\n\r\nexport class AudioCanvas {\r\n  domElement: HTMLDivElement;\r\n  canvas: HTMLCanvasElement;\r\n  ctx: CanvasRenderingContext2D;\r\n  buffer: AudioBuffer | null = null;\r\n\r\n  constructor(width = 800, height = 200, playOnClick = true) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-canvas\");\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n    this.domElement.appendChild(this.canvas);\r\n\r\n    if (playOnClick) {\r\n      this.canvas.addEventListener(\"click\", () => {\r\n        if (this.buffer) {\r\n          this.playBuffer(this.buffer);\r\n        }\r\n      });\r\n    }\r\n\r\n    this.ctx = this.canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; note: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.note,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n\r\n  playBuffer(audioBuffer: AudioBuffer) {\r\n    const ctx = getAudioContext();\r\n    const source = ctx.createBufferSource();\r\n    source.buffer = audioBuffer;\r\n    source.connect(ctx.destination);\r\n    source.start();\r\n  }\r\n\r\n  loadBuffer(audioBuffer: AudioBuffer) {\r\n    this.buffer = audioBuffer;\r\n\r\n    const channelData = audioBuffer.getChannelData(0);\r\n    const bufferLength = channelData.length;\r\n    const sliceWidth = this.canvas.width / bufferLength;\r\n\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.canvas.height / 2);\r\n\r\n    for (let i = 0; i < bufferLength; i++) {\r\n      const x = i * sliceWidth;\r\n      const y = ((channelData[i] + 1) * this.canvas.height) / 2;\r\n\r\n      this.ctx.lineTo(x, y);\r\n    }\r\n\r\n    this.ctx.lineTo(this.canvas.width, this.canvas.height / 2);\r\n    this.ctx.stroke();\r\n  }\r\n}\r\n","import { triggerActive } from \"../../../../elements/src/animation\";\r\nimport { AudioCanvas } from \"../../../../elements/src/elements/AudioCanvas\";\r\nimport { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\nimport { ControllerGroup, ISamplerSlot, InstrumentType } from \"../../schema\";\r\nimport { AudioClock } from \"./AudioClock\";\r\n\r\nexport interface ISourceEvent {\r\n  source: AudioBufferSourceNode;\r\n  gain: GainNode;\r\n  cutByGroups: number[];\r\n  time: number;\r\n}\r\n\r\nexport class SamplerSlot extends BaseElement<\"update\"> implements ISamplerSlot {\r\n  private _nameElement;\r\n\r\n  type: InstrumentType = \"sampler\";\r\n  controllerGroups: ControllerGroup[] = [];\r\n  buffer: AudioBuffer | null = null;\r\n  velocity: number;\r\n  pan: number;\r\n  pitch: number;\r\n  randomPitch: number;\r\n  randomVelocity: number;\r\n  startPosition: number;\r\n  endPosition: number;\r\n  loop: boolean;\r\n  loopStart: number;\r\n  loopEnd: number;\r\n  protected _sources: ISourceEvent[] = [];\r\n  private _previewCanvas: AudioCanvas;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    public name = \"\",\r\n    public keyBinding: number | null = null,\r\n    public cutGroup = -1,\r\n    readonly cutByGroups: number[] = []\r\n  ) {\r\n    super(\"div\", \"sampler-slot\");\r\n\r\n    this.name = name;\r\n    this.buffer = null;\r\n    this.keyBinding = keyBinding || null;\r\n    this.velocity = 1;\r\n    this.pan = 1;\r\n    this.pitch = 1;\r\n    this.randomPitch = 0;\r\n    this.randomVelocity = 0.05;\r\n    this.startPosition = 0;\r\n    this.endPosition = 0;\r\n    this.loop = false;\r\n    this.loopStart = 0;\r\n    this.loopEnd = 0;\r\n    this.cutGroup = cutGroup;\r\n    this.cutByGroups = cutByGroups;\r\n\r\n    this._previewCanvas = new AudioCanvas(200, 60);\r\n    this.domElement.appendChild(this._previewCanvas.domElement);\r\n\r\n    this._nameElement = document.createElement(\"div\");\r\n    this._nameElement.classList.add(\"sampler-slot-name\");\r\n    this.domElement.appendChild(this._nameElement);\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => this.trigger());\r\n  }\r\n\r\n  async loadSample(name: string, url: string) {\r\n    const audioContext = getAudioContext();\r\n\r\n    this._nameElement.textContent = \"(Loading)\";\r\n\r\n    const response = await fetch(url);\r\n    if (!response.ok) {\r\n      this._nameElement.textContent = \"(Empty)\";\r\n      console.error(`Error loading sample: ${url}`, response.statusText);\r\n      return;\r\n    }\r\n\r\n    response\r\n      .arrayBuffer()\r\n      .then((buffer) => audioContext.decodeAudioData(buffer))\r\n      .then((audioBuffer) => {\r\n        this._nameElement.textContent = name;\r\n        this.buffer = audioBuffer;\r\n        this.emit(\"update\");\r\n        setTimeout(() => {\r\n          this._previewCanvas.loadBuffer(audioBuffer);\r\n        }, 1);\r\n      })\r\n      .catch((error) => {\r\n        this._nameElement.textContent = \"(Empty)\";\r\n        console.error(`Error loading sample: ${url}`, error);\r\n      });\r\n  }\r\n\r\n  trigger(beat = 0) {\r\n    if (!this.buffer) {\r\n      console.error(\"No buffer loaded for sample\", this.name);\r\n      return;\r\n    }\r\n\r\n    const audioContext = getAudioContext();\r\n    const source = audioContext.createBufferSource();\r\n    source.buffer = this.buffer;\r\n    source.playbackRate.value = this.pitch + Math.random() * this.randomPitch;\r\n    source.connect(audioContext.destination);\r\n\r\n    const gain = audioContext.createGain();\r\n    gain.gain.value = this.velocity + Math.random() * this.randomVelocity;\r\n    gain.connect(audioContext.destination);\r\n\r\n    source.connect(gain);\r\n\r\n    if (this.pan !== 1) {\r\n      const pan = audioContext.createStereoPanner();\r\n      pan.pan.value = this.pan;\r\n      source.connect(pan);\r\n      pan.connect(gain);\r\n    }\r\n\r\n    const time =\r\n      (this.audioClock.startTime || audioContext.currentTime) +\r\n      (beat * 60) / this.audioClock.bpm;\r\n\r\n    const entry: ISourceEvent = {\r\n      source,\r\n      gain,\r\n      cutByGroups: this.cutByGroups,\r\n      time,\r\n    };\r\n\r\n    this._sources.push(entry);\r\n\r\n    source.onended = () => {\r\n      source.disconnect();\r\n      gain.disconnect();\r\n      const index = this._sources.indexOf(entry);\r\n      if (index >= 0) this._sources.splice(index, 1);\r\n    };\r\n\r\n    console.log(beat, audioContext.currentTime, time);\r\n\r\n    if (this.startPosition >= 0) {\r\n      source.start(\r\n        time,\r\n        this.startPosition,\r\n        (this.endPosition || this.buffer.duration) - this.startPosition\r\n      );\r\n    } else {\r\n      source.start(time);\r\n    }\r\n\r\n    if (time === 0 || !this.audioClock.isPlaying) {\r\n      triggerActive(this.domElement);\r\n    } else {\r\n      this.audioClock.scheduleEventAtTime(\r\n        () => triggerActive(this.domElement),\r\n        time\r\n      );\r\n    }\r\n\r\n    if (this.loop) {\r\n      source.loop = true;\r\n      source.loopStart = this.loopStart;\r\n      source.loopEnd = this.loopEnd || this.buffer.duration;\r\n    }\r\n\r\n    return entry;\r\n  }\r\n\r\n  release(time: number) {\r\n    for (const entry of this._sources) {\r\n      if (time >= entry.time) this.cut(entry, time);\r\n    }\r\n  }\r\n\r\n  cut(entry: ISourceEvent, time = 0) {\r\n    const currentValue = entry.gain.gain.value;\r\n    entry.gain.gain.cancelScheduledValues(time);\r\n    entry.gain.gain.setValueAtTime(currentValue, time);\r\n    entry.gain.gain.exponentialRampToValueAtTime(0.0001, time + 0.1);\r\n    entry.source.stop(time + 0.1);\r\n  }\r\n}\r\n","import { Instrument } from \"../../abstracts/Instrument\";\r\nimport { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport { AudioClock } from \"../../elements/components/AudioClock\";\r\nimport { SamplerSlot } from \"../../elements/components/SamplerSlot\";\r\nimport { ControllerGroup } from \"../../schema\";\r\nimport { Plugins } from \"../plugins\";\r\n\r\nexport class Sampler extends Instrument {\r\n  readonly name = \"Sampler\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple sampler\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly id = \"sampler\";\r\n  readonly window: InstrumentWindow;\r\n\r\n  private readonly _slotsContainer: HTMLDivElement;\r\n\r\n  slots: SamplerSlot[] = [];\r\n  controllerGroups: ControllerGroup[] = [];\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(audioClock);\r\n    window.addEventListener(\"keydown\", (event) => this.onKeyDown(event));\r\n\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"sampler-slots-container\");\r\n    this._slotsContainer = container;\r\n\r\n    //keypad numbers 0-9\r\n    // then . / * + - Enter\r\n    const defaultSlots = [\r\n      { keyBinding: 96, name: \"0\" },\r\n      { keyBinding: 97, name: \"1\" },\r\n      { keyBinding: 98, name: \"2\" },\r\n      { keyBinding: 99, name: \"3\" },\r\n      { keyBinding: 100, name: \"4\" },\r\n      { keyBinding: 101, name: \"5\" },\r\n      { keyBinding: 102, name: \"6\", cutByGroups: [3, 6] },\r\n      { keyBinding: 103, name: \"7\" },\r\n      { keyBinding: 104, name: \"8\" },\r\n      { keyBinding: 105, name: \"9\" },\r\n      { keyBinding: 111, name: \"/\", cutByGroups: [0, 10] },\r\n      { keyBinding: 106, name: \"*\" },\r\n      { keyBinding: 109, name: \"-\" },\r\n      { keyBinding: 107, name: \"+\" },\r\n      { keyBinding: 13, name: \"Enter\" },\r\n    ];\r\n\r\n    for (let i = 0; i < 14; i++) {\r\n      const slot = new SamplerSlot(\r\n        this.audioClock,\r\n        defaultSlots[i].name,\r\n        defaultSlots[i].keyBinding,\r\n        i,\r\n        defaultSlots[i].cutByGroups\r\n      );\r\n      this.slots.push(slot);\r\n      container.appendChild(slot.domElement);\r\n      slot.loadSample(\"Sample\", `./data/samples/kit1/${i}.wav`);\r\n    }\r\n\r\n    audioClock.on(\"stop\", () => {\r\n      for (const slot of this.slots) {\r\n        slot.release(0);\r\n      }\r\n    });\r\n\r\n    this.domElement.appendChild(container);\r\n\r\n    this.window = new InstrumentWindow(\"Sampler\", true, this.domElement);\r\n  }\r\n\r\n  trigger(note: number, channel: number | null, beat = 0) {\r\n    console.log(\"Sampler trigger\", note);\r\n    const slot = this.slots[note];\r\n    if (slot) {\r\n      for (const each of this.slots) {\r\n        if (each.cutByGroups.includes(slot.cutGroup)) {\r\n          each.release(beat);\r\n        }\r\n      }\r\n      return slot.trigger(beat);\r\n    }\r\n  }\r\n\r\n  release(note: number, time = 0): void {\r\n    if (this.slots[note]) {\r\n      this.slots[note].release(time);\r\n    }\r\n  }\r\n\r\n  onKeyDown(event: KeyboardEvent) {\r\n    //console.log(event.key, event.keyCode);\r\n    const slot = this.slots.find((slot) => slot.keyBinding === event.keyCode);\r\n    if (slot) {\r\n      event.preventDefault();\r\n      const note = this.slots.indexOf(slot);\r\n      this.trigger(note, null);\r\n    }\r\n  }\r\n}\r\n\r\nPlugins.register(Sampler);\r\n","import EventObject from \"../../../elements/src/EventObject\";\r\nimport { Instrument } from \"../abstracts/Instrument\";\r\nimport { FMBass } from \"../plugins/fmbass/FMBass\";\r\nimport { Sampler } from \"../plugins/sampler/Sampler\";\r\nimport { IPattern, IProject, ISequence, ITimelineSequence } from \"../schema\";\r\nimport { IInstrument } from \"./IInstrument\";\r\nimport { AudioClock } from \"./components/AudioClock\";\r\n\r\nexport class Project extends EventObject<\"update\"> implements IProject {\r\n  title: string;\r\n  description: string;\r\n  tempo: number;\r\n  instruments: Instrument[] = [];\r\n  patterns: IPattern[] = [];\r\n  sequences: ISequence[] = [];\r\n  timeline: ITimelineSequence[] = [];\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    title = \"Untitled\",\r\n    description = \"\"\r\n  ) {\r\n    super();\r\n    this.title = title;\r\n    this.description = description;\r\n    this.tempo = 120;\r\n  }\r\n\r\n  serialize(): string {\r\n    return JSON.stringify({\r\n      title: this.title,\r\n      description: this.description,\r\n      tempo: this.tempo,\r\n      instruments: this.instruments.map((instrument) => {\r\n        return {\r\n          name: instrument.name,\r\n          controllerGroups: instrument.controllerGroups,\r\n        };\r\n      }),\r\n      patterns: this.patterns,\r\n      sequences: this.sequences,\r\n      timeline: this.timeline,\r\n    });\r\n  }\r\n\r\n  deserialize(data: string): void {\r\n    console.log(\"Project deserialize\", data);\r\n\r\n    const project = JSON.parse(data);\r\n    this.title = project.title;\r\n    this.description = project.description;\r\n    this.tempo = project.tempo;\r\n    this.patterns = project.patterns;\r\n    this.sequences = project.sequences;\r\n    this.timeline = project.timeline;\r\n    this.instruments = [];\r\n\r\n    for (const instrument of project.instruments) {\r\n      console.log(\"debug\", instrument);\r\n      const inst = instrument as IInstrument;\r\n      if (inst.id === \"sampler\") {\r\n        this.instruments.push(new Sampler(this.audioClock));\r\n      } else if (inst.id === \"fm_bass\") {\r\n        this.instruments.push(new FMBass(this.audioClock));\r\n      }\r\n\r\n    }\r\n\r\n    // TODO error checking\r\n\r\n    this.emit(\"update\", { type: \"project\", value: this });\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { DraggableWindow } from \"./DraggableWindow\";\r\n\r\nexport class WindowContainer {\r\n  readonly domElement: HTMLDivElement;\r\n\r\n  windows: DraggableWindow<keyof EventDataMap>[] = [];\r\n  _draggingWindow: DraggableWindow<keyof EventDataMap> | null = null;\r\n\r\n  constructor() {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.className = \"window-container\";\r\n    this.domElement.addEventListener(\"pointerdown\", () => {});\r\n  }\r\n\r\n  addWindow<T extends DraggableWindow<keyof EventDataMap>>(window: T) {\r\n    this.windows.push(window);\r\n    this.domElement.appendChild(window.domElement);\r\n  }\r\n}\r\n","export const DEFAULT_NOTE_HEIGHT = 20;\r\n\r\nexport const BOTTOM_ROW = [\r\n  90, 83, 88, 68, 67, 86, 71, 66, 72, 78, 74, 77, 188, 76, 190, 59, 191,\r\n];\r\n\r\nexport const TOP_ROW = [\r\n  81, 50, 87, 51, 69, 82, 53, 84, 54, 89, 55, 85, 73, 57, 79, 48, 80, 219, 61,\r\n  221,\r\n];\r\n\r\nexport const KEY_COLORS = [\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n];\r\n\r\nexport const NOTE_NAMES = [\r\n  \"A\",\r\n  \"A#\",\r\n  \"B\",\r\n  \"C\",\r\n  \"C#\",\r\n  \"D\",\r\n  \"D#\",\r\n  \"E\",\r\n  \"F\",\r\n  \"F#\",\r\n  \"G\",\r\n  \"G#\",\r\n];\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { BOTTOM_ROW, TOP_ROW } from \"../../constants\";\r\n\r\nexport interface IKeyboardEvent {\r\n  type: \"press\" | \"release\";\r\n  note: number;\r\n}\r\n\r\nfunction keyToNote(keyCode: number) {\r\n  let note = -1;\r\n\r\n  if (BOTTOM_ROW.includes(keyCode)) {\r\n    note = BOTTOM_ROW.indexOf(keyCode);\r\n  } else if (TOP_ROW.includes(keyCode)) {\r\n    note = TOP_ROW.indexOf(keyCode) + 12;\r\n  }\r\n\r\n  return note;\r\n}\r\n\r\nexport class Keyboard extends BaseElement<\"update\"> {\r\n  constructor() {\r\n    super(\"div\", \"keyboard\");\r\n\r\n    const pressedKeys: number[] = [];\r\n\r\n    window.addEventListener(\"keydown\", (event) => {\r\n      //console.log(event.key, event.keyCode);\r\n\r\n      if (event.ctrlKey || event.altKey || event.shiftKey) return;\r\n\r\n      const target = event.target as HTMLElement;\r\n      if (target.tagName == \"INPUT\") return;\r\n\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || pressedKeys.includes(note)) return;\r\n\r\n      pressedKeys.push(note);\r\n      this.emit(\"update\", { type: \"press\", note });\r\n    });\r\n\r\n    window.addEventListener(\"keyup\", (event) => {\r\n\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || !pressedKeys.includes(note)) return;      \r\n\r\n      pressedKeys.splice(pressedKeys.indexOf(note), 1);\r\n      this.emit(\"update\", { type: \"release\", note });\r\n    });\r\n  }\r\n}\r\n","import { AudioClock } from \"./AudioClock\";\r\n\r\nexport interface ICursorTimeline {\r\n  domElement: HTMLElement;\r\n  timeline: HTMLElement;\r\n  cursor: AudioCursor;\r\n  audioClock: AudioClock;\r\n  beatWidth: number;\r\n}\r\n\r\nexport class AudioCursor {\r\n  readonly domElement: HTMLDivElement;\r\n\r\n  constructor(readonly timeline: ICursorTimeline) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-cursor\");\r\n\r\n    const clock = timeline.audioClock;\r\n\r\n    clock.on(\"update\", () => {\r\n      this.update();\r\n    });\r\n\r\n    clock.on(\"start\", () => {\r\n      this.domElement.style.transform = \"translateX(0)\";\r\n      this.domElement.style.display = \"block\";\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n    });\r\n\r\n    clock.on(\"stop\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n  }\r\n\r\n  update() {\r\n    this.domElement.style.transform = `translateX(${\r\n      this.timeline.audioClock.currentBeat * this.timeline.beatWidth\r\n    }px)`;\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { triggerActive } from \"../../../../elements/src/animation\";\r\nimport { IEventItem, ISequence } from \"../../schema\";\r\nimport { ISourceEvent } from \"./SamplerSlot\";\r\nimport { Project } from \"../Project\";\r\nimport { Instrument } from \"../../abstracts/Instrument\";\r\n\r\nexport class PatternTrack\r\n  extends BaseElement<\"update\" | \"select\" | \"edit\">\r\n  implements ISequence\r\n{\r\n  private _canvas: HTMLCanvasElement;\r\n  private readonly _instrumentPanel: HTMLDivElement;\r\n  private readonly _indicator: HTMLDivElement;\r\n  port: number | null = null;\r\n  channel: number = 0;\r\n  events: IEventItem[] = [];\r\n\r\n  get canvas() {\r\n    return this._canvas;\r\n  }\r\n\r\n  get name() {\r\n    return this.instrument.name;\r\n  }\r\n\r\n  private _selected: boolean = false;\r\n  get selected() {\r\n    return this._selected;\r\n  }\r\n  set selected(value: boolean) {\r\n    console.log(\"PatternTrack set selected\", value);\r\n    this._selected = value;\r\n    this._instrumentPanel.classList.toggle(\"selected\", value);\r\n  }\r\n\r\n  constructor(\r\n    readonly project: Project,\r\n    public instrument: Instrument\r\n  ) {\r\n    super(\"div\", \"pattern-track\");\r\n\r\n    this._instrumentPanel = document.createElement(\"div\");\r\n    this._instrumentPanel.classList.add(\"pattern-track-panel\");\r\n    this._instrumentPanel.addEventListener(\"pointerdown\", () => {\r\n      this.instrument.window.show();\r\n    });\r\n\r\n    const label = document.createElement(\"div\");\r\n    this._instrumentPanel.appendChild(label);\r\n    label.textContent = instrument.name;\r\n\r\n    const buttons = document.createElement(\"div\");\r\n    buttons.classList.add(\"pattern-track-buttons\");\r\n    this._instrumentPanel.appendChild(buttons);\r\n\r\n    const edit = document.createElement(\"button\");\r\n    edit.textContent = \"e\";\r\n    buttons.appendChild(edit);\r\n\r\n    const mute = document.createElement(\"button\");\r\n    mute.textContent = \"M\";\r\n    buttons.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"button\");\r\n    solo.textContent = \"S\";\r\n    buttons.appendChild(solo);\r\n\r\n    this._indicator = document.createElement(\"div\");\r\n    this._indicator.classList.add(\"pattern-track-indicator\");\r\n    buttons.appendChild(this._indicator);\r\n\r\n    buttons.appendChild(mute);\r\n    buttons.appendChild(solo);\r\n\r\n    this._canvas = document.createElement(\"canvas\");\r\n    this._canvas.height = 100;\r\n    this._canvas.width = 1600;\r\n    this._canvas.classList.add(\"pattern-track-pattern\");\r\n\r\n    this._canvas.addEventListener(\"pointerdown\", () => {\r\n      this.emit(\"edit\", this);\r\n    });\r\n\r\n    this._instrumentPanel.addEventListener(\"pointerdown\", () => {\r\n      this.emit(\"select\", this);\r\n    });\r\n\r\n    this.domElement.appendChild(this._instrumentPanel);\r\n    this.domElement.appendChild(this._indicator);\r\n    this.domElement.appendChild(this._canvas);\r\n  }\r\n\r\n  trigger(note: number, beat = 0) {\r\n    const source = this.instrument.trigger(note, this.channel, beat);\r\n    if (beat > 0) {\r\n      this.project.audioClock.scheduleEventAtBeat(() => {\r\n        triggerActive(this._indicator);\r\n      }, beat);\r\n    } else {\r\n      triggerActive(this._indicator);\r\n    }\r\n    return source;\r\n  }\r\n\r\n  release(note: number, beat = 0) {\r\n    console.warn(\"TODO: PatternTrack release\", note, beat);\r\n  }\r\n\r\n  load(sequence: ISequence) {\r\n    this.events = sequence.events;\r\n  }\r\n\r\n  playback() {\r\n    if (!this.project.audioClock.isPlaying) {\r\n      console.warn(\"Playback cancelled\");\r\n      return;\r\n    }\r\n\r\n    let sourceEvent: ISourceEvent | undefined = undefined;\r\n\r\n    for (const event of this.events) {\r\n      sourceEvent = this.trigger(event.note, event.start);\r\n      if (event.domElement) {\r\n        this.project.audioClock.scheduleEventAtBeat(\r\n          () => event.domElement!.classList.toggle(\"active\", true),\r\n          event.start\r\n        );\r\n        this.project.audioClock.scheduleEventAtBeat(\r\n          () => event.domElement!.classList.toggle(\"active\", false),\r\n          event.start + event.duration\r\n        );\r\n      }\r\n    }\r\n\r\n    if (typeof sourceEvent !== \"undefined\" && \"source\" in sourceEvent) {\r\n      sourceEvent.source.onended = () => {\r\n        const nextLoop =\r\n          this.project.audioClock.currentBeat +\r\n          (4 - (this.project.audioClock.currentBeat % 4));\r\n        this.project.audioClock.scheduleEventAtBeat(() => {\r\n          this.project.audioClock.restart();\r\n          this.playback();\r\n        }, nextLoop);\r\n      };\r\n    }\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { Instrument } from \"../../abstracts/Instrument\";\r\nimport { IPattern } from \"../../schema\";\r\nimport { Project } from \"../Project\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"../components/AudioCursor\";\r\nimport { PatternTrack } from \"../components/PatternTrack\";\r\n\r\nexport class PatternWindow\r\n  extends DraggableWindow<\"select\" | \"edit\">\r\n  implements ICursorTimeline\r\n{\r\n  readonly trackContainer: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  readonly tracks: PatternTrack[] = [];\r\n  readonly timeline: HTMLDivElement;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.project.audioClock;\r\n  }\r\n\r\n  beatWidth = 20;\r\n  patterns: IPattern[] = [\r\n    {\r\n      name: \"Pattern 1\",\r\n      sequences: [],\r\n    },\r\n  ];\r\n\r\n  constructor(readonly project: Project) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"pattern-track-container\");\r\n\r\n    super(\"Pattern\", true, container);\r\n    this.trackContainer = container;\r\n    this.setSize(800, 400);\r\n\r\n    project.patterns = this.patterns;\r\n\r\n    this.timeline = document.createElement(\"div\");\r\n    this.timeline.style.position = \"absolute\";\r\n    this.timeline.style.width = \"calc(100% - 88px)\";\r\n    this.timeline.style.height = \"100%\";\r\n    this.timeline.style.left = \"88px\";\r\n    this.timeline.style.pointerEvents = \"none\";\r\n    this.timeline.style.overflow = \"hidden\";\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.timeline.appendChild(this.cursor.domElement);\r\n\r\n    const canvas = this.domElement.querySelector(\"canvas\");\r\n    if (canvas) this.beatWidth = canvas.width / 16;\r\n\r\n    this.on(\"resize\", () => {\r\n      this.beatWidth = this.domElement.clientWidth / 16;\r\n    });\r\n\r\n    project.audioClock.on(\"start\", () => {\r\n      if (!project.audioClock.startTime) {\r\n        throw new Error(\"Audio clock start time is not set\");\r\n      }\r\n      for (const track of this.tracks) {\r\n        track.playback();\r\n      }\r\n    });\r\n\r\n    this.addPattern(\"Pattern 1\");\r\n\r\n    // container.appendChild(this.cursor.domElement);\r\n  }\r\n\r\n  loadProject(project: Project) {\r\n    this.patterns = project.patterns;\r\n    this.tracks.forEach((track) => {\r\n      this.trackContainer.removeChild(track.domElement);\r\n    });\r\n    this.tracks.length = 0;\r\n    for (let i = 0; i < project.instruments.length; i++) {\r\n      const track = this.addTrack(project.instruments[i]);\r\n      track.load(project.patterns[0].sequences[i]);\r\n    }\r\n  }\r\n\r\n  addPattern(name: string) {\r\n    console.log(\"Created pattern:\", name);\r\n    const pattern: IPattern = { name, sequences: [] };\r\n    this.patterns.push(pattern);\r\n  }\r\n\r\n  addTrack(instrument: Instrument) {\r\n    console.log(\"Added track + instrument:\", instrument);\r\n\r\n    const track = new PatternTrack(this.project, instrument);\r\n    if (this.tracks.length === 0) {\r\n      track.selected = true;\r\n      track.domElement.appendChild(this.timeline);\r\n    }\r\n\r\n    track.on(\"select\", (selectedTrack) => {\r\n      console.log(\"PatternWindow select\", selectedTrack);\r\n      this.emit(\"select\", selectedTrack);\r\n    });\r\n\r\n    track.on(\"edit\", (selectedTrack) => {\r\n      console.log(\"PatternWindow edit\", selectedTrack);\r\n      this.emit(\"edit\", selectedTrack);\r\n    });\r\n\r\n    this.tracks.push(track);\r\n    this.trackContainer.appendChild(track.domElement);\r\n\r\n    return track;\r\n  }\r\n\r\n  removeTrack(track: PatternTrack) {\r\n    const index = this.tracks.indexOf(track);\r\n    if (index !== -1) {\r\n      this.tracks.splice(index, 1);\r\n      this.trackContainer.removeChild(track.domElement);\r\n    }\r\n  }\r\n\r\n  trigger(note: number) {\r\n    for (const track of this.tracks) {\r\n      if (track.selected) track.trigger(note);\r\n    }\r\n  }\r\n\r\n  play() {\r\n    if (this.audioClock.startTime == null) {\r\n      throw new Error(\"Audio clock start time is not set\");\r\n    }\r\n    for (const track of this.tracks) {\r\n      for (const event of track.events) {\r\n        track.trigger(\r\n          event.note,\r\n          this.audioClock.startTime + (event.start * 60) / this.audioClock.bpm\r\n        );\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class ScrollPanel<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"scroll\" | T> {\r\n  sensitivity = 50;\r\n  private linkedElements: HTMLElement[] = [];\r\n  private _scrollTop = 0;\r\n\r\n  get scrollTop() {\r\n    return this._scrollTop;\r\n  }\r\n\r\n  set scrollTop(value: number) {\r\n    const top = -value;\r\n    this._scrollTop = top;\r\n    this.scrollElement.style.transform = `translateY(${top}px)`;\r\n    for (const linkedElement of this.linkedElements) {\r\n      linkedElement.style.transform = `translateY(${top}px)`;\r\n    }\r\n  }\r\n\r\n  constructor(readonly scrollElement: HTMLElement) {\r\n    super(\"div\", \"scroll-panel\");\r\n    scrollElement.classList.add(\"scroll-panel-content\");\r\n\r\n    this.scrollElement.addEventListener(\"wheel\", (e) => {\r\n      e.preventDefault();\r\n      console.log(e.deltaY);\r\n      let top =\r\n        this._scrollTop + (e.deltaY > 0 ? -this.sensitivity : this.sensitivity);\r\n      const bottom = top + this.scrollElement.offsetHeight;\r\n      if (bottom < this.domElement.offsetHeight) {\r\n        top = this.domElement.offsetHeight - this.scrollElement.offsetHeight;\r\n      } else if (top > 0) {\r\n        top = 0;\r\n      }\r\n      this._scrollTop = top;\r\n      this.scrollElement.style.transform = `translateY(${top}px)`;\r\n      for (const linkedElement of this.linkedElements) {\r\n        linkedElement.style.transform = `translateY(${top}px)`;\r\n      }\r\n\r\n      this.emit(\"scroll\", e);\r\n    });\r\n  }\r\n\r\n  linkElement(element: HTMLElement) {\r\n    this.linkedElements.push(element);\r\n    element.classList.add(\"scroll-panel-content\");\r\n  }\r\n}\r\n","import { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\nimport { AudioCanvas } from \"../../../../elements/src/elements/AudioCanvas\";\r\n\r\nexport class LyricCanvas extends AudioCanvas {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; note: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.note,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n}\r\n","import { BaseElement } from \"./elements/BaseElement\";\r\n\r\nexport class DialogPopup extends BaseElement<\"result\" | \"cancel\"> {  \r\n  closeButton: HTMLButtonElement;\r\n  okButton: HTMLButtonElement | undefined;\r\n  cancelButton: HTMLButtonElement | undefined;\r\n\r\n  get isVisibile() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    private readonly ok: string | HTMLButtonElement = \"OK\",\r\n    private readonly cancel: string | HTMLButtonElement = \"Cancel\"\r\n  ) {\r\n    super(\"div\", \"dialog-popup\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");    \r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"pointerdown\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    if (ok instanceof HTMLButtonElement) {\r\n      this.okButton = ok;\r\n    } else if (ok) {\r\n      this.okButton = document.createElement(\"button\");\r\n      this.okButton.textContent = ok;\r\n      this.domElement.appendChild(this.okButton);\r\n    }\r\n\r\n    if (this.okButton) {\r\n      this.okButton.addEventListener(\"click\", () => {\r\n        this.emit(\"result\", this);\r\n      });\r\n    }\r\n\r\n    if (cancel instanceof HTMLButtonElement) {\r\n      this.cancelButton = cancel;\r\n    } else if (cancel) {\r\n      this.cancelButton = document.createElement(\"button\");\r\n      this.cancelButton.textContent = cancel;\r\n      this.domElement.appendChild(this.cancelButton);\r\n    }\r\n\r\n    if (this.cancelButton) {\r\n      this.cancelButton.addEventListener(\"click\", () => {\r\n        this.emit(\"cancel\", this);\r\n      });\r\n    }\r\n  }\r\n\r\n  show(x: number, y: number, targetObject?: unknown) { /* eslint-disable-line @typescript-eslint/no-unused-vars */\r\n    this.domElement.style.display = \"block\";\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","import { LyricCanvas } from \"./components/LyricCanvas\";\r\nimport { DialogPopup } from \"../../../elements/src/DialogPopup\";\r\nimport { IEventItem } from \"../schema\";\r\n\r\nexport class PianoRollDialog extends DialogPopup {\r\n  domElement: HTMLDivElement;\r\n  closeButton: HTMLButtonElement;\r\n  saveButton: HTMLButtonElement;\r\n  note: IEventItem | null = null;\r\n\r\n  constructor(public onsave: (note: IEventItem) => void) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-dialog\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");\r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"click\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    this.saveButton = document.createElement(\"button\");\r\n    this.saveButton.textContent = \"Save\";\r\n    this.domElement.appendChild(this.saveButton);\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  override show(x: number, y: number, note: IEventItem) {\r\n    super.show(x, y, note);\r\n    this.note = note;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class LyricEditorDialog extends PianoRollDialog {\r\n  textInput: HTMLInputElement;\r\n  audioCanvas: LyricCanvas;\r\n  pitchSlider: HTMLInputElement;\r\n  constructor(onsave: (note: IEventItem) => void) {\r\n    super(onsave);\r\n    this.domElement.classList.add(\"piano-roll-note-editor\");\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this.textInput = document.createElement(\"input\");\r\n    this.textInput.setAttribute(\"placeholder\", \"Note lyric\");\r\n    this.textInput.classList.add(\"lyric-editor-text\");\r\n    this.textInput.type = \"text\";\r\n    this.domElement.appendChild(this.textInput);\r\n\r\n    this.pitchSlider = document.createElement(\"input\");\r\n    this.pitchSlider.classList.add(\"lyric-editor-pitch\");\r\n    this.pitchSlider.type = \"range\";\r\n    this.pitchSlider.min = \"-0.5\";\r\n    this.pitchSlider.max = \"0.5\";\r\n    this.pitchSlider.step = \"0.01\";\r\n    this.pitchSlider.value = \"0\";\r\n    this.pitchSlider.addEventListener(\"input\", () => {\r\n      this.note!.note = parseFloat(this.pitchSlider.value);\r\n    });\r\n    this.domElement.appendChild(this.pitchSlider);\r\n\r\n    this.audioCanvas = new LyricCanvas();\r\n    this.domElement.appendChild(this.audioCanvas.domElement);\r\n\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.audioCanvas.domElement.style.display = \"block\";\r\n      // this.audioCanvas.generateAudio(this.note!, true).then((buffer) => {\r\n      //   this.note!.audio = buffer;\r\n      // });\r\n      // this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  show(x: number, y: number, note: IEventItem) {\r\n    super.show(x, y, note);\r\n    this.textInput.value = this.note?.label || \"\";\r\n    // if (this.note?.audio) {\r\n    //   this.audioCanvas.loadBuffer(this.note.audio);\r\n    //   this.audioCanvas.domElement.style.display = \"block\";\r\n    // } else {\r\n    //   this.audioCanvas.domElement.style.display = \"none\";\r\n    // }\r\n  }\r\n}\r\n","import { ScrollPanel } from \"../../../../elements/src/elements/ScrollPanel\";\r\nimport { DEFAULT_NOTE_HEIGHT, NOTE_NAMES } from \"../../constants\";\r\nimport { PatternTrack } from \"./PatternTrack\";\r\nimport { LyricEditorDialog } from \"../audioDialogs\";\r\nimport { IEventItem } from \"../../schema\";\r\n\r\n\r\nfunction getNoteNameFromPitch(pitch: number): string {\r\n  const note = NOTE_NAMES[pitch % NOTE_NAMES.length];\r\n  return `${note}${Math.floor(pitch / NOTE_NAMES.length)}`;\r\n}\r\n\r\nconst NOTE_HANDLE_WIDTH = 6;\r\n\r\nexport class GridItem {\r\n  note: number;\r\n  start: number;\r\n  duration: number;\r\n  velocity: number = 0.8;\r\n  label: string | \"\" = \"\";\r\n  domElement: HTMLDivElement;\r\n  noteLabel: HTMLDivElement;\r\n  lyricLabel: HTMLDivElement;\r\n  audio: AudioBuffer | null = null;\r\n\r\n  constructor(\r\n    private readonly grid: Grid,\r\n    item: IEventItem\r\n  ) {\r\n    this.note = item.note;\r\n    this.start = item.start;\r\n    this.duration = item.duration;\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-note\");\r\n    this.domElement.style.height = `${grid.noteHeight}px`;\r\n\r\n    this.noteLabel = document.createElement(\"div\");\r\n    this.noteLabel.classList.add(\"piano-roll-note-label\");\r\n    this.noteLabel.textContent = getNoteNameFromPitch(this.note);\r\n    this.domElement.appendChild(this.noteLabel);\r\n\r\n    this.lyricLabel = document.createElement(\"div\");\r\n    this.lyricLabel.classList.add(\"piano-roll-note-lyric\");\r\n    this.domElement.appendChild(this.lyricLabel);\r\n\r\n    if (item.label) this.lyricLabel.textContent = item.label;\r\n\r\n    console.log(\"GridItem\", this);\r\n\r\n    grid.gridElement.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class Grid extends ScrollPanel<\"select\" | \"update\"> {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly gridElement: HTMLDivElement;\r\n  readonly previewCanvas: HTMLCanvasElement;\r\n  readonly noteHeight = DEFAULT_NOTE_HEIGHT;\r\n  readonly beatWidth = 100;\r\n  readonly noteEditor: LyricEditorDialog;\r\n  private _currentNote: IEventItem | null = null;\r\n  private _dragMode: string | null = null;\r\n  private _quantize: number = 0.25;\r\n  private _dragOffset: number = 0;\r\n  private _track: PatternTrack | null = null;\r\n  readonly scrollElement: HTMLDivElement;\r\n\r\n  constructor() {\r\n    const gridElement = document.createElement(\"div\");\r\n\r\n    super(gridElement);\r\n\r\n    this.scrollElement = gridElement;\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n\r\n    this.gridElement = gridElement;\r\n\r\n    this.domElement.classList.add(\"piano-roll-grid-container\");\r\n    this.gridElement.classList.add(\"piano-roll-grid\");\r\n\r\n    this.gridElement.addEventListener(\"dragstart\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.previewCanvas = document.createElement(\"canvas\");\r\n    this.previewCanvas.style.imageRendering = \"pixelated\";\r\n\r\n    const rowBackgroundCanvas = document.createElement(\"canvas\");\r\n    rowBackgroundCanvas.style.imageRendering = \"pixelated\";\r\n    rowBackgroundCanvas.width = this.beatWidth * 4;\r\n    rowBackgroundCanvas.height = this.noteHeight;\r\n    console.log(\"debug\", rowBackgroundCanvas.width, rowBackgroundCanvas.height);\r\n    const ctx = rowBackgroundCanvas.getContext(\"2d\");\r\n    // disable anti-alias\r\n\r\n    if (ctx) {\r\n      ctx.strokeStyle = \"#666\";\r\n      ctx.lineWidth = 0.5;\r\n      for (let j = 1; j < 4; j++) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(j * this.beatWidth, 0);\r\n        ctx.lineTo(j * this.beatWidth, this.noteHeight);\r\n        ctx.stroke();\r\n      }\r\n      ctx.lineWidth = 1;\r\n      ctx.strokeStyle = \"white\";\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, 0);\r\n      ctx.lineTo(0, this.noteHeight);\r\n      ctx.stroke();\r\n    }\r\n    for (let i = 0; i < 88; i++) {\r\n      const row = document.createElement(\"div\");\r\n      row.classList.add(\"piano-roll-grid-row\");\r\n      row.style.height = `${this.noteHeight}px`;\r\n      this.gridElement.appendChild(row);\r\n      const base64 = rowBackgroundCanvas.toDataURL();\r\n      row.style.backgroundImage = `url(${base64})`;\r\n      row.style.backgroundRepeat = \"repeat\";\r\n    }\r\n    this.domElement.appendChild(this.gridElement);\r\n\r\n    this.noteEditor = new LyricEditorDialog((note) => {\r\n      const input = this.noteEditor.domElement.querySelector(\r\n        \".lyric-editor-text\"\r\n      ) as HTMLInputElement;\r\n      note.label = input?.value || \"\";\r\n    });\r\n\r\n    document.body.appendChild(this.noteEditor.domElement);\r\n\r\n    this.gridElement.addEventListener(\"pointerdown\", (event) => {\r\n      if (!this._track) throw new Error(\"No track\");\r\n\r\n      if (!this._track.events) throw new Error(\"No events\");\r\n\r\n      event.preventDefault();\r\n\r\n      this._dragOffset = event.layerX;\r\n\r\n      if (this.noteEditor.domElement.style.display === \"block\") {\r\n        this.noteEditor.domElement.style.display = \"none\";\r\n        return;\r\n      }\r\n\r\n      if (\r\n        event.target instanceof HTMLDivElement &&\r\n        event.target.classList.contains(\"piano-roll-note\")\r\n      ) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const note = this._track.events.find(\r\n          (n) => n.domElement === event.target\r\n        );\r\n\r\n        if (event.ctrlKey || event.button === 1) {\r\n          if (note)\r\n            this.noteEditor.show(event.clientX + 20, event.clientY - 5, note);\r\n          else this.noteEditor.domElement.style.display = \"none\";\r\n        }\r\n\r\n        if (note) {\r\n          this._currentNote = note;\r\n\r\n          if (event.button === 2) {\r\n            this.remove(note);\r\n            this._currentNote = null;\r\n          } else {\r\n            note.domElement!.parentElement?.appendChild(note.domElement!);\r\n            if (this._dragOffset < NOTE_HANDLE_WIDTH) {\r\n              this._dragMode = \"start\";\r\n            } else if (\r\n              note.domElement!.offsetWidth - this._dragOffset <\r\n              NOTE_HANDLE_WIDTH\r\n            ) {\r\n              this._dragMode = \"end\";\r\n            } else {\r\n              this._dragMode = \"move\";\r\n            }\r\n          }\r\n        }\r\n      } else if (event.button !== 0) return;\r\n      else if (event.target === this.gridElement) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const pitch = 87 - Math.floor(event.layerY / this.noteHeight);\r\n\r\n        let start = event.layerX / this.beatWidth;\r\n        start = Math.round(start / this._quantize) * this._quantize;\r\n        console.log(\"start\", start, event.layerX);\r\n\r\n        const item: IEventItem = {\r\n          note: pitch,\r\n          start: start,\r\n          velocity: 100,\r\n          duration: 0.25,\r\n          label: \"\",\r\n          domElement: undefined\r\n        };\r\n\r\n        this._currentNote = this.add(item);\r\n        this._currentNote.domElement!.style.top = `${\r\n          (87 - this._currentNote.note) * this.noteHeight\r\n        }px`;\r\n        this._currentNote.domElement!.style.left = `${\r\n          this._currentNote.start * this.beatWidth\r\n        }px`;\r\n        this._dragMode = \"end\";\r\n\r\n        this.emit(\"select\", this._currentNote);\r\n      }\r\n\r\n      this.emit(\"update\", this);\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      this._currentNote = null;\r\n\r\n      this.emit(\"update\", this);\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentNote) {\r\n        this.remove(this._currentNote);\r\n        this._currentNote = null;\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"contextmenu\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointermove\", (event) => {\r\n      if (this._currentNote && event.buttons === 1) {\r\n        if (this._dragMode === \"start\") {\r\n          const oldStart = this._currentNote.start;\r\n          this._currentNote.start = event.layerX / this.beatWidth;\r\n          this._currentNote.start =\r\n            Math.round(this._currentNote.start / this._quantize) *\r\n            this._quantize;\r\n          this._currentNote.duration =\r\n            oldStart - this._currentNote.start + this._currentNote.duration;\r\n          this._currentNote.domElement!.style.left = `${\r\n            this._currentNote.start * this.beatWidth\r\n          }px`;\r\n          this._currentNote.domElement!.style.width = `${\r\n            this._currentNote.duration * this.beatWidth\r\n          }px`;\r\n        } else if (this._dragMode === \"end\") {\r\n          this._currentNote.duration =\r\n            event.layerX / this.beatWidth - this._currentNote.start;\r\n\r\n          // quantize\r\n          this._currentNote.duration =\r\n            Math.round(this._currentNote.duration / this._quantize) *\r\n            this._quantize;\r\n\r\n          this._currentNote.domElement!.style.width = `${\r\n            this._currentNote.duration * this.beatWidth\r\n          }px`;\r\n        } else if (this._dragMode === \"move\") {\r\n          this._currentNote.start =\r\n            (event.layerX - this._dragOffset) / this.beatWidth;\r\n          this._currentNote.start =\r\n            Math.round(this._currentNote.start / this._quantize) *\r\n            this._quantize;\r\n          this._currentNote.domElement!.style.left = `${\r\n            this._currentNote.start * this.beatWidth\r\n          }px`;\r\n        } else {\r\n          return;\r\n        }\r\n\r\n        this.emit(\"update\", this);\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentNote) {\r\n        this._currentNote.domElement!.style.pointerEvents = \"auto\";\r\n      }\r\n      this._currentNote = null;\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentNote) {\r\n        this._currentNote.domElement!.style.pointerEvents = \"auto\";\r\n      }\r\n      this._currentNote = null;\r\n    });\r\n  }\r\n\r\n  add(event: IEventItem) {\r\n    if (!this._track) throw new Error(\"add() No track!\");\r\n    const item = new GridItem(this, event);\r\n    this._track.events.push(item);\r\n    console.log(\"Grid: add\", event);\r\n    return item;\r\n  }\r\n\r\n  remove(event: IEventItem) {\r\n    if (!this._track) throw new Error(\"remove() No track!\");\r\n    this._track.events.splice(this._track.events.indexOf(event), 1);\r\n    this.gridElement.removeChild(event.domElement!);\r\n  }\r\n\r\n  load(track: PatternTrack) {\r\n    console.log(\"Grid: load\", track.events);\r\n    this._track?.events.forEach((event) => event.domElement!.remove());\r\n    this._track = track;\r\n    track.events.forEach((event) => {\r\n      this.gridElement.appendChild(event.domElement!);\r\n    });\r\n  }\r\n\r\n  renderToCanvas(canvas: HTMLCanvasElement, color: string) {\r\n    if (!this._track) throw new Error(\"renderToCanvas() No track!\");\r\n\r\n    // find lowest note\r\n    let lowestNote = 88;\r\n    this._track.events.forEach((note) => {\r\n      if (note.note < lowestNote) lowestNote = note.note;\r\n    });\r\n\r\n    // find highest note\r\n    let highestNote = 0;\r\n    this._track.events.forEach((note) => {\r\n      if (note.note > highestNote) highestNote = note.note;\r\n    });\r\n\r\n    highestNote += 12;\r\n    lowestNote -= 12;\r\n\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    let padded_scale = canvas.height / (highestNote - lowestNote + 1);\r\n\r\n    if (padded_scale > 2) {\r\n      padded_scale = 2;\r\n    }\r\n\r\n    this._track.events.forEach((note) => {\r\n      const y = canvas.height - (note.note - lowestNote + 1) * padded_scale;\r\n      const x = note.start * this.beatWidth;\r\n      const width = note.duration * this.beatWidth;\r\n      ctx.fillStyle = color;\r\n      ctx.fillRect(x, y, width, padded_scale);\r\n    });\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport {\r\n  DEFAULT_NOTE_HEIGHT,\r\n  KEY_COLORS,\r\n  NOTE_NAMES,\r\n} from \"../../constants\";\r\nimport { IKeyboardEvent } from \"./Keyboard\";\r\n\r\nexport class SideKeyboard extends BaseElement<\"update\"> {  \r\n  keys: HTMLDivElement[] = [];\r\n  noteHeight = DEFAULT_NOTE_HEIGHT;\r\n\r\n  constructor() {\r\n\r\n    super(\"div\", \"piano-roll-keyboard\");\r\n\r\n    this.redraw();\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const key = e.target as HTMLDivElement;\r\n\r\n      if (key.classList.contains(\"piano-roll-keyboard-key\")) {\r\n        const note_index = this.keys.indexOf(key);\r\n        console.log(\"key\", key.textContent, note_index);        \r\n        key.classList.add(\"active\");\r\n        this.emit(\"update\", { type: \"press\", note: note_index } as IKeyboardEvent);\r\n        const pointerup = () => {\r\n          key.classList.remove(\"active\");\r\n          this.emit(\"update\", { type: \"release\", note: note_index } as IKeyboardEvent);\r\n          window.removeEventListener(\"pointerup\", pointerup);\r\n        };\r\n\r\n        window.addEventListener(\"pointerup\", () => pointerup());\r\n      }\r\n    });\r\n  }\r\n\r\n  redraw() {\r\n    this.domElement.innerHTML = \"\";\r\n\r\n    for (let i = 87; i >= 0; i--) {\r\n      const key = document.createElement(\"div\");\r\n      key.classList.add(\"piano-roll-keyboard-key\");\r\n      key.style.height = `${this.noteHeight}px`;\r\n      // key.style.bottom = `${i * this.noteHeight}px`;\r\n      key.style.backgroundColor =\r\n        KEY_COLORS[i % 12] === \"white\" ? \"#fff\" : \"#000\";\r\n      key.style.color = KEY_COLORS[i % 12] === \"white\" ? \"#000\" : \"#fff\";\r\n      key.textContent = NOTE_NAMES[i % 12] + ((i / 12) | 0).toString();\r\n      this.domElement.appendChild(key);\r\n      this.keys.push(key);\r\n    }\r\n\r\n    this.keys.reverse();\r\n  }\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"./AudioCursor\";\r\nimport { Grid, GridItem } from \"./Grid\";\r\nimport { IKeyboardEvent } from \"./Keyboard\";\r\nimport { PatternTrack } from \"./PatternTrack\";\r\nimport { SideKeyboard } from \"./SideKeyboard\";\r\n\r\nexport class PianoRoll\r\n  extends EventObject<\"update\">\r\n  implements ICursorTimeline\r\n{\r\n  readonly domElement: HTMLDivElement;\r\n  readonly grid: Grid;\r\n  readonly sideKeyboard: SideKeyboard;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLElement;\r\n  cursorUpdateInterval: number | object | null = null;\r\n  track: PatternTrack | null = null;\r\n  color = \"#7979ce\";\r\n  beatWidth = 100;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll\");\r\n\r\n    this.sideKeyboard = new SideKeyboard();\r\n    this.domElement.appendChild(this.sideKeyboard.domElement);\r\n    this.sideKeyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      if (e.type == \"press\") this.track!.trigger(e.note);\r\n      else if (e.type == \"release\") this.track!.release(e.note);\r\n    });\r\n\r\n    this.grid = new Grid();\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.on(\"select\", (item) => {\r\n      const note = item as GridItem;\r\n      this.track!.trigger(note.note);\r\n      if (this.track) {\r\n        this.grid.renderToCanvas(this.track.canvas, this.color);\r\n      }\r\n    });\r\n    this.grid.on(\"update\", () => {\r\n      if (this.track) {\r\n        this.grid.renderToCanvas(this.track.canvas, this.color);\r\n      }\r\n    });\r\n    this.grid.linkElement(this.sideKeyboard.domElement);\r\n\r\n    this.timeline = this.grid.domElement;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.classList.add(\"audio-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor.domElement);\r\n\r\n    this.grid.scrollTop = 1000;\r\n  }\r\n\r\n  load(track: PatternTrack) {\r\n    this.track = track;\r\n    this.grid.load(track);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { PatternTrack } from \"../components/PatternTrack\";\r\nimport { PianoRoll } from \"../components/PianoRoll\";\r\n\r\nexport class PianoRollWindow extends DraggableWindow<\"update\"> {\r\n  pianoRoll: PianoRoll;\r\n\r\n  constructor(readonly clock: AudioClock) {\r\n    const pianoRoll = new PianoRoll(clock);\r\n\r\n    super(\"Piano Roll\", true, pianoRoll.domElement);\r\n    this.pianoRoll = pianoRoll;\r\n\r\n    this.setSize(800, 400);\r\n  }\r\n\r\n  loadTrack(track: PatternTrack) {\r\n    this.pianoRoll.load(track);\r\n    this.setTitle(`Piano Roll (${track.name})`);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { ITimelineItem, ITimelineSequence } from \"../../schema\";\r\n\r\nexport class PlaylistTrack\r\n  extends BaseElement<\"update\">\r\n  implements ITimelineSequence\r\n{\r\n  name = \"Track 1\";\r\n  items: ITimelineItem[] = [];\r\n\r\n  constructor(name: string) {\r\n    super(\"div\", \"playlist-track\");\r\n\r\n    const settings = document.createElement(\"div\");\r\n    settings.classList.add(\"instrument-panel\");\r\n\r\n    const label = document.createElement(\"div\");\r\n    settings.appendChild(label);\r\n    label.textContent = name;\r\n\r\n    const buttons = document.createElement(\"div\");\r\n    buttons.classList.add(\"playlist-track-selector\");\r\n    settings.appendChild(buttons);\r\n\r\n    const mute = document.createElement(\"button\");\r\n    mute.textContent = \"M\";\r\n    buttons.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"button\");\r\n    solo.textContent = \"S\";\r\n    buttons.appendChild(solo);\r\n\r\n    const track = document.createElement(\"div\");\r\n    track.classList.add(\"pattern-panel\");\r\n\r\n    this.domElement.appendChild(settings);\r\n    this.domElement.appendChild(track);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { Project } from \"../Project\";\r\nimport { PlaylistTrack } from \"../components/PlaylistTrack\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"../components/AudioCursor\";\r\n\r\nexport class PlaylistWindow\r\n  extends DraggableWindow<\"update\" | \"select\">\r\n  implements ICursorTimeline\r\n{\r\n  private _tracks: PlaylistTrack[] = [];\r\n  readonly timeline: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  beatWidth = 100;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.project.audioClock;\r\n  }\r\n\r\n  constructor(readonly project: Project) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"playlist-track-container\");\r\n\r\n    super(\"Playlist\", true, container);\r\n    this.timeline = container;\r\n    this.setSize(800, 400);\r\n\r\n    this.cursor = new AudioCursor(this);\r\n\r\n    this.project.audioClock.on(\"update\", () => {\r\n      this.cursor.update();\r\n    });\r\n  }\r\n\r\n  addTrack(name: string) {\r\n    const track = new PlaylistTrack(name);\r\n    this._tracks.push(track);\r\n    this.timeline.appendChild(track.domElement);\r\n    this.timeline.appendChild(this.cursor.domElement);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport { WindowContainer } from \"../../../elements/src/elements/WindowContainer\";\r\nimport { Project } from \"./Project\";\r\nimport { IKeyboardEvent, Keyboard } from \"./components/Keyboard\";\r\nimport { PatternTrack } from \"./components/PatternTrack\";\r\nimport { PatternWindow } from \"./windows/PatternWindow\";\r\nimport { PianoRollWindow } from \"./windows/PianoRollWindow\";\r\nimport { PlaylistWindow } from \"./windows/PlaylistWindow\";\r\n\r\nexport class ProjectUI extends BaseElement<\"update\"> {\r\n  container: WindowContainer;\r\n\r\n  constructor(readonly project: Project) {\r\n    super(\"div\", \"project-ui\");\r\n\r\n    this.container = new WindowContainer();\r\n    this.domElement.appendChild(this.container.domElement);\r\n\r\n    const pianoRollWindow = new PianoRollWindow(project.audioClock);\r\n    this.container.addWindow(pianoRollWindow);\r\n    pianoRollWindow.setSize(900, 400);\r\n    pianoRollWindow.setPosition(500, 100);\r\n\r\n    const patternWindow = new PatternWindow(project);\r\n    patternWindow.setSize(400, 400);\r\n    patternWindow.show(35, 100);\r\n    this.container.addWindow(patternWindow);\r\n\r\n    const playlistWindow = new PlaylistWindow(project);\r\n    patternWindow.show(200, 200);\r\n    this.container.addWindow(playlistWindow);\r\n\r\n    patternWindow.on(\"edit\", (selectedTrack) => {\r\n      console.log(\"edit\", selectedTrack);\r\n      pianoRollWindow.loadTrack(selectedTrack as PatternTrack);\r\n      pianoRollWindow.show();\r\n    });\r\n\r\n    patternWindow.on(\"select\", (selectedTrack) => {\r\n      console.log(\"select\", selectedTrack);\r\n      const track = selectedTrack as PatternTrack;\r\n      track.instrument.window.show();\r\n    });\r\n\r\n    // playlistWindow.show(600, 100);\r\n\r\n    // const samplerWindow: SamplerWindow = project.instruments[0] as SamplerWindow;\r\n    // container.addWindow(samplerWindow);\r\n    //samplerWindow.setSize(400, 400);\r\n    //samplerWindow.show(1465, 100);\r\n\r\n    const keyboard = new Keyboard();\r\n    this.domElement.appendChild(keyboard.domElement);\r\n    keyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      console.log(\"Keyboard\", event);\r\n      if (e.type === \"press\") {\r\n        patternWindow.trigger(e.note);\r\n      } else if (e.type === \"release\") {\r\n        console.log(\"Release\", e.note);\r\n      }\r\n    });\r\n\r\n    this.project.on(\"update\", (event) => {\r\n      console.log(\"Composition\", event);\r\n\r\n      if (!(event instanceof Object)) {\r\n        throw new Error(\"Invalid event\");\r\n      }\r\n\r\n      if (!(\"type\" in event)) {\r\n        throw new Error(\"Invalid event\");\r\n      }\r\n\r\n      const e = event as { type: string; value: unknown };\r\n\r\n      if (e.type === \"project\") {\r\n        const project = e.value as Project;\r\n        console.log(\"Project\", project);\r\n        patternWindow.loadProject(project);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { AudioClock } from \"./elements/components/AudioClock\";\r\nimport { Project } from \"./elements/Project\";\r\nimport { ProjectUI } from \"./elements/ProjectUI\";\r\nimport { templates } from \"./schema\";\r\n\r\nconst domElement = document.createElement(\"div\");\r\ndomElement.classList.add(\"studio\");\r\n\r\nconst audioClock = new AudioClock();\r\ndomElement.appendChild(audioClock.domElement);\r\n\r\nconst project = new Project(audioClock);\r\nconst projectUI = new ProjectUI(project);\r\ndomElement.appendChild(projectUI.domElement);\r\n\r\ndocument.body.appendChild(domElement);\r\n\r\nproject.deserialize(JSON.stringify(templates.Basic));\r\n","export type ControllerGroup = { [key: string]: IPluginControl };\r\nexport type ControllerValue = number | string | boolean | AudioBuffer | object;\r\nexport type ControlType =\r\n  | \"knob\"\r\n  | \"slider\"\r\n  | \"string\"\r\n  | \"select\"\r\n  | \"audio\"\r\n  | \"object\";\r\nexport type InstrumentType = \"sampler\" | \"synthesizer\" | null;\r\n\r\nexport interface IEvent {\r\n  start: number;\r\n  duration: number;\r\n}\r\n\r\nexport interface IEventItem extends IEvent {\r\n  note: number;\r\n  velocity: number;\r\n  label: string;\r\n  domElement: HTMLElement | undefined;\r\n}\r\n\r\nexport interface ISequence {\r\n  events: IEventItem[];\r\n}\r\n\r\nexport interface IPattern {\r\n  name: string;\r\n  sequences: ISequence[];\r\n}\r\n\r\nexport interface IHasOwnEnvelope {\r\n  envelope: IEnvelope | null;\r\n}\r\n\r\nexport interface IHasOwnLFO {\r\n  lfo?: IOscillatorSettings;\r\n}\r\n\r\nexport interface IUseEnvelope {\r\n  envelopeNumber: number | null;\r\n}\r\n\r\nexport interface IUseLFO {\r\n  lfoNumber: number | null;\r\n}\r\n\r\nexport interface IHasControls {\r\n  controllerGroups: ControllerGroup[];\r\n}\r\n\r\nexport interface IInstrumentSettings extends IHasControls {\r\n  name: string;  \r\n  id: string;\r\n  inputPort?: number;\r\n  inputChannel?: number;\r\n}\r\n\r\nexport interface ITimelineItem extends IEvent {\r\n  type: \"pattern\" | \"audio\";\r\n  label: string;\r\n}\r\n\r\nexport interface ITimelinePattern extends ITimelineItem {\r\n  pattern: IPattern;\r\n}\r\n\r\nexport interface ITimelineAudio extends ITimelineItem {\r\n  buffer: AudioBuffer;\r\n  fadeIn: number;\r\n  fadeOut: number;\r\n}\r\n\r\nexport interface ITimelineSequence {\r\n  name: string;\r\n  items: ITimelineItem[];\r\n}\r\n\r\nexport interface IProject {\r\n  title: string;\r\n  description: string;\r\n  tempo: number;\r\n  instruments: IInstrumentSettings[];\r\n  patterns: IPattern[];\r\n  timeline: ITimelineSequence[];\r\n}\r\n\r\nexport interface ISamplerSlot {\r\n  name: string;\r\n  buffer: AudioBuffer | null;\r\n  keyBinding: number | null;\r\n  velocity: number;\r\n  pan: number;\r\n  pitch: number;\r\n  randomPitch: number;\r\n  randomVelocity: number;\r\n  startPosition: number;\r\n  endPosition: number;\r\n  loop: boolean;\r\n  loopStart: number;\r\n  loopEnd: number;\r\n  cutGroup: number;\r\n  cutByGroups: number[];\r\n}\r\n\r\nexport interface ISamplerSettings {\r\n  name: string;\r\n  slots: ISamplerSlot[];\r\n}\r\n\r\nexport interface IPluginControl {\r\n  type: ControlType;\r\n  name: string;\r\n  label: string;\r\n  default: ControllerValue;\r\n  value: ControllerValue;\r\n  min?: number;\r\n  max?: number;\r\n  step?: number;\r\n}\r\n\r\nexport interface IEnvelope {\r\n  attack: IPluginControl;\r\n  hold: IPluginControl;\r\n  decay: IPluginControl;\r\n  sustain: IPluginControl;\r\n  release: IPluginControl;\r\n}\r\n\r\nexport interface IOscillatorSettings extends IHasOwnEnvelope {\r\n  shape: \"sine\" | \"square\" | \"sawtooth\" | \"triangle\";\r\n  detune: number;\r\n  gain?: number;\r\n  route?: number;\r\n  feedback?: number;\r\n}\r\n\r\nexport interface IFilter extends IHasOwnEnvelope {\r\n  type:\r\n    | \"lowpass\"\r\n    | \"highpass\"\r\n    | \"bandpass\"\r\n    | \"lowshelf\"\r\n    | \"highshelf\"\r\n    | \"peaking\"\r\n    | \"notch\"\r\n    | \"allpass\";\r\n  frequency: number;\r\n  detune: number;\r\n  Q: number;\r\n  gain: number;\r\n}\r\n\r\nexport interface ISynthesizerSettings {\r\n  name: string;\r\n  voices: ISynthesizerVoiceSettings[];\r\n}\r\n\r\nexport interface ISynthesizerVoiceSettings extends IUseEnvelope, IUseLFO {\r\n  gain: number;\r\n  frequency: number | null;\r\n  detune: number | null;\r\n  oscillators: IOscillatorSettings[];\r\n  note: number | null;\r\n}\r\n\r\nexport const templates: { [key: string]: IProject } = {\r\n  Basic: {\r\n    title: \"Basic\",\r\n    description: \"Basic project template with Sampler and Synthesizer\",\r\n    tempo: 120,\r\n    instruments: [\r\n      { name: \"Sampler\", id: \"sampler\", controllerGroups: [] },\r\n      {\r\n        name: \"FM Bass\",        \r\n        id: \"fm_bass\",\r\n        controllerGroups: [],\r\n      },\r\n    ],\r\n    patterns: [\r\n      {\r\n        name: \"Pattern 1\",\r\n        sequences: [\r\n          {\r\n            events: [],\r\n          },\r\n          {\r\n            events: [],\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n    timeline: [],\r\n  },\r\n};\r\n"],"names":["exports","Symbol","toStringTag","Object","defineProperty","value","_events","_onceEvents","on","eventName","callback","this","push","once","emit","eventData","onceCallbacks","error","console","undefined","callbacks","audioContext","AudioContext","window","webkitAudioContext","getAudioContext","latencyHint","sampleRate","prototype","navigator","mediaDevices","enumerateDevices","getAudioDevices","then","devices","log","_bpm","_scheduledEvents","_startTime","domElement","document","createElement","classList","add","playPauseButton","textContent","addEventListener","isPlaying","stop","playPause","appendChild","stopButton","bpmInput","type","parseFloat","currentTimeDisplay","currentTime","start","requestAnimationFrame","_render","bind","_update","currentBeat","source","disconnect","restart","buffer","createBuffer","createBufferSource","connect","destination","beat","bars","Math","floor","beats","timeString","toString","padStart","scheduleEventAtTime","time","emptyBuffer","onended","scheduleEventAtBeat","tagName","className","_resizing","_startX","_startY","_startWidth","_startHeight","_startTop","_startLeft","_resizeDirection","e","handle","getCurrentHandle","style","cursor","onmove","dx","clientX","dy","clientY","width","height","left","top","offsetWidth","offsetHeight","preventDefault","startResize","onrelease","stopResize","removeEventListener","direction","offsetTop","offsetLeft","rect","getBoundingClientRect","offsetX","offsetY","BaseElement","title","persistent","innerContent","_isDragging","_dragOffsetX","_dragOffsetY","_top","_left","parentElement","titlebar","scrollTop","ondrag","newTop","newLeft","body","_title","content","_closeButton","button","close","display","show","x","y","setTimeout","remove","setSize","setPosition","setTitle","SizableElement","audioClock","register","plugin","Plugins","plugins","includes","warn","get","name","find","Plugin","voices","_nextVoice","_held","_ctx","_gain","createGain","addVoice","voice","handleEvent","event","length","Instrument","_settings","_note","_frequency","settings","Error","gain","lfoNumber","envelopeNumber","detune","oscillators","loadSettings","trigger","note","velocity","pow","release","when","SynthesizerVoice","id","version","description","author","controllerGroups","DraggableWindow","Synthesizer","FMBass","triggerActive","elt","timeout","toggle","playOnClick","canvas","playBuffer","ctx","getContext","generateAudio","preview","Promise","resolve","reject","req","text","label","pitch","rate","fetch","method","JSON","stringify","headers","res","arrayBuffer","data","decodeAudioData","audioBuffer","catch","loadBuffer","channelData","getChannelData","bufferLength","sliceWidth","clearRect","beginPath","moveTo","i","lineTo","stroke","keyBinding","cutGroup","cutByGroups","_sources","pan","randomPitch","randomVelocity","startPosition","endPosition","loop","loopStart","loopEnd","_previewCanvas","AudioCanvas","_nameElement","loadSample","url","response","ok","statusText","playbackRate","random","createStereoPanner","startTime","bpm","entry","index","indexOf","splice","duration","cut","currentValue","cancelScheduledValues","setValueAtTime","exponentialRampToValueAtTime","slots","onKeyDown","container","_slotsContainer","defaultSlots","slot","SamplerSlot","InstrumentWindow","channel","each","keyCode","Sampler","instruments","patterns","sequences","timeline","tempo","serialize","map","instrument","deserialize","project","parse","inst","windows","_draggingWindow","addWindow","BOTTOM_ROW","TOP_ROW","KEY_COLORS","NOTE_NAMES","keyToNote","pressedKeys","ctrlKey","altKey","shiftKey","target","clock","update","transform","beatWidth","hide","port","events","_selected","_instrumentPanel","buttons","edit","mute","solo","_indicator","_canvas","load","sequence","playback","sourceEvent","nextLoop","tracks","trackContainer","position","pointerEvents","overflow","AudioCursor","querySelector","clientWidth","addPattern","loadProject","forEach","track","removeChild","addTrack","pattern","PatternTrack","selected","selectedTrack","removeTrack","play","scrollElement","sensitivity","linkedElements","_scrollTop","deltaY","linkElement","element","cancel","closeButton","HTMLButtonElement","okButton","cancelButton","targetObject","onsave","textInput","setAttribute","pitchSlider","min","max","step","audioCanvas","LyricCanvas","saveButton","DialogPopup","grid","item","audio","noteHeight","noteLabel","lyricLabel","gridElement","_currentNote","_dragMode","_quantize","_dragOffset","_track","previewCanvas","imageRendering","rowBackgroundCanvas","strokeStyle","lineWidth","j","row","base64","toDataURL","backgroundImage","backgroundRepeat","noteEditor","LyricEditorDialog","input","layerX","HTMLDivElement","contains","n","layerY","round","oldStart","GridItem","renderToCanvas","color","lowestNote","highestNote","padded_scale","fillStyle","fillRect","ScrollPanel","keys","redraw","key","innerHTML","backgroundColor","reverse","cursorUpdateInterval","sideKeyboard","SideKeyboard","Grid","pianoRoll","PianoRoll","loadTrack","items","_tracks","PlaylistTrack","WindowContainer","pianoRollWindow","PianoRollWindow","patternWindow","PatternWindow","playlistWindow","PlaylistWindow","keyboard","Keyboard","AudioClock","Project","projectUI","ProjectUI"],"sourceRoot":""}