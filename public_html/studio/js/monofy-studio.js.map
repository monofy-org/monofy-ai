{"version":3,"file":"monofy-studio.js","mappings":"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","sources":["webpack://monofy/webpack/bootstrap","webpack://monofy/webpack/runtime/make namespace object","webpack://monofy/../elements/src/EventObject.ts","webpack://monofy/../elements/src/managers/AudioManager.ts","webpack://monofy/./src/elements/components/AudioClock.ts","webpack://monofy/../elements/src/elements/BaseElement.ts","webpack://monofy/./src/plugins/plugins.ts","webpack://monofy/./src/abstracts/MathHelpers.ts","webpack://monofy/./src/elements/Mixer.ts","webpack://monofy/./src/elements/Project.ts","webpack://monofy/../elements/src/elements/WindowSnapPanel.ts","webpack://monofy/../elements/src/elements/WindowContainer.ts","webpack://monofy/./src/constants.ts","webpack://monofy/./src/elements/components/Keyboard.ts","webpack://monofy/../elements/src/elements/SizableElement.ts","webpack://monofy/../elements/src/elements/DraggableWindow.ts","webpack://monofy/./src/elements/components/MixerChannelStrip.ts","webpack://monofy/./src/elements/windows/MixerWindow.ts","webpack://monofy/../elements/src/elements/SelectableGroup.ts","webpack://monofy/./src/elements/components/AudioCursor.ts","webpack://monofy/../elements/src/animation.ts","webpack://monofy/../elements/src/elements/SelectableElement.ts","webpack://monofy/./src/elements/components/PatternTrack.ts","webpack://monofy/./src/elements/windows/PatternWindow.ts","webpack://monofy/./src/abstracts/GraphicsHelpers.ts","webpack://monofy/../elements/src/elements/ScrollPanel.ts","webpack://monofy/../elements/src/elements/AudioCanvas.ts","webpack://monofy/./src/elements/components/LyricCanvas.ts","webpack://monofy/../elements/src/elements/DialogPopup.ts","webpack://monofy/./src/elements/audioDialogs.ts","webpack://monofy/./src/elements/components/Grid.ts","webpack://monofy/./src/elements/components/SideKeyboard.ts","webpack://monofy/./src/elements/components/PianoRoll.ts","webpack://monofy/./src/elements/windows/PianoRollWindow.ts","webpack://monofy/../elements/src/elements/ContextMenu.ts","webpack://monofy/./src/elements/PlaylistSourceItem.ts","webpack://monofy/./src/elements/components/PlaylistTrack.ts","webpack://monofy/./src/elements/components/Playlist.ts","webpack://monofy/./src/elements/windows/PlaylistWindow.ts","webpack://monofy/./src/elements/ProjectUI.ts","webpack://monofy/../elements/src/elements/DraggableNumber.ts","webpack://monofy/./src/abstracts/InstrumentWindow.ts","webpack://monofy/./src/abstracts/Instrument.ts","webpack://monofy/./src/abstracts/Synthesizer.ts","webpack://monofy/./src/abstracts/SynthesizerVoice.ts","webpack://monofy/./src/elements/components/Slider.ts","webpack://monofy/./src/elements/components/Envelope.ts","webpack://monofy/./src/plugins/fmbass/FMBass.ts","webpack://monofy/./src/elements/components/SamplerSlot.ts","webpack://monofy/./src/plugins/sampler/Sampler.ts","webpack://monofy/./src/index.ts","webpack://monofy/./src/schema.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { BaseElement } from \"./elements/BaseElement\";\r\n\r\nexport interface IBaseEvent {\r\n  target: BaseElement;\r\n  event: PointerEvent;\r\n}\r\n\r\nexport interface IDragEvent extends IBaseEvent {\r\n  top: number;\r\n  left: number;\r\n  deltaX: number;\r\n  deltaY: number;\r\n}\r\n\r\nexport interface IResizeEvent extends IBaseEvent {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface EventDataMap {\r\n  cancel: unknown;\r\n  start: unknown;\r\n  stop: unknown;\r\n  pause: unknown;\r\n  result: unknown;\r\n  update: unknown;\r\n  open: unknown;\r\n  close: unknown;\r\n  edit: unknown;\r\n  release: unknown;\r\n  resize: IResizeEvent;\r\n  select: IBaseEvent;\r\n  scroll: WheelEvent;\r\n  add: unknown;\r\n  remove: unknown;\r\n  change: unknown;\r\n  drag: IDragEvent;\r\n}\r\n\r\nexport type BaseEvent = keyof EventDataMap;\r\n\r\nexport default abstract class EventObject<E extends BaseEvent = BaseEvent> {\r\n  private _events: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n  private _onceEvents: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n\r\n  on(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._events[eventName]) {\r\n      this._events[eventName] = [];\r\n    }\r\n    this._events[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  once(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._onceEvents[eventName]) {\r\n      this._onceEvents[eventName] = [];\r\n    }\r\n    this._onceEvents[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  emit(eventName: E, eventData?: unknown) {\r\n    const onceCallbacks = this._onceEvents[eventName];\r\n    if (onceCallbacks) {\r\n      for (const callback of onceCallbacks) {\r\n        try {\r\n          callback(eventData as EventDataMap[E]);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .once callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n      this._onceEvents[eventName] = undefined;\r\n    }\r\n\r\n    const callbacks = this._events[eventName];\r\n    if (callbacks) {\r\n      for (const callback of callbacks) {\r\n        try {\r\n          callback(eventData as EventDataMap[E]);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .on callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","let audioContext: AudioContext | null = null;\r\n\r\nconst AudioContext = window.AudioContext || (window as any).webkitAudioContext;\r\n\r\nexport function getAudioContext() {\r\n  if (!audioContext) {\r\n    audioContext = new AudioContext({\r\n      latencyHint: \"interactive\",\r\n      sampleRate: 44100,\r\n    });\r\n    getAudioDevices().then((devices) => {\r\n      console.log(\"Audio devices\", devices);\r\n    });\r\n    console.log(\"Audio context created\");\r\n    return audioContext;\r\n  }\r\n  return audioContext;\r\n}\r\n\r\nexport async function getAudioDevices() {\r\n  if (\"setSinkId\" in AudioContext.prototype) {\r\n    const devices = await navigator.mediaDevices.enumerateDevices();\r\n    return devices;\r\n  }\r\n  return null;\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\n\r\n/**\r\n * Represents an audio clock that provides functionality for controlling audio playback and scheduling events.\r\n */\r\nexport class AudioClock extends EventObject<\r\n  \"start\" | \"stop\" | \"pause\" | \"update\"\r\n> {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly bpmInput: HTMLInputElement;\r\n  readonly playPauseButton: HTMLButtonElement;\r\n  readonly stopButton: HTMLButtonElement;\r\n  readonly currentTimeDisplay: HTMLSpanElement;\r\n  private _playbackMode: \"pattern\" | \"playlist\" = \"pattern\";\r\n  private _audioContext: AudioContext | null = null;\r\n  private _bpm: number = 100;\r\n  private _scheduledEvents: {\r\n    source: AudioBufferSourceNode;\r\n    time: number;\r\n    callback: () => void;\r\n  }[] = [];\r\n  private _startTime: number | null = null;\r\n\r\n  get startTime(): number | null {\r\n    return this._startTime;\r\n  }\r\n\r\n  get currentTime(): number {\r\n    return this.audioContext.currentTime;\r\n  }\r\n\r\n  get audioContext(): AudioContext {\r\n    if (!this._audioContext) {\r\n      this._audioContext = getAudioContext();\r\n    }\r\n    return this._audioContext;\r\n  }\r\n\r\n  get currentBeat(): number {\r\n    const elapsedTime =\r\n      this._startTime !== null\r\n        ? this.audioContext.currentTime - this._startTime\r\n        : 0;\r\n    return elapsedTime * (this._bpm / 60);\r\n  }\r\n\r\n  get isPlaying(): boolean {\r\n    return this._startTime != null && this._startTime >= 0;\r\n  }\r\n\r\n  get bpm(): number {\r\n    return this._bpm;\r\n  }\r\n\r\n  get playbackMode(): \"pattern\" | \"playlist\" {\r\n    return this._playbackMode;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-clock\");\r\n\r\n    this.playPauseButton = document.createElement(\"button\");\r\n    this.playPauseButton.classList.add(\"audio-clock-play-pause\");\r\n    this.playPauseButton.textContent = \"Play\";\r\n\r\n    this.playPauseButton.addEventListener(\"click\", () => {\r\n      if (this.isPlaying) {\r\n        this.stop();\r\n      } else {\r\n        getAudioContext();\r\n        this.playPause();\r\n      }\r\n    });\r\n    this.domElement.appendChild(this.playPauseButton);\r\n    this.stopButton = document.createElement(\"button\");\r\n    this.stopButton.classList.add(\"audio-clock-stop\");\r\n    this.stopButton.textContent = \"Stop\";\r\n\r\n    this.stopButton.addEventListener(\"click\", () => {\r\n      this.stop();\r\n    });\r\n    this.domElement.appendChild(this.stopButton);\r\n\r\n    this.bpmInput = document.createElement(\"input\");\r\n    this.bpmInput.classList.add(\"audio-clock-bpm\");\r\n    this.bpmInput.type = \"number\";\r\n    this.bpmInput.value = \"120\";\r\n\r\n    this.bpmInput.addEventListener(\"input\", () => {\r\n      this._bpm = parseFloat(this.bpmInput.value);\r\n    });\r\n    this.domElement.appendChild(this.bpmInput);\r\n\r\n    this.currentTimeDisplay = document.createElement(\"span\");\r\n    this.currentTimeDisplay.classList.add(\"audio-clock-time\");\r\n    this.currentTimeDisplay.textContent = \"01:1\";\r\n\r\n    this.domElement.appendChild(this.currentTimeDisplay);\r\n  }\r\n\r\n  start(): void {\r\n    this._startTime = this.audioContext.currentTime;\r\n    console.log(\"Started at\", this._startTime);\r\n    requestAnimationFrame(this._render.bind(this));\r\n    this.emit(\"start\");\r\n  }\r\n\r\n  private _render(): void {\r\n    this._update(this.currentBeat);\r\n    this.emit(\"update\");\r\n    if (this.isPlaying) requestAnimationFrame(this._render.bind(this));\r\n  }\r\n\r\n  stop(): void {\r\n    this.emit(\"stop\");\r\n    this._startTime = null;\r\n\r\n    for (const { source } of this._scheduledEvents) {\r\n      source.stop();\r\n      source.disconnect();\r\n    }\r\n    this._scheduledEvents = [];\r\n\r\n    this._update(this.currentBeat);\r\n    this.playPauseButton.textContent = \"Play\";\r\n  }\r\n\r\n  restart() {\r\n    if (this.isPlaying) {\r\n      this._startTime = this.audioContext.currentTime;\r\n    }\r\n  }\r\n\r\n  playPause(): void {\r\n    if (this.isPlaying) {\r\n      this.stop(); // TODO: This should be a pause\r\n    } else {\r\n      const buffer = this.audioContext.createBuffer(\r\n        1,\r\n        1,\r\n        this.audioContext.sampleRate\r\n      );\r\n      const source = this.audioContext.createBufferSource();\r\n      source.buffer = buffer;\r\n      source.connect(this.audioContext.destination);\r\n      source.start();\r\n\r\n      this.start();\r\n    }\r\n    this.playPauseButton.textContent = this.isPlaying ? \"Pause\" : \"Play\";\r\n  }\r\n\r\n  private _update(beat: number): void {\r\n    const bars = Math.floor(beat / 4) + 1;\r\n    const beats = Math.floor(beat % 4) + 1;\r\n    const timeString = `${bars\r\n      .toString()\r\n      .padStart(2, \"0\")}:${beats.toString()}`;\r\n    this.currentTimeDisplay.textContent = timeString;\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtTime(callback: () => void, time: number): void {\r\n    const emptyBuffer = this.audioContext.createBuffer(\r\n      1,\r\n      1,\r\n      this.audioContext.sampleRate\r\n    );\r\n    const source = this.audioContext.createBufferSource();\r\n    source.buffer = emptyBuffer;\r\n    source.connect(this.audioContext.destination);\r\n    source.onended = () => callback();\r\n    source.start(time);\r\n    this._scheduledEvents.push({ source, time, callback });\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtBeat(callback: () => void, beat: number): void {\r\n    const time = this._startTime! + (beat / this._bpm) * 60;\r\n    this.scheduleEventAtTime(callback, time);\r\n  }\r\n}\r\n","import EventObject, { EventDataMap } from \"../EventObject\";\r\n\r\nexport abstract class BaseElement<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n> extends EventObject<T> {\r\n  readonly domElement: HTMLElement;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super();\r\n    this.domElement = document.createElement(tagName);\r\n    if (className) {\r\n      this.domElement.classList.add(className);\r\n    }\r\n  }\r\n\r\n  appendChild(child: BaseElement<keyof EventDataMap>) {\r\n    this.domElement.appendChild(child.domElement);\r\n    return this;\r\n  }\r\n\r\n  removeChild(child: BaseElement<keyof EventDataMap>) {\r\n    this.domElement.removeChild(child.domElement);\r\n    return this;\r\n  }\r\n}\r\n","import type { EventDataMap } from \"../../../elements/src/EventObject\";\r\nimport { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport type { DraggableWindow } from \"../../../elements/src/elements/DraggableWindow\";\r\nimport type { Mixer } from \"../elements/Mixer\";\r\nimport type { AudioClock } from \"../elements/components/AudioClock\";\r\nimport type { ControllerGroup, IHasControls } from \"../schema\";\r\n\r\nexport abstract class Plugin\r\n  extends BaseElement<\"update\">\r\n  implements IHasControls\r\n{\r\n  abstract id: string;\r\n  abstract name: string;\r\n  abstract version: string;\r\n  abstract description: string;\r\n  abstract author: string;\r\n  abstract controllerGroups: ControllerGroup[];\r\n  abstract window: DraggableWindow<\"update\" | keyof EventDataMap>;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    readonly mixer: Mixer\r\n  ) {\r\n    console.assert(audioClock, \"audioClock is required\");\r\n    console.assert(mixer, \"mixer is required\");\r\n    super(\"div\", \"plugin-container\");\r\n  }\r\n}\r\n\r\nexport class Plugins {\r\n  private static readonly _plugins: { [key: string]: typeof Plugin } = {};\r\n\r\n  static register(name: string, plugin: typeof Plugin) {\r\n    if (this._plugins[name]) {\r\n      console.warn(\"Plugin already registered:\", plugin);\r\n      return;\r\n    }\r\n    this._plugins[name] = plugin;\r\n  }\r\n\r\n  static get<T extends Plugin>(name: string): T {\r\n    return this._plugins[name] as any as T;\r\n  }\r\n\r\n  static instantiate<T extends Plugin>(\r\n    id: string,\r\n    audioClock: AudioClock,\r\n    mixer: Mixer\r\n  ) {\r\n    return new (this.get(id) as any)(audioClock, mixer) as T;\r\n  }\r\n}\r\n","export abstract class MathHelpers {\r\n  static linearToGain(linearValue: number): number {\r\n    const clampedValue = Math.max(0, Math.min(1, linearValue));\r\n    const dBValue = clampedValue * 80 - 80;\r\n    const gain = Math.pow(10, dBValue / 20);\r\n\r\n    return gain;\r\n  }\r\n}\r\n","import { MathHelpers } from \"../abstracts/MathHelpers\";\r\nimport { IMixer, IMixerChannel } from \"../schema\";\r\n\r\nexport class MixerChannel implements IMixerChannel {\r\n  gainNode: GainNode;\r\n  mute = false;\r\n  solo = false;\r\n\r\n  get gain() {\r\n    return this.gainNode.gain.value;\r\n  }\r\n\r\n  constructor(\r\n    readonly audioContext: AudioContext,\r\n    public label: string,\r\n    gain = 1,\r\n    readonly outputs: number[] = [0]\r\n  ) {\r\n    this.gainNode = audioContext.createGain();\r\n    this.gainNode.gain.value = MathHelpers.linearToGain(gain);\r\n  }\r\n}\r\n\r\nexport class Mixer implements IMixer {\r\n  channels: MixerChannel[] = [];\r\n\r\n  constructor(readonly audioContext: AudioContext) {\r\n    const master = new MixerChannel(audioContext, \"Master\", 1);\r\n    master.gainNode.connect(audioContext.destination);\r\n    this.channels.push(master);\r\n    for (let i = 1; i <= 16; i++) {\r\n      const channel = new MixerChannel(audioContext, i.toString());\r\n      channel.gainNode.connect(master.gainNode);\r\n      this.channels.push(channel);\r\n    }\r\n  }\r\n}\r\n","import EventObject from \"../../../elements/src/EventObject\";\r\nimport { Instrument } from \"../abstracts/Instrument\";\r\nimport { Plugins } from \"../plugins/plugins\";\r\nimport { IPattern, IPlaylist, IProject, ITrackOptions } from \"../schema\";\r\nimport { IInstrument } from \"./IInstrument\";\r\nimport { Mixer } from \"./Mixer\";\r\nimport { AudioClock } from \"./components/AudioClock\";\r\n\r\nexport class Project extends EventObject<\"update\"> implements IProject {\r\n  title = \"Untitled\";\r\n  description = \"\";\r\n  tempo = 120;\r\n  instruments: Instrument[] = [];\r\n  patterns: IPattern[] = [];\r\n  tracks: ITrackOptions[] = [];\r\n  playlist: IPlaylist = { events: [] };\r\n  readonly mixer: Mixer;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    project?: IProject\r\n  ) {\r\n    super();\r\n    if (project) {\r\n      setTimeout(() => {\r\n        this.load(project);\r\n      }, 0);\r\n    }\r\n\r\n    this.mixer = new Mixer(audioClock.audioContext);\r\n\r\n    audioClock.on(\"start\", () => {\r\n      console.log(\"DEBUG START\", this.playlist);\r\n      for (const event of this.playlist.events) {        \r\n        // const e = event.value as IPattern;\r\n        console.log(\"DEBUG ITEM\", event.start, event);\r\n      }\r\n    });\r\n  }\r\n\r\n  serialize(): string {\r\n    return JSON.stringify({\r\n      title: this.title,\r\n      description: this.description,\r\n      tempo: this.tempo,\r\n      instruments: this.instruments.map((instrument) => {\r\n        return {\r\n          name: instrument.name,\r\n          controllerGroups: instrument.controllerGroups,\r\n        };\r\n      }),\r\n      patterns: this.patterns,\r\n      timeline: this.playlist,\r\n    });\r\n  }\r\n\r\n  deserialize(data: string): void {\r\n    console.log(\"Project deserialize\", data);\r\n    const project = JSON.parse(data) as IProject;\r\n\r\n    // TODO error checking\r\n\r\n    this.load(project);\r\n  }\r\n\r\n  load(project: IProject): void {\r\n    console.log(\"Project load\", project);\r\n\r\n    this.title = project.title;\r\n    this.description = project.description;\r\n    this.tempo = project.tempo;\r\n    this.patterns = project.patterns;\r\n    this.playlist = project.playlist;\r\n    this.instruments = [];\r\n\r\n    for (const instrument of project.instruments as IInstrument[]) {\r\n      console.log(\"loading instrument\", instrument);\r\n      const T = Plugins.get(instrument.id);\r\n      const instance: typeof T = Plugins.instantiate<typeof T>(\r\n        instrument.id,\r\n        this.audioClock,\r\n        this.mixer\r\n      );\r\n      this.instruments.push(instance as Instrument);\r\n    }\r\n\r\n    console.log(\"emitting update...\");\r\n    this.emit(\"update\", { type: \"project\", value: this });\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\nimport type { WindowContainer } from \"./WindowContainer\";\r\n\r\nexport class WindowSnapPanel extends BaseElement<\"open\" | \"close\"> {\r\n  private _isOpen = false;\r\n\r\n  get isOpen() {\r\n    return this._isOpen;\r\n  }\r\n\r\n  constructor(readonly container: WindowContainer) {\r\n    super(\"div\", \"window-snap-panel\");\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.toggle();\r\n    });\r\n  }\r\n\r\n  open() {\r\n    if (!this._isOpen) {\r\n      this.domElement.classList.toggle(\"open\", true);\r\n      this._isOpen = true;\r\n      this.emit(\"open\");\r\n    }\r\n  }\r\n\r\n  close() {\r\n    if (this._isOpen) {\r\n      this.domElement.classList.toggle(\"open\", false);\r\n      this._isOpen = false;\r\n      this.emit(\"close\");\r\n    }\r\n  }\r\n\r\n  toggle() {\r\n    if (this._isOpen) {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap, IDragEvent, IResizeEvent } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\nimport { DraggableWindow } from \"./DraggableWindow\";\r\nimport { WindowSnapPanel } from \"./WindowSnapPanel\";\r\n\r\nexport class WindowContainer extends BaseElement<\"update\"> {\r\n  private _activeWindow: DraggableWindow | null = null;\r\n\r\n  readonly windows: DraggableWindow<keyof EventDataMap>[] = [];\r\n  private _draggingWindow: DraggableWindow | null = null;\r\n  private _bottomPanel: WindowSnapPanel;\r\n  private _leftPanel: WindowSnapPanel;\r\n  private _rightPanel: WindowSnapPanel;\r\n  private _workspace: HTMLElement;\r\n\r\n  constructor() {\r\n    super(\"div\", \"window-container\");\r\n    //this.domElement.addEventListener(\"pointerdown\", () => {});\r\n\r\n    const topRow = document.createElement(\"div\");\r\n    topRow.classList.add(\"window-snap-row\");\r\n    this.domElement.appendChild(topRow);\r\n\r\n    const bottomRow = document.createElement(\"div\");\r\n    bottomRow.classList.add(\"window-snap-row\");\r\n    bottomRow.classList.add(\"bottom-row\");\r\n    this.domElement.appendChild(bottomRow);\r\n\r\n    this._leftPanel = new WindowSnapPanel(this);\r\n    topRow.appendChild(this._leftPanel.domElement);\r\n\r\n    this._workspace = document.createElement(\"div\");\r\n    this._workspace.classList.add(\"window-container-workspace\");\r\n    topRow.appendChild(this._workspace);\r\n\r\n    this._rightPanel = new WindowSnapPanel(this);\r\n    topRow.appendChild(this._rightPanel.domElement);\r\n\r\n    this._bottomPanel = new WindowSnapPanel(this);\r\n    bottomRow.appendChild(this._bottomPanel.domElement);\r\n  }\r\n\r\n  private _handleWindowDrag(e: IDragEvent) {\r\n    // console.log(\"drag\", e);\r\n    const elt = e.target.domElement;\r\n    const workspaceWidth = this._workspace.getBoundingClientRect().width;\r\n    if (elt.parentElement === this._workspace) {\r\n      const leftPanelWidth =\r\n        this._leftPanel.domElement.getBoundingClientRect().width;\r\n      if (e.event.clientX <= Math.max(0, leftPanelWidth)) {\r\n        const panelWidth = leftPanelWidth || 300;\r\n        this._leftPanel.domElement.appendChild(elt);\r\n        elt.style.width = `${panelWidth}px`;\r\n        elt.style.height = \"unset\";\r\n        elt.classList.toggle(\"snap\", true);\r\n      } else {\r\n        const rightPanelWidth =\r\n          this._rightPanel.domElement.getBoundingClientRect().width;\r\n        if (\r\n          e.event.clientX + Math.max(250, rightPanelWidth) >\r\n          workspaceWidth + rightPanelWidth + leftPanelWidth\r\n        ) {\r\n          const panelWidth = rightPanelWidth || 300;\r\n          this._rightPanel.domElement.appendChild(elt);\r\n          elt.style.width = `${panelWidth}px`;\r\n          elt.style.height = \"unset\";\r\n          elt.classList.toggle(\"snap\", true);\r\n        }\r\n      }\r\n    } else {\r\n      if (\r\n        elt.parentElement === this._leftPanel.domElement &&\r\n        (e.event.target as HTMLElement) === this._workspace\r\n      ) {\r\n        this._workspace.appendChild(elt);\r\n        elt.classList.toggle(\"snap\", false);\r\n        elt.style.left = e.event.clientX + \"px\";\r\n        const win = e.target as DraggableWindow;\r\n        win.resetDragOffset();\r\n        win.setSize(win.options.width!, win.options.height!);\r\n      } else if (\r\n        elt.parentElement === this._rightPanel.domElement &&\r\n        (e.event.target as HTMLElement) === this._workspace\r\n      ) {\r\n        this._workspace.appendChild(elt);\r\n        elt.classList.toggle(\"snap\", false);\r\n        elt.style.left = workspaceWidth + \"px\";\r\n        const win = e.target as DraggableWindow;\r\n        win.resetDragOffset();\r\n        win.setSize(win.options.width!, win.options.height!);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _handleWindowResize(e: IResizeEvent) {\r\n    for (const win of this.windows) {\r\n      if (\r\n        win.domElement !== e.target.domElement &&\r\n        win.domElement.parentElement !== this._workspace &&\r\n        win.domElement.parentElement === e.target.domElement.parentElement\r\n      ) {\r\n        win.domElement.style.width = `${e.width}px`;\r\n      }\r\n    }\r\n  }\r\n\r\n  addWindow<T extends DraggableWindow>(window: T) {\r\n    if (this.windows.includes(window)) {\r\n      console.warn(\"Window already added\", window);\r\n      return;\r\n    }\r\n    window.on(\"drag\", (e) => this._handleWindowDrag(e as IDragEvent));\r\n    window.on(\"resize\", (e) => this._handleWindowResize(e as IResizeEvent));\r\n    this.windows.push(window);\r\n    this._workspace.appendChild(window.domElement);\r\n    if (!this._activeWindow) {\r\n      this._activeWindow = window;\r\n      this.activateWindow(window);\r\n    }\r\n\r\n    window.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.activateWindow(window);\r\n    });\r\n\r\n    window.on(\"open\", () => {\r\n      this.activateWindow(window);\r\n    });\r\n\r\n    window.on(\"close\", () => {\r\n      if (this._activeWindow === window) {\r\n        this._activeWindow = null;\r\n      }\r\n    });\r\n  }\r\n\r\n  activateWindow(window: DraggableWindow) {\r\n    if (this._activeWindow === window) {\r\n      return;\r\n    }\r\n\r\n    this._activeWindow = window;\r\n\r\n    for (const w of this.windows) {\r\n      w.domElement.classList.toggle(\"active\", w === window);\r\n      w.domElement.style.zIndex = w === window ? \"1\" : \"0\";\r\n    }\r\n  }\r\n}\r\n","export const DEFAULT_NOTE_HEIGHT = 20;\r\n\r\nexport const BOTTOM_ROW = [\r\n  90, 83, 88, 68, 67, 86, 71, 66, 72, 78, 74, 77, 188, 76, 190, 59, 191,\r\n];\r\n\r\nexport const TOP_ROW = [\r\n  81, 50, 87, 51, 69, 82, 53, 84, 54, 89, 55, 85, 73, 57, 79, 48, 80, 219, 61,\r\n  221,\r\n];\r\n\r\nexport const KEY_COLORS = [\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n];\r\n\r\nexport const NOTE_NAMES = [\r\n  \"A\",\r\n  \"A#\",\r\n  \"B\",\r\n  \"C\",\r\n  \"C#\",\r\n  \"D\",\r\n  \"D#\",\r\n  \"E\",\r\n  \"F\",\r\n  \"F#\",\r\n  \"G\",\r\n  \"G#\",\r\n];\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { BOTTOM_ROW, TOP_ROW } from \"../../constants\";\r\n\r\nexport interface IKeyboardEvent {\r\n  type: \"press\" | \"release\";\r\n  note: number;\r\n}\r\n\r\nfunction keyToNote(keyCode: number) {\r\n  let note = -1;\r\n\r\n  if (BOTTOM_ROW.includes(keyCode)) {\r\n    note = BOTTOM_ROW.indexOf(keyCode);\r\n  } else if (TOP_ROW.includes(keyCode)) {\r\n    note = TOP_ROW.indexOf(keyCode) + 12;\r\n  }\r\n\r\n  return note;\r\n}\r\n\r\nexport class Keyboard extends BaseElement<\"update\"> {\r\n  constructor() {\r\n    super(\"div\", \"keyboard\");\r\n\r\n    const pressedKeys: number[] = [];\r\n\r\n    window.addEventListener(\"keydown\", (event) => {\r\n      //console.log(event.key, event.keyCode);\r\n\r\n      if (event.ctrlKey || event.altKey || event.shiftKey) return;\r\n\r\n      const target = event.target as HTMLElement;\r\n      if (target.tagName == \"INPUT\") return;\r\n\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || pressedKeys.includes(note)) return;\r\n\r\n      pressedKeys.push(note);\r\n      this.emit(\"update\", { type: \"press\", note });\r\n    });\r\n\r\n    window.addEventListener(\"keyup\", (event) => {\r\n\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || !pressedKeys.includes(note)) return;      \r\n\r\n      pressedKeys.splice(pressedKeys.indexOf(note), 1);\r\n      this.emit(\"update\", { type: \"release\", note });\r\n    });\r\n  }\r\n}\r\n","import { EventDataMap, IResizeEvent } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class SizableElement<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"resize\" | T> {\r\n  private _resizing = false;\r\n  private _startX = 0;\r\n  private _startY = 0;\r\n  private _startWidth = 0;\r\n  private _startHeight = 0;\r\n  private _startTop = 0;\r\n  private _startLeft = 0;\r\n\r\n  private _resizeDirection: \"top\" | \"right\" | \"bottom\" | \"left\" | null = null;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super(tagName, className);\r\n\r\n    this.domElement.addEventListener(\"pointermove\", (e) => {\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle === \"top\" || handle === \"bottom\") {\r\n        this.domElement.style.cursor = \"ns-resize\";\r\n      } else if (handle === \"left\" || handle === \"right\") {\r\n        this.domElement.style.cursor = \"ew-resize\";\r\n      } else {\r\n        this.domElement.style.cursor = \"auto\";\r\n      }\r\n    });\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      if (this._resizing) {\r\n        console.log(this._resizeDirection);\r\n\r\n        const dx = e.clientX - this._startX;\r\n        const dy = e.clientY - this._startY;\r\n\r\n        if (this._resizeDirection === \"right\") {\r\n          this.domElement.style.width = `${this._startWidth + dx}px`;\r\n        } else if (this._resizeDirection === \"bottom\") {\r\n          this.domElement.style.height = `${this._startHeight + dy}px`;\r\n        } else if (this._resizeDirection === \"left\") {\r\n          this.domElement.style.width = `${this._startWidth - dx}px`;\r\n          this.domElement.style.left = `${this._startLeft + dx}px`;\r\n        } else if (this._resizeDirection === \"top\") {\r\n          this.domElement.style.height = `${this._startHeight - dy}px`;\r\n          this.domElement.style.top = `${this._startTop + dy}px`;\r\n        }\r\n\r\n        const event: IResizeEvent = {\r\n          target: this,\r\n          width: this.domElement.offsetWidth,\r\n          height: this.domElement.offsetHeight,\r\n          event: e,\r\n        };\r\n        this.emit(\"resize\", event);\r\n      }\r\n    };\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      if (e.button !== 0) return;\r\n      //if (e.target !== this.domElement) return;\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle) {\r\n        window.addEventListener(\"pointermove\", onmove);\r\n        this.startResize(e, handle);\r\n        e.preventDefault();\r\n      }\r\n      const onrelease = () => {\r\n        this.stopResize();\r\n        window.removeEventListener(\"pointermove\", onmove);\r\n        window.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      window.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n  }\r\n\r\n  protected startResize(\r\n    e: PointerEvent,\r\n    direction: \"top\" | \"right\" | \"bottom\" | \"left\"\r\n  ) {\r\n    console.log(\"startResize\", direction);\r\n    this._resizing = true;\r\n    this._startX = e.clientX;\r\n    this._startY = e.clientY;\r\n    this._startWidth = this.domElement.offsetWidth;\r\n    this._startHeight = this.domElement.offsetHeight;\r\n    this._startTop = this.domElement.offsetTop;\r\n    this._startLeft = this.domElement.offsetLeft;\r\n    this._resizeDirection = direction;\r\n  }\r\n\r\n  protected stopResize() {\r\n    this._resizing = false;\r\n    this._resizeDirection = null;\r\n  }\r\n\r\n  getCurrentHandle(e: PointerEvent) {\r\n    const rect = this.domElement.getBoundingClientRect();\r\n    const offsetX = e.clientX - rect.left;\r\n    const offsetY = e.clientY - rect.top;\r\n\r\n    if (offsetX > 0 && offsetX < 8) {\r\n      return \"left\";\r\n    } else if (rect.width - offsetX < 8) {\r\n      return \"right\";\r\n    } else if (offsetY > 0 && offsetY < 8) {\r\n      return \"top\";\r\n    } else if (rect.height - offsetY < 8) {\r\n      return \"bottom\";\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { EventDataMap, IDragEvent, IResizeEvent } from \"../EventObject\";\r\nimport { SizableElement } from \"./SizableElement\";\r\n\r\nexport interface IWindowOptions {\r\n  title: string;\r\n  content?: HTMLElement;\r\n  persistent?: boolean;\r\n  width?: number;\r\n  height?: number;\r\n  top?: number;\r\n  left?: number;\r\n}\r\n\r\ntype WindowEvents = \"update\" | \"resize\" | \"open\" | \"close\" | \"drag\";\r\n\r\nexport class DraggableWindow<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n> extends SizableElement<WindowEvents | T> {\r\n  readonly titlebar: HTMLElement;\r\n  readonly content: HTMLElement;\r\n  private readonly persistent;\r\n  private readonly _title: HTMLElement;\r\n  private readonly _closeButton: HTMLButtonElement;\r\n  private _isDragging = false;\r\n  private _dragOffsetX = 0;\r\n  private _dragOffsetY = 0;\r\n  private _top = 0;\r\n  private _left = 0;\r\n\r\n  get isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(readonly options: IWindowOptions) {\r\n    super(\"div\", \"draggable-window\");\r\n\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this._top = options.top || 0;\r\n    this._left = options.left || 0;\r\n\r\n    this.persistent = options.persistent || false;\r\n\r\n    this.titlebar = document.createElement(\"div\");\r\n    this.titlebar.className = \"window-titlebar\";\r\n    this.domElement.appendChild(this.titlebar);\r\n\r\n    this.on(\"resize\", (e) => {\r\n      const event = e as IResizeEvent;\r\n      this.options.width = event.width;\r\n      this.options.height = event.height;\r\n    });\r\n\r\n    this.titlebar.addEventListener(\"pointerdown\", (e) => {\r\n      this._isDragging = true;\r\n      this._dragOffsetX =\r\n        e.clientX -\r\n        this.domElement.getBoundingClientRect().left +\r\n        this.domElement.parentElement!.getBoundingClientRect().left;\r\n      this._dragOffsetY =\r\n        e.clientY -\r\n        this.domElement.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.scrollTop;\r\n\r\n      const ondrag = (e: PointerEvent) => {\r\n        if (this._isDragging) {\r\n          let newTop = e.clientY - this._dragOffsetY;\r\n          const newLeft = e.clientX - this._dragOffsetX;\r\n\r\n          const deltaX = newLeft - this._left;\r\n          const deltaY = newTop - this._top;\r\n\r\n          if (newTop < 0) {\r\n            newTop = 0;\r\n          }\r\n\r\n          // if (newLeft < 0) {\r\n          //   newLeft = 0;\r\n          // }\r\n\r\n          this.domElement.style.top = `${newTop}px`;\r\n          this.domElement.style.left = `${newLeft}px`;\r\n\r\n          this._top = newTop;\r\n          this._left = newLeft;\r\n\r\n          const event: IDragEvent = {\r\n            target: this,\r\n            event: e,\r\n            top: newTop,\r\n            left: newLeft,\r\n            deltaX: deltaX,\r\n            deltaY: deltaY,\r\n          };\r\n\r\n          this.emit(\"drag\", event);\r\n        }\r\n      };\r\n\r\n      const onrelease = () => {\r\n        this._isDragging = false;\r\n        document.body.removeEventListener(\"pointermove\", ondrag);\r\n        document.body.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      document.body.addEventListener(\"pointermove\", ondrag);\r\n      document.body.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n\r\n    this._title = document.createElement(\"div\");\r\n    this._title.className = \"window-titlebar-title\";\r\n    this._title.textContent = options.title;\r\n    this.titlebar.appendChild(this._title);\r\n\r\n    this.content = document.createElement(\"div\");\r\n    this.content.className = \"window-content\";\r\n    this.domElement.appendChild(this.content);\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.className = \"window-close-button\";\r\n    this._closeButton.addEventListener(\"pointerdown\", (e) => {\r\n      if (e.button === 0) this.close();\r\n    });\r\n\r\n    this.titlebar.appendChild(this._closeButton);\r\n\r\n    const width = options.width || 640;\r\n    const height = options.height || 400;\r\n    this.setSize(width, height);\r\n\r\n    if (options.content) this.content.appendChild(options.content);\r\n  }\r\n\r\n  resetDragOffset() {\r\n    const rect = this.domElement.parentElement!.getBoundingClientRect();\r\n    this._dragOffsetX = rect.left + 100;\r\n    this._dragOffsetY = rect.top + 10;\r\n  }\r\n\r\n  show(x?: number, y?: number) {\r\n    if (x === undefined) x = this._left;\r\n    if (y === undefined) y = this._top;\r\n\r\n    this._top = y;\r\n    this._left = x;\r\n\r\n    if (this._top === 0 && this._left === 0) {\r\n      x = window.innerWidth / 2 - 200;\r\n      y = window.innerHeight / 4;\r\n    }\r\n\r\n    this.domElement.style.display = \"flex\";\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n\r\n    setTimeout(() => {\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n      this.emit(\"open\");\r\n    }, 1);\r\n  }\r\n\r\n  close() {\r\n    this.domElement.style.display = \"none\";\r\n    this.emit(\"close\");\r\n    if (!this.persistent) {\r\n      console.log(\"Removing window\", this);\r\n      this.domElement.remove();\r\n    }\r\n  }\r\n\r\n  setSize(width: number, height: number) {\r\n    this.options.width = width;\r\n    this.options.height = height;\r\n    this.domElement.style.width = `${width}px`;\r\n    this.domElement.style.height = `${height}px`;\r\n  }\r\n\r\n  setPosition(x: number, y: number) {\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this._title.textContent = title;\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { IMixerChannel } from \"../../schema\";\r\n\r\nexport class MixerChannelStrip extends BaseElement<\"change\"> {\r\n  private readonly _channel: IMixerChannel;\r\n  private readonly _volume: HTMLInputElement;\r\n  private readonly _mute: HTMLInputElement;\r\n  private readonly _solo: HTMLInputElement;\r\n  private readonly _label: HTMLSpanElement;\r\n\r\n  get channel() {\r\n    return this._channel;\r\n  }\r\n\r\n  get volume() {\r\n    return this._volume.valueAsNumber;\r\n  }\r\n\r\n  set volume(value: number) {\r\n    this._volume.value = value.toString();\r\n  }\r\n\r\n  get mute() {\r\n    return this._mute.checked;\r\n  }\r\n\r\n  set mute(value: boolean) {\r\n    this._mute.checked = value;\r\n  }\r\n\r\n  get solo() {\r\n    return this._solo.checked;\r\n  }\r\n\r\n  set solo(value: boolean) {\r\n    this._solo.checked = value;\r\n  }\r\n\r\n  constructor(\r\n    channel: IMixerChannel,    \r\n    readonly isMaster = false,\r\n  ) {\r\n    super(\"div\", \"mixer-channel\");\r\n\r\n    this._channel = channel;\r\n\r\n    this._label = document.createElement(\"span\");\r\n    this._label.textContent = channel.label;\r\n    this.domElement.appendChild(this._label);\r\n\r\n    const volume = document.createElement(\"input\");\r\n    volume.type = \"range\";\r\n    volume.min = \"0\";\r\n    volume.max = \"1.2\";\r\n    volume.step = \"0.01\";\r\n    volume.value = \"1\";\r\n\r\n    const mute = document.createElement(\"input\");\r\n    mute.type = \"checkbox\";\r\n\r\n    const solo = document.createElement(\"input\");\r\n    solo.type = \"checkbox\";\r\n\r\n    this._volume = volume;\r\n    this._mute = mute;\r\n    this._solo = solo;\r\n\r\n    this.domElement.appendChild(volume);\r\n    this.domElement.appendChild(mute);\r\n    this.domElement.appendChild(solo);\r\n\r\n    volume.addEventListener(\"input\", () => {\r\n      this.emit(\"change\");\r\n    });\r\n\r\n    mute.addEventListener(\"change\", () => {\r\n      this.emit(\"change\");\r\n    });\r\n\r\n    solo.addEventListener(\"change\", () => {\r\n      this.emit(\"change\");\r\n    });\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport type { ProjectUI } from \"../ProjectUI\";\r\nimport { MixerChannelStrip } from \"../components/MixerChannelStrip\";\r\n\r\nexport class MixerWindow extends DraggableWindow {\r\n  get mixer() {\r\n    return this.ui.project.mixer;\r\n  }\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    super({\r\n      title: \"Mixer\",\r\n      persistent: true,\r\n      content: document.createElement(\"div\"),\r\n      width: 500,\r\n      height: 300,\r\n    });\r\n\r\n    this.domElement.classList.add(\"mixer-window\");\r\n\r\n    const container = document.createElement(\"div\");\r\n    container.style.display = \"flex\";\r\n    container.style.width = \"100%\";\r\n    container.style.height = \"100%\";\r\n    container.style.overflowX = \"auto\";\r\n\r\n    this.content.appendChild(container);\r\n\r\n    console.log(\"MIXER CHANNELS DEBUG\", this.mixer.channels);\r\n\r\n    for (let i = 0; i < this.mixer.channels.length; i++) {\r\n      const channel = new MixerChannelStrip(this.mixer.channels[i], i === 0);\r\n      this.mixer.channels[i].gainNode.gain.value = channel.volume;\r\n      channel.on(\"change\", () => {\r\n        this.mixer.channels[i].gainNode.gain.value = channel.volume;\r\n      });\r\n      container.appendChild(channel.domElement);\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\nimport { SelectableElement } from \"./SelectableElement\";\r\n\r\nexport class SelectableGroup<\r\n  T extends SelectableElement = SelectableElement,\r\n> extends BaseElement<\"select\"> {\r\n  constructor(readonly items: T[] = []) {\r\n    super(\"div\", \"selectable-group\");\r\n    for (const item of items) {\r\n      this.addSelectable(item, false);\r\n    }\r\n  }\r\n\r\n  addSelectable(selectable: T, addToDom = true) {\r\n    if (this.items.indexOf(selectable) !== -1) {\r\n      console.warn(\"Already added\", selectable);\r\n    } else {\r\n      this.items.push(selectable);\r\n      selectable.on(\"select\", () => {\r\n        this.emit(\"select\", this);\r\n      });\r\n      if (addToDom) this.domElement.appendChild(selectable.domElement);\r\n\r\n      selectable.domElement.addEventListener(\"pointerdown\", (e) => {        \r\n        if (!e.ctrlKey && !e.shiftKey) {\r\n          for (const item of this.items) {\r\n            item.selected = item === selectable;\r\n          }\r\n        } else if (e.ctrlKey) {\r\n          selectable.selected = !selectable.selected;\r\n        } else if (e.shiftKey) {\r\n          const f = this.items.find((t) => t.selected);\r\n          if (!f) {\r\n            selectable.selected = true;\r\n            return;\r\n          }\r\n          const start = this.items.indexOf(f);\r\n          const end = this.items.indexOf(selectable);\r\n          const min = Math.min(start, end);\r\n          const max = Math.max(start, end);\r\n          for (let i = min; i <= max; i++) {\r\n            this.items[i].selected = true;\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  removeSelectable(selectable: T) {\r\n    const index = this.items.indexOf(selectable);\r\n    if (index !== -1) {\r\n      this.items.splice(index, 1);\r\n      this.domElement.removeChild(selectable.domElement);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    for (const item of this.items) {\r\n      this.domElement.removeChild(item.domElement);\r\n    }\r\n    this.items.length = 0;\r\n  }\r\n}\r\n","import { AudioClock } from \"./AudioClock\";\r\n\r\nexport interface ICursorTimeline {\r\n  domElement: HTMLElement;\r\n  timeline: HTMLElement;\r\n  cursor: AudioCursor;\r\n  audioClock: AudioClock;\r\n  beatWidth: number;\r\n}\r\n\r\nexport class AudioCursor {\r\n  readonly domElement: HTMLDivElement;\r\n\r\n  constructor(readonly timeline: ICursorTimeline) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-cursor\");\r\n\r\n    const clock = timeline.audioClock;\r\n\r\n    clock.on(\"update\", () => {\r\n      this.update();\r\n    });\r\n\r\n    clock.on(\"start\", () => {\r\n      this.domElement.style.transform = \"translateX(0)\";\r\n      this.domElement.style.display = \"block\";\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n    });\r\n\r\n    clock.on(\"stop\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n  }\r\n\r\n  update() {\r\n    this.domElement.style.transform = `translateX(${\r\n      this.timeline.audioClock.currentBeat * this.timeline.beatWidth\r\n    }px)`;\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","export async function triggerActive(elt: HTMLElement, timeout = 100) {  \r\n  elt.classList.toggle(\"active\", true);\r\n  setTimeout(() => {\r\n    elt.classList.toggle(\"active\", false);\r\n  }, timeout);\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\nimport { SelectableGroup } from \"./SelectableGroup\";\r\n\r\nexport class SelectableElement extends BaseElement<\"select\" | keyof EventDataMap> {\r\n  get selected() {\r\n    return this.domElement.classList.contains(\"selected\");\r\n  }\r\n\r\n  set selected(value: boolean) {\r\n    if (value === this.selected) return;\r\n    this.domElement.classList.toggle(\"selected\", value);\r\n    this.emit(\"select\", this);\r\n  }\r\n\r\n  constructor(\r\n    readonly group: SelectableGroup<SelectableElement>,\r\n    tagName: string,\r\n    className?: string\r\n  ) {\r\n    super(tagName, className);\r\n    this.group.addSelectable(this);\r\n  }\r\n}\r\n","import { triggerActive } from \"../../../../elements/src/animation\";\r\nimport { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { SelectableElement } from \"../../../../elements/src/elements/SelectableElement\";\r\nimport type { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport type { Instrument } from \"../../abstracts/Instrument\";\r\nimport type { IEvent, ISequence } from \"../../schema\";\r\nimport type { Project } from \"../Project\";\r\nimport type { ISourceEvent } from \"./SamplerSlot\";\r\n\r\nexport class PatternTrackInstrument extends SelectableElement {\r\n  readonly indicator: HTMLDivElement;\r\n\r\n  constructor(\r\n    readonly track: PatternTrack,\r\n    buttonGroup: SelectableGroup\r\n  ) {\r\n    console.assert(track, \"PatternTrackInstrument track is null or undefined\");\r\n\r\n    super(buttonGroup, \"div\", \"pattern-track-instrument\");\r\n\r\n    this.domElement.classList.add(\"pattern-track-panel\");\r\n\r\n    const labelAndButtons = document.createElement(\"div\");\r\n    labelAndButtons.classList.add(\"pattern-track-label-and-buttons\");\r\n\r\n    const textLabel = document.createElement(\"div\");\r\n    textLabel.textContent = track.name;\r\n    labelAndButtons.appendChild(textLabel);\r\n\r\n    const buttons = document.createElement(\"div\");\r\n    buttons.classList.add(\"pattern-track-buttons\");\r\n    labelAndButtons.appendChild(buttons);\r\n\r\n    this.domElement.appendChild(labelAndButtons);\r\n\r\n    const edit = document.createElement(\"div\");\r\n    edit.classList.add(\"track-button\");\r\n    edit.classList.add(\"track-edit-button\");\r\n    edit.textContent = \"e\";\r\n    edit.addEventListener(\"pointerdown\", () => {\r\n      if (this.track.instrument.window.isVisible) {\r\n        this.track.instrument.window.close();\r\n      } else {\r\n        track.instrument.window.show();\r\n      }\r\n    });\r\n    this.track.instrument.window.on(\"close\", () => {\r\n      edit.classList.toggle(\"active\", false);\r\n    });\r\n    this.track.instrument.window.on(\"open\", () => {\r\n      edit.classList.toggle(\"active\", true);\r\n    });\r\n    buttons.appendChild(edit);\r\n\r\n    const mute = document.createElement(\"div\");\r\n    mute.classList.add(\"track-button\");\r\n    mute.classList.add(\"track-mute-button\");\r\n    mute.textContent = \"M\";\r\n    mute.addEventListener(\"pointerdown\", () => {\r\n      mute.classList.toggle(\"active\");\r\n    });\r\n    buttons.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"div\");\r\n    solo.classList.add(\"track-button\");\r\n    solo.classList.add(\"track-solo-button\");\r\n    solo.textContent = \"S\";\r\n    solo.addEventListener(\"pointerdown\", () => {\r\n      solo.classList.toggle(\"active\");\r\n    });\r\n    buttons.appendChild(solo);\r\n\r\n    buttons.appendChild(mute);\r\n    buttons.appendChild(solo);\r\n\r\n    this.indicator = document.createElement(\"div\");\r\n    this.indicator.classList.add(\"pattern-track-indicator\");\r\n    this.domElement.appendChild(this.indicator);\r\n  }\r\n}\r\n\r\nexport class PatternTrackPreview extends BaseElement {\r\n  private _canvas: HTMLCanvasElement;\r\n\r\n  get canvas() {\r\n    return this._canvas;\r\n  }\r\n\r\n  constructor(readonly track: PatternTrack) {\r\n    console.assert(track, \"PatternTrackPreview track is null or undefined\");\r\n\r\n    super(\"div\", \"pattern-track-preview\");\r\n    this._canvas = document.createElement(\"canvas\");\r\n    this._canvas.height = 60;\r\n    this._canvas.width = 1280;\r\n    this._canvas.classList.add(\"pattern-track-pattern\");\r\n\r\n    this.domElement.append(this._canvas);\r\n  }\r\n}\r\n\r\nexport class PatternTrack extends BaseElement implements ISequence {\r\n  readonly button: PatternTrackInstrument;\r\n  readonly preview: PatternTrackPreview;\r\n  port: number | null = null;\r\n  channel: number = 0;  \r\n\r\n  get name() {\r\n    return this.instrument.name;\r\n  }\r\n\r\n  constructor(\r\n    readonly project: Project,\r\n    public instrument: Instrument,\r\n    public events: IEvent[],\r\n    readonly buttonGroup: SelectableGroup,\r\n    readonly previewGroup: SelectableGroup\r\n  ) {\r\n    super(\"div\", \"pattern-track\");\r\n\r\n    this.button = new PatternTrackInstrument(this, this.buttonGroup);\r\n    this.preview = new PatternTrackPreview(this);\r\n\r\n    this.domElement.appendChild(this.button.domElement);\r\n    this.domElement.appendChild(this.preview.domElement);\r\n  }\r\n\r\n  trigger(note: number, beat: number = this.project.audioClock.currentBeat) {\r\n    const source = this.instrument.trigger(note, this.channel, beat);\r\n    if (beat > 0) {\r\n      this.project.audioClock.scheduleEventAtBeat(() => {\r\n        triggerActive(this.button.indicator);\r\n      }, beat);\r\n    } else {\r\n      triggerActive(this.button.indicator);\r\n    }\r\n    return source;\r\n  }\r\n\r\n  release(note: number, beat: number = this.project.audioClock.currentBeat) {\r\n    this.instrument.release(note, beat);\r\n  }\r\n\r\n  load(sequence: ISequence) {\r\n    this.events = sequence.events;\r\n  }\r\n\r\n  playback() {\r\n    if (!this.project.audioClock.isPlaying) {\r\n      console.warn(\"Playback cancelled\");\r\n      return;\r\n    }\r\n\r\n    let sourceEvent: ISourceEvent | undefined = undefined;\r\n\r\n    for (const event of this.events) {\r\n      if (!(event.note || event.note === 0)) {\r\n        console.warn(\"Missing note property in event object\");\r\n        continue;\r\n      }\r\n\r\n      sourceEvent = this.trigger(event.note, event.start);\r\n      if (event.domElement) {\r\n        this.project.audioClock.scheduleEventAtBeat(\r\n          () => event.domElement!.classList.toggle(\"active\", true),\r\n          event.start\r\n        );\r\n        this.project.audioClock.scheduleEventAtBeat(\r\n          () => event.domElement!.classList.toggle(\"active\", false),\r\n          event.start + event.duration\r\n        );\r\n      }\r\n    }\r\n\r\n    if (typeof sourceEvent !== \"undefined\" && \"source\" in sourceEvent) {\r\n      sourceEvent.source.onended = () => {\r\n        const nextLoop =\r\n          this.project.audioClock.currentBeat +\r\n          (4 - (this.project.audioClock.currentBeat % 4));\r\n        this.project.audioClock.scheduleEventAtBeat(() => {\r\n          this.project.audioClock.restart();\r\n          this.playback();\r\n        }, nextLoop);\r\n      };\r\n    }\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { Instrument } from \"../../abstracts/Instrument\";\r\nimport { IEvent, IPattern } from \"../../schema\";\r\nimport { Project } from \"../Project\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"../components/AudioCursor\";\r\nimport {\r\n  PatternTrack,\r\n  PatternTrackInstrument,\r\n  PatternTrackPreview,\r\n} from \"../components/PatternTrack\";\r\n\r\nexport class PatternWindow\r\n  extends DraggableWindow<\"select\" | \"edit\">\r\n  implements ICursorTimeline\r\n{\r\n  readonly trackContainer: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLDivElement;\r\n  readonly tracks: PatternTrack[] = [];\r\n  readonly patternPreviews: SelectableGroup;\r\n  readonly buttons: SelectableGroup;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.ui.project.audioClock;\r\n  }\r\n\r\n  beatWidth = 20;\r\n\r\n  constructor(public ui: ProjectUI) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"pattern-track-container\");\r\n\r\n    super({\r\n      title: \"Pattern\",\r\n      persistent: true,\r\n      content: container,\r\n      width: 400,\r\n      height: 400,\r\n    });\r\n    this.trackContainer = container;\r\n\r\n    this.timeline = this.trackContainer;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.style.marginLeft = \"150px\";\r\n    this.timeline.appendChild(this.cursor.domElement);\r\n\r\n    const canvas = this.domElement.querySelector(\"canvas\");\r\n    if (canvas) this.beatWidth = canvas.width / 16;\r\n\r\n    this.on(\"resize\", () => {\r\n      this.beatWidth = this.domElement.clientWidth / 16;\r\n    });\r\n\r\n    this.addPattern(\"Pattern 1\");\r\n\r\n    this.patternPreviews = new SelectableGroup();\r\n    this.buttons = new SelectableGroup<PatternTrackInstrument>();\r\n  }\r\n\r\n  loadProject(project: Project) {\r\n    for (const track of this.tracks) {\r\n      this.trackContainer.removeChild(track.domElement);\r\n    }\r\n    this.tracks.length = 0;\r\n    for (let i = 0; i < project.instruments.length; i++) {\r\n      const track = this.addTrack(\r\n        project.instruments[i],\r\n        project.patterns[0]?.tracks[i].events || []\r\n      );\r\n      track.load(project.patterns[0].tracks[i]);\r\n      if (i === 0) {\r\n        track.button.selected = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  addPattern(name: string) {\r\n    console.log(\"Created pattern:\", name);\r\n    const pattern: IPattern = { name, tracks: [] };\r\n    this.ui.project.patterns.push(pattern);\r\n  }\r\n\r\n  addTrack(instrument: Instrument, events: IEvent[]) {\r\n    console.log(\"Add track + instrument:\", instrument);\r\n\r\n    const track = new PatternTrack(\r\n      this.ui.project,\r\n      instrument,\r\n      events,\r\n      this.buttons,\r\n      this.patternPreviews\r\n    );\r\n\r\n    instrument.output.connect(this.ui.mixerWindow.mixer.channels[0].gainNode);\r\n\r\n    console.assert(\r\n      track.button instanceof PatternTrackInstrument,\r\n      \"button is not an instance of PatternTrackInstrument\"\r\n    );\r\n    console.assert(\r\n      track.preview instanceof PatternTrackPreview,\r\n      \"preview is not an instance of PatternTrackPreview\"\r\n    );\r\n\r\n    track.preview.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.ui.pianoRollWindow.loadTrack(track);\r\n      this.ui.pianoRollWindow.show();\r\n    });\r\n\r\n    this.tracks.push(track);\r\n    this.trackContainer.appendChild(track.domElement);\r\n\r\n    return track;\r\n  }\r\n\r\n  removeTrack(track: PatternTrack) {\r\n    const index = this.tracks.indexOf(track);\r\n    if (index !== -1) {\r\n      this.tracks.splice(index, 1);\r\n      this.trackContainer.removeChild(track.domElement);      \r\n      this.buttons.removeSelectable(track.button);\r\n    }\r\n  }\r\n\r\n  trigger(note: number, beat: number = this.audioClock.currentBeat) {\r\n    for (const track of this.tracks) {\r\n      if (track.button.selected) {\r\n        track.trigger(note, beat);\r\n      }\r\n    }\r\n  }\r\n\r\n  release(note: number, beat: number = this.audioClock.currentBeat) {\r\n    for (const track of this.tracks) {\r\n      if (track.button.selected) {\r\n        track.release(note, beat);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { IEvent, IPattern } from \"../schema\";\r\n\r\nexport abstract class GraphicsHelpers {\r\n  static renderSequence(\r\n    canvas: HTMLCanvasElement,\r\n    events: IEvent[],\r\n    color: string,\r\n    beatWidth: number,\r\n    clearFirst = true\r\n  ) {\r\n    // find lowest note\r\n    let lowestNote = 88;\r\n    let highestNote = 0;\r\n    for (const event of events) {\r\n      if (!(event.note || event.note === 0)) {\r\n        console.log(\"event\", event);\r\n        throw new Error(\"renderToCanvas() No note!\");\r\n      }\r\n      if (event.note < lowestNote) lowestNote = event.note;\r\n      if (event.note > highestNote) highestNote = event.note;\r\n    }\r\n\r\n    highestNote += 12;\r\n    lowestNote -= 12;\r\n\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n    if (clearFirst) ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    const paddedScale = Math.min(\r\n      canvas.height / (highestNote - lowestNote + 1),\r\n      2\r\n    );\r\n\r\n    for (const note of events) {\r\n      const y = canvas.height - (note.note! - lowestNote + 1) * paddedScale;\r\n      const x = note.start * beatWidth;\r\n      const width = note.duration * beatWidth;\r\n      ctx.fillStyle = color;\r\n      ctx.fillRect(x, y, width, paddedScale);\r\n    }\r\n  }\r\n\r\n  static renderPattern(\r\n    canvas: HTMLCanvasElement,\r\n    pattern: IPattern,\r\n    color: string,\r\n    beatWidth: number\r\n  ) {\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    const concat: IEvent[] = [];\r\n\r\n    for (const sequence of pattern.tracks) {\r\n      concat.push(...sequence.events);\r\n    }\r\n\r\n    GraphicsHelpers.renderSequence(canvas, concat, color, beatWidth, false);\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class ScrollPanel<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"scroll\" | T> {\r\n  sensitivity = 50;\r\n  private linkedElements: HTMLElement[] = [];\r\n  private _scrollTop = 0;\r\n\r\n  get scrollTop() {\r\n    return this._scrollTop;\r\n  }\r\n\r\n  set scrollTop(value: number) {\r\n    const top = -value;\r\n    this._scrollTop = top;\r\n    this.scrollElement.style.transform = `translateY(${top}px)`;\r\n    for (const linkedElement of this.linkedElements) {\r\n      linkedElement.style.transform = `translateY(${top}px)`;\r\n    }\r\n  }\r\n\r\n  constructor(readonly scrollElement: HTMLElement) {\r\n    super(\"div\", \"scroll-panel\");\r\n    scrollElement.classList.add(\"scroll-panel-content\");\r\n\r\n    this.scrollElement.addEventListener(\"wheel\", (e) => {\r\n      e.preventDefault();\r\n      let top =\r\n        this._scrollTop + (e.deltaY > 0 ? -this.sensitivity : this.sensitivity);\r\n      const bottom = top + this.scrollElement.offsetHeight;\r\n      if (bottom < this.domElement.offsetHeight) {\r\n        top = this.domElement.offsetHeight - this.scrollElement.offsetHeight;\r\n      } else if (top > 0) {\r\n        top = 0;\r\n      }\r\n      this._scrollTop = top;\r\n      this.scrollElement.style.transform = `translateY(${top}px)`;\r\n      for (const linkedElement of this.linkedElements) {\r\n        linkedElement.style.transform = `translateY(${top}px)`;\r\n      }\r\n\r\n      this.emit(\"scroll\", e);\r\n    });\r\n  }\r\n\r\n  linkElement(element: HTMLElement) {\r\n    this.linkedElements.push(element);\r\n    element.classList.add(\"scroll-panel-content\");\r\n  }\r\n}\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\n\r\nexport class AudioCanvas {\r\n  domElement: HTMLDivElement;\r\n  canvas: HTMLCanvasElement;\r\n  ctx: CanvasRenderingContext2D;\r\n  buffer: AudioBuffer | null = null;\r\n\r\n  constructor(width = 800, height = 200, playOnClick = true) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-canvas\");\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n    this.domElement.appendChild(this.canvas);\r\n\r\n    if (playOnClick) {\r\n      this.canvas.addEventListener(\"click\", () => {\r\n        if (this.buffer) {\r\n          this.playBuffer(this.buffer);\r\n        }\r\n      });\r\n    }\r\n\r\n    this.ctx = this.canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; note: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.note,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n\r\n  playBuffer(audioBuffer: AudioBuffer) {\r\n    const ctx = getAudioContext();\r\n    const source = ctx.createBufferSource();\r\n    source.buffer = audioBuffer;\r\n    source.connect(ctx.destination);\r\n    source.start();\r\n  }\r\n\r\n  loadBuffer(audioBuffer: AudioBuffer) {\r\n    this.buffer = audioBuffer;\r\n\r\n    const channelData = audioBuffer.getChannelData(0);\r\n    const bufferLength = channelData.length;\r\n    const sliceWidth = this.canvas.width / bufferLength;\r\n\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.canvas.height / 2);\r\n\r\n    for (let i = 0; i < bufferLength; i++) {\r\n      const x = i * sliceWidth;\r\n      const y = ((channelData[i] + 1) * this.canvas.height) / 2;\r\n\r\n      this.ctx.lineTo(x, y);\r\n    }\r\n\r\n    this.ctx.lineTo(this.canvas.width, this.canvas.height / 2);\r\n    this.ctx.stroke();\r\n  }\r\n}\r\n","import { AudioCanvas } from \"../../../../elements/src/elements/AudioCanvas\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\n\r\nexport class LyricCanvas extends AudioCanvas {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; note: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.note,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class DialogPopup extends BaseElement<\"result\" | \"cancel\"> {  \r\n  closeButton: HTMLButtonElement;\r\n  okButton: HTMLButtonElement | undefined;\r\n  cancelButton: HTMLButtonElement | undefined;\r\n\r\n  get isVisibile() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    private readonly ok: string | HTMLButtonElement = \"OK\",\r\n    private readonly cancel: string | HTMLButtonElement = \"Cancel\"\r\n  ) {\r\n    super(\"div\", \"dialog-popup\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");    \r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"pointerdown\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    if (ok instanceof HTMLButtonElement) {\r\n      this.okButton = ok;\r\n    } else if (ok) {\r\n      this.okButton = document.createElement(\"button\");\r\n      this.okButton.textContent = ok;\r\n      this.domElement.appendChild(this.okButton);\r\n    }\r\n\r\n    if (this.okButton) {\r\n      this.okButton.addEventListener(\"click\", () => {\r\n        this.emit(\"result\", this);\r\n      });\r\n    }\r\n\r\n    if (cancel instanceof HTMLButtonElement) {\r\n      this.cancelButton = cancel;\r\n    } else if (cancel) {\r\n      this.cancelButton = document.createElement(\"button\");\r\n      this.cancelButton.textContent = cancel;\r\n      this.domElement.appendChild(this.cancelButton);\r\n    }\r\n\r\n    if (this.cancelButton) {\r\n      this.cancelButton.addEventListener(\"click\", () => {\r\n        this.emit(\"cancel\", this);\r\n      });\r\n    }\r\n  }\r\n\r\n  show(x: number, y: number, targetObject?: unknown) { /* eslint-disable-line @typescript-eslint/no-unused-vars */\r\n    this.domElement.style.display = \"block\";\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","import { LyricCanvas } from \"./components/LyricCanvas\";\r\nimport { DialogPopup } from \"../../../elements/src/elements/DialogPopup\";\r\nimport { IEvent } from \"../schema\";\r\n\r\nexport class PianoRollDialog extends DialogPopup {\r\n  domElement: HTMLDivElement;\r\n  closeButton: HTMLButtonElement;\r\n  saveButton: HTMLButtonElement;\r\n  note: IEvent | null = null;\r\n\r\n  constructor(public onsave: (note: IEvent) => void) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-dialog\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");\r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"click\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    this.saveButton = document.createElement(\"button\");\r\n    this.saveButton.textContent = \"Save\";\r\n    this.domElement.appendChild(this.saveButton);\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  override show(x: number, y: number, note: IEvent) {\r\n    super.show(x, y, note);\r\n    this.note = note;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class LyricEditorDialog extends PianoRollDialog {\r\n  textInput: HTMLInputElement;\r\n  audioCanvas: LyricCanvas;  \r\n  constructor(onsave: (note: IEvent) => void) {\r\n    super(onsave);\r\n    this.domElement.classList.add(\"grid-item-editor\");\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this.textInput = document.createElement(\"input\");\r\n    this.textInput.setAttribute(\"placeholder\", \"Note lyric\");\r\n    this.textInput.classList.add(\"lyric-editor-text\");\r\n    this.textInput.type = \"text\";\r\n    this.domElement.appendChild(this.textInput);\r\n\r\n    this.audioCanvas = new LyricCanvas();\r\n    this.domElement.appendChild(this.audioCanvas.domElement);\r\n\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.audioCanvas.domElement.style.display = \"block\";\r\n      // this.audioCanvas.generateAudio(this.note!, true).then((buffer) => {\r\n      //   this.note!.audio = buffer;\r\n      // });\r\n      // this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  show(x: number, y: number, event: IEvent) {\r\n    super.show(x, y, event);\r\n    this.textInput.value = this.note?.label || \"\";\r\n    // if (this.note?.audio) {\r\n    //   this.audioCanvas.loadBuffer(this.note.audio);\r\n    //   this.audioCanvas.domElement.style.display = \"block\";\r\n    // } else {\r\n    //   this.audioCanvas.domElement.style.display = \"none\";\r\n    // }\r\n  }\r\n}\r\n","import { ScrollPanel } from \"../../../../elements/src/elements/ScrollPanel\";\r\nimport { DEFAULT_NOTE_HEIGHT, NOTE_NAMES } from \"../../constants\";\r\nimport { LyricEditorDialog } from \"../audioDialogs\";\r\nimport { IEvent, ISequence } from \"../../schema\";\r\n\r\nfunction getNoteNameFromPitch(pitch: number): string {\r\n  const note = NOTE_NAMES[pitch % NOTE_NAMES.length];\r\n  return `${note}${Math.floor(pitch / NOTE_NAMES.length)}`;\r\n}\r\n\r\nconst NOTE_HANDLE_WIDTH = 6;\r\n\r\nexport class GridItem implements IEvent {\r\n  note: number;\r\n  start: number;\r\n  duration: number;\r\n  velocity: number = 0.8;\r\n  labelElement: HTMLDivElement;\r\n  label: string | \"\" = \"\";\r\n  audio: AudioBuffer | null = null;\r\n  domElement: HTMLDivElement;\r\n\r\n  constructor(\r\n    private readonly grid: Grid,\r\n    readonly item: IEvent,\r\n    label?: string,\r\n    image?: string\r\n  ) {\r\n    const noteItem = item as IEvent;\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"grid-item\");\r\n    this.domElement.style.height = `${grid.rowHeight}px`;\r\n\r\n    this.labelElement = document.createElement(\"div\");\r\n    this.labelElement.classList.add(\"grid-item-label\");\r\n    this.domElement.appendChild(this.labelElement);\r\n\r\n    if (image) {\r\n      const image = document.createElement(\"div\");\r\n      image.classList.add(\"grid-item-image\");\r\n      image.style.backgroundImage = `url(${image})`;\r\n      this.domElement.appendChild(image);\r\n      this.domElement.classList.add(\"has-image\");\r\n    }\r\n\r\n    if (noteItem.velocity) this.velocity = noteItem.velocity;\r\n    if (noteItem.note) {\r\n      this.note = noteItem.note;\r\n      this.label = label || getNoteNameFromPitch(this.note);\r\n      this.labelElement.textContent = this.label;\r\n    } else {\r\n      this.note = 0;\r\n    }\r\n\r\n    this.start = item.start;\r\n    this.duration = item.duration;\r\n\r\n    if (item.label) this.labelElement.textContent = item.label;\r\n\r\n    console.log(\"GridItem\", this);\r\n\r\n    grid.gridElement.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class Grid extends ScrollPanel<\r\n  \"select\" | \"update\" | \"release\" | \"add\" | \"remove\"\r\n> {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly gridElement: HTMLDivElement;\r\n  readonly previewCanvas: HTMLCanvasElement;\r\n  readonly noteEditor: LyricEditorDialog;\r\n  private _currentItem: IEvent | null = null;\r\n  private _dragMode: string | null = null;\r\n  private _dragOffset: number = 0;\r\n  private _sequence: ISequence | null = null;\r\n  readonly scrollElement: HTMLDivElement;\r\n\r\n  public quantize: number = 0.25;\r\n  public drawingEnabled: boolean = true;\r\n  public drawingLabel: string | undefined = undefined;\r\n  public drawingImage: string | undefined = undefined;\r\n\r\n  constructor(\r\n    readonly rowCount = 88,\r\n    readonly beatWidth = 100,\r\n    readonly rowHeight = DEFAULT_NOTE_HEIGHT\r\n  ) {\r\n    const gridElement = document.createElement(\"div\");\r\n\r\n    super(gridElement);\r\n\r\n    this.scrollElement = gridElement;\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n\r\n    this.gridElement = gridElement;\r\n\r\n    this.domElement.classList.add(\"grid-container\");\r\n    this.gridElement.classList.add(\"grid\");\r\n\r\n    this.gridElement.addEventListener(\"dragstart\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.previewCanvas = document.createElement(\"canvas\");\r\n    this.previewCanvas.style.imageRendering = \"pixelated\";\r\n\r\n    const rowBackgroundCanvas = document.createElement(\"canvas\");\r\n    rowBackgroundCanvas.style.imageRendering = \"pixelated\";\r\n    rowBackgroundCanvas.width = this.beatWidth * 4;\r\n    rowBackgroundCanvas.height = this.rowHeight;\r\n    console.log(\"debug\", rowBackgroundCanvas.width, rowBackgroundCanvas.height);\r\n    const ctx = rowBackgroundCanvas.getContext(\"2d\");\r\n    // disable anti-alias\r\n\r\n    if (ctx) {\r\n      ctx.clearRect(\r\n        0,\r\n        0,\r\n        rowBackgroundCanvas.width,\r\n        rowBackgroundCanvas.height\r\n      );\r\n      ctx.lineWidth = 1;\r\n      ctx.strokeStyle = \"#444\";\r\n      for (let j = 1; j < 4; j++) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(j * this.beatWidth, 0);\r\n        ctx.lineTo(j * this.beatWidth, this.rowHeight);\r\n        ctx.stroke();\r\n      }\r\n      ctx.strokeStyle = \"#999\";\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, 0);\r\n      ctx.lineTo(0, this.rowHeight);\r\n      ctx.stroke();\r\n    }\r\n    for (let i = 0; i < rowCount; i++) {\r\n      const row = document.createElement(\"div\");\r\n      row.classList.add(\"grid-row\");\r\n      row.style.height = `${this.rowHeight}px`;\r\n      this.gridElement.appendChild(row);\r\n      const base64 = rowBackgroundCanvas.toDataURL();\r\n      row.style.backgroundImage = `url(${base64})`;\r\n      row.style.backgroundRepeat = \"repeat\";\r\n    }\r\n    this.domElement.appendChild(this.gridElement);\r\n\r\n    this.noteEditor = new LyricEditorDialog((note) => {\r\n      const input = this.noteEditor.domElement.querySelector(\r\n        \".lyric-editor-text\"\r\n      ) as HTMLInputElement;\r\n      note.label = input?.value || \"\";\r\n    });\r\n\r\n    document.body.appendChild(this.noteEditor.domElement);\r\n\r\n    this.gridElement.addEventListener(\"pointerdown\", (event) => {\r\n      if (!this._sequence) throw new Error(\"No track\");\r\n\r\n      if (!this._sequence.events) throw new Error(\"No events\");\r\n\r\n      if (!this.drawingEnabled) return;\r\n\r\n      event.preventDefault();\r\n\r\n      this._dragOffset = event.layerX;\r\n\r\n      if (this.noteEditor.domElement.style.display === \"block\") {\r\n        this.noteEditor.domElement.style.display = \"none\";\r\n        return;\r\n      }\r\n\r\n      if (\r\n        event.target instanceof HTMLDivElement &&\r\n        event.target.classList.contains(\"grid-item\")\r\n      ) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const note = this._sequence.events.find(\r\n          (n) => n.domElement === event.target\r\n        );\r\n\r\n        if (event.ctrlKey || event.button === 1) {\r\n          if (note)\r\n            this.noteEditor.show(event.clientX + 20, event.clientY - 5, note);\r\n          else this.noteEditor.domElement.style.display = \"none\";\r\n        }\r\n\r\n        if (note) {\r\n          this._currentItem = note;\r\n\r\n          if (event.button === 2) {\r\n            this.remove(note);\r\n            this._currentItem = null;\r\n          } else {\r\n            note.domElement!.parentElement?.appendChild(note.domElement!);\r\n            note.domElement!.style.width =\r\n              note.duration * this.beatWidth + \"px\";\r\n            if (this._dragOffset < NOTE_HANDLE_WIDTH) {\r\n              this._dragMode = \"start\";\r\n            } else if (\r\n              note.domElement!.offsetWidth - this._dragOffset <\r\n              NOTE_HANDLE_WIDTH\r\n            ) {\r\n              this._dragMode = \"end\";\r\n            } else {\r\n              this._dragMode = \"move\";\r\n            }\r\n          }\r\n        }\r\n      } else if (event.button !== 0) return;\r\n      else if (event.target === this.gridElement) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const row = Math.floor(event.layerY / this.rowHeight);\r\n        const note = 87 - row;\r\n\r\n        let start = event.layerX / this.beatWidth;\r\n        start = Math.round(start / this.quantize) * this.quantize;\r\n        console.log(\"start\", start, event.layerX);\r\n\r\n        const item: IEvent = {\r\n          row: row,\r\n          note: note,\r\n          start: start,\r\n          velocity: 100,\r\n          duration: this.quantize,\r\n          label: \"\",\r\n          domElement: undefined,\r\n        };\r\n\r\n        this._currentItem = this.add(item);\r\n        this._currentItem.domElement!.style.top = `${\r\n          (87 - this._currentItem.note!) * this.rowHeight\r\n        }px`;\r\n        this._currentItem.domElement!.style.left = `${\r\n          this._currentItem.start * this.beatWidth\r\n        }px`;\r\n        this._dragMode = \"end\";\r\n\r\n        this.emit(\"select\", this._currentItem);\r\n      }\r\n\r\n      this.emit(\"update\", this);\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n\r\n      this.emit(\"update\", this);\r\n      this.emit(\"release\", this._currentItem);\r\n\r\n      this._currentItem = null;\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentItem) {\r\n        // this.remove(this._currentItem);\r\n        this._currentItem = null;\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"contextmenu\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointermove\", (event) => {\r\n      if (this._currentItem && event.buttons === 1) {\r\n        if (this._dragMode === \"start\") {\r\n          const start =\r\n            Math.round(event.layerX / this.beatWidth / this.quantize) *\r\n            this.quantize;\r\n\r\n          const oldStart = this._currentItem.start;\r\n\r\n          if (start >= this._currentItem.start + this._currentItem.duration) {\r\n            return;\r\n          }\r\n\r\n          this._currentItem.start = start;\r\n\r\n          this._currentItem.duration =\r\n            oldStart - this._currentItem.start + this._currentItem.duration;\r\n          this._currentItem.domElement!.style.left = `${\r\n            this._currentItem.start * this.beatWidth\r\n          }px`;\r\n          this._currentItem.domElement!.style.width = `${Math.max(\r\n            this.quantize,\r\n            this._currentItem.duration * this.beatWidth\r\n          )}px`;\r\n        } else if (this._dragMode === \"end\") {\r\n          this._currentItem.duration =\r\n            event.layerX / this.beatWidth - this._currentItem.start;\r\n\r\n          // quantize\r\n          this._currentItem.duration =\r\n            Math.round(this._currentItem.duration / this.quantize) *\r\n            this.quantize;\r\n\r\n          this._currentItem.domElement!.style.width = `${Math.max(\r\n            this.quantize,\r\n            this._currentItem.duration * this.beatWidth\r\n          )}px`;\r\n        } else if (this._dragMode === \"move\") {\r\n          this._currentItem.start =\r\n            Math.max(0, event.layerX - this._dragOffset) / this.beatWidth;\r\n          this._currentItem.start =\r\n            Math.round(this._currentItem.start / this.quantize) * this.quantize;\r\n          this._currentItem.domElement!.style.left = `${\r\n            this._currentItem.start * this.beatWidth\r\n          }px`;\r\n        } else {\r\n          return;\r\n        }\r\n\r\n        this.emit(\"update\", this);\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentItem) {\r\n        this._currentItem.domElement!.style.pointerEvents = \"auto\";\r\n      }\r\n      this._currentItem = null;\r\n    });\r\n\r\n    // this.gridElement.addEventListener(\"pointerleave\", () => {\r\n    //   this.gridElement.classList.remove(\"dragging\");\r\n    //   if (this._currentItem) {\r\n    //     this._currentItem.domElement!.style.pointerEvents = \"auto\";\r\n    //   }\r\n    //   this._currentItem = null;\r\n    // });\r\n  }\r\n\r\n  add(event: IEvent) {\r\n    if (!this._sequence) throw new Error(\"add() No sequence loaded!\");\r\n    const item = new GridItem(\r\n      this,\r\n      event,\r\n      this.drawingLabel,\r\n      this.drawingImage\r\n    );\r\n    this._sequence.events.push(item);\r\n    event.domElement = item.domElement;\r\n    this.emit(\"add\", item);\r\n    return item;\r\n  }\r\n\r\n  remove(item: IEvent) {\r\n    if (!this._sequence) throw new Error(\"remove() No sequence loaded!\");\r\n    this._sequence.events.splice(this._sequence.events.indexOf(item), 1);\r\n    this.emit(\"remove\", item);\r\n    this.gridElement.removeChild(item.domElement!);\r\n  }\r\n\r\n  load(track: ISequence) {\r\n    if (!track) {\r\n      throw new Error(\"load() No track!\");\r\n    }\r\n    console.log(\"Grid: load\", track.events);\r\n    for (const event of this._sequence?.events || []) {\r\n      event.domElement?.remove();\r\n    }\r\n    this._sequence = track;\r\n    for (const event of track.events) {\r\n      this.gridElement.appendChild(event.domElement!);\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport {\r\n  DEFAULT_NOTE_HEIGHT,\r\n  KEY_COLORS,\r\n  NOTE_NAMES,\r\n} from \"../../constants\";\r\nimport { IKeyboardEvent } from \"./Keyboard\";\r\n\r\nexport class SideKeyboard extends BaseElement<\"update\"> {  \r\n  keys: HTMLDivElement[] = [];\r\n  noteHeight = DEFAULT_NOTE_HEIGHT;\r\n\r\n  constructor() {\r\n\r\n    super(\"div\", \"piano-roll-keyboard\");\r\n\r\n    this.redraw();\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const key = e.target as HTMLDivElement;\r\n\r\n      if (key.classList.contains(\"piano-roll-keyboard-key\")) {\r\n        const note_index = this.keys.indexOf(key);\r\n        console.log(\"key\", key.textContent, note_index);        \r\n        key.classList.add(\"active\");\r\n        this.emit(\"update\", { type: \"press\", note: note_index } as IKeyboardEvent);\r\n        const pointerup = () => {\r\n          window.removeEventListener(\"pointerup\", pointerup);\r\n          key.classList.remove(\"active\");\r\n          this.emit(\"update\", { type: \"release\", note: note_index } as IKeyboardEvent);          \r\n        };\r\n\r\n        window.addEventListener(\"pointerup\", () => pointerup());\r\n      }\r\n    });\r\n  }\r\n\r\n  redraw() {\r\n    this.domElement.innerHTML = \"\";\r\n\r\n    for (let i = 87; i >= 0; i--) {\r\n      const key = document.createElement(\"div\");\r\n      key.classList.add(\"piano-roll-keyboard-key\");\r\n      key.style.height = `${this.noteHeight}px`;\r\n      // key.style.bottom = `${i * this.noteHeight}px`;\r\n      key.style.backgroundColor =\r\n        KEY_COLORS[i % 12] === \"white\" ? \"#fff\" : \"#000\";\r\n      key.style.color = KEY_COLORS[i % 12] === \"white\" ? \"#000\" : \"#fff\";\r\n      key.textContent = NOTE_NAMES[i % 12] + ((i / 12) | 0).toString();\r\n      this.domElement.appendChild(key);\r\n      this.keys.push(key);\r\n    }\r\n\r\n    this.keys.reverse();\r\n  }\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { GraphicsHelpers } from \"../../abstracts/GraphicsHelpers\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"./AudioCursor\";\r\nimport type { GridItem } from \"./Grid\";\r\nimport { Grid } from \"./Grid\";\r\nimport type { IKeyboardEvent } from \"./Keyboard\";\r\nimport type { PatternTrack } from \"./PatternTrack\";\r\nimport { SideKeyboard } from \"./SideKeyboard\";\r\n\r\nexport class PianoRoll\r\n  extends EventObject<\"update\">\r\n  implements ICursorTimeline\r\n{\r\n  readonly domElement: HTMLDivElement;\r\n  readonly grid: Grid;\r\n  readonly sideKeyboard: SideKeyboard;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLElement;\r\n  cursorUpdateInterval: number | object | null = null;\r\n  track: PatternTrack | null = null;\r\n  color = \"#7979ce\";\r\n  beatWidth = 100;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll\");\r\n\r\n    this.sideKeyboard = new SideKeyboard();\r\n    this.domElement.appendChild(this.sideKeyboard.domElement);\r\n    this.sideKeyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      if (e.type == \"press\") this.track!.trigger(e.note);\r\n      else if (e.type == \"release\") this.track!.release(e.note);\r\n    });\r\n\r\n    this.grid = new Grid();\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.on(\"select\", (item) => {\r\n      const note = item as GridItem;\r\n      this.track!.trigger(note.note);\r\n      if (this.track) {\r\n        GraphicsHelpers.renderSequence(\r\n          this.track.preview.canvas,\r\n          this.track.events,\r\n          this.color,\r\n          this.beatWidth\r\n        );\r\n      } else {\r\n        console.warn(\"No track loaded!\");\r\n      }\r\n    });\r\n    this.grid.on(\"update\", () => {\r\n      if (this.track) {\r\n        GraphicsHelpers.renderSequence(\r\n          this.track.preview.canvas,\r\n          this.track.events,\r\n          this.color,\r\n          this.beatWidth\r\n        );\r\n      }\r\n    });\r\n    this.grid.on(\"release\", (item) => {\r\n      if (item) this.track!.release((item as GridItem).note);\r\n    });\r\n    this.grid.linkElement(this.sideKeyboard.domElement);\r\n\r\n    this.timeline = this.grid.domElement;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.classList.add(\"audio-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor.domElement);\r\n    this.cursor.domElement.style.marginLeft =\r\n      this.sideKeyboard.domElement.offsetWidth + \"px\";\r\n\r\n    this.grid.scrollTop = 1000;\r\n  }\r\n\r\n  load(track: PatternTrack) {\r\n    if (!track) {\r\n      console.warn(\"No track provided!\");\r\n      return;\r\n    }\r\n    this.track = track;\r\n    this.grid.load(track);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { PatternTrack } from \"../components/PatternTrack\";\r\nimport { PianoRoll } from \"../components/PianoRoll\";\r\n\r\nexport class PianoRollWindow extends DraggableWindow {\r\n  pianoRoll: PianoRoll;\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    const pianoRoll = new PianoRoll(ui.project.audioClock);\r\n\r\n    super({\r\n      title: \"Piano Roll\",\r\n      persistent: true,\r\n      content: pianoRoll.domElement,\r\n      width: 900,\r\n      height: 400,\r\n      left: 100,\r\n      top: 100,\r\n    });\r\n    this.pianoRoll = pianoRoll;\r\n  }\r\n\r\n  loadTrack(track: PatternTrack) {\r\n    this.pianoRoll.load(track);\r\n    this.setTitle(`Piano Roll (${track.name})`);\r\n  }\r\n}\r\n","export class ContextMenu {\r\n  private readonly domElement: HTMLElement;\r\n  private readonly _submenus: ContextMenu[] = [];\r\n\r\n  constructor(\r\n    private readonly container?: HTMLElement,\r\n    private readonly attachedElement?: HTMLElement\r\n  ) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"context-menu\");\r\n\r\n    if (container) container.appendChild(this.domElement);\r\n\r\n    if (attachedElement) {\r\n      this.hide();\r\n      attachedElement.addEventListener(\"contextmenu\", (event) => {\r\n        event.preventDefault();\r\n        this.show(event.clientX + 10, event.clientY - 5);\r\n      });\r\n    }\r\n    \r\n  }\r\n\r\n  private _handlePointerDown(e: MouseEvent) {\r\n    if (\r\n      e.target !== this.domElement &&\r\n      !this.domElement.contains(e.target as Node)\r\n    )\r\n      this.hide();\r\n  }\r\n\r\n  public isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  public addItem(label: string, callback: () => void) {\r\n    const item = document.createElement(\"div\");\r\n    item.classList.add(\"context-menu-item\");\r\n    item.textContent = label;\r\n    item.addEventListener(\"click\", () => {\r\n      callback();\r\n      this.hide();\r\n    });\r\n    this.domElement.appendChild(item);\r\n\r\n    return item;\r\n  }\r\n\r\n  public addSubmenu(label: string, submenu: ContextMenu) {\r\n    const item = document.createElement(\"div\");\r\n    item.classList.add(\"context-menu-item\");\r\n    item.textContent = label;\r\n    item.addEventListener(\"click\", (e) => {\r\n      submenu.show(\r\n        this.domElement.offsetLeft + this.domElement.offsetWidth - 5,\r\n        item.offsetTop\r\n      );\r\n      const elt = e.target as HTMLElement;\r\n      if (elt.classList.contains(\"context-menu-item\")) {\r\n        this.hide();\r\n      }\r\n    });\r\n\r\n    submenu.domElement.classList.add(\"context-menu-submenu\");\r\n    this._submenus.push(submenu);\r\n\r\n    item.appendChild(submenu.domElement);\r\n    this.domElement.appendChild(item);\r\n  }\r\n\r\n  public show(x: number, y: number) {\r\n    if (!this.container) return;\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.display = \"block\";\r\n    document.addEventListener(\"pointerdown\", (e) => this._handlePointerDown(e));\r\n  }\r\n\r\n  public hide() {\r\n    if (!this.isVisible() || !this.container) return;\r\n    this.domElement.style.display = \"none\";\r\n    for (let i = 0; i < this._submenus.length; i++) {\r\n      this._submenus[i].hide();      \r\n    }\r\n    document.removeEventListener(\"pointerdown\", (e) => this._handlePointerDown(e));\r\n  }\r\n}\r\n","import { SelectableElement } from \"../../../elements/src/elements/SelectableElement\";\r\nimport { SelectableGroup } from \"../../../elements/src/elements/SelectableGroup\";\r\nimport { IPattern } from \"../schema\";\r\n\r\nexport class PlaylistSourceItem extends SelectableElement {\r\n  constructor(group: SelectableGroup<PlaylistSourceItem>, readonly item: IPattern) {\r\n    super(group, \"div\", \"playlist-source-item\");\r\n\r\n    this.domElement.innerText = item.name;\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { ITrackOptions } from \"../../schema\";\r\n\r\nexport class PlaylistTrack\r\n  extends BaseElement<\"update\">\r\n  implements ITrackOptions\r\n{\r\n  private _track: ITrackOptions;\r\n\r\n  get mute() {\r\n    return this._track.mute;\r\n  }\r\n\r\n  get solo() {\r\n    return this._track.solo;\r\n  }\r\n\r\n  get selected() {\r\n    return false;\r\n  }\r\n\r\n  get name() {\r\n    return this._track.name;\r\n  }\r\n\r\n  constructor(track: ITrackOptions) {\r\n    super(\"div\", \"playlist-track\");\r\n\r\n    this._track = track;\r\n\r\n    const settings = document.createElement(\"div\");\r\n    settings.classList.add(\"playlist-track-panel\");\r\n\r\n    const labelAndButtons = document.createElement(\"div\");\r\n    labelAndButtons.classList.add(\"playlist-track-label-and-buttons\");\r\n\r\n    const label = document.createElement(\"div\");    \r\n    label.textContent = track.name;\r\n\r\n    const buttons = document.createElement(\"div\");\r\n    buttons.classList.add(\"playlist-track-buttons\");    \r\n\r\n    labelAndButtons.appendChild(label);\r\n    labelAndButtons.appendChild(buttons);\r\n    settings.appendChild(labelAndButtons);\r\n\r\n    const mute = document.createElement(\"div\");\r\n    mute.classList.add(\"track-button\");\r\n    mute.classList.add(\"track-mute-button\");\r\n    mute.textContent = \"M\";\r\n    mute.addEventListener(\"pointerdown\", () => {\r\n      mute.classList.toggle(\"active\");\r\n    });\r\n    buttons.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"div\");\r\n    solo.classList.add(\"track-button\");\r\n    solo.classList.add(\"track-solo-button\");\r\n    solo.textContent = \"S\";\r\n    solo.addEventListener(\"pointerdown\", () => {\r\n      solo.classList.toggle(\"active\");\r\n    });\r\n    buttons.appendChild(solo);\r\n\r\n    this.domElement.appendChild(settings);\r\n  }\r\n\r\n  trigger(note: number, velocity: number) {\r\n    console.log(\"Trigger\", note, velocity);\r\n  }\r\n\r\n  release(note: number) {\r\n    console.log(\"Release\", note);\r\n  }\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { IEvent, IPlaylistEvent, IProject, ITrackOptions } from \"../../schema\";\r\nimport { Project } from \"../Project\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"./AudioCursor\";\r\nimport { Grid } from \"./Grid\";\r\nimport { PlaylistTrack } from \"./PlaylistTrack\";\r\n\r\nexport class Playlist extends EventObject<\"update\"> implements ICursorTimeline {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly grid: Grid;\r\n  readonly _trackPanels: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLElement;\r\n  beatWidth = 20;\r\n  readonly _items: Map<IEvent, IPlaylistEvent> = new Map();\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.project.audioClock;\r\n  }\r\n\r\n  constructor(readonly project: Project) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"playlist\");\r\n\r\n    this._trackPanels = document.createElement(\"div\");\r\n    this._trackPanels.classList.add(\"playlist-tracks\");\r\n    this.domElement.appendChild(this._trackPanels);\r\n\r\n    this.grid = new Grid(16, this.beatWidth, 60);\r\n    this.grid.on(\"add\", (e) => {\r\n      const event = e as IEvent;\r\n      const playlistEvent = e as IPlaylistEvent;\r\n      if (!this.project.playlist.events.includes(playlistEvent)) {\r\n        this.project.playlist.events.push(playlistEvent);\r\n      }\r\n      this._items.set(event, playlistEvent);\r\n      this.emit(\"update\");\r\n      console.log(\"Added event\", e);\r\n    });\r\n\r\n    this.grid.on(\"remove\", (e) => {      \r\n      const event = e as IEvent;\r\n      if (this._items.has(event)) {\r\n        const playlistEvent = e as IPlaylistEvent;\r\n        const index = this.project.playlist.events.indexOf(playlistEvent);\r\n        if (index >= 0) {\r\n          this.project.playlist.events.splice(index, 1);\r\n          console.log(\"Removed event\", e);\r\n        }\r\n        this._items.delete(event);\r\n      }\r\n      this.emit(\"update\");\r\n    });\r\n\r\n    this.grid.quantize = 1;\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.linkElement(this._trackPanels);\r\n    this.grid.load(this.project.playlist);\r\n\r\n    this.timeline = this.grid.domElement;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.classList.add(\"audio-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor.domElement);\r\n    this.cursor.domElement.style.marginLeft =\r\n      this._trackPanels.offsetWidth + \"px\";\r\n    this.grid.scrollTop = 0;\r\n  }\r\n\r\n  loadProject(project: IProject) {\r\n    let i = 0;\r\n\r\n    for (const track of project.tracks) {\r\n      const playlistTrack = new PlaylistTrack(track);\r\n      this._trackPanels.appendChild(playlistTrack.domElement);\r\n      i++;\r\n    }\r\n\r\n    for (; i < 16; i++) {\r\n      const track: ITrackOptions = {\r\n        name: `Track ${i + 1}`,\r\n        mute: false,\r\n        solo: false,\r\n        selected: false,\r\n      };\r\n      const playlistTrack = new PlaylistTrack(track);\r\n      project.tracks.push(track);\r\n      this._trackPanels.appendChild(playlistTrack.domElement);\r\n    }\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ContextMenu } from \"../../../../elements/src/elements/ContextMenu\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { IProject } from \"../../schema\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { PlaylistSourceItem } from \"../PlaylistSourceItem\";\r\nimport { Playlist } from \"../components/Playlist\";\r\n\r\nexport class PlaylistWindow extends DraggableWindow {\r\n  readonly bucket: SelectableGroup<PlaylistSourceItem>;\r\n  readonly playlist: Playlist;\r\n\r\n  beatWidth = 10;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.ui.project.audioClock;\r\n  }\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"playlist-container\");\r\n\r\n    super({\r\n      title: \"Playlist\",\r\n      persistent: true,\r\n      content: container,\r\n      width: 800,\r\n      height: 400,\r\n    });\r\n\r\n    this.playlist = new Playlist(this.ui.project);\r\n\r\n    const sourceContainer = document.createElement(\"div\");\r\n    sourceContainer.classList.add(\"playlist-source-container\");\r\n\r\n    this.bucket = new SelectableGroup<PlaylistSourceItem>();\r\n    this.bucket.domElement.classList.add(\"playlist-source-bucket\");\r\n    this.refresh();\r\n\r\n    const addMenu = new ContextMenu(document.body);\r\n\r\n    addMenu.addItem(\"Import Audio\", () => {\r\n      const fileInput = document.createElement(\"input\");\r\n      fileInput.type = \"file\";\r\n      fileInput.accept = \"audio/*\";\r\n      fileInput.addEventListener(\"change\", () => {\r\n        const file = fileInput.files?.[0];\r\n        if (file) {\r\n          console.log(\"Importing audio file\", file);\r\n        }\r\n      });\r\n      fileInput.click();\r\n    });\r\n\r\n\r\n    addMenu.addItem(\"Generate (Stable Audio)\", () => {\r\n      console.log(\"Add Audio\");\r\n    });\r\n\r\n    addMenu.addItem(\"Generate (MusicGen)\", () => {\r\n      console.log(\"Add Audio\");\r\n    });\r\n\r\n    const addButton = document.createElement(\"button\");\r\n    addButton.classList.add(\"bucket-add-button\");\r\n    addButton.textContent = \"+\";\r\n    addButton.addEventListener(\"click\", (e) => {\r\n      addMenu.show(e.clientX, e.clientY);\r\n    });\r\n\r\n    sourceContainer.appendChild(this.bucket.domElement);\r\n    sourceContainer.appendChild(addButton);\r\n\r\n    container.appendChild(sourceContainer);\r\n    container.appendChild(this.playlist.domElement);\r\n  }\r\n\r\n  refresh() {\r\n    this.bucket.clear();\r\n\r\n    for (const pattern of this.ui.project.patterns) {\r\n      const item = new PlaylistSourceItem(this.bucket, pattern);\r\n      this.bucket.addSelectable(item);\r\n    }\r\n\r\n    if (this.bucket.items.length > 0) {\r\n      this.bucket.items[0].selected = true;\r\n      this.playlist.grid.drawingEnabled = true;\r\n      this.playlist.grid.drawingLabel = this.bucket.items[0].item.name;\r\n      this.playlist.grid.drawingImage = this.bucket.items[0].item.name;\r\n    } else {\r\n      this.playlist.grid.drawingEnabled = false;\r\n    }\r\n  }\r\n\r\n  loadProject(project: IProject) {\r\n    this.playlist.loadProject(project);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport { WindowContainer } from \"../../../elements/src/elements/WindowContainer\";\r\nimport { Project } from \"./Project\";\r\nimport { IKeyboardEvent, Keyboard } from \"./components/Keyboard\";\r\nimport { MixerWindow } from \"./windows/MixerWindow\";\r\nimport { PatternWindow } from \"./windows/PatternWindow\";\r\nimport { PianoRollWindow } from \"./windows/PianoRollWindow\";\r\nimport { PlaylistWindow } from \"./windows/PlaylistWindow\";\r\n\r\nexport class ProjectUI extends BaseElement<\"update\"> {\r\n  container: WindowContainer;\r\n  readonly pianoRollWindow: PianoRollWindow;\r\n  readonly mixerWindow: MixerWindow;\r\n\r\n  get audioContext() {\r\n    return this.project.audioClock.audioContext;\r\n  }\r\n\r\n  constructor(readonly project: Project) {\r\n    super(\"div\", \"project-ui\");\r\n\r\n    this.container = new WindowContainer();\r\n    this.domElement.appendChild(this.container.domElement);\r\n\r\n    this.pianoRollWindow = new PianoRollWindow(this);\r\n    this.container.addWindow(this.pianoRollWindow);\r\n\r\n    const patternWindow = new PatternWindow(this);\r\n    this.container.addWindow(patternWindow);\r\n    patternWindow.show(35, 100);\r\n\r\n    const playlistWindow = new PlaylistWindow(this);\r\n    this.container.addWindow(playlistWindow);\r\n    playlistWindow.show(1000, 50);\r\n\r\n    this.mixerWindow = new MixerWindow(this);\r\n    this.container.addWindow(this.mixerWindow);\r\n    this.mixerWindow.show(1000, 470);\r\n\r\n    const keyboard = new Keyboard();\r\n    this.domElement.appendChild(keyboard.domElement);\r\n    keyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      console.log(\"Keyboard\", event);\r\n      if (e.type === \"press\") {\r\n        patternWindow.trigger(e.note);\r\n      } else if (e.type === \"release\") {\r\n        patternWindow.release(e.note);\r\n      }\r\n    });\r\n\r\n    this.project.on(\"update\", (event) => {\r\n      console.log(\"ProjectUI project update\", event);\r\n\r\n      if (!(event instanceof Object)) {\r\n        throw new Error(\"Invalid event\");\r\n      }\r\n\r\n      if (!(\"type\" in event)) {\r\n        throw new Error(\"Invalid event\");\r\n      }\r\n\r\n      const e = event as { type: string; value: unknown };\r\n\r\n      if (e.type === \"project\") {\r\n        const project = e.value as Project;\r\n        console.log(\"Project\", project);\r\n        patternWindow.loadProject(project);\r\n        playlistWindow.loadProject(project);\r\n        for (const instrument of project.instruments) {\r\n          this.container.addWindow(instrument.window);\r\n        }\r\n      }\r\n    });\r\n  }\r\n  loadProject(project: Project) {\r\n    this.project.load(project);\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class DraggableNumber extends BaseElement<\"change\"> {\r\n  private _value: number;\r\n  private _step: number;\r\n  private _hideZero: string | null;\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(value: number) {\r\n    this._value = value;\r\n    if (value === 0 && this._hideZero !== null) {\r\n      this.domElement.textContent = this._hideZero;\r\n    } else {\r\n      this.domElement.textContent = value.toString();\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    value: number,\r\n    min: number,\r\n    max: number,\r\n    step = 1,\r\n    sensitivity = 0.25,\r\n    hideZero: string | null = \"-\"\r\n  ) {\r\n    super(\"div\", \"draggable-number\");\r\n\r\n    this._hideZero = hideZero;\r\n    this._value = value;\r\n    this._step = step;\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const startY = e.clientY;\r\n      const startValue = this.value;\r\n      const onMouseMove = (event: PointerEvent) => {\r\n        const oldValue = this.value;\r\n        const dy = Math.round(-(event.clientY - startY) * sensitivity);\r\n        const newValue = startValue + dy * this._step;\r\n        this.value = Math.max(min, Math.min(max, newValue));\r\n        if (oldValue !== this.value) this.emit(\"change\", this.value);\r\n      };\r\n      const onMouseUp = () => {\r\n        document.removeEventListener(\"pointermove\", onMouseMove);\r\n        document.removeEventListener(\"pointerup\", onMouseUp);\r\n      };\r\n      document.addEventListener(\"pointermove\", onMouseMove);\r\n      document.addEventListener(\"pointerup\", onMouseUp);\r\n    });\r\n\r\n    this.value = value || 0;\r\n  }\r\n}\r\n","import { DraggableNumber } from \"../../../elements/src/elements/DraggableNumber\";\r\n\r\nimport {\r\n  DraggableWindow,\r\n  IWindowOptions,\r\n} from \"../../../elements/src/elements/DraggableWindow\";\r\nimport { Instrument } from \"./Instrument\";\r\n\r\nexport interface IInstrumentWindowOptions extends IWindowOptions {\r\n  mixerChannel: number;\r\n}\r\n\r\nexport class InstrumentWindow extends DraggableWindow {\r\n  private _settingsBar: HTMLDivElement;\r\n\r\n  get mixerChannel() {\r\n    return this.options.mixerChannel;\r\n  }\r\n\r\n  set mixerChannel(value: number) {\r\n    this.options.mixerChannel = value;\r\n  }\r\n\r\n  constructor(\r\n    readonly options: IInstrumentWindowOptions,\r\n    readonly instrument: Instrument,    \r\n  ) {\r\n    super(options);\r\n\r\n    const mixerChannelSelector = new DraggableNumber(\r\n      options.mixerChannel,\r\n      0,\r\n      16\r\n    );\r\n    mixerChannelSelector.on(\"change\", (value) => {\r\n      this.mixerChannel = value as number;\r\n      console.assert(instrument.mixer, \"instrument.mixer is undefined!\");\r\n      instrument.output.disconnect();\r\n      instrument.output.connect(\r\n        instrument.mixer.channels[this.mixerChannel].gainNode\r\n      );\r\n    });\r\n\r\n    this._settingsBar = document.createElement(\"div\");\r\n    this._settingsBar.classList.add(\"window-settings-bar\");\r\n    this._settingsBar.appendChild(mixerChannelSelector.domElement);\r\n\r\n    this.domElement.insertBefore(this._settingsBar, this.content);\r\n  }\r\n}\r\n","import { IInstrument } from \"../elements/IInstrument\";\r\nimport { Mixer } from \"../elements/Mixer\";\r\nimport { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { ISourceEvent } from \"../elements/components/SamplerSlot\";\r\nimport { Plugin } from \"../plugins/plugins\";\r\n\r\nexport abstract class Instrument extends Plugin implements IInstrument {\r\n  inputPort?: number | undefined;\r\n  inputChannel?: number | undefined;\r\n  output: GainNode;\r\n\r\n  constructor(audioClock: AudioClock, mixer: Mixer, mixerChannel = 0) {\r\n    super(audioClock, mixer);\r\n    this.output = audioClock.audioContext.createGain();\r\n    this.output.connect(mixer.channels[mixerChannel].gainNode);\r\n  }\r\n\r\n  abstract trigger(\r\n    note: number,\r\n    when: number,\r\n    velocity?: number\r\n  ): ISourceEvent | undefined;\r\n\r\n  abstract release(note: number, when: number): void;\r\n}\r\n","import { SynthesizerVoice } from \"./SynthesizerVoice\";\r\nimport { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { IKeyboardEvent } from \"../elements/components/Keyboard\";\r\nimport { ISynthesizerSettings } from \"../schema\";\r\nimport { Instrument } from \"./Instrument\";\r\nimport { InstrumentWindow } from \"./InstrumentWindow\";\r\nimport { Mixer } from \"../elements/Mixer\";\r\n\r\ninterface ISynthesizerEvent extends IKeyboardEvent {\r\n  voice: SynthesizerVoice;\r\n}\r\n\r\nexport abstract class Synthesizer<T extends SynthesizerVoice>\r\n  extends Instrument\r\n  implements ISynthesizerSettings\r\n{\r\n  abstract readonly window: InstrumentWindow;\r\n  readonly voices: SynthesizerVoice[] = [];\r\n  private _nextVoice = 0;  \r\n  private _held: ISynthesizerEvent[] = [];\r\n  public transpose = 24;\r\n\r\n  constructor(audioClock: AudioClock, mixer: Mixer) {\r\n    super(audioClock, mixer);\r\n  }\r\n\r\n  addVoice(voice: T) {\r\n    this.voices.push(voice);\r\n  }\r\n\r\n  handleEvent(event: IKeyboardEvent) {\r\n    if (event.type == \"press\") {\r\n      console.log(this.name + \" triggered voice \" + this._nextVoice);\r\n\r\n      this._held.push({ ...event, voice: this.voices[this._nextVoice] });\r\n\r\n      this._nextVoice++;\r\n      if (this._nextVoice >= this.voices.length) {\r\n        this._nextVoice = 0;\r\n      }\r\n    } else if (event.type == \"release\") {\r\n      console.log(this.name + \" released voice \" + event);\r\n\r\n      const index = this._held.findIndex((e) => e.note == event.note);\r\n      if (index >= 0) {\r\n        this._held.splice(index, 1);\r\n      }\r\n\r\n      this.voices.forEach((voice) => {\r\n        voice.release(event.note);\r\n      });\r\n    } else {\r\n      console.error(this.name + \": Invalid event passed to trigger()\", event);\r\n    }\r\n  }\r\n}\r\n","import { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { ISynthesizerVoiceSettings } from \"../schema\";\r\n\r\nexport abstract class SynthesizerVoice implements ISynthesizerVoiceSettings {\r\n  _settings: ISynthesizerVoiceSettings | null = null;\r\n\r\n  get settings(): ISynthesizerVoiceSettings {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n    return this.settings;\r\n  }\r\n\r\n  private readonly _gain: GainNode;\r\n  private _note: number | null = null;\r\n  private _frequency: number | null = null;  \r\n\r\n  get gain() {\r\n    return this._gain.gain.value;\r\n  }\r\n\r\n  get note() {\r\n    return this._note;\r\n  }\r\n\r\n  get lfoNumber() {\r\n    return this.settings.lfoNumber;\r\n  }\r\n\r\n  get envelopeNumber() {\r\n    return this.settings.envelopeNumber;\r\n  }\r\n\r\n  get frequency() {\r\n    return this._frequency;\r\n  }\r\n\r\n  get detune() {\r\n    return this.settings.detune;\r\n  }\r\n\r\n  get oscillators() {\r\n    return this.settings.oscillators;\r\n  }\r\n\r\n  constructor(readonly audioClock: AudioClock) {    \r\n    this._gain = audioClock.audioContext.createGain();\r\n  }\r\n\r\n  loadSettings(settings: ISynthesizerVoiceSettings) {\r\n    this._settings = settings;\r\n    this._gain.gain.value = settings.gain;\r\n  }\r\n\r\n  trigger(note: number, velocity: number, time = 0) {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n\r\n    this._note = note;\r\n    this._frequency = 440 * Math.pow(2, (note - 69) / 12);\r\n    this._gain.gain.value = this.settings.gain * velocity;\r\n\r\n    // TODO\r\n  }\r\n\r\n  release(time = 0) {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n\r\n    this._note = null;\r\n    this._frequency = null;\r\n\r\n    // TODO\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { ControlType, IPluginControl } from \"../../schema\";\r\n\r\nexport class Slider extends BaseElement<\"update\"> implements IPluginControl {\r\n  private readonly _name: string;\r\n  private readonly _label: string;\r\n  private readonly _type: ControlType = \"slider\";\r\n  private readonly _default: number;\r\n  private readonly _min: number;\r\n  private readonly _max: number;\r\n  private readonly _step: number;\r\n  private readonly _range: HTMLInputElement;\r\n  private _value: number;\r\n\r\n  get name() {\r\n    return this._name;\r\n  }\r\n\r\n  get label() {\r\n    return this._label;\r\n  }\r\n\r\n  get type() {\r\n    return this._type;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  get default() {\r\n    return this._default;\r\n  }\r\n\r\n  get min() {\r\n    return this._min;\r\n  }\r\n\r\n  get max() {\r\n    return this._max;\r\n  }\r\n\r\n  get step() {\r\n    return this._step;\r\n  }\r\n\r\n  set value(value: number) {\r\n    this._value = value;\r\n    this._range.value = value.toString();\r\n  }\r\n\r\n  get element() {\r\n    return this._range;\r\n  }\r\n\r\n  constructor(\r\n    name: string,\r\n    label: string,\r\n    min: number,\r\n    max: number,\r\n    step: number,\r\n    value: number\r\n  ) {\r\n    super(\"div\", \"slider\");\r\n\r\n    this._name = name;\r\n    this._label = label;\r\n    this._min = min;\r\n    this._max = max;\r\n    this._step = step;\r\n    this._value = value;\r\n    this._default = value;\r\n\r\n    this._range = document.createElement(\"input\");\r\n    this._range.type = \"range\";\r\n    this._range.min = min.toString();\r\n    this._range.max = max.toString();\r\n    this._range.step = step.toString();\r\n    this._range.value = value.toString();\r\n\r\n    this._range.addEventListener(\"input\", () => {\r\n      this._value = parseFloat(this._range.value);\r\n      this.emit(\"update\", this);\r\n    });\r\n\r\n    this._range.addEventListener(\"change\", () => {\r\n      this._range.blur();\r\n    });\r\n\r\n    this.domElement.appendChild(this._range);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { IEnvelope } from \"../../schema\";\r\nimport { Slider } from \"./Slider\";\r\n\r\nexport class Envelope extends BaseElement<\"update\"> implements IEnvelope {\r\n  readonly attack: Slider;\r\n  readonly hold: Slider;\r\n  readonly decay: Slider;\r\n  readonly sustain: Slider;\r\n  readonly release: Slider;\r\n\r\n  constructor(\r\n    attack = 0.003,\r\n    hold = 0.0,\r\n    decay = 2.0,\r\n    sustain = 0.01,\r\n    release = 0.05\r\n  ) {\r\n    super(\"div\", \"envelope\");\r\n\r\n    this.attack = new Slider(\"attack\", \"A\", 0, 1, 0.01, attack);\r\n    this.hold = new Slider(\"hold\", \"H\", 0, 1, 0.01, hold);\r\n    this.decay = new Slider(\"decay\", \"D\", 0, 1, 0.01, decay);\r\n    this.sustain = new Slider(\"sustain\", \"S\", 0, 1, 0.01, sustain);\r\n    this.release = new Slider(\"release\", \"R\", 0, 1, 0.01, release);\r\n\r\n    this.domElement.appendChild(this.attack.domElement);\r\n    this.domElement.appendChild(this.decay.domElement);\r\n    this.domElement.appendChild(this.sustain.domElement);\r\n    this.domElement.appendChild(this.release.domElement);\r\n  }\r\n\r\n  trigger(param: AudioParam, when: number) {\r\n    console.log(\"trigger @ \" + when);\r\n    const value = param.value;\r\n    param.cancelScheduledValues(when);\r\n    param.setValueAtTime(value, when);\r\n    param.exponentialRampToValueAtTime(0.015, when);\r\n    //param.setValueAtTime(0.015, when);\r\n    param.linearRampToValueAtTime(1, when + this.attack.value);\r\n    //param.setValueAtTime(1, when + this.attack.value);\r\n    param.exponentialRampToValueAtTime(\r\n      this.sustain.value,\r\n      when + this.attack.value + this.decay.value\r\n    );\r\n  }\r\n\r\n  triggerRelease(param: AudioParam, when: number) {\r\n    console.log(\"triggerRelease @ \" + when);\r\n    param.setValueAtTime(param.value, when);\r\n    param.setTargetAtTime(0.0001, when + 0.01, this.release.value);\r\n    param.cancelScheduledValues(when + 0.01 + this.release.value);\r\n  }\r\n}\r\n","import { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport { Synthesizer } from \"../../abstracts/Synthesizer\";\r\nimport { SynthesizerVoice } from \"../../abstracts/SynthesizerVoice\";\r\nimport type { Mixer } from \"../../elements/Mixer\";\r\nimport type { AudioClock } from \"../../elements/components/AudioClock\";\r\nimport { Envelope } from \"../../elements/components/Envelope\";\r\nimport type { ISourceEvent } from \"../../elements/components/SamplerSlot\";\r\nimport { Slider } from \"../../elements/components/Slider\";\r\nimport type { ControllerGroup } from \"../../schema\";\r\n\r\nfunction noteToFrequency(note: number) {\r\n  return 440 * Math.pow(2, (note - 69) / 12);\r\n}\r\n\r\nexport class FMBassVoice extends SynthesizerVoice {\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(audioClock);\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity: number | undefined) {\r\n    console.log(\"FMBassVoice triggered\", note, when, velocity);\r\n  }\r\n\r\n  release(note: number) {\r\n    console.log(\"FMBassVoice released\", note);\r\n  }\r\n}\r\n\r\nexport class FMBass extends Synthesizer<FMBassVoice> {\r\n  readonly name = \"FM Bass\";\r\n  readonly id = \"fm_bass\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple FM bass synthesizer\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly controllerGroups: ControllerGroup[] = [];\r\n  readonly window: InstrumentWindow;\r\n  private _carrier?: OscillatorNode;\r\n  private _modulator?: OscillatorNode;\r\n  readonly modulatorGain: GainNode;\r\n  readonly filter: BiquadFilterNode;\r\n  readonly gain: GainNode;\r\n  readonly filterEnvelope: Envelope;\r\n  readonly gainEnvelope: Envelope;\r\n  private _heldNote: number | undefined;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    mixer: Mixer,\r\n    mixerChannel = 0\r\n  ) {\r\n    super(audioClock, mixer);\r\n\r\n    this.window = new InstrumentWindow(\r\n      {\r\n        title: \"FM Bass\",\r\n        persistent: true,\r\n        content: this.domElement,\r\n        mixerChannel,\r\n      },\r\n      this\r\n    );\r\n\r\n    const audioContext = this.audioClock.audioContext;\r\n\r\n    this.modulatorGain = audioContext.createGain();\r\n    this.modulatorGain.gain.value = 100;\r\n\r\n    this.gain = audioContext.createGain();\r\n    this.gain.gain.value = 0;\r\n\r\n    const highpassFilter = audioContext.createBiquadFilter();\r\n    highpassFilter.type = \"highpass\";\r\n    highpassFilter.frequency.value = 20;\r\n    this.gain.connect(highpassFilter);\r\n    highpassFilter.connect(this.output);\r\n\r\n    this.output.gain.value = 0.5;\r\n\r\n    this.filter = audioContext.createBiquadFilter();\r\n    this.filter.type = \"lowpass\";\r\n    this.filter.frequency.value = 440;\r\n    this.filter.Q.value = 1;\r\n    this.filter.connect(this.gain);\r\n\r\n    this.filterEnvelope = new Envelope(0);\r\n    this.gainEnvelope = new Envelope(0.015);\r\n\r\n    const fmGainSlider = new Slider(\"FM Gain\", \"FM Gain\", 0, 1000, 1, 100);\r\n    this.window.content.appendChild(fmGainSlider.domElement);\r\n    fmGainSlider.on(\"update\", () => {\r\n      console.log(\"FM Gain\", fmGainSlider.value);\r\n      this.modulatorGain.gain.value = fmGainSlider.value;\r\n    });\r\n    // const container = this.window.content.appendChild();\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity = 1): ISourceEvent | undefined {\r\n    console.log(\"FM Bass triggered\", when);\r\n\r\n    this._heldNote = note;\r\n\r\n    note += this.transpose;\r\n\r\n    if (this._carrier?.context.state === \"running\") {\r\n      const g = this.gain.gain.value;\r\n      this.gain.gain.cancelScheduledValues(when);\r\n      this.gain.gain.setValueAtTime(g, when);\r\n      this.gain.gain.setTargetAtTime(0.01, when, 0.01);\r\n\r\n      try {\r\n        this._carrier.stop(when + 0.02);\r\n        this._modulator?.stop(when + 0.02);\r\n      } catch (e) {\r\n        console.error(\"Error stopping carrier/modulator\", e);\r\n      }\r\n    }\r\n\r\n    this._carrier = this.audioClock.audioContext.createOscillator();\r\n    this._carrier.frequency.value = 220;\r\n\r\n    this._modulator = this.audioClock.audioContext.createOscillator();\r\n    this._modulator.frequency.value = 220;\r\n\r\n    this._carrier.connect(this.gain);\r\n    this._modulator.connect(this.modulatorGain);\r\n    this.modulatorGain.connect(this._carrier.frequency);\r\n\r\n    this._carrier.type = \"sine\";\r\n\r\n    this._carrier.start(when);\r\n    this._modulator.start(when);\r\n\r\n    const freq = noteToFrequency(note);\r\n    let time = when || this.audioClock.currentTime;\r\n\r\n    this.gainEnvelope.trigger(this.gain.gain, time);\r\n\r\n    const value = this._carrier.frequency.value;\r\n\r\n    time += 0.001;\r\n\r\n    this._carrier.frequency.cancelScheduledValues(time);\r\n    this._modulator.frequency.cancelScheduledValues(time);\r\n\r\n    this._carrier.frequency.setValueAtTime(value, time);\r\n    this._modulator.frequency.setValueAtTime(value * 2, time);\r\n\r\n    this._carrier.frequency.setTargetAtTime(freq, time, 0.001);\r\n    this._modulator.frequency.setTargetAtTime(freq * 2, time, 0.001);\r\n    //this.filterEnvelope.trigger(this.filter.frequency, time);\r\n\r\n    return undefined;\r\n  }\r\n\r\n  release(note: number, when: number) {\r\n    if (this._heldNote !== note) {\r\n      return;\r\n    }\r\n    console.log(\"FM Bass released\", note);\r\n    const time = when || this.audioClock.currentTime;\r\n    this.filterEnvelope.triggerRelease(this.filter.frequency, time);\r\n    this.gainEnvelope.triggerRelease(this.gain.gain, time);\r\n  }\r\n}\r\n","import { triggerActive } from \"../../../../elements/src/animation\";\r\nimport { AudioCanvas } from \"../../../../elements/src/elements/AudioCanvas\";\r\nimport { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { ControllerGroup, ISamplerSlot } from \"../../schema\";\r\nimport { AudioClock } from \"./AudioClock\";\r\n\r\nexport interface ISourceEvent {\r\n  source: AudioBufferSourceNode;\r\n  gain: GainNode;\r\n  cutByGroups: number[];\r\n  time: number;\r\n}\r\n\r\nexport class SamplerSlot extends BaseElement<\"update\"> implements ISamplerSlot {\r\n  private _nameElement;\r\n  controllerGroups: ControllerGroup[] = [];\r\n  buffer: AudioBuffer | null = null;\r\n  velocity: number;\r\n  pan: number;\r\n  pitch: number;\r\n  randomPitch: number;\r\n  randomVelocity: number;\r\n  startPosition: number;\r\n  endPosition: number;\r\n  loop: boolean;\r\n  loopStart: number;\r\n  loopEnd: number;\r\n  protected _sources: ISourceEvent[] = [];\r\n  private _previewCanvas: AudioCanvas;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    protected output: AudioNode,\r\n    public name = \"\",\r\n    public keyBinding: number | null = null,\r\n    public cutGroup = -1,\r\n    readonly cutByGroups: number[] = []\r\n  ) {\r\n    super(\"div\", \"sampler-slot\");\r\n\r\n    this.name = name;\r\n    this.buffer = null;\r\n    this.keyBinding = keyBinding || null;\r\n    this.velocity = 1;\r\n    this.pan = 1;\r\n    this.pitch = 1;\r\n    this.randomPitch = 0;\r\n    this.randomVelocity = 0.05;\r\n    this.startPosition = 0;\r\n    this.endPosition = 0;\r\n    this.loop = false;\r\n    this.loopStart = 0;\r\n    this.loopEnd = 0;\r\n    this.cutGroup = cutGroup;\r\n    this.cutByGroups = cutByGroups;\r\n\r\n    this._previewCanvas = new AudioCanvas(200, 60);\r\n    this.domElement.appendChild(this._previewCanvas.domElement);\r\n\r\n    this._nameElement = document.createElement(\"div\");\r\n    this._nameElement.classList.add(\"sampler-slot-name\");\r\n    this.domElement.appendChild(this._nameElement);\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => this.trigger());\r\n  }\r\n\r\n  async loadSample(name: string, url: string) {\r\n    this._nameElement.textContent = \"(Loading)\";\r\n\r\n    const response = await fetch(url);\r\n    if (!response.ok) {\r\n      this._nameElement.textContent = \"(Empty)\";\r\n      console.error(`Error loading sample: ${url}`, response.statusText);\r\n      return;\r\n    }\r\n\r\n    response\r\n      .arrayBuffer()\r\n      .then((buffer) => this.audioClock.audioContext.decodeAudioData(buffer))\r\n      .then((audioBuffer) => {\r\n        this._nameElement.textContent = name;\r\n        this.buffer = audioBuffer;\r\n        this.emit(\"update\");\r\n        setTimeout(() => {\r\n          this._previewCanvas.loadBuffer(audioBuffer);\r\n        }, 1);\r\n      })\r\n      .catch((error) => {\r\n        this._nameElement.textContent = \"(Empty)\";\r\n        console.error(`Error loading sample: ${url}`, error);\r\n      });\r\n  }\r\n\r\n  trigger(beat = 0) {\r\n    if (!this.buffer) {\r\n      console.error(\"No buffer loaded for sample\", this.name);\r\n      return;\r\n    }\r\n\r\n    const audioContext = this.audioClock.audioContext;\r\n    const source = audioContext.createBufferSource();\r\n    source.buffer = this.buffer;\r\n    source.playbackRate.value = this.pitch + Math.random() * this.randomPitch;    \r\n\r\n    const gain = audioContext.createGain();\r\n    gain.gain.value = this.velocity + Math.random() * this.randomVelocity;\r\n    gain.connect(this.output);\r\n\r\n    source.connect(gain);\r\n\r\n    if (this.pan !== 1) {\r\n      const pan = audioContext.createStereoPanner();\r\n      pan.pan.value = this.pan;\r\n      source.connect(pan);\r\n      pan.connect(gain);\r\n    }\r\n\r\n    const time =\r\n      (this.audioClock.startTime || audioContext.currentTime) +\r\n      (beat * 60) / this.audioClock.bpm;\r\n\r\n    const entry: ISourceEvent = {\r\n      source,\r\n      gain,\r\n      cutByGroups: this.cutByGroups,\r\n      time,\r\n    };\r\n\r\n    this._sources.push(entry);\r\n\r\n    source.onended = () => {\r\n      source.disconnect();\r\n      gain.disconnect();\r\n      const index = this._sources.indexOf(entry);\r\n      if (index >= 0) this._sources.splice(index, 1);\r\n    };\r\n\r\n    console.log(beat, audioContext.currentTime, time);\r\n\r\n    if (this.startPosition >= 0) {\r\n      source.start(\r\n        time,\r\n        this.startPosition,\r\n        (this.endPosition || this.buffer.duration) - this.startPosition\r\n      );\r\n    } else {\r\n      source.start(time);\r\n    }\r\n\r\n    if (time === 0 || !this.audioClock.isPlaying) {\r\n      triggerActive(this.domElement);\r\n    } else {\r\n      this.audioClock.scheduleEventAtTime(\r\n        () => triggerActive(this.domElement),\r\n        time\r\n      );\r\n    }\r\n\r\n    if (this.loop) {\r\n      source.loop = true;\r\n      source.loopStart = this.loopStart;\r\n      source.loopEnd = this.loopEnd || this.buffer.duration;\r\n    }\r\n\r\n    return entry;\r\n  }\r\n\r\n  release(time: number) {\r\n    for (const entry of this._sources) {\r\n      if (time >= entry.time) this.cut(entry, time);\r\n    }\r\n  }\r\n\r\n  cut(entry: ISourceEvent, time = 0) {\r\n    const currentValue = entry.gain.gain.value;\r\n    entry.gain.gain.cancelScheduledValues(time);\r\n    entry.gain.gain.setValueAtTime(currentValue, time);\r\n    entry.gain.gain.exponentialRampToValueAtTime(0.0001, time + 0.1);\r\n    entry.source.stop(time + 0.1);\r\n  }\r\n}\r\n","import { Instrument } from \"../../abstracts/Instrument\";\r\nimport { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport { Mixer } from \"../../elements/Mixer\";\r\nimport { AudioClock } from \"../../elements/components/AudioClock\";\r\nimport { SamplerSlot } from \"../../elements/components/SamplerSlot\";\r\nimport { ControllerGroup } from \"../../schema\";\r\n\r\nexport class Sampler extends Instrument {\r\n  readonly name = \"Sampler\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple sampler\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly id = \"sampler\";\r\n  readonly window: InstrumentWindow;  \r\n\r\n  private readonly _slotsContainer: HTMLDivElement;\r\n\r\n  slots: SamplerSlot[] = [];\r\n  controllerGroups: ControllerGroup[] = [];\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    mixer: Mixer,\r\n    mixerChannel = 0,    \r\n  ) {\r\n    super(audioClock, mixer, mixerChannel);\r\n\r\n    this.output = this.audioClock.audioContext.createGain();\r\n\r\n    window.addEventListener(\"keydown\", (event) => this.onKeyDown(event));\r\n\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"sampler-slots-container\");\r\n    this._slotsContainer = container;\r\n\r\n    //keypad numbers 0-9\r\n    // then . / * + - Enter\r\n    const defaultSlots = [\r\n      { keyBinding: 96, name: \"0\" },\r\n      { keyBinding: 97, name: \"1\" },\r\n      { keyBinding: 98, name: \"2\" },\r\n      { keyBinding: 99, name: \"3\" },\r\n      { keyBinding: 100, name: \"4\" },\r\n      { keyBinding: 101, name: \"5\" },\r\n      { keyBinding: 102, name: \"6\", cutByGroups: [3, 6] },\r\n      { keyBinding: 103, name: \"7\" },\r\n      { keyBinding: 104, name: \"8\" },\r\n      { keyBinding: 105, name: \"9\" },\r\n      { keyBinding: 111, name: \"/\", cutByGroups: [0, 10] },\r\n      { keyBinding: 106, name: \"*\" },\r\n      { keyBinding: 109, name: \"-\" },\r\n      { keyBinding: 107, name: \"+\" },\r\n      { keyBinding: 13, name: \"Enter\" },\r\n    ];\r\n\r\n    for (let i = 0; i < 14; i++) {\r\n      const slot = new SamplerSlot(\r\n        this.audioClock,\r\n        this.output,\r\n        defaultSlots[i].name,\r\n        defaultSlots[i].keyBinding,\r\n        i,\r\n        defaultSlots[i].cutByGroups\r\n      );\r\n      this.slots.push(slot);\r\n      container.appendChild(slot.domElement);\r\n      slot.loadSample(\"Sample\", `./data/samples/kit1/${i}.wav`);\r\n    }\r\n\r\n    audioClock.on(\"stop\", () => {\r\n      for (const slot of this.slots) {\r\n        slot.release(0);\r\n      }\r\n    });\r\n\r\n    this.domElement.appendChild(container);\r\n\r\n    this.window = new InstrumentWindow({\r\n      title: \"Sampler\",\r\n      persistent: true,\r\n      content: this.domElement,\r\n      mixerChannel,\r\n    }, this);\r\n  }\r\n\r\n  trigger(note: number, channel: number | null, beat = 0) {\r\n    console.log(\"Sampler trigger\", note);\r\n    const slot = this.slots[note];\r\n    if (slot) {\r\n      for (const each of this.slots) {\r\n        if (each.cutByGroups.includes(slot.cutGroup)) {\r\n          each.release(beat);\r\n        }\r\n      }\r\n      return slot.trigger(beat);\r\n    }\r\n  }\r\n\r\n  release(note: number, time = 0): void {\r\n    if (this.slots[note]) {\r\n      this.slots[note].release(time);\r\n    }\r\n  }\r\n\r\n  onKeyDown(event: KeyboardEvent) {\r\n    //console.log(event.key, event.keyCode);\r\n    const slot = this.slots.find((slot) => slot.keyBinding === event.keyCode);\r\n    if (slot) {\r\n      event.preventDefault();\r\n      const note = this.slots.indexOf(slot);\r\n      this.trigger(note, null);\r\n    }\r\n  }\r\n}\r\n","import { AudioClock } from \"./elements/components/AudioClock\";\r\nimport { Project } from \"./elements/Project\";\r\nimport { ProjectUI } from \"./elements/ProjectUI\";\r\nimport { FMBass } from \"./plugins/fmbass/FMBass\";\r\nimport { Plugins } from \"./plugins/plugins\";\r\nimport { Sampler } from \"./plugins/sampler/Sampler\";\r\nimport { templates } from \"./schema\";\r\n\r\nPlugins.register(\"sampler\", Sampler);\r\nPlugins.register(\"fm_bass\", FMBass);\r\n\r\nconst domElement = document.createElement(\"div\");\r\ndomElement.classList.add(\"studio\");\r\n\r\nconst audioClock = new AudioClock();\r\nconst project = new Project(audioClock, templates.Basic);\r\nconst projectUI = new ProjectUI(project);\r\n\r\ndomElement.appendChild(audioClock.domElement);\r\ndomElement.appendChild(projectUI.domElement);\r\ndocument.body.appendChild(domElement);\r\n","export type ControllerGroup = { [key: string]: IPluginControl };\r\nexport type ControllerValue = number | string | boolean | AudioBuffer | object;\r\nexport type ControlType =\r\n  | \"knob\"\r\n  | \"slider\"\r\n  | \"string\"\r\n  | \"select\"\r\n  | \"audio\"\r\n  | \"object\";\r\n\r\nexport interface IEvent {\r\n  label: string;\r\n  start: number;\r\n  duration: number;\r\n  note?: number;\r\n  row?: number;\r\n  velocity?: number;\r\n  domElement?: HTMLElement;\r\n}\r\n\r\nexport interface IPlaylistEvent extends IEvent {\r\n  type: \"pattern\" | \"audio\";\r\n  value: IPattern | AudioBuffer;\r\n  domElement?: HTMLElement;\r\n  start: number;\r\n  duration: number;\r\n}\r\n\r\nexport interface ISequence {\r\n  events: IEvent[];\r\n}\r\n\r\nexport interface IPattern {\r\n  name: string;\r\n  tracks: ISequence[];\r\n  image?: string;\r\n}\r\n\r\nexport interface ITrackOptions {\r\n  name: string;\r\n  mute: boolean;\r\n  solo: boolean;\r\n  selected: boolean;\r\n}\r\n\r\nexport interface IHasOwnEnvelope {\r\n  envelope: IEnvelope | null;\r\n}\r\n\r\nexport interface IHasOwnLFO {\r\n  lfo?: IOscillatorSettings;\r\n}\r\n\r\nexport interface IUseEnvelope {\r\n  envelopeNumber: number | null;\r\n}\r\n\r\nexport interface IUseLFO {\r\n  lfoNumber: number | null;\r\n}\r\n\r\nexport interface IHasControls {\r\n  controllerGroups: ControllerGroup[];\r\n}\r\n\r\nexport interface IInstrumentSettings extends IHasControls {\r\n  name: string;\r\n  id: string;\r\n  inputPort?: number;\r\n  inputChannel?: number;\r\n}\r\n\r\nexport interface IPlaylist {\r\n  events: IPlaylistEvent[];\r\n}\r\n\r\nexport interface IMixer {\r\n  channels: IMixerChannel[];\r\n}\r\n\r\nexport interface IMixerChannel {\r\n  label: string;\r\n  gain: number;\r\n  mute: boolean;\r\n  solo: boolean;\r\n  outputs: number[];\r\n}\r\n\r\nexport interface IProject {\r\n  title: string;\r\n  description: string;\r\n  tempo: number;\r\n  instruments: IInstrumentSettings[];\r\n  patterns: IPattern[];\r\n  tracks: ITrackOptions[];\r\n  playlist: IPlaylist;\r\n  mixer: IMixer;\r\n}\r\n\r\nexport interface ISamplerSlot {\r\n  name: string;\r\n  buffer: AudioBuffer | null;\r\n  keyBinding: number | null;\r\n  velocity: number;\r\n  pan: number;\r\n  pitch: number;\r\n  randomPitch: number;\r\n  randomVelocity: number;\r\n  startPosition: number;\r\n  endPosition: number;\r\n  loop: boolean;\r\n  loopStart: number;\r\n  loopEnd: number;\r\n  cutGroup: number;\r\n  cutByGroups: number[];\r\n}\r\n\r\nexport interface ISamplerSettings {\r\n  name: string;\r\n  slots: ISamplerSlot[];\r\n}\r\n\r\nexport interface IPluginControl {\r\n  type: ControlType;\r\n  name: string;\r\n  label: string;\r\n  default: ControllerValue;\r\n  value: ControllerValue;\r\n  min?: number;\r\n  max?: number;\r\n  step?: number;\r\n}\r\n\r\nexport interface IEnvelope {\r\n  attack: IPluginControl;\r\n  hold: IPluginControl;\r\n  decay: IPluginControl;\r\n  sustain: IPluginControl;\r\n  release: IPluginControl;\r\n}\r\n\r\nexport interface IOscillatorSettings extends IHasOwnEnvelope {\r\n  shape: \"sine\" | \"square\" | \"sawtooth\" | \"triangle\";\r\n  detune: number;\r\n  gain?: number;\r\n  route?: number;\r\n  feedback?: number;\r\n}\r\n\r\nexport interface IFilter extends IHasOwnEnvelope {\r\n  type:\r\n    | \"lowpass\"\r\n    | \"highpass\"\r\n    | \"bandpass\"\r\n    | \"lowshelf\"\r\n    | \"highshelf\"\r\n    | \"peaking\"\r\n    | \"notch\"\r\n    | \"allpass\";\r\n  frequency: number;\r\n  detune: number;\r\n  Q: number;\r\n  gain: number;\r\n}\r\n\r\nexport interface ISynthesizerSettings {\r\n  name: string;\r\n  voices: ISynthesizerVoiceSettings[];\r\n}\r\n\r\nexport interface ISynthesizerVoiceSettings extends IUseEnvelope, IUseLFO {\r\n  gain: number;\r\n  frequency: number | null;\r\n  detune: number | null;\r\n  oscillators: IOscillatorSettings[];\r\n  note: number | null;\r\n}\r\n\r\nexport const templates: { [key: string]: IProject } = {\r\n  Basic: {\r\n    title: \"Basic\",\r\n    description: \"Basic project template with Sampler and Synthesizer\",\r\n    tempo: 120,\r\n    instruments: [\r\n      { name: \"Sampler\", id: \"sampler\", controllerGroups: [] },\r\n      {\r\n        name: \"FM Bass\",\r\n        id: \"fm_bass\",\r\n        controllerGroups: [],\r\n      },\r\n    ],\r\n    patterns: [\r\n      {\r\n        name: \"Pattern 1\",\r\n        tracks: [\r\n          {\r\n            events: [],\r\n          },\r\n          {\r\n            events: [],\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n    tracks: [],\r\n    playlist: { events: [] },\r\n    mixer: {\r\n      channels: [\r\n        { label: \"Master\", gain: 1, mute: false, solo: false, outputs: [] },\r\n        { label: \"Drums\", gain: 1, mute: false, solo: false, outputs: [0] },\r\n        { label: \"Bass\", gain: 1, mute: false, solo: false, outputs: [0] },\r\n      ],\r\n    },\r\n  },\r\n};\r\n"],"names":["exports","Symbol","toStringTag","Object","defineProperty","value","_events","_onceEvents","on","eventName","callback","this","push","once","emit","eventData","onceCallbacks","error","console","undefined","callbacks","audioContext","AudioContext","window","webkitAudioContext","getAudioContext","latencyHint","sampleRate","prototype","navigator","mediaDevices","enumerateDevices","getAudioDevices","then","devices","log","_playbackMode","_audioContext","_bpm","_scheduledEvents","_startTime","domElement","document","createElement","classList","add","playPauseButton","textContent","addEventListener","isPlaying","stop","playPause","appendChild","stopButton","bpmInput","type","parseFloat","currentTimeDisplay","currentTime","start","requestAnimationFrame","_render","bind","_update","currentBeat","source","disconnect","restart","buffer","createBuffer","createBufferSource","connect","destination","beat","bars","Math","floor","beats","timeString","toString","padStart","scheduleEventAtTime","time","emptyBuffer","onended","scheduleEventAtBeat","tagName","className","child","removeChild","audioClock","mixer","assert","BaseElement","register","name","plugin","_plugins","warn","get","instantiate","id","linearToGain","linearValue","dBValue","max","min","pow","label","gain","outputs","mute","solo","gainNode","createGain","MathHelpers","channels","master","MixerChannel","i","channel","project","title","description","tempo","instruments","patterns","tracks","playlist","events","setTimeout","load","Mixer","serialize","JSON","stringify","map","instrument","controllerGroups","timeline","deserialize","data","parse","Plugins","instance","container","_isOpen","toggle","open","close","_activeWindow","windows","_draggingWindow","topRow","bottomRow","_leftPanel","WindowSnapPanel","_workspace","_rightPanel","_bottomPanel","_handleWindowDrag","e","elt","target","workspaceWidth","getBoundingClientRect","width","parentElement","leftPanelWidth","event","clientX","panelWidth","style","height","rightPanelWidth","left","win","resetDragOffset","setSize","options","_handleWindowResize","addWindow","includes","activateWindow","w","zIndex","BOTTOM_ROW","TOP_ROW","KEY_COLORS","NOTE_NAMES","keyToNote","keyCode","note","indexOf","pressedKeys","ctrlKey","altKey","shiftKey","splice","_resizing","_startX","_startY","_startWidth","_startHeight","_startTop","_startLeft","_resizeDirection","handle","getCurrentHandle","cursor","onmove","dx","dy","clientY","top","offsetWidth","offsetHeight","button","startResize","preventDefault","onrelease","stopResize","removeEventListener","direction","offsetTop","offsetLeft","rect","offsetX","offsetY","_isDragging","_dragOffsetX","_dragOffsetY","_top","_left","display","persistent","titlebar","scrollTop","ondrag","newTop","newLeft","deltaX","deltaY","body","_title","content","_closeButton","show","x","y","innerWidth","innerHeight","remove","setPosition","setTitle","SizableElement","isMaster","_channel","_label","volume","step","_volume","_mute","_solo","valueAsNumber","checked","ui","overflowX","MixerChannelStrip","length","DraggableWindow","items","item","addSelectable","selectable","addToDom","selected","f","find","t","end","removeSelectable","index","clear","clock","update","transform","beatWidth","hide","triggerActive","timeout","group","contains","track","buttonGroup","labelAndButtons","textLabel","buttons","edit","isVisible","indicator","SelectableElement","_canvas","append","previewGroup","port","PatternTrackInstrument","preview","PatternTrackPreview","trigger","release","sequence","playback","sourceEvent","duration","nextLoop","trackContainer","AudioCursor","marginLeft","canvas","querySelector","clientWidth","addPattern","patternPreviews","SelectableGroup","loadProject","addTrack","pattern","PatternTrack","output","mixerWindow","pianoRollWindow","loadTrack","removeTrack","renderSequence","color","clearFirst","lowestNote","highestNote","Error","ctx","getContext","clearRect","paddedScale","fillStyle","fillRect","renderPattern","concat","GraphicsHelpers","scrollElement","sensitivity","linkedElements","_scrollTop","linkElement","element","playOnClick","playBuffer","generateAudio","Promise","resolve","reject","req","text","pitch","rate","fetch","method","headers","res","arrayBuffer","decodeAudioData","audioBuffer","catch","loadBuffer","channelData","getChannelData","bufferLength","sliceWidth","beginPath","moveTo","lineTo","stroke","AudioCanvas","ok","cancel","closeButton","HTMLButtonElement","okButton","cancelButton","targetObject","onsave","textInput","setAttribute","audioCanvas","LyricCanvas","saveButton","DialogPopup","grid","image","velocity","audio","noteItem","rowHeight","labelElement","backgroundImage","gridElement","rowCount","_currentItem","_dragMode","_dragOffset","_sequence","quantize","drawingEnabled","drawingLabel","drawingImage","previewCanvas","imageRendering","rowBackgroundCanvas","lineWidth","strokeStyle","j","row","base64","toDataURL","backgroundRepeat","noteEditor","LyricEditorDialog","input","layerX","HTMLDivElement","n","layerY","round","oldStart","pointerEvents","GridItem","ScrollPanel","keys","noteHeight","redraw","key","innerHTML","backgroundColor","reverse","cursorUpdateInterval","sideKeyboard","SideKeyboard","Grid","pianoRoll","PianoRoll","attachedElement","_submenus","_handlePointerDown","addItem","addSubmenu","submenu","innerText","_track","settings","_items","Map","_trackPanels","playlistEvent","set","has","delete","playlistTrack","PlaylistTrack","Playlist","sourceContainer","bucket","refresh","addMenu","ContextMenu","fileInput","accept","file","files","click","addButton","PlaylistSourceItem","WindowContainer","PianoRollWindow","patternWindow","PatternWindow","playlistWindow","PlaylistWindow","MixerWindow","keyboard","Keyboard","hideZero","_hideZero","_value","_step","startY","startValue","onMouseMove","oldValue","newValue","onMouseUp","mixerChannelSelector","DraggableNumber","mixerChannel","_settingsBar","insertBefore","Plugin","voices","_nextVoice","_held","transpose","addVoice","voice","handleEvent","findIndex","forEach","Instrument","_settings","_note","_frequency","_gain","lfoNumber","envelopeNumber","detune","oscillators","loadSettings","_type","_name","_min","_max","_default","_range","blur","attack","hold","decay","sustain","Slider","param","when","cancelScheduledValues","setValueAtTime","exponentialRampToValueAtTime","linearRampToValueAtTime","triggerRelease","setTargetAtTime","SynthesizerVoice","version","author","InstrumentWindow","modulatorGain","highpassFilter","createBiquadFilter","frequency","filter","Q","filterEnvelope","Envelope","gainEnvelope","fmGainSlider","_heldNote","_carrier","context","state","g","_modulator","createOscillator","freq","noteToFrequency","Synthesizer","keyBinding","cutGroup","cutByGroups","_sources","pan","randomPitch","randomVelocity","startPosition","endPosition","loop","loopStart","loopEnd","_previewCanvas","_nameElement","loadSample","url","response","statusText","playbackRate","random","createStereoPanner","startTime","bpm","entry","cut","currentValue","slots","onKeyDown","_slotsContainer","defaultSlots","slot","SamplerSlot","each","Sampler","FMBass","AudioClock","projectUI","ProjectUI","Project"],"sourceRoot":""}