{"version":3,"file":"monofy-studio.js","mappings":"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","sources":["webpack://monofy/webpack/bootstrap","webpack://monofy/webpack/runtime/make namespace object","webpack://monofy/../elements/src/managers/AudioManager.ts","webpack://monofy/../elements/src/constants/audioConstants.ts","webpack://monofy/../elements/src/elements/AudioCanvas.ts","webpack://monofy/./src/elements/LyricCanvas.ts","webpack://monofy/../elements/src/EventObject.ts","webpack://monofy/../elements/src/DialogPopup.ts","webpack://monofy/./src/elements/audioDialogs.ts","webpack://monofy/./src/elements/Grid.ts","webpack://monofy/./src/elements/SideKeyboard.ts","webpack://monofy/./src/elements/PianoRoll.ts","webpack://monofy/./src/elements/AudioClock.ts","webpack://monofy/../elements/src/elements/BaseElement.ts","webpack://monofy/../elements/src/elements/SizableElement.ts","webpack://monofy/../elements/src/elements/DraggableWindow.ts","webpack://monofy/../elements/src/elements/WindowContainer.ts","webpack://monofy/./src/elements/PatternTrack.ts","webpack://monofy/./src/elements/PatternWindow.ts","webpack://monofy/./src/elements/PlaylistTrack.ts","webpack://monofy/./src/elements/PlaylistWindow.ts","webpack://monofy/./src/index.ts","webpack://monofy/./src/elements/Composition.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","let audioContext: AudioContext | null = null;\r\n\r\nexport function getAudioContext() {\r\n  if (!audioContext) {\r\n    const AudioContext =\r\n      window.AudioContext || (window as any).webkitAudioContext;\r\n    audioContext = new AudioContext();\r\n\r\n    console.log(\"Audio context created\");\r\n\r\n    // force audio context to start\r\n    const buffer = audioContext.createBuffer(1, 1, audioContext.sampleRate);\r\n    const source = audioContext.createBufferSource();\r\n    source.buffer = buffer;\r\n    source.connect(audioContext.destination);\r\n    source.start(0);\r\n  }\r\n  return audioContext;\r\n}\r\n","export const DEFAULT_NOTE_HEIGHT = 20;\r\n\r\nexport const KEY_COLORS = [\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n];\r\n\r\nexport const NOTE_NAMES = [\r\n  \"A\",\r\n  \"A#\",\r\n  \"B\",\r\n  \"C\",\r\n  \"C#\",\r\n  \"D\",\r\n  \"D#\",\r\n  \"E\",\r\n  \"F\",\r\n  \"F#\",\r\n  \"G\",\r\n  \"G#\",\r\n];\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\n\r\nexport class AudioCanvas {\r\n  domElement: HTMLDivElement;\r\n  canvas: HTMLCanvasElement;\r\n  ctx: CanvasRenderingContext2D;\r\n  buffer: AudioBuffer | null = null;\r\n\r\n  constructor() {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-canvas\");\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.canvas.width = 800;\r\n    this.canvas.height = 200;\r\n    this.domElement.appendChild(this.canvas);\r\n\r\n    this.canvas.addEventListener(\"click\", () => {\r\n      if (this.buffer) {\r\n        this.playBuffer(this.buffer);\r\n      }\r\n    });\r\n\r\n    this.ctx = this.canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; pitch: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.pitch,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n\r\n  playBuffer(audioBuffer: AudioBuffer) {\r\n    const ctx = getAudioContext();\r\n    const source = ctx.createBufferSource();\r\n    source.buffer = audioBuffer;\r\n    source.connect(ctx.destination);\r\n    source.start();\r\n  }\r\n\r\n  loadBuffer(audioBuffer: AudioBuffer) {\r\n    this.buffer = audioBuffer;\r\n\r\n    const channelData = audioBuffer.getChannelData(0);\r\n    const bufferLength = channelData.length;\r\n    const sliceWidth = this.canvas.width / bufferLength;\r\n\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.canvas.height / 2);\r\n\r\n    for (let i = 0; i < bufferLength; i++) {\r\n      const x = i * sliceWidth;\r\n      const y = ((channelData[i] + 1) * this.canvas.height) / 2;\r\n\r\n      this.ctx.lineTo(x, y);\r\n    }\r\n\r\n    this.ctx.lineTo(this.canvas.width, this.canvas.height / 2);\r\n    this.ctx.stroke();\r\n  }\r\n}\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\nimport { AudioCanvas } from \"../../../elements/src/elements/AudioCanvas\";\r\nimport { GridItem } from \"./Grid\";\r\n\r\nexport class LyricCanvas extends AudioCanvas {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  async generateAudio(\r\n    note: GridItem,\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.pitch,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n}\r\n","export interface EventDataMap {\r\n  cancel: unknown;\r\n  start: unknown;\r\n  stop: unknown;\r\n  pause: unknown;\r\n  result: unknown;\r\n  update: unknown;\r\n  open: unknown;\r\n  close: unknown;\r\n  resize: unknown;\r\n}\r\n\r\nexport type BaseEvent = keyof EventDataMap;\r\n\r\nexport default abstract class EventObject<E extends BaseEvent = BaseEvent> {\r\n  private _events: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n  private _onceEvents: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n\r\n  on(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._events[eventName]) {\r\n      this._events[eventName] = [];\r\n    }\r\n    this._events[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  once(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._onceEvents[eventName]) {\r\n      this._onceEvents[eventName] = [];\r\n    }\r\n    this._onceEvents[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  fireEvent(eventName: E, eventData?: EventDataMap[E]) {\r\n    const onceCallbacks = this._onceEvents[eventName];\r\n    if (onceCallbacks) {\r\n      for (const callback of onceCallbacks) {\r\n        try {\r\n          callback(eventData);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .once callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n      this._onceEvents[eventName] = undefined;\r\n    }\r\n\r\n    const callbacks = this._events[eventName];\r\n    if (callbacks) {\r\n      for (const callback of callbacks) {\r\n        try {\r\n          callback(eventData);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .on callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import EventObject from \"./EventObject\";\r\n\r\nexport class DialogPopup extends EventObject<\"result\" | \"cancel\"> {\r\n  domElement: HTMLDivElement;\r\n  closeButton: HTMLButtonElement;\r\n  okButton: HTMLButtonElement | undefined;\r\n  cancelButton: HTMLButtonElement | undefined;\r\n\r\n  get isVisibile() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    private readonly ok: string | HTMLButtonElement = \"OK\",\r\n    private readonly cancel: string | HTMLButtonElement = \"Cancel\"\r\n  ) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"dialog-popup\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.textContent = \"X\";\r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"click\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    if (ok instanceof HTMLButtonElement) {\r\n      this.okButton = ok;\r\n    } else if (ok) {\r\n      this.okButton = document.createElement(\"button\");\r\n      this.okButton.textContent = ok;\r\n      this.domElement.appendChild(this.okButton);\r\n    }\r\n\r\n    if (this.okButton) {\r\n      this.okButton.addEventListener(\"click\", () => {\r\n        this.fireEvent(\"result\", this);\r\n      });\r\n    }\r\n\r\n    if (cancel instanceof HTMLButtonElement) {\r\n      this.cancelButton = cancel;\r\n    } else if (cancel) {\r\n      this.cancelButton = document.createElement(\"button\");\r\n      this.cancelButton.textContent = cancel;\r\n      this.domElement.appendChild(this.cancelButton);\r\n    }\r\n\r\n    if (this.cancelButton) {\r\n      this.cancelButton.addEventListener(\"click\", () => {\r\n        this.fireEvent(\"cancel\", this);\r\n      });\r\n    }\r\n  }\r\n\r\n  show(x: number, y: number, targetObject?: unknown) { /* eslint-disable-line @typescript-eslint/no-unused-vars */\r\n    this.domElement.style.display = \"block\";\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","import { LyricCanvas } from \"./LyricCanvas\";\r\nimport { GridItem } from \"./Grid\";\r\nimport { DialogPopup } from \"../../../elements/src/DialogPopup\";\r\n\r\nexport class PianoRollDialog extends DialogPopup {\r\n  domElement: HTMLDivElement;\r\n  closeButton: HTMLButtonElement;\r\n  saveButton: HTMLButtonElement;\r\n  note: GridItem | null = null;\r\n\r\n  constructor(public onsave: (note: GridItem) => void) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-dialog\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.textContent = \"X\";\r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"click\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    this.saveButton = document.createElement(\"button\");\r\n    this.saveButton.textContent = \"Save\";\r\n    this.domElement.appendChild(this.saveButton);\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  override show(x: number, y: number, note: GridItem) {\r\n    super.show(x, y, note);\r\n    this.note = note;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class LyricEditorDialog extends PianoRollDialog {\r\n  textInput: HTMLInputElement;\r\n  audioCanvas: LyricCanvas;\r\n  pitchSlider: HTMLInputElement;\r\n  constructor(onsave: (note: GridItem) => void) {\r\n    super(onsave);\r\n    this.domElement.classList.add(\"piano-roll-note-editor\");\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this.textInput = document.createElement(\"input\");\r\n    this.textInput.setAttribute(\"placeholder\", \"Note lyric\");\r\n    this.textInput.classList.add(\"lyric-editor-text\");\r\n    this.textInput.type = \"text\";\r\n    this.domElement.appendChild(this.textInput);\r\n\r\n    this.pitchSlider = document.createElement(\"input\");\r\n    this.pitchSlider.classList.add(\"lyric-editor-pitch\");\r\n    this.pitchSlider.type = \"range\";\r\n    this.pitchSlider.min = \"-0.5\";\r\n    this.pitchSlider.max = \"0.5\";\r\n    this.pitchSlider.step = \"0.01\";\r\n    this.pitchSlider.value = \"0\";\r\n    this.pitchSlider.addEventListener(\"input\", () => {\r\n      this.note!.pitch = parseFloat(this.pitchSlider.value);\r\n    });\r\n    this.domElement.appendChild(this.pitchSlider);\r\n\r\n    this.audioCanvas = new LyricCanvas();\r\n    this.domElement.appendChild(this.audioCanvas.domElement);\r\n\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.audioCanvas.domElement.style.display = \"block\";\r\n      this.audioCanvas.generateAudio(this.note!, true).then((buffer) => {\r\n        this.note!.audio = buffer;\r\n      });\r\n      this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  show(x: number, y: number, note: GridItem) {\r\n    super.show(x, y, note);\r\n    this.textInput.value = this.note?.label || \"\";\r\n    if (this.note?.audio) {\r\n      this.audioCanvas.loadBuffer(this.note.audio);\r\n      this.audioCanvas.domElement.style.display = \"block\";\r\n    } else {\r\n      this.audioCanvas.domElement.style.display = \"none\";\r\n    }\r\n  }\r\n}\r\n","import {\r\n  DEFAULT_NOTE_HEIGHT,\r\n  NOTE_NAMES,\r\n} from \"../../../elements/src/constants/audioConstants\";\r\nimport { LyricEditorDialog } from \"./audioDialogs\";\r\n\r\nfunction getNoteNameFromPitch(pitch: number): string {\r\n  const note = NOTE_NAMES[pitch % NOTE_NAMES.length];\r\n  return `${note}${Math.floor(pitch / NOTE_NAMES.length)}`;\r\n}\r\n\r\nconst NOTE_HANDLE_WIDTH = 6;\r\n\r\nexport interface IGridItem {\r\n  pitch: number;\r\n  start: number;\r\n  end: number;\r\n  label: string;\r\n}\r\n\r\nexport class GridItem implements IGridItem {\r\n  pitch: number;\r\n  start: number;\r\n  end: number;\r\n  label: string | \"\" = \"\";\r\n  domElement: HTMLDivElement;\r\n  noteLabel: HTMLDivElement;\r\n  lyricLabel: HTMLDivElement;\r\n  audio: AudioBuffer | null = null;\r\n\r\n  constructor(\r\n    private readonly grid: Grid,\r\n    item: IGridItem\r\n  ) {\r\n    this.pitch = item.pitch;\r\n    this.start = item.start;\r\n    this.end = item.end;\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-note\");\r\n    this.domElement.style.height = `${grid.noteHeight}px`;\r\n\r\n    this.noteLabel = document.createElement(\"div\");\r\n    this.noteLabel.classList.add(\"piano-roll-note-label\");\r\n    this.noteLabel.textContent = getNoteNameFromPitch(this.pitch);\r\n    this.domElement.appendChild(this.noteLabel);\r\n\r\n    this.lyricLabel = document.createElement(\"div\");\r\n    this.lyricLabel.classList.add(\"piano-roll-note-lyric\");\r\n    this.domElement.appendChild(this.lyricLabel);\r\n\r\n    if (item.label) this.lyricLabel.textContent = item.label;\r\n    this.update();\r\n\r\n    grid.domElement.appendChild(this.domElement);\r\n  }\r\n\r\n  update() {\r\n    this.noteLabel.textContent = getNoteNameFromPitch(this.pitch);\r\n    this.lyricLabel.textContent = this.label;\r\n    this.domElement.style.top = `${(87 - this.pitch) * this.grid.noteHeight}px`;\r\n    this.domElement.style.left = `${this.start * this.grid.beatWidth}px`;\r\n    this.domElement.style.width = `${(this.end - this.start) * 100}px`;\r\n  }\r\n}\r\n\r\nexport class Grid {\r\n  domElement: HTMLDivElement;\r\n  gridElement: HTMLDivElement;\r\n  notes: GridItem[] = [];\r\n  currentNote: GridItem | null = null;\r\n  noteHeight = DEFAULT_NOTE_HEIGHT;\r\n  beatWidth = 100;\r\n  noteEditor: LyricEditorDialog;\r\n  dragMode: string | null = null;\r\n  quantize: number = 0.25;\r\n  private dragOffset: number = 0;\r\n\r\n  constructor() {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-grid-container\");\r\n\r\n    this.gridElement = document.createElement(\"div\");\r\n    this.gridElement.classList.add(\"piano-roll-grid\");\r\n\r\n    const rowBackgroundCanvas = document.createElement(\"canvas\");\r\n    rowBackgroundCanvas.width = this.beatWidth * 4;\r\n    rowBackgroundCanvas.height = this.noteHeight;\r\n    console.log(\"debug\", rowBackgroundCanvas.width, rowBackgroundCanvas.height);\r\n    const ctx = rowBackgroundCanvas.getContext(\"2d\");\r\n    if (ctx) {\r\n      ctx.strokeStyle = \"#ddd\";\r\n      ctx.lineWidth = 1;\r\n      for (let j = 1; j < 4; j++) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(j * this.beatWidth, 0);\r\n        ctx.lineTo(j * this.beatWidth, this.noteHeight);\r\n        ctx.stroke();\r\n      }\r\n      ctx.lineWidth = 3;\r\n      ctx.strokeStyle = \"#aaa\";\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, 0);\r\n      ctx.lineTo(0, this.noteHeight);\r\n      ctx.stroke();\r\n    }\r\n    for (let i = 0; i < 88; i++) {\r\n      const row = document.createElement(\"div\");\r\n      row.classList.add(\"piano-roll-grid-row\");\r\n      row.style.height = `${this.noteHeight}px`;\r\n      this.gridElement.appendChild(row);\r\n      row.style.backgroundImage = `url(${rowBackgroundCanvas.toDataURL()})`;\r\n      row.style.backgroundRepeat = \"repeat\";\r\n    }\r\n    this.domElement.appendChild(this.gridElement);\r\n\r\n    this.noteEditor = new LyricEditorDialog((note) => {\r\n      const input = this.noteEditor.domElement.querySelector(\r\n        \".lyric-editor-text\"\r\n      ) as HTMLInputElement;\r\n      note.label = input?.value || \"\";\r\n      note.update();\r\n    });\r\n\r\n    document.body.appendChild(this.noteEditor.domElement);\r\n\r\n    this.gridElement.addEventListener(\"pointerdown\", (event) => {\r\n      const x = event.layerX;\r\n      this.dragOffset = x;\r\n      event.preventDefault();\r\n      if (this.noteEditor.domElement.style.display === \"block\") {\r\n        this.noteEditor.domElement.style.display = \"none\";\r\n        return;\r\n      }\r\n\r\n      if (\r\n        event.target instanceof HTMLDivElement &&\r\n        event.target.classList.contains(\"piano-roll-note\")\r\n      ) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const note = this.notes.find((n) => n.domElement === event.target);\r\n\r\n        if (event.ctrlKey || event.button === 1) {\r\n          if (note)\r\n            this.noteEditor.show(event.clientX + 20, event.clientY - 5, note);\r\n          else this.noteEditor.domElement.style.display = \"none\";\r\n        }\r\n\r\n        if (note) {\r\n          this.currentNote = note;\r\n\r\n          if (event.button === 2) {\r\n            this.remove(note);\r\n            this.currentNote = null;\r\n          } else {\r\n            this.currentNote.domElement.parentElement?.appendChild(\r\n              this.currentNote.domElement\r\n            );\r\n            if (x < NOTE_HANDLE_WIDTH) {\r\n              this.dragMode = \"start\";\r\n            } else if (\r\n              this.currentNote.domElement.offsetWidth - x <\r\n              NOTE_HANDLE_WIDTH\r\n            ) {\r\n              this.dragMode = \"end\";\r\n            } else {\r\n              this.dragMode = \"move\";\r\n            }\r\n            console.log(\r\n              \"drag mode\",\r\n              this.dragMode,\r\n              x,\r\n              this.currentNote.domElement.offsetWidth\r\n            );\r\n          }\r\n        }\r\n      } else if (event.button !== 0) return;\r\n      else if (event.target === this.gridElement) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const pitch = 87 - Math.floor(event.layerY / this.noteHeight);\r\n\r\n        let start = event.layerX / this.beatWidth;\r\n        start = Math.round(start / this.quantize) * this.quantize;\r\n\r\n        this.currentNote = new GridItem(this, {\r\n          pitch: pitch,\r\n          start: start,\r\n          end: (event.layerX + 0.125) / this.beatWidth,\r\n          label: \"\",\r\n        });\r\n        this.add(this.currentNote);\r\n        this.dragMode = \"end\";\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      this.currentNote = null;\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this.currentNote) {\r\n        this.remove(this.currentNote);\r\n        this.currentNote = null;\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"contextmenu\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointermove\", (event) => {\r\n      if (this.currentNote && event.buttons === 1) {\r\n        if (this.dragMode === \"start\") {\r\n          this.currentNote.start = event.layerX / this.beatWidth;\r\n          this.currentNote.start =\r\n            Math.round(this.currentNote.start / this.quantize) * this.quantize;\r\n          this.currentNote.domElement.style.left = `${\r\n            this.currentNote.start * this.beatWidth\r\n          }px`;\r\n          this.currentNote.domElement.style.width = `${\r\n            (this.currentNote.end - this.currentNote.start) * this.beatWidth\r\n          }px`;\r\n        } else if (this.dragMode === \"end\") {\r\n          this.currentNote.end = event.layerX / this.beatWidth;\r\n          this.currentNote.end =\r\n            Math.round(this.currentNote.end / this.quantize) * this.quantize;\r\n          this.currentNote.domElement.style.width = `${\r\n            (this.currentNote.end - this.currentNote.start) * this.beatWidth\r\n          }px`;\r\n        } else if (this.dragMode === \"move\") {\r\n          this.currentNote.start =\r\n            (event.layerX - this.dragOffset) / this.beatWidth;\r\n          this.currentNote.start =\r\n            Math.round(this.currentNote.start / this.quantize) * this.quantize;\r\n          this.currentNote.domElement.style.left = `${\r\n            this.currentNote.start * this.beatWidth\r\n          }px`;\r\n        }\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this.currentNote) {\r\n        this.currentNote.domElement.style.pointerEvents = \"auto\";\r\n      }\r\n      this.currentNote = null;\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this.currentNote) {\r\n        this.currentNote.domElement.style.pointerEvents = \"auto\";\r\n      }\r\n      this.currentNote = null;\r\n    });\r\n\r\n    this.update();\r\n  }\r\n\r\n  update() {\r\n    // TODO: update background grid\r\n\r\n    this.notes.forEach((note) => note.update());\r\n  }\r\n\r\n  add(note: GridItem) {\r\n    this.notes.push(note);\r\n    this.gridElement.appendChild(note.domElement);\r\n  }\r\n  remove(note: GridItem) {\r\n    this.notes = this.notes.filter((n) => n !== note);\r\n    this.gridElement.removeChild(note.domElement);\r\n  }\r\n  loadEvents(events: IGridItem[]) {\r\n    this.notes = events.map((e) => new GridItem(this, e));\r\n    this.notes.forEach((note) => this.gridElement.appendChild(note.domElement));\r\n  }\r\n  createPreviewImage(): HTMLCanvasElement {\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = this.beatWidth * 4;\r\n    canvas.height = this.noteHeight * 88;\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (ctx) {\r\n      ctx.fillStyle = \"#fff\";\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n      this.notes.forEach((note) => {\r\n        ctx.fillStyle = \"#000\";\r\n        ctx.fillRect(\r\n          note.start * this.beatWidth,\r\n          (87 - note.pitch) * this.noteHeight,\r\n          (note.end - note.start) * this.beatWidth,\r\n          this.noteHeight\r\n        );\r\n      });\r\n    }\r\n    return canvas;\r\n  }\r\n}\r\n","import {\r\n  DEFAULT_NOTE_HEIGHT,\r\n  KEY_COLORS,\r\n  NOTE_NAMES,\r\n} from \"../../../elements/src/constants/audioConstants\";\r\n\r\nexport class SideKeyboard {\r\n  domElement: HTMLDivElement;\r\n  keys: HTMLDivElement[] = [];\r\n  noteHeight = DEFAULT_NOTE_HEIGHT;\r\n\r\n  constructor() {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-keyboard\");\r\n\r\n    this.redraw();\r\n  }\r\n\r\n  redraw() {\r\n    this.domElement.innerHTML = \"\";\r\n\r\n    for (let i = 87; i >= 0; i--) {\r\n      const key = document.createElement(\"div\");\r\n      key.classList.add(\"piano-roll-keyboard-key\");\r\n      key.style.height = `${this.noteHeight}px`;\r\n      // key.style.bottom = `${i * this.noteHeight}px`;\r\n      key.style.backgroundColor =\r\n        KEY_COLORS[i % 12] === \"white\" ? \"#fff\" : \"#000\";\r\n      key.style.color = KEY_COLORS[i % 12] === \"white\" ? \"#000\" : \"#fff\";\r\n      key.textContent = NOTE_NAMES[i % 12] + ((i / 12) | 0).toString();\r\n      this.domElement.appendChild(key);\r\n    }\r\n  }\r\n}\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { Grid, IGridItem } from \"./Grid\";\r\nimport { SideKeyboard } from \"./SideKeyboard\";\r\n\r\nexport class PianoRoll {\r\n  domElement: HTMLDivElement;\r\n  grid: Grid;\r\n  sideKeyboard: SideKeyboard;\r\n  cursor: HTMLDivElement;\r\n  cursorUpdateInterval: number | object | null = null;\r\n  scheduledSources: AudioBufferSourceNode[] = [];\r\n\r\n  constructor(private readonly clock: AudioClock) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll\");\r\n\r\n    this.sideKeyboard = new SideKeyboard();\r\n    this.domElement.appendChild(this.sideKeyboard.domElement);\r\n\r\n    this.grid = new Grid();\r\n    this.domElement.appendChild(this.grid.domElement);\r\n\r\n    this.cursor = document.createElement(\"div\");\r\n    this.cursor.classList.add(\"piano-roll-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor);\r\n\r\n    clock.on(\"start\", () => {\r\n      if (this.cursorUpdateInterval) {\r\n        clearInterval(this.cursorUpdateInterval as number);\r\n      }\r\n      this.cursor.style.transform = \"translateX(0)\";\r\n      this.cursor.style.display = \"block\";\r\n      this.cursor.parentElement?.appendChild(this.cursor);\r\n      this.scheduleAudioEvents();\r\n    });\r\n\r\n    clock.on(\"update\", () => {\r\n      this.updateCursor();\r\n    });\r\n\r\n    clock.on(\"stop\", () => {\r\n      this.cursor.style.display = \"none\";\r\n      this.scheduledSources.forEach((source) => source.stop());\r\n      this.scheduledSources = [];\r\n    });\r\n  }\r\n\r\n  updateCursor() {\r\n    if (this.clock.isPlaying) {\r\n      this.cursor.style.transform = `translateX(${\r\n        this.clock.currentBeat * this.grid.beatWidth\r\n      }px)`;\r\n    }\r\n  }\r\n\r\n  scheduleAudioEvents() {\r\n    const ctx = getAudioContext();\r\n    this.grid.notes.forEach((note) => {\r\n      const bufferSource = ctx.createBufferSource();\r\n      bufferSource.buffer = note.audio;\r\n      bufferSource.connect(ctx.destination);\r\n      bufferSource.start(ctx.currentTime + (note.start * 60) / this.clock.bpm);\r\n      this.scheduledSources.push(bufferSource);\r\n    });\r\n  }\r\n\r\n  loadEvents(events: IGridItem[]) {\r\n    this.grid.loadEvents(events);\r\n  }\r\n}\r\n","import EventObject from \"../../../elements/src/EventObject\";\r\nimport { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\n\r\nexport class AudioClock extends EventObject<\r\n  \"start\" | \"stop\" | \"pause\" | \"update\"\r\n> {\r\n  domElement: HTMLDivElement;\r\n  bpmInput: HTMLInputElement;\r\n  playPauseButton: HTMLButtonElement;\r\n  stopButton: HTMLButtonElement;\r\n  currentTimeDisplay: HTMLSpanElement;\r\n  private _isPlaying: boolean = false;\r\n  private _bpm: number = 100;\r\n  private startTime: number | null = null;\r\n\r\n  get currentBeat(): number {\r\n    const elapsedTime =\r\n      this.startTime !== null\r\n        ? getAudioContext().currentTime - this.startTime\r\n        : 0;\r\n    return elapsedTime * (this._bpm / 60);\r\n  }\r\n\r\n  get isPlaying(): boolean {\r\n    return this._isPlaying;\r\n  }\r\n\r\n  get bpm(): number {\r\n    return this._bpm;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-clock\");\r\n\r\n    this.bpmInput = document.createElement(\"input\");\r\n    this.bpmInput.classList.add(\"audio-clock-bpm\");\r\n    this.bpmInput.type = \"number\";\r\n    this.bpmInput.value = \"120\";\r\n\r\n    this.bpmInput.addEventListener(\"input\", () => {\r\n      this._bpm = parseFloat(this.bpmInput.value);\r\n    });\r\n    this.domElement.appendChild(this.bpmInput);\r\n    this.playPauseButton = document.createElement(\"button\");\r\n    this.playPauseButton.classList.add(\"audio-clock-play-pause\");\r\n    this.playPauseButton.textContent = \"Play\";\r\n\r\n    this.playPauseButton.addEventListener(\"click\", () => {\r\n      if (this._isPlaying) {\r\n        this.stop();\r\n      } else {\r\n        getAudioContext();\r\n        this.play();\r\n      }\r\n    });\r\n    this.domElement.appendChild(this.playPauseButton);\r\n    this.stopButton = document.createElement(\"button\");\r\n    this.stopButton.classList.add(\"audio-clock-stop\");\r\n    this.stopButton.textContent = \"Stop\";\r\n\r\n    this.stopButton.addEventListener(\"click\", () => {\r\n      this.stop();\r\n    });\r\n    this.domElement.appendChild(this.stopButton);\r\n    this.currentTimeDisplay = document.createElement(\"span\");\r\n    this.currentTimeDisplay.classList.add(\"audio-clock-time\");\r\n    this.currentTimeDisplay.textContent = \"01:1\";\r\n\r\n    this.domElement.appendChild(this.currentTimeDisplay);\r\n  }\r\n\r\n  private start(): void {\r\n    this.fireEvent(\"start\");\r\n    this.startTime = getAudioContext().currentTime;\r\n    console.log(\"Started at\", this.startTime);\r\n    requestAnimationFrame(this.render.bind(this));\r\n  }\r\n\r\n  private render(): void {\r\n    this.updateCurrentTimeDisplay(this.currentBeat);\r\n    this.fireEvent(\"update\");\r\n    if (this._isPlaying) requestAnimationFrame(this.render.bind(this));\r\n  }\r\n\r\n  private stop(): void {\r\n    this.fireEvent(\"stop\");\r\n    this._isPlaying = false;\r\n    this.startTime = null;\r\n    this.updateCurrentTimeDisplay(this.currentBeat);\r\n    this.playPauseButton.textContent = \"Play\";\r\n  }\r\n\r\n  private play(): void {\r\n    if (this._isPlaying) {\r\n      this.stop(); // TODO: This should be a pause\r\n    } else {\r\n      this.start();\r\n    }\r\n    this._isPlaying = !this._isPlaying;\r\n    this.playPauseButton.textContent = this._isPlaying ? \"Pause\" : \"Play\";\r\n  }\r\n\r\n  private updateCurrentTimeDisplay(beat: number): void {\r\n    const bars = Math.floor(beat / 4) + 1;\r\n    const beats = Math.floor(beat % 4) + 1;\r\n    const timeString = `${bars\r\n      .toString()\r\n      .padStart(2, \"0\")}:${beats.toString()}`;\r\n    this.currentTimeDisplay.textContent = timeString;\r\n  }\r\n}\r\n","import EventObject, { EventDataMap } from \"../EventObject\";\r\n\r\nexport abstract class BaseElement<\r\n  T extends keyof EventDataMap,\r\n> extends EventObject<T> {\r\n  domElement: HTMLElement;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super();\r\n    console.log(\"BaseElement constructor\");\r\n    this.domElement = document.createElement(tagName);\r\n    if (className) {\r\n      this.domElement.classList.add(className);\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class SizableElement<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"resize\" | T> {\r\n  private _resizing = false;\r\n  private _startX = 0;\r\n  private _startY = 0;\r\n  private _startWidth = 0;\r\n  private _startHeight = 0;\r\n  private _startTop = 0;\r\n  private _startLeft = 0;\r\n\r\n  private _resizeDirection: \"top\" | \"right\" | \"bottom\" | \"left\" | null = null;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super(tagName, className);\r\n\r\n    this.domElement.addEventListener(\"pointermove\", (e) => {\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle === \"top\" || handle === \"bottom\") {\r\n        this.domElement.style.cursor = \"ns-resize\";\r\n      } else if (handle === \"left\" || handle === \"right\") {\r\n        this.domElement.style.cursor = \"ew-resize\";\r\n      } else {\r\n        this.domElement.style.cursor = \"auto\";\r\n      }\r\n    });\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      if (this._resizing) {\r\n        console.log(this._resizeDirection);\r\n\r\n        const dx = e.clientX - this._startX;\r\n        const dy = e.clientY - this._startY;\r\n\r\n        if (this._resizeDirection === \"right\") {\r\n          this.domElement.style.width = `${this._startWidth + dx}px`;\r\n        } else if (this._resizeDirection === \"bottom\") {\r\n          this.domElement.style.height = `${this._startHeight + dy}px`;\r\n        } else if (this._resizeDirection === \"left\") {\r\n          this.domElement.style.width = `${this._startWidth - dx}px`;\r\n          this.domElement.style.left = `${this._startLeft + dx}px`;\r\n        } else if (this._resizeDirection === \"top\") {\r\n          this.domElement.style.height = `${this._startHeight - dy}px`;\r\n          this.domElement.style.top = `${this._startTop + dy}px`;\r\n        }\r\n\r\n        this.fireEvent(\"resize\", {\r\n          width: this.domElement.offsetWidth,\r\n          height: this.domElement.offsetHeight,\r\n        });\r\n      }\r\n    };\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle) {\r\n        window.addEventListener(\"pointermove\", onmove);\r\n        this.startResize(e, handle);\r\n      }\r\n      const onrelease = () => {\r\n        this.stopResize();\r\n        window.removeEventListener(\"pointermove\", onmove);\r\n        window.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      window.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n  }\r\n\r\n  protected startResize(\r\n    e: PointerEvent,\r\n    direction: \"top\" | \"right\" | \"bottom\" | \"left\"\r\n  ) {\r\n    console.log(\"startResize\", direction);\r\n    this._resizing = true;\r\n    this._startX = e.clientX;\r\n    this._startY = e.clientY;\r\n    this._startWidth = this.domElement.offsetWidth;\r\n    this._startHeight = this.domElement.offsetHeight;\r\n    this._startTop = this.domElement.offsetTop;\r\n    this._startLeft = this.domElement.offsetLeft;\r\n    this._resizeDirection = direction;\r\n  }\r\n\r\n  protected stopResize() {\r\n    console.log(\"stopResize\");\r\n    this._resizing = false;\r\n    this._resizeDirection = null;\r\n  }\r\n\r\n  getCurrentHandle(e: PointerEvent) {\r\n    const rect = this.domElement.getBoundingClientRect();\r\n    const offsetX = e.clientX - rect.left;\r\n    const offsetY = e.clientY - rect.top;\r\n\r\n    if (offsetX > 0 && offsetX < 10) {\r\n      return \"left\";\r\n    } else if (rect.width - offsetX < 10) {\r\n      return \"right\";\r\n    } else if (offsetY > 0 && offsetY < 10) {\r\n      return \"top\";\r\n    } else if (rect.height - offsetY < 10) {\r\n      return \"bottom\";\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { SizableElement } from \"./SizableElement\";\r\n\r\nexport class DraggableWindow extends SizableElement<\r\n  \"update\" | \"resize\" | \"open\" | \"close\"\r\n> {\r\n  readonly titlebar: HTMLElement;\r\n  readonly content: HTMLElement;\r\n  private readonly _title: HTMLElement;\r\n  private readonly _closeButton: HTMLButtonElement;\r\n  private _isDragging = false;\r\n  private _dragOffsetX = 0;\r\n  private _dragOffsetY = 0;\r\n  private _top = 0;\r\n  private _left = 0;\r\n\r\n  get isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    title: string,\r\n    private readonly persistent = false,\r\n    private innerContent: HTMLElement\r\n  ) {\r\n    super(\"div\", \"draggable-window\");\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.domElement.parentElement!.appendChild(this.domElement);\r\n    });\r\n\r\n    this.titlebar = document.createElement(\"div\");\r\n    this.titlebar.className = \"window-titlebar\";\r\n    this.domElement.appendChild(this.titlebar);\r\n\r\n    this.titlebar.addEventListener(\"pointerdown\", (e) => {\r\n      this._isDragging = true;\r\n      this._dragOffsetX =\r\n        e.clientX - this.domElement.getBoundingClientRect().left;\r\n      this._dragOffsetY =\r\n        e.clientY -\r\n        this.domElement.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.scrollTop;\r\n\r\n      const ondrag = (e: PointerEvent) => {\r\n        if (this._isDragging) {\r\n          console.log(\"Dragging\");\r\n\r\n          let newTop = e.clientY - this._dragOffsetY;\r\n          let newLeft = e.clientX - this._dragOffsetX;\r\n\r\n          if (newTop < 0) {\r\n            newTop = 0;\r\n          }\r\n\r\n          if (newLeft < 0) {\r\n            newLeft = 0;\r\n          }\r\n\r\n          this.domElement.style.top = `${newTop}px`;\r\n          this.domElement.style.left = `${newLeft}px`;\r\n\r\n          this._top = newTop;\r\n          this._left = newLeft;\r\n        }\r\n      };\r\n\r\n      const onrelease = () => {\r\n        this._isDragging = false;\r\n        document.body.removeEventListener(\"pointermove\", ondrag);\r\n        document.body.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      document.body.addEventListener(\"pointermove\", ondrag);\r\n      document.body.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n\r\n    this._title = document.createElement(\"div\");\r\n    this._title.className = \"title\";\r\n    this._title.textContent = title;\r\n    this.titlebar.appendChild(this._title);\r\n\r\n    this.content = document.createElement(\"div\");\r\n    this.content.className = \"window-content\";\r\n    this.domElement.appendChild(this.content);\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.className = \"window-close-button\";\r\n    this._closeButton.innerHTML = \"X\";\r\n    this._closeButton.addEventListener(\"click\", this.close.bind(this));\r\n\r\n    this.titlebar.appendChild(this._closeButton);\r\n\r\n    this.content.appendChild(this.innerContent);\r\n  }\r\n\r\n  show(x: number, y: number) {\r\n    this.domElement.style.display = \"flex\";\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n    this.fireEvent(\"open\");\r\n  }\r\n\r\n  close() {\r\n    this.domElement.style.display = \"none\";\r\n    this.fireEvent(\"close\");\r\n    if (!this.persistent) {\r\n      this.domElement.remove();\r\n    }\r\n  }\r\n\r\n  setSize(width: number, height: number) {\r\n    this.domElement.style.width = `${width}px`;\r\n    this.domElement.style.height = `${height}px`;\r\n  }\r\n\r\n  setPosition(x: number, y: number) {\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n  }\r\n}\r\n","import { DraggableWindow } from \"./DraggableWindow\";\r\n\r\nexport class WindowContainer {\r\n  readonly domElement: HTMLDivElement;\r\n\r\n  windows: DraggableWindow[] = [];\r\n  _draggingWindow: DraggableWindow | null = null;\r\n\r\n  constructor() {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.className = \"window-container\";\r\n    this.domElement.addEventListener(\"pointerdown\", () => {\r\n      \r\n    });\r\n  }\r\n\r\n  addWindow(window: DraggableWindow) {\r\n    this.windows.push(window);\r\n    this.domElement.appendChild(window.domElement);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport { IGridItem } from \"./Grid\";\r\n\r\nexport class PatternTrack extends BaseElement<\"update\"> {\r\n  constructor(\r\n    name: string,\r\n    readonly pattern: IGridItem[]\r\n  ) {\r\n    super(\"div\", \"pattern-track\");\r\n\r\n    const instrumentPanel = document.createElement(\"div\");\r\n    instrumentPanel.classList.add(\"pattern-track-panel\");\r\n\r\n    const label = document.createElement(\"div\");\r\n    instrumentPanel.appendChild(label);\r\n    label.textContent = name;\r\n\r\n    const buttons = document.createElement(\"div\");\r\n    buttons.classList.add(\"pattern-track-buttons\");\r\n    instrumentPanel.appendChild(buttons);\r\n\r\n    const mute = document.createElement(\"button\");\r\n    mute.textContent = \"M\";\r\n    buttons.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"button\");\r\n    solo.textContent = \"S\";\r\n    buttons.appendChild(solo);\r\n\r\n    const indicator = document.createElement(\"div\");\r\n    indicator.classList.add(\"pattern-track-indicator\");\r\n    buttons.appendChild(indicator);\r\n\r\n    buttons.appendChild(mute);\r\n    buttons.appendChild(solo);\r\n\r\n    const patternPanel = document.createElement(\"div\");\r\n    patternPanel.classList.add(\"pattern-track-pattern\");\r\n\r\n    this.domElement.appendChild(instrumentPanel);\r\n    this.domElement.appendChild(indicator);\r\n    this.domElement.appendChild(patternPanel);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../elements/src/elements/DraggableWindow\";\r\nimport { Composition } from \"./Composition\";\r\nimport { IGridItem } from \"./Grid\";\r\nimport { PatternTrack } from \"./PatternTrack\";\r\n\r\nexport class PatternWindow extends DraggableWindow {\r\n  private _trackContainer: HTMLDivElement;\r\n  readonly tracks: PatternTrack[] = [];\r\n\r\n  constructor(readonly composition: Composition) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"pattern-track-container\");\r\n\r\n    super(\"Pattern\", true, container);\r\n    this._trackContainer = container;\r\n    this.setSize(800, 400);\r\n    this.show(100, 100);\r\n  }\r\n\r\n  addTrack(name: string, pattern: IGridItem[] = []) {\r\n    const track = new PatternTrack(name, pattern);\r\n    this.tracks.push(track);\r\n    this._trackContainer.appendChild(track.domElement);\r\n  }\r\n\r\n  removeTrack(track: PatternTrack) {\r\n    const index = this.tracks.indexOf(track);\r\n    if (index !== -1) {\r\n      this.tracks.splice(index, 1);\r\n      this._trackContainer.removeChild(track.domElement);\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\n\r\nexport class PlaylistTrack extends BaseElement<\"update\"> {\r\n  constructor(name: string) {\r\n    super(\"div\", \"playlist-track\");\r\n\r\n    const settings = document.createElement(\"div\");\r\n    settings.classList.add(\"instrument-panel\");\r\n\r\n    const label = document.createElement(\"div\");\r\n    settings.appendChild(label);\r\n    label.textContent = name;\r\n\r\n    const buttons = document.createElement(\"div\");\r\n    buttons.classList.add(\"playlist-track-selector\");\r\n    settings.appendChild(buttons);\r\n\r\n    const mute = document.createElement(\"button\");\r\n    mute.textContent = \"M\";\r\n    buttons.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"button\");\r\n    solo.textContent = \"S\";\r\n    buttons.appendChild(solo);\r\n\r\n    const track = document.createElement(\"div\");\r\n    track.classList.add(\"pattern-panel\");\r\n\r\n    this.domElement.appendChild(settings);\r\n    this.domElement.appendChild(track);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../elements/src/elements/DraggableWindow\";\r\nimport { Composition } from \"./Composition\";\r\nimport { PlaylistTrack } from \"./PlaylistTrack\";\r\n\r\nexport class PlaylistWindow extends DraggableWindow {\r\n  private _trackContainer: HTMLDivElement;\r\n  private _tracks: PlaylistTrack[] = [];\r\n\r\n  constructor(readonly composition: Composition) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"playlist-track-container\");\r\n\r\n    super(\"Playlist\", true, container);\r\n    this._trackContainer = container;\r\n    this.setSize(800, 400);\r\n    this.show(100, 100);\r\n  }\r\n\r\n  addTrack(name: string) {\r\n    const track = new PlaylistTrack(name);\r\n    this._tracks.push(track);\r\n    this._trackContainer.appendChild(track.domElement);\r\n  }\r\n}\r\n","import { PianoRoll } from \"./elements/PianoRoll\";\r\nimport { AudioClock } from \"./elements/AudioClock\";\r\nimport { DraggableWindow } from \"../../elements/src/elements/DraggableWindow\";\r\nimport { WindowContainer } from \"../../elements/src/elements/WindowContainer\";\r\nimport { PatternWindow } from \"./elements/PatternWindow\";\r\nimport { PlaylistWindow } from \"./elements/PlaylistWindow\";\r\nimport { Composition } from \"./elements/Composition\";\r\n\r\nconst domElement = document.createElement(\"div\");\r\ndomElement.style.display = \"flex\";\r\ndomElement.style.flexDirection = \"column\";\r\ndomElement.style.width = \"100%\";\r\ndomElement.style.height = \"100%\";\r\n\r\nconst audioClock = new AudioClock();\r\ndomElement.appendChild(audioClock.domElement);\r\n\r\nconst container = new WindowContainer();\r\ndomElement.appendChild(container.domElement);\r\n\r\nconst composition = new Composition();\r\n\r\nconst pianoRoll = new PianoRoll(audioClock);\r\nconst pianoRollWindow = new DraggableWindow(\r\n  \"Piano Roll\",\r\n  true,\r\n  pianoRoll.domElement\r\n);\r\ncontainer.addWindow(pianoRollWindow);\r\npianoRollWindow.setSize(800, 400);\r\n\r\nconst patternWindow = new PatternWindow(composition);\r\npatternWindow.addTrack(\"Kick\");\r\npatternWindow.addTrack(\"Snare\");\r\npatternWindow.addTrack(\"Hats\");\r\npatternWindow.addTrack(\"Bass\");\r\npatternWindow.addTrack(\"Lead\");\r\npatternWindow.show(100, 100);\r\ncontainer.addWindow(patternWindow);\r\n\r\nconst playlistWindow = new PlaylistWindow(composition);\r\nfor (let i = 1; i <= 9; i++) {\r\n  playlistWindow.addTrack(`Track ${i}`);\r\n}\r\ncontainer.addWindow(playlistWindow);\r\nplaylistWindow.show(600, 100);\r\npianoRollWindow.show(300, 300);\r\n\r\ndocument.body.appendChild(domElement);\r\n","import { GridItem } from \"./Grid\";\r\n\r\nexport class Composition {\r\n  title: string;\r\n  description: string;\r\n  tempo: number;\r\n  patterns: GridItem[][] = [[]];\r\n\r\n  constructor() {\r\n    this.title = \"Untitled\";\r\n    this.description = \"No description\";\r\n    this.tempo = 120;\r\n  }\r\n}\r\n"],"names":["exports","Symbol","toStringTag","Object","defineProperty","value","audioContext","getAudioContext","window","AudioContext","webkitAudioContext","console","log","buffer","createBuffer","sampleRate","source","createBufferSource","connect","destination","start","KEY_COLORS","NOTE_NAMES","this","domElement","document","createElement","classList","add","canvas","width","height","appendChild","addEventListener","playBuffer","ctx","getContext","generateAudio","note","preview","Promise","resolve","reject","req","text","label","pitch","rate","fetch","method","body","JSON","stringify","headers","then","res","arrayBuffer","data","decodeAudioData","audioBuffer","catch","error","loadBuffer","channelData","getChannelData","bufferLength","length","sliceWidth","clearRect","beginPath","moveTo","i","x","y","lineTo","stroke","AudioCanvas","_events","_onceEvents","on","eventName","callback","push","once","fireEvent","eventData","onceCallbacks","undefined","callbacks","ok","cancel","closeButton","textContent","style","display","HTMLButtonElement","okButton","cancelButton","show","targetObject","left","top","parentElement","hide","onsave","textInput","setAttribute","type","pitchSlider","min","max","step","parseFloat","audioCanvas","LyricCanvas","saveButton","audio","DialogPopup","getNoteNameFromPitch","Math","floor","grid","item","end","noteHeight","noteLabel","lyricLabel","update","beatWidth","notes","currentNote","dragMode","quantize","dragOffset","gridElement","rowBackgroundCanvas","strokeStyle","lineWidth","j","row","backgroundImage","toDataURL","backgroundRepeat","noteEditor","LyricEditorDialog","input","querySelector","event","layerX","preventDefault","target","HTMLDivElement","contains","find","n","ctrlKey","button","clientX","clientY","remove","offsetWidth","layerY","round","GridItem","buttons","pointerEvents","forEach","filter","removeChild","loadEvents","events","map","e","createPreviewImage","fillStyle","fillRect","keys","redraw","innerHTML","key","backgroundColor","color","toString","clock","cursorUpdateInterval","scheduledSources","sideKeyboard","SideKeyboard","Grid","cursor","clearInterval","transform","scheduleAudioEvents","updateCursor","stop","isPlaying","currentBeat","bufferSource","currentTime","bpm","_isPlaying","_bpm","startTime","bpmInput","playPauseButton","play","stopButton","currentTimeDisplay","requestAnimationFrame","render","bind","updateCurrentTimeDisplay","beat","bars","beats","timeString","padStart","tagName","className","_resizing","_startX","_startY","_startWidth","_startHeight","_startTop","_startLeft","_resizeDirection","handle","getCurrentHandle","onmove","dx","dy","offsetHeight","startResize","onrelease","stopResize","removeEventListener","direction","offsetTop","offsetLeft","rect","getBoundingClientRect","offsetX","offsetY","BaseElement","title","persistent","innerContent","_isDragging","_dragOffsetX","_dragOffsetY","_top","_left","titlebar","scrollTop","ondrag","newTop","newLeft","_title","content","_closeButton","close","setSize","setPosition","SizableElement","windows","_draggingWindow","addWindow","name","pattern","instrumentPanel","mute","solo","indicator","patternPanel","composition","container","tracks","_trackContainer","addTrack","track","PatternTrack","removeTrack","index","indexOf","splice","DraggableWindow","settings","_tracks","PlaylistTrack","flexDirection","audioClock","AudioClock","WindowContainer","patterns","description","tempo","pianoRollWindow","PianoRoll","patternWindow","PatternWindow","playlistWindow","PlaylistWindow"],"sourceRoot":""}