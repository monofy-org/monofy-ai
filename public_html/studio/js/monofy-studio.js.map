{"version":3,"file":"monofy-studio.js","mappings":"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","sources":["webpack://monofy/webpack/bootstrap","webpack://monofy/webpack/runtime/make namespace object","webpack://monofy/../elements/src/EventObject.ts","webpack://monofy/../elements/src/managers/AudioManager.ts","webpack://monofy/./src/elements/components/AudioClock.ts","webpack://monofy/./src/plugins/plugins.ts","webpack://monofy/./src/abstracts/MathHelpers.ts","webpack://monofy/./src/elements/Mixer.ts","webpack://monofy/./src/elements/Project.ts","webpack://monofy/../elements/src/elements/BaseElement.ts","webpack://monofy/../elements/src/elements/WindowSnapPanel.ts","webpack://monofy/../elements/src/elements/WindowContainer.ts","webpack://monofy/../elements/src/elements/PopupNotification.ts","webpack://monofy/./src/constants.ts","webpack://monofy/./src/elements/components/Keyboard.ts","webpack://monofy/../elements/src/elements/SizableElement.ts","webpack://monofy/../elements/src/elements/DraggableWindow.ts","webpack://monofy/../elements/src/elements/SelectableGroup.ts","webpack://monofy/../elements/src/elements/SelectableElement.ts","webpack://monofy/./src/elements/components/MuteSoloButtons.ts","webpack://monofy/./src/elements/components/MixerChannelStrip.ts","webpack://monofy/./src/elements/windows/MixerWindow.ts","webpack://monofy/./src/elements/components/AudioCursor.ts","webpack://monofy/../elements/src/animation.ts","webpack://monofy/./src/abstracts/GraphicsHelpers.ts","webpack://monofy/./src/elements/components/PatternTrack.ts","webpack://monofy/./src/elements/windows/PatternWindow.ts","webpack://monofy/../elements/src/elements/ScrollPanel.ts","webpack://monofy/../elements/src/elements/AudioCanvas.ts","webpack://monofy/./src/elements/components/LyricCanvas.ts","webpack://monofy/../elements/src/elements/DialogPopup.ts","webpack://monofy/./src/elements/audioDialogs.ts","webpack://monofy/./src/elements/components/Grid.ts","webpack://monofy/./src/elements/components/SideKeyboard.ts","webpack://monofy/./src/elements/components/PianoRoll.ts","webpack://monofy/./src/elements/windows/PianoRollWindow.ts","webpack://monofy/../elements/src/elements/ContextMenu.ts","webpack://monofy/./src/elements/components/PlaylistTrack.ts","webpack://monofy/./src/elements/components/Playlist.ts","webpack://monofy/../elements/src/UUID.ts","webpack://monofy/../elements/src/elements/TreeView.ts","webpack://monofy/./src/importers/AudioImporter.ts","webpack://monofy/./src/importers/FileImporter.ts","webpack://monofy/./src/elements/ProjectTreeView.ts","webpack://monofy/../elements/src/elements/ImagePreview.ts","webpack://monofy/./src/elements/windows/ImagePreviewWindow.ts","webpack://monofy/./src/elements/windows/ProjectWindow.ts","webpack://monofy/./src/elements/ProjectUI.ts","webpack://monofy/./src/abstracts/Instrument.ts","webpack://monofy/./src/abstracts/SynthesizerVoice.ts","webpack://monofy/./src/abstracts/PluginControl.ts","webpack://monofy/./src/elements/components/Slider.ts","webpack://monofy/./src/elements/components/Envelope.ts","webpack://monofy/../elements/src/elements/DraggableNumber.ts","webpack://monofy/./src/abstracts/InstrumentWindow.ts","webpack://monofy/./src/elements/components/Knob.ts","webpack://monofy/./src/plugins/fmbass/FMBassWindow.ts","webpack://monofy/./src/plugins/fmbass/FMBass.ts","webpack://monofy/./src/abstracts/Synthesizer.ts","webpack://monofy/./src/plugins/fmpiano/FMPiano.ts","webpack://monofy/./src/plugins/sampler/Sampler.ts","webpack://monofy/./src/plugins/sampler/MultisamplerWindow.ts","webpack://monofy/./src/plugins/sampler/Multisampler.ts","webpack://monofy/./src/index.ts","webpack://monofy/./src/schema.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { BaseElement } from \"./elements/BaseElement\";\r\n\r\nexport interface IBaseEvent {\r\n  target: BaseElement;\r\n  event: PointerEvent;\r\n}\r\n\r\nexport interface IDragEvent extends IBaseEvent {\r\n  top: number;\r\n  left: number;\r\n  deltaX: number;\r\n  deltaY: number;\r\n}\r\n\r\nexport interface IResizeEvent extends IBaseEvent {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface EventDataMap {\r\n  cancel: unknown;\r\n  start: unknown;\r\n  stop: unknown;\r\n  pause: unknown;\r\n  result: unknown;\r\n  update: unknown;\r\n  open: unknown;\r\n  close: unknown;\r\n  edit: unknown;\r\n  release: unknown;\r\n  resize: IResizeEvent;\r\n  select: IBaseEvent;\r\n  scroll: WheelEvent;\r\n  add: unknown;\r\n  remove: unknown;\r\n  change: unknown;\r\n  drag: IDragEvent;\r\n  shown: void;\r\n}\r\n\r\nexport type BaseEvent = keyof EventDataMap;\r\n\r\nexport default abstract class EventObject<E extends BaseEvent = BaseEvent> {\r\n  private _events: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n  private _onceEvents: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n\r\n  on(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._events[eventName]) {\r\n      this._events[eventName] = [];\r\n    }\r\n    this._events[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  once(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._onceEvents[eventName]) {\r\n      this._onceEvents[eventName] = [];\r\n    }\r\n    this._onceEvents[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  emit(eventName: E, eventData?: unknown) {\r\n    const onceCallbacks = this._onceEvents[eventName];\r\n    if (onceCallbacks) {\r\n      for (const callback of onceCallbacks) {\r\n        try {\r\n          callback(eventData as EventDataMap[E]);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .once callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n      this._onceEvents[eventName] = undefined;\r\n    }\r\n\r\n    const callbacks = this._events[eventName];\r\n    if (callbacks) {\r\n      for (const callback of callbacks) {\r\n        try {\r\n          callback(eventData as EventDataMap[E]);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .on callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  removeAllListeners() {\r\n    this._events = {};\r\n    this._onceEvents = {};\r\n  }\r\n}\r\n","let audioContext: AudioContext | null = null;\r\n\r\nconst AudioContext = window.AudioContext || (window as any).webkitAudioContext;\r\n\r\nexport function getAudioContext() {\r\n  if (!audioContext) {\r\n    audioContext = new AudioContext({\r\n      latencyHint: \"interactive\",\r\n      sampleRate: 44100,\r\n    });\r\n    getAudioDevices().then((devices) => {\r\n      console.log(\"Audio devices\", devices);\r\n    });\r\n    console.log(\"Audio context created\");    \r\n\r\n    return audioContext;\r\n  }\r\n\r\n  if (audioContext.state === \"suspended\") {\r\n    audioContext.resume();\r\n  }\r\n\r\n  return audioContext;\r\n}\r\n\r\nexport async function getAudioDevices() {\r\n  if (\"setSinkId\" in AudioContext.prototype) {\r\n    const devices = await navigator.mediaDevices.enumerateDevices();\r\n    return devices;\r\n  }\r\n  return null;\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\n\r\n/**\r\n * Represents an audio clock that provides functionality for controlling audio playback and scheduling events.\r\n */\r\nexport class AudioClock extends EventObject<\r\n  \"start\" | \"stop\" | \"pause\" | \"update\"\r\n> {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly bpmInput: HTMLInputElement;\r\n  readonly playPauseButton: HTMLButtonElement;\r\n  readonly stopButton: HTMLButtonElement;\r\n  readonly currentTimeDisplay: HTMLSpanElement;\r\n  private _playbackMode: \"pattern\" | \"playlist\" = \"pattern\";\r\n  private _audioContext: AudioContext | null = null;\r\n  private _bpm: number = 100;\r\n  private _scheduledEvents: {\r\n    source: AudioBufferSourceNode;\r\n    time: number;\r\n    callback: () => void;\r\n  }[] = [];\r\n  private _startTime: number | null = null;\r\n\r\n  get startTime(): number | null {\r\n    return this._startTime;\r\n  }\r\n\r\n  get currentTime(): number {\r\n    return this.audioContext.currentTime;\r\n  }\r\n\r\n  get audioContext(): AudioContext {\r\n    if (!this._audioContext) {\r\n      this._audioContext = getAudioContext();\r\n    }\r\n    return this._audioContext;\r\n  }\r\n\r\n  get currentBeat(): number {\r\n    const elapsedTime =\r\n      this._startTime !== null\r\n        ? this.audioContext.currentTime - this._startTime\r\n        : 0;\r\n    return elapsedTime * (this._bpm / 60);\r\n  }\r\n\r\n  get isPlaying(): boolean {\r\n    return this._startTime != null && this._startTime >= 0;\r\n  }\r\n\r\n  get bpm(): number {\r\n    return this._bpm;\r\n  }\r\n\r\n  get playbackMode(): \"pattern\" | \"playlist\" {\r\n    return this._playbackMode;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-clock\");\r\n\r\n    this.playPauseButton = document.createElement(\"button\");\r\n    this.playPauseButton.classList.add(\"audio-clock-play-pause\");\r\n\r\n    this.playPauseButton.addEventListener(\"click\", () => {\r\n      if (this.isPlaying) {\r\n        this.stop();\r\n      } else {\r\n        getAudioContext();\r\n        this.playPause();\r\n      }\r\n    });\r\n    this.domElement.appendChild(this.playPauseButton);\r\n    this.stopButton = document.createElement(\"button\");\r\n    this.stopButton.classList.add(\"audio-clock-stop\");\r\n    this.stopButton.textContent = \"\\u25A0\";\r\n\r\n    this.stopButton.addEventListener(\"click\", () => {\r\n      this.stop();\r\n    });\r\n    this.domElement.appendChild(this.stopButton);\r\n\r\n    this.bpmInput = document.createElement(\"input\");\r\n    this.bpmInput.classList.add(\"audio-clock-bpm\");\r\n    this.bpmInput.type = \"number\";\r\n    this.bpmInput.value = \"120\";\r\n\r\n    this.bpmInput.addEventListener(\"input\", () => {\r\n      this._bpm = parseFloat(this.bpmInput.value);\r\n    });\r\n    this.domElement.appendChild(this.bpmInput);\r\n\r\n    this.currentTimeDisplay = document.createElement(\"span\");\r\n    this.currentTimeDisplay.classList.add(\"audio-clock-time\");\r\n    this.currentTimeDisplay.textContent = \"01:1\";\r\n\r\n    this.domElement.appendChild(this.currentTimeDisplay);\r\n  }\r\n\r\n  getBeatTime(beat: number): number {\r\n    return this.currentTime + beat * (this.bpm / 60);\r\n  }\r\n\r\n  start(): void {\r\n    this._startTime = this.audioContext.currentTime;\r\n    console.log(\"Started at\", this._startTime);\r\n    requestAnimationFrame(this._render.bind(this));\r\n    this.emit(\"start\");\r\n  }\r\n\r\n  private _render(): void {\r\n    this._update(this.currentBeat);\r\n    this.emit(\"update\");\r\n    if (this.isPlaying) requestAnimationFrame(this._render.bind(this));\r\n  }\r\n\r\n  stop(): void {\r\n    this.emit(\"stop\");\r\n    this._startTime = null;\r\n\r\n    for (const { source } of this._scheduledEvents) {\r\n      source.stop();\r\n      source.disconnect();\r\n    }\r\n    this._scheduledEvents = [];\r\n\r\n    this.playPauseButton.classList.remove(\"active\");\r\n\r\n    this._update(this.currentBeat);\r\n  }\r\n\r\n  restart() {\r\n    if (this.isPlaying) {\r\n      this._startTime = this.audioContext.currentTime;\r\n    }\r\n  }\r\n\r\n  playPause(): void {\r\n    if (this.isPlaying) {\r\n      this.stop(); // TODO: This should be a pause\r\n    } else {\r\n      const buffer = this.audioContext.createBuffer(\r\n        1,\r\n        1,\r\n        this.audioContext.sampleRate\r\n      );\r\n      const source = this.audioContext.createBufferSource();\r\n      source.buffer = buffer;\r\n      source.connect(this.audioContext.destination);\r\n      source.start();\r\n\r\n      this.start();\r\n    }\r\n    this.playPauseButton.classList.toggle(\"active\", this.isPlaying);\r\n  }\r\n\r\n  private _update(beat: number): void {\r\n    const bars = Math.floor(beat / 4) + 1;\r\n    const beats = Math.floor(beat % 4) + 1;\r\n    const timeString = `${bars\r\n      .toString()\r\n      .padStart(2, \"0\")}:${beats.toString()}`;\r\n    this.currentTimeDisplay.textContent = timeString;\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtTime(callback: () => void, time: number): void {\r\n    const emptyBuffer = this.audioContext.createBuffer(\r\n      1,\r\n      1,\r\n      this.audioContext.sampleRate\r\n    );\r\n    const source = this.audioContext.createBufferSource();\r\n    source.buffer = emptyBuffer;\r\n    source.connect(this.audioContext.destination);\r\n    source.onended = () => callback();\r\n    source.start(time);\r\n    this._scheduledEvents.push({ source, time, callback });\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtBeat(callback: () => void, beat: number): void {\r\n    const time = this._startTime! + (beat / this._bpm) * 60;\r\n    this.scheduleEventAtTime(callback, time);\r\n  }\r\n}\r\n","import { InstrumentWindow } from \"../abstracts/InstrumentWindow\";\r\nimport type { Project } from \"../elements/Project\";\r\n\r\nexport abstract class Plugin {\r\n  abstract id: string;\r\n  abstract name: string;\r\n  abstract version: string;\r\n  abstract description: string;\r\n  abstract author: string;  \r\n  private readonly _project;\r\n\r\n  abstract Window: typeof InstrumentWindow;\r\n\r\n  get project() {\r\n    return this._project;\r\n  }\r\n\r\n  constructor(project: Project) {        \r\n    console.assert(project.audioClock, \"audioClock is required\");\r\n    console.assert(project.mixer, \"mixer is required\");\r\n    this._project = project;\r\n  }\r\n}\r\n\r\nexport class Plugins {\r\n  private static readonly _plugins: { [key: string]: typeof Plugin } = {};\r\n\r\n  static register(name: string, plugin: typeof Plugin) {\r\n    if (this._plugins[name]) {\r\n      console.warn(\"Plugin already registered:\", plugin);\r\n      return;\r\n    }\r\n    this._plugins[name] = plugin;\r\n  }\r\n\r\n  static get<T extends Plugin>(name: string): T {\r\n    return this._plugins[name] as any as T;\r\n  }\r\n\r\n  static instantiate<T extends Plugin>(project: Project, id: string) {\r\n    return new (this.get(id) as any)(project) as T;\r\n  }\r\n}\r\n","export abstract class MathHelpers {\r\n  static linearToGain(linearValue: number): number {\r\n    const clampedValue = Math.max(0, Math.min(1, linearValue));\r\n    const dBValue = clampedValue * 80 - 80;\r\n    const gain = Math.pow(10, dBValue / 20);\r\n\r\n    return gain;\r\n  }\r\n\r\n  static lerp(a: number, b: number, t: number): number {\r\n    return a + (b - a) * t;\r\n  }\r\n}\r\n","import { MathHelpers } from \"../abstracts/MathHelpers\";\r\nimport { IMixer, IMixerChannel } from \"../schema\";\r\nimport { Effect } from \"./components/Effect\";\r\n\r\nexport class MixerChannel implements IMixerChannel {\r\n  gainNode: GainNode;\r\n  mute = false;\r\n  solo = false;\r\n  effects: Effect[] = [];\r\n\r\n  get gain() {\r\n    return this.gainNode.gain.value;\r\n  }\r\n\r\n  constructor(\r\n    readonly audioContext: AudioContext,\r\n    public label: string,\r\n    gain = 1,\r\n    readonly outputs: number[] = [0]\r\n  ) {\r\n    this.gainNode = audioContext.createGain();\r\n    this.gainNode.gain.value = MathHelpers.linearToGain(gain);\r\n  }\r\n}\r\n\r\nexport class Mixer implements IMixer {\r\n  channels: MixerChannel[] = [];\r\n\r\n  constructor(readonly audioContext: AudioContext) {\r\n    const master = new MixerChannel(audioContext, \"Master\", 1);\r\n    master.gainNode.connect(audioContext.destination);\r\n    this.channels.push(master);\r\n    for (let i = 1; i <= 16; i++) {\r\n      const channel = new MixerChannel(audioContext, i.toString());\r\n      channel.gainNode.connect(master.gainNode);\r\n      this.channels.push(channel);\r\n    }\r\n  }\r\n}\r\n","import EventObject from \"../../../elements/src/EventObject\";\r\nimport type { IInstrument, Instrument } from \"../abstracts/Instrument\";\r\nimport { Plugins } from \"../plugins/plugins\";\r\nimport { IPattern, IPlaylist, IProject } from \"../schema\";\r\nimport { Mixer } from \"./Mixer\";\r\nimport { AudioClock } from \"./components/AudioClock\";\r\n\r\nexport interface IProjectUpdateEvent {\r\n  type: \"project\" | \"pattern\";\r\n  value: Project | IPattern;\r\n}\r\n\r\nexport class Project extends EventObject<\"update\"> implements IProject {\r\n  title = \"Untitled\";\r\n  description = \"\";\r\n  tempo = 120;\r\n  instruments: Instrument[] = [];\r\n  patterns: IPattern[] = [];\r\n  playlist: IPlaylist = { tracks: [], events: [] };\r\n  audioClock: AudioClock;\r\n  readonly mixer: Mixer;\r\n\r\n  constructor(audioClock: AudioClock, project?: IProject) {\r\n    console.assert(audioClock, \"audioClock is required\");\r\n\r\n    super();\r\n\r\n    this.audioClock = audioClock;\r\n\r\n    this.mixer = new Mixer(audioClock.audioContext);\r\n\r\n    audioClock.on(\"start\", () => {\r\n      console.log(\"DEBUG START\", this.playlist);\r\n      for (const event of this.playlist.events) {\r\n        // const e = event.value as IPattern;\r\n        console.log(\"DEBUG ITEM\", event.start, event);\r\n        if (event.value instanceof AudioBuffer) {\r\n          const source = audioClock.audioContext.createBufferSource();\r\n          source.buffer = event.value;\r\n          source.connect(this.mixer.channels[0].gainNode);\r\n          source.start(audioClock.getBeatTime(event.start));\r\n          source.stop(audioClock.getBeatTime(event.start + event.duration));\r\n          console.log(\"DEBUG PLAY\", audioClock.getBeatTime(event.start));\r\n        } else {\r\n          console.error(\"DEBUG VALUE\", event.value);        \r\n        }\r\n      }\r\n    });\r\n\r\n    if (project) {\r\n      setTimeout(() => {\r\n        this.load(project);\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  serialize(): string {\r\n    return JSON.stringify({\r\n      title: this.title,\r\n      description: this.description,\r\n      tempo: this.tempo,\r\n      instruments: this.instruments.map((instrument) => {\r\n        return {\r\n          name: instrument.name,\r\n        };\r\n      }),\r\n      patterns: this.patterns,\r\n      timeline: this.playlist,\r\n    });\r\n  }\r\n\r\n  deserialize(data: string): void {\r\n    console.log(\"Project deserialize\", data);\r\n    const project = JSON.parse(data) as IProject;\r\n\r\n    // TODO error checking\r\n\r\n    this.load(project);\r\n  }\r\n\r\n  load(project: IProject): void {\r\n    console.log(\"Project load\", project);\r\n\r\n    this.title = project.title;\r\n    this.description = project.description;\r\n    this.tempo = project.tempo;\r\n    this.patterns = project.patterns;\r\n    this.playlist = project.playlist;\r\n    this.instruments = [];\r\n\r\n    for (const instrument of project.instruments as IInstrument[]) {\r\n      console.log(\"loading instrument\", instrument);\r\n      const T = Plugins.get(instrument.id);\r\n      const instance: typeof T = Plugins.instantiate<typeof T>(\r\n        this,\r\n        instrument.id\r\n      );\r\n      this.instruments.push(instance as Instrument);\r\n    }\r\n\r\n    console.log(\"emitting update...\");\r\n    this.emit(\"update\", { type: \"project\", value: this });\r\n  }\r\n}\r\n","import EventObject, { EventDataMap } from \"../EventObject\";\r\n\r\nexport abstract class BaseElement<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n  E extends HTMLElement = HTMLElement,\r\n> extends EventObject<T> {\r\n  readonly domElement: E;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super();\r\n    this.domElement = document.createElement(tagName) as E;\r\n    if (className) {\r\n      this.domElement.classList.add(className);\r\n    }\r\n  }\r\n\r\n  dispose() {    \r\n    this.removeAllListeners();\r\n    this.domElement.remove();\r\n  }  \r\n\r\n  appendChild(child: BaseElement<keyof EventDataMap>) {\r\n    this.domElement.appendChild(child.domElement);\r\n    return this;\r\n  }\r\n\r\n  removeChild(child: BaseElement<keyof EventDataMap>) {\r\n    this.domElement.removeChild(child.domElement);\r\n    return this;\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\nimport type { WindowContainer } from \"./WindowContainer\";\r\n\r\nexport class WindowSnapPanel extends BaseElement<\"open\" | \"close\"> {\r\n  private _isOpen = false;\r\n\r\n  get isOpen() {\r\n    return this._isOpen;\r\n  }\r\n\r\n  constructor(readonly container: WindowContainer) {\r\n    super(\"div\", \"window-snap-panel\");\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.toggle();\r\n    });\r\n  }\r\n\r\n  open() {\r\n    if (!this._isOpen) {\r\n      this.domElement.classList.toggle(\"open\", true);\r\n      this._isOpen = true;\r\n      this.emit(\"open\");\r\n    }\r\n  }\r\n\r\n  close() {\r\n    if (this._isOpen) {\r\n      this.domElement.classList.toggle(\"open\", false);\r\n      this._isOpen = false;\r\n      this.emit(\"close\");\r\n    }\r\n  }\r\n\r\n  toggle() {\r\n    if (this._isOpen) {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap, IDragEvent, IResizeEvent } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\nimport { DraggableWindow } from \"./DraggableWindow\";\r\nimport { WindowSnapPanel } from \"./WindowSnapPanel\";\r\n\r\nexport class WindowContainer extends BaseElement<\"update\"> {\r\n  private _activeWindow: DraggableWindow | null = null;\r\n\r\n  readonly windows: DraggableWindow<keyof EventDataMap>[] = [];\r\n  private _draggingWindow: DraggableWindow | null = null;\r\n  private _bottomPanel: WindowSnapPanel;\r\n  private _leftPanel: WindowSnapPanel;\r\n  private _rightPanel: WindowSnapPanel;\r\n  private _workspace: HTMLElement;\r\n\r\n  constructor() {\r\n    super(\"div\", \"window-container\");\r\n    //this.domElement.addEventListener(\"pointerdown\", () => {});\r\n\r\n    const topRow = document.createElement(\"div\");\r\n    topRow.classList.add(\"window-snap-row\");\r\n    this.domElement.appendChild(topRow);\r\n\r\n    const bottomRow = document.createElement(\"div\");\r\n    bottomRow.classList.add(\"window-snap-row\");\r\n    bottomRow.classList.add(\"bottom-row\");\r\n    this.domElement.appendChild(bottomRow);\r\n\r\n    this._leftPanel = new WindowSnapPanel(this);\r\n    topRow.appendChild(this._leftPanel.domElement);\r\n\r\n    this._workspace = document.createElement(\"div\");\r\n    this._workspace.classList.add(\"window-container-workspace\");\r\n    topRow.appendChild(this._workspace);\r\n\r\n    this._rightPanel = new WindowSnapPanel(this);\r\n    topRow.appendChild(this._rightPanel.domElement);\r\n\r\n    this._bottomPanel = new WindowSnapPanel(this);\r\n    bottomRow.appendChild(this._bottomPanel.domElement);\r\n  }\r\n\r\n  private _handleWindowDrag(e: IDragEvent) {\r\n    // console.log(\"drag\", e);\r\n    const elt = e.target.domElement;\r\n    const workspaceWidth = this._workspace.getBoundingClientRect().width;\r\n    if (elt.parentElement === this._workspace) {\r\n      const leftPanelWidth =\r\n        this._leftPanel.domElement.getBoundingClientRect().width;\r\n      if (e.event.clientX <= Math.max(0, leftPanelWidth)) {\r\n        const panelWidth = leftPanelWidth || 300;\r\n        this._leftPanel.domElement.appendChild(elt);\r\n        elt.style.width = `${panelWidth}px`;\r\n        elt.style.height = \"unset\";\r\n        elt.classList.toggle(\"snap\", true);\r\n      } else {\r\n        const rightPanelWidth =\r\n          this._rightPanel.domElement.getBoundingClientRect().width;\r\n        if (\r\n          e.event.clientX + Math.max(250, rightPanelWidth) >\r\n          workspaceWidth + rightPanelWidth + leftPanelWidth\r\n        ) {\r\n          const panelWidth = rightPanelWidth || 300;\r\n          this._rightPanel.domElement.appendChild(elt);\r\n          elt.style.width = `${panelWidth}px`;\r\n          elt.style.height = \"unset\";\r\n          elt.classList.toggle(\"snap\", true);\r\n        }\r\n      }\r\n    } else {\r\n      if (\r\n        elt.parentElement === this._leftPanel.domElement &&\r\n        (e.event.target as HTMLElement) === this._workspace\r\n      ) {\r\n        this._workspace.appendChild(elt);\r\n        elt.classList.toggle(\"snap\", false);\r\n        elt.style.left = e.event.clientX + \"px\";\r\n        const win = e.target as DraggableWindow;\r\n        win.resetDragOffset();\r\n        win.setSize(win.options.width!, win.options.height!);\r\n      } else if (\r\n        elt.parentElement === this._rightPanel.domElement &&\r\n        (e.event.target as HTMLElement) === this._workspace\r\n      ) {\r\n        this._workspace.appendChild(elt);\r\n        elt.classList.toggle(\"snap\", false);\r\n        elt.style.left = workspaceWidth + \"px\";\r\n        const win = e.target as DraggableWindow;\r\n        win.resetDragOffset();\r\n        win.setSize(win.options.width!, win.options.height!);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _handleWindowResize(e: IResizeEvent) {\r\n    for (const win of this.windows) {\r\n      if (\r\n        win.domElement !== e.target.domElement &&\r\n        win.domElement.parentElement !== this._workspace &&\r\n        win.domElement.parentElement === e.target.domElement.parentElement\r\n      ) {\r\n        win.domElement.style.width = `${e.width}px`;\r\n      }\r\n    }\r\n  }\r\n\r\n  addWindow<T extends DraggableWindow>(window: T) {\r\n    if (this.windows.includes(window)) {\r\n      console.warn(\"Window already added\", window);\r\n      return;\r\n    }\r\n    window.on(\"drag\", (e) => this._handleWindowDrag(e as IDragEvent));\r\n    window.on(\"resize\", (e) => this._handleWindowResize(e as IResizeEvent));\r\n    this.windows.push(window);\r\n    this._workspace.appendChild(window.domElement);\r\n    if (!this._activeWindow) {\r\n      this._activeWindow = window;\r\n      this.activateWindow(window);\r\n    }\r\n\r\n    window.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.activateWindow(window);\r\n    });\r\n\r\n    window.on(\"open\", () => {\r\n      this.activateWindow(window);\r\n    });\r\n\r\n    window.on(\"close\", () => {\r\n      if (this._activeWindow === window) {\r\n        this._activeWindow = null;\r\n      }\r\n    });\r\n  }\r\n\r\n  activateWindow(window: DraggableWindow) {\r\n    if (this._activeWindow === window) {\r\n      return;\r\n    }\r\n\r\n    this._activeWindow = window;\r\n\r\n    for (const w of this.windows) {\r\n      w.domElement.classList.toggle(\"active\", w === window);\r\n      w.domElement.style.zIndex = w === window ? \"1\" : \"0\";\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class PopupNotification extends BaseElement<\"close\"> {\r\n  private readonly _closeButton: HTMLButtonElement;\r\n\r\n  constructor(title: string, options?: NotificationOptions | undefined) {\r\n    super(\"div\", \"notification\");\r\n\r\n    this.domElement.style.display = \"hidden\";\r\n\r\n    const titleElt = document.createElement(\"h1\");\r\n    const messageElt = document.createElement(\"p\");\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.textContent = \"\";\r\n    const onclick = () => {\r\n      this._closeButton.removeEventListener(\"click\", onclick);\r\n      this.dispose();\r\n      this.emit(\"close\");\r\n    };\r\n    this._closeButton.addEventListener(\"click\", onclick);\r\n\r\n    if (options?.body) {\r\n      messageElt.textContent = options.body;\r\n    }\r\n\r\n    titleElt.textContent = title;\r\n\r\n    this.domElement.appendChild(titleElt);\r\n    this.domElement.appendChild(messageElt);\r\n    this.domElement.appendChild(this._closeButton);\r\n\r\n    document.body.appendChild(this.domElement);\r\n  }\r\n}\r\n","export const DEFAULT_NOTE_HEIGHT = 20;\r\n\r\nexport const BOTTOM_ROW = [\r\n  90, 83, 88, 68, 67, 86, 71, 66, 72, 78, 74, 77, 188, 76, 190, 59, 191,\r\n];\r\n\r\nexport const TOP_ROW = [\r\n  81, 50, 87, 51, 69, 82, 53, 84, 54, 89, 55, 85, 73, 57, 79, 48, 80, 219, 61,\r\n  221,\r\n];\r\n\r\nexport const KEY_COLORS = [\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n];\r\n\r\nexport const NOTE_NAMES = [\r\n  \"A\",\r\n  \"A#\",\r\n  \"B\",\r\n  \"C\",\r\n  \"C#\",\r\n  \"D\",\r\n  \"D#\",\r\n  \"E\",\r\n  \"F\",\r\n  \"F#\",\r\n  \"G\",\r\n  \"G#\",\r\n];\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { PopupNotification } from \"../../../../elements/src/elements/PopupNotification\";\r\nimport { BOTTOM_ROW, TOP_ROW } from \"../../constants\";\r\n\r\nlet midiAccess: MIDIAccess | null = null;\r\n\r\nexport interface IKeyboardEvent {\r\n  type: \"press\" | \"release\";\r\n  channel: number;\r\n  note: number;\r\n  velocity: number;\r\n}\r\n\r\nfunction keyToNote(keyCode: number) {\r\n  let note = -1;\r\n\r\n  if (BOTTOM_ROW.includes(keyCode)) {\r\n    note = BOTTOM_ROW.indexOf(keyCode);\r\n  } else if (TOP_ROW.includes(keyCode)) {\r\n    note = TOP_ROW.indexOf(keyCode) + 12;\r\n  }\r\n\r\n  return note;\r\n}\r\n\r\nexport class Keyboard extends BaseElement<\"update\"> {\r\n  constructor() {\r\n    super(\"div\", \"keyboard\");\r\n\r\n    if (!midiAccess) {\r\n      navigator\r\n        .requestMIDIAccess()\r\n        .then((midi) => {\r\n          console.log(\"MIDI Access\", midi);\r\n          midiAccess = midi;\r\n          midi.inputs.forEach((entry) => {\r\n            entry.onmidimessage = (e) => this.handleMIDI(e);\r\n          });\r\n        })\r\n        .catch((e) => {\r\n          console.error(\"MIDI Access error\", e);\r\n          new PopupNotification(\"MIDI Access error\", { body: e.message });\r\n        });\r\n    }\r\n\r\n    const pressedKeys: number[] = [];\r\n\r\n    window.addEventListener(\"keydown\", (event) => {\r\n      //console.log(event.key, event.keyCode);\r\n\r\n      if (event.ctrlKey || event.altKey || event.shiftKey) return;\r\n\r\n      const target = event.target as HTMLElement;\r\n      if (target.tagName == \"INPUT\") return;\r\n\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || pressedKeys.includes(note)) return;\r\n\r\n      pressedKeys.push(note);\r\n      const update: IKeyboardEvent = { type: \"press\", note, velocity: 0.98, channel: 0 };\r\n      this.emit(\"update\", update);\r\n    });\r\n\r\n    window.addEventListener(\"keyup\", (event) => {\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || !pressedKeys.includes(note)) return;\r\n\r\n      pressedKeys.splice(pressedKeys.indexOf(note), 1);\r\n      this.emit(\"update\", { type: \"release\", note });\r\n    });\r\n  }\r\n\r\n  private handleMIDI(event: MIDIMessageEvent) {\r\n    console.log(\"MIDI\", event.data?.length, \"bytes\", event.data);\r\n    if (event.data === null || event.data.length < 3) return;\r\n\r\n    // event.data is a uint8array\r\n\r\n    const statusByte = event.data[0];\r\n    const eventType = statusByte & 0xf0;\r\n    const channel = statusByte & 0x0f;\r\n\r\n    const dataByte1 = event.data[1];\r\n    const dataByte2 = event.data[2];\r\n\r\n    if (eventType === 0x90 && dataByte2 !== 0) {\r\n      // Note On event\r\n      const note = dataByte1 - 36;\r\n      const velocity = dataByte2 / 128;\r\n\r\n      const update: IKeyboardEvent = { type: \"press\", note, velocity, channel };\r\n\r\n      this.emit(\"update\", update);\r\n    } else if (eventType === 0x80 || (eventType === 0x90 && dataByte2 === 0)) {\r\n      // Note Off event\r\n      const note = dataByte1 - 36;\r\n      this.emit(\"update\", { type: \"release\", note });\r\n    } else if (eventType === 0xb0) {\r\n      // Control Change event\r\n      const control = dataByte1;\r\n      const value = dataByte2;\r\n      // Process the control change event\r\n      console.log(\"Control Change\", control, value);\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap, IResizeEvent } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class SizableElement<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"resize\" | T> {\r\n  private _resizing = false;\r\n  private _startX = 0;\r\n  private _startY = 0;\r\n  private _startWidth = 0;\r\n  private _startHeight = 0;\r\n  private _startTop = 0;\r\n  private _startLeft = 0;\r\n\r\n  private _resizeDirection: \"top\" | \"right\" | \"bottom\" | \"left\" | null = null;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super(tagName, className);\r\n\r\n    this.domElement.addEventListener(\"pointermove\", (e) => {\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle === \"top\" || handle === \"bottom\") {\r\n        this.domElement.style.cursor = \"ns-resize\";\r\n      } else if (handle === \"left\" || handle === \"right\") {\r\n        this.domElement.style.cursor = \"ew-resize\";\r\n      } else {\r\n        this.domElement.style.cursor = \"auto\";\r\n      }\r\n    });\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      if (this._resizing) {\r\n        console.log(this._resizeDirection);\r\n\r\n        const dx = e.clientX - this._startX;\r\n        const dy = e.clientY - this._startY;\r\n\r\n        if (this._resizeDirection === \"right\") {\r\n          this.domElement.style.width = `${this._startWidth + dx}px`;\r\n        } else if (this._resizeDirection === \"bottom\") {\r\n          this.domElement.style.height = `${this._startHeight + dy}px`;\r\n        } else if (this._resizeDirection === \"left\") {\r\n          this.domElement.style.width = `${this._startWidth - dx}px`;\r\n          this.domElement.style.left = `${this._startLeft + dx}px`;\r\n        } else if (this._resizeDirection === \"top\") {\r\n          this.domElement.style.height = `${this._startHeight - dy}px`;\r\n          this.domElement.style.top = `${this._startTop + dy}px`;\r\n        }\r\n\r\n        const event: IResizeEvent = {\r\n          target: this,\r\n          width: this.domElement.offsetWidth,\r\n          height: this.domElement.offsetHeight,\r\n          event: e,\r\n        };\r\n        this.emit(\"resize\", event);\r\n      }\r\n    };\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      if (e.button !== 0) return;\r\n      //if (e.target !== this.domElement) return;\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle) {\r\n        window.addEventListener(\"pointermove\", onmove);\r\n        this.startResize(e, handle);\r\n        e.preventDefault();\r\n      }\r\n      const onrelease = () => {\r\n        this.stopResize();\r\n        window.removeEventListener(\"pointermove\", onmove);\r\n        window.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      window.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n  }\r\n\r\n  protected startResize(\r\n    e: PointerEvent,\r\n    direction: \"top\" | \"right\" | \"bottom\" | \"left\"\r\n  ) {\r\n    console.log(\"startResize\", direction);\r\n    this._resizing = true;\r\n    this._startX = e.clientX;\r\n    this._startY = e.clientY;\r\n    this._startWidth = this.domElement.offsetWidth;\r\n    this._startHeight = this.domElement.offsetHeight;\r\n    this._startTop = this.domElement.offsetTop;\r\n    this._startLeft = this.domElement.offsetLeft;\r\n    this._resizeDirection = direction;\r\n  }\r\n\r\n  protected stopResize() {\r\n    this._resizing = false;\r\n    this._resizeDirection = null;\r\n  }\r\n\r\n  getCurrentHandle(e: PointerEvent) {\r\n    const rect = this.domElement.getBoundingClientRect();\r\n    const offsetX = e.clientX - rect.left;\r\n    const offsetY = e.clientY - rect.top;\r\n\r\n    if (offsetX > 0 && offsetX < 8) {\r\n      return \"left\";\r\n    } else if (rect.width - offsetX < 8) {\r\n      return \"right\";\r\n    } else if (offsetY > 0 && offsetY < 8) {\r\n      return \"top\";\r\n    } else if (rect.height - offsetY < 8) {\r\n      return \"bottom\";\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { EventDataMap, IDragEvent, IResizeEvent } from \"../EventObject\";\r\nimport { SizableElement } from \"./SizableElement\";\r\n\r\nexport interface IWindowOptions {\r\n  title: string;\r\n  content?: HTMLElement;\r\n  persistent?: boolean;\r\n  width?: number;\r\n  height?: number;\r\n  top?: number;\r\n  left?: number;\r\n}\r\n\r\ntype WindowEvents = \"update\" | \"resize\" | \"open\" | \"close\" | \"drag\";\r\n\r\nexport class DraggableWindow<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n> extends SizableElement<WindowEvents | T> {\r\n  readonly titlebar: HTMLElement;\r\n  readonly content: HTMLElement;\r\n  private readonly persistent;\r\n  private readonly _title: HTMLElement;\r\n  private readonly _closeButton: HTMLButtonElement;\r\n  private _isDragging = false;\r\n  private _dragOffsetX = 0;\r\n  private _dragOffsetY = 0;\r\n  private _top = 0;\r\n  private _left = 0;\r\n\r\n  get isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(readonly options: IWindowOptions) {\r\n    super(\"div\", \"draggable-window\");\r\n\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this._top = options.top || 0;\r\n    this._left = options.left || 0;\r\n\r\n    this.persistent = options.persistent || false;\r\n\r\n    this.titlebar = document.createElement(\"div\");\r\n    this.titlebar.className = \"window-titlebar\";\r\n    this.domElement.appendChild(this.titlebar);\r\n\r\n    this.on(\"resize\", (e) => {\r\n      const event = e as IResizeEvent;\r\n      this.options.width = event.width;\r\n      this.options.height = event.height;\r\n    });\r\n\r\n    this.titlebar.addEventListener(\"pointerdown\", (e) => {\r\n      this._isDragging = true;\r\n      this._dragOffsetX =\r\n        e.clientX -\r\n        this.domElement.getBoundingClientRect().left +\r\n        this.domElement.parentElement!.getBoundingClientRect().left;\r\n      this._dragOffsetY =\r\n        e.clientY -\r\n        this.domElement.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.scrollTop;\r\n\r\n      const ondrag = (e: PointerEvent) => {\r\n        if (this._isDragging) {\r\n          let newTop = e.clientY - this._dragOffsetY;\r\n          const newLeft = e.clientX - this._dragOffsetX;\r\n\r\n          const deltaX = newLeft - this._left;\r\n          const deltaY = newTop - this._top;\r\n\r\n          if (newTop < 0) {\r\n            newTop = 0;\r\n          }\r\n\r\n          // if (newLeft < 0) {\r\n          //   newLeft = 0;\r\n          // }\r\n\r\n          this.domElement.style.top = `${newTop}px`;\r\n          this.domElement.style.left = `${newLeft}px`;\r\n\r\n          this._top = newTop;\r\n          this._left = newLeft;\r\n\r\n          const event: IDragEvent = {\r\n            target: this,\r\n            event: e,\r\n            top: newTop,\r\n            left: newLeft,\r\n            deltaX: deltaX,\r\n            deltaY: deltaY,\r\n          };\r\n\r\n          this.emit(\"drag\", event);\r\n        }\r\n      };\r\n\r\n      const onrelease = () => {\r\n        this._isDragging = false;\r\n        document.body.removeEventListener(\"pointermove\", ondrag);\r\n        document.body.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      document.body.addEventListener(\"pointermove\", ondrag);\r\n      document.body.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n\r\n    this._title = document.createElement(\"div\");\r\n    this._title.className = \"window-titlebar-title\";\r\n    this._title.textContent = options.title;\r\n    this.titlebar.appendChild(this._title);\r\n\r\n    this.content = document.createElement(\"div\");\r\n    this.content.className = \"window-content\";\r\n    this.domElement.appendChild(this.content);\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.className = \"window-close-button\";\r\n    this._closeButton.addEventListener(\"pointerdown\", (e) => {\r\n      if (e.button === 0) this.close();\r\n    });\r\n\r\n    this.titlebar.appendChild(this._closeButton);\r\n\r\n    const width = options.width || 640;\r\n    const height = options.height || 400;\r\n    this.setSize(width, height);\r\n\r\n    if (options.content) this.content.appendChild(options.content);\r\n  }\r\n\r\n  resetDragOffset() {\r\n    const rect = this.domElement.parentElement!.getBoundingClientRect();\r\n    this._dragOffsetX = rect.left + 100;\r\n    this._dragOffsetY = rect.top + 10;\r\n  }\r\n\r\n  show(x?: number, y?: number) {\r\n    if (x === undefined) x = this._left;\r\n    if (y === undefined) y = this._top;\r\n\r\n    this._top = y;\r\n    this._left = x;\r\n\r\n    if (this._top === 0 && this._left === 0) {\r\n      x = window.innerWidth / 2 - 200;\r\n      y = window.innerHeight / 4;\r\n    }\r\n\r\n    this.domElement.style.display = \"flex\";\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n\r\n    setTimeout(() => {\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n      this.emit(\"open\");\r\n    }, 1);\r\n  }\r\n\r\n  close() {\r\n    this.domElement.style.display = \"none\";\r\n    this.emit(\"close\");\r\n    if (!this.persistent) {\r\n      console.log(\"Removing window\", this);\r\n      this.domElement.remove();\r\n    }\r\n  }\r\n\r\n  setSize(width: number, height: number) {\r\n    this.options.width = width;\r\n    this.options.height = height;\r\n    this.domElement.style.width = `${width}px`;\r\n    this.domElement.style.height = `${height}px`;\r\n  }\r\n\r\n  setPosition(x: number, y: number) {\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this._title.textContent = title;\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\nimport { SelectableElement } from \"./SelectableElement\";\r\n\r\nexport class SelectableGroup<\r\n  T extends SelectableElement = SelectableElement,\r\n> extends BaseElement<\"select\", HTMLDivElement> {\r\n  constructor(readonly items: T[] = []) {\r\n    super(\"div\", \"selectable-group\");\r\n    for (const item of items) {\r\n      this.addSelectable(item, false);\r\n    }\r\n  }\r\n\r\n  addSelectable(selectable: T, addToDom = true) {\r\n    if (this.items.indexOf(selectable) !== -1) {\r\n      console.warn(\"Already added\", selectable);\r\n    } else {\r\n      this.items.push(selectable);\r\n      selectable.on(\"select\", () => {\r\n        this.emit(\"select\", this);\r\n      });\r\n      if (addToDom) this.domElement.appendChild(selectable.domElement);\r\n\r\n      selectable.domElement.addEventListener(\"pointerdown\", (e) => {        \r\n        if (!e.ctrlKey && !e.shiftKey) {\r\n          for (const item of this.items) {\r\n            item.selected = item === selectable;\r\n          }\r\n        } else if (e.ctrlKey) {\r\n          selectable.selected = !selectable.selected;\r\n        } else if (e.shiftKey) {\r\n          const f = this.items.find((t) => t.selected);\r\n          if (!f) {\r\n            selectable.selected = true;\r\n            return;\r\n          }\r\n          const start = this.items.indexOf(f);\r\n          const end = this.items.indexOf(selectable);\r\n          const min = Math.min(start, end);\r\n          const max = Math.max(start, end);\r\n          for (let i = min; i <= max; i++) {\r\n            this.items[i].selected = true;\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  removeSelectable(selectable: T) {\r\n    const index = this.items.indexOf(selectable);\r\n    if (index !== -1) {\r\n      this.items.splice(index, 1);\r\n      this.domElement.removeChild(selectable.domElement);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    for (const item of this.items) {\r\n      this.domElement.removeChild(item.domElement);\r\n    }\r\n    this.items.length = 0;\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport class SelectableElement<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n> extends BaseElement<\"select\" | T> {\r\n  get selected() {\r\n    return this.domElement.classList.contains(\"selected\");\r\n  }\r\n\r\n  set selected(value: boolean) {\r\n    if (value === this.selected) return;\r\n    this.domElement.classList.toggle(\"selected\", value);\r\n    this.emit(\"select\", this);\r\n  }\r\n\r\n  constructor(    \r\n    tagName: string,\r\n    className?: string\r\n  ) {\r\n    super(tagName, className);    \r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\n\r\nexport class MuteSoloButtons extends BaseElement<\"change\"> {\r\n  private _mute: boolean = false;\r\n  private _solo: boolean = false;\r\n  private _muteButton: HTMLDivElement;\r\n  private _soloButton: HTMLDivElement;\r\n\r\n  get mute() {\r\n    return this._mute;\r\n  }\r\n\r\n  set mute(value: boolean) {\r\n    this._mute = value;\r\n    this._muteButton.classList.toggle(\"active\", this._mute);\r\n  }\r\n\r\n  get solo() {\r\n    return this._solo;\r\n  }\r\n\r\n  set solo(value: boolean) {\r\n    this._solo = value;\r\n    this._soloButton.classList.toggle(\"active\", this._solo);\r\n  }\r\n\r\n  constructor() {\r\n    super(\"div\", \"track-buttons\");\r\n\r\n    const mute = document.createElement(\"div\");\r\n    this._muteButton = mute;\r\n    mute.classList.add(\"track-button\");\r\n    mute.classList.add(\"track-mute-button\");\r\n    mute.textContent = \"M\";\r\n    mute.addEventListener(\"pointerdown\", () => {\r\n      this._mute = !this._mute;\r\n      mute.classList.toggle(\"active\", this._mute);\r\n      this.emit(\"change\");\r\n    });\r\n    this.domElement.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"div\");\r\n    this._soloButton = solo;\r\n    solo.classList.add(\"track-button\");\r\n    solo.classList.add(\"track-solo-button\");\r\n    solo.textContent = \"S\";\r\n    solo.addEventListener(\"pointerdown\", () => {\r\n      this._solo = !this._solo;\r\n      solo.classList.toggle(\"active\", this._solo);\r\n      this.emit(\"change\");\r\n    });\r\n    this.domElement.appendChild(solo);\r\n  }\r\n}\r\n","import { SelectableElement } from \"../../../../elements/src/elements/SelectableElement\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { IMixerChannel } from \"../../schema\";\r\nimport { Effect } from \"./Effect\";\r\nimport { MuteSoloButtons } from \"./MuteSoloButtons\";\r\n\r\nexport class MixerChannelStrip extends SelectableElement<\"change\"> {\r\n  private readonly _channel: IMixerChannel;\r\n  private readonly _volume: HTMLInputElement;\r\n  private readonly _label: HTMLSpanElement;\r\n  readonly muteSoloButtons: MuteSoloButtons;\r\n  readonly effects: Effect[] = [];\r\n\r\n  get channel() {\r\n    return this._channel;\r\n  }\r\n\r\n  get volume() {\r\n    return this._volume.valueAsNumber;\r\n  }\r\n\r\n  set volume(value: number) {\r\n    this._volume.value = value.toString();\r\n  }\r\n\r\n  get mute() {\r\n    return this.muteSoloButtons.mute;\r\n  }\r\n\r\n  set mute(value: boolean) {\r\n    if (value !== this.muteSoloButtons.mute) {\r\n      this.muteSoloButtons.mute = value;\r\n      this.channel.mute = value;\r\n    }\r\n  }\r\n\r\n  get solo() {\r\n    return this.muteSoloButtons.solo;\r\n  }\r\n\r\n  set solo(value: boolean) {\r\n    if (value !== this.muteSoloButtons.solo) {\r\n      this.muteSoloButtons.solo = value;\r\n      this.channel.solo = value;\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    group: SelectableGroup,\r\n    channel: IMixerChannel,\r\n    readonly isMaster = false\r\n  ) {\r\n    super(\"div\", \"mixer-channel\");\r\n\r\n    this._channel = channel;\r\n\r\n    this._label = document.createElement(\"span\");\r\n    this._label.textContent = channel.label;\r\n    this.domElement.appendChild(this._label);\r\n\r\n    const volume = document.createElement(\"input\");\r\n    volume.type = \"range\";\r\n    volume.min = \"0\";\r\n    volume.max = \"1.2\";\r\n    volume.step = \"0.01\";\r\n    volume.value = \"1\";\r\n\r\n    this._volume = volume;\r\n\r\n    this.domElement.appendChild(volume);\r\n\r\n    this.muteSoloButtons = new MuteSoloButtons();\r\n    this.domElement.appendChild(this.muteSoloButtons.domElement);\r\n\r\n    volume.addEventListener(\"input\", () => {\r\n      this.emit(\"change\");\r\n    });\r\n\r\n    this.muteSoloButtons.on(\"change\", () => {\r\n      this.emit(\"change\");\r\n    });\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport type { ProjectUI } from \"../ProjectUI\";\r\nimport { MixerChannelStrip } from \"../components/MixerChannelStrip\";\r\n\r\nexport class MixerWindow extends DraggableWindow {\r\n\r\n  readonly channels: SelectableGroup<MixerChannelStrip> = new SelectableGroup();\r\n\r\n  get mixer() {\r\n    return this.ui.project.mixer;\r\n  }\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    super({\r\n      title: \"Mixer\",\r\n      persistent: true,\r\n      content: document.createElement(\"div\"),\r\n      width: 500,\r\n      height: 300,\r\n    });\r\n\r\n    this.domElement.classList.add(\"mixer-window\");\r\n\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"mixer-container\");\r\n\r\n    const channelsContainer = document.createElement(\"div\");\r\n    channelsContainer.classList.add(\"mixer-channels-container\");\r\n\r\n    const effectsContainer = document.createElement(\"div\");\r\n    effectsContainer.classList.add(\"mixer-effects-container\");\r\n\r\n    container.appendChild(channelsContainer);\r\n    container.appendChild(effectsContainer);\r\n\r\n    this.content.appendChild(container);\r\n\r\n    console.log(\"MIXER CHANNELS DEBUG\", this.mixer.channels);\r\n\r\n    for (let i = 0; i < this.mixer.channels.length; i++) {\r\n      const channel = new MixerChannelStrip(this.channels, this.mixer.channels[i], i === 0);\r\n      this.channels.addSelectable(channel);\r\n      this.mixer.channels[i].gainNode.gain.value = channel.volume;\r\n      channel.on(\"change\", () => {\r\n        this.mixer.channels[i].gainNode.gain.value = channel.volume;\r\n      });\r\n      channelsContainer.appendChild(channel.domElement);\r\n    }\r\n\r\n    this.channels.items[0].selected = true;\r\n  }\r\n}\r\n","import { AudioClock } from \"./AudioClock\";\r\n\r\nexport interface ICursorTimeline {\r\n  domElement: HTMLElement;\r\n  timeline: HTMLElement;\r\n  cursor: AudioCursor;\r\n  audioClock: AudioClock;\r\n  beatWidth: number;\r\n}\r\n\r\nexport class AudioCursor {\r\n  readonly domElement: HTMLDivElement;\r\n\r\n  constructor(readonly timeline: ICursorTimeline) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-cursor\");\r\n\r\n    const clock = timeline.audioClock;\r\n\r\n    clock.on(\"update\", () => {\r\n      this.update();\r\n    });\r\n\r\n    clock.on(\"start\", () => {\r\n      this.domElement.style.transform = \"translateX(0)\";\r\n      this.domElement.style.display = \"block\";\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n    });\r\n\r\n    clock.on(\"stop\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n  }\r\n\r\n  update() {\r\n    this.domElement.style.transform = `translateX(${\r\n      this.timeline.audioClock.currentBeat * this.timeline.beatWidth\r\n    }px)`;\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","export async function triggerActive(elt: HTMLElement, timeout = 100) {  \r\n  elt.classList.toggle(\"active\", true);\r\n  setTimeout(() => {\r\n    elt.classList.toggle(\"active\", false);\r\n  }, timeout);\r\n}\r\n","import { IEvent, IPattern } from \"../schema\";\r\n\r\nexport abstract class GraphicsHelpers {\r\n  static renderWaveform(canvas: HTMLCanvasElement, buffer: AudioBuffer) {\r\n    const channelData = buffer.getChannelData(0);\r\n    const bufferLength = channelData.length;\r\n    const sliceWidth = canvas.width / bufferLength;\r\n\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    ctx.beginPath();\r\n    ctx.moveTo(0, canvas.height / 2);\r\n\r\n    for (let i = 0; i < bufferLength; i++) {\r\n      const x = i * sliceWidth;\r\n      const y = ((channelData[i] + 1) * canvas.height) / 2;\r\n      ctx.lineTo(x, y);\r\n    }\r\n\r\n    ctx.lineTo(canvas.width, canvas.height / 2);\r\n    ctx.stroke();\r\n  }\r\n\r\n  static renderSequence(\r\n    canvas: HTMLCanvasElement,\r\n    events: IEvent[],\r\n    color: string,\r\n    beatWidth: number,\r\n    clearFirst = true\r\n  ) {\r\n    // find lowest note\r\n    let lowestNote = 88;\r\n    let highestNote = 0;\r\n    for (const event of events) {\r\n      if (!(event.note || event.note === 0)) {\r\n        console.log(\"event\", event);\r\n        throw new Error(\"renderToCanvas() No note!\");\r\n      }\r\n      if (event.note < lowestNote) lowestNote = event.note;\r\n      if (event.note > highestNote) highestNote = event.note;\r\n    }\r\n\r\n    highestNote += 12;\r\n    lowestNote -= 12;\r\n\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n    if (clearFirst) ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    const paddedScale = Math.min(\r\n      canvas.height / (highestNote - lowestNote + 1),\r\n      2\r\n    );\r\n\r\n    for (const note of events) {\r\n      const y = canvas.height - (note.note! - lowestNote + 1) * paddedScale;\r\n      const x = note.start * beatWidth;\r\n      const width = note.duration * beatWidth;\r\n      ctx.fillStyle = color;\r\n      ctx.fillRect(x, y, width, paddedScale);\r\n    }\r\n  }\r\n\r\n  static renderPattern(\r\n    canvas: HTMLCanvasElement,\r\n    pattern: IPattern,\r\n    color: string,\r\n    beatWidth: number\r\n  ) {\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    const concat: IEvent[] = [];\r\n\r\n    for (const sequence of pattern.tracks) {\r\n      concat.push(...sequence.events);\r\n    }\r\n\r\n    GraphicsHelpers.renderSequence(canvas, concat, color, beatWidth, false);\r\n  }\r\n}\r\n","import { triggerActive } from \"../../../../elements/src/animation\";\r\nimport { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { SelectableElement } from \"../../../../elements/src/elements/SelectableElement\";\r\nimport type { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { GraphicsHelpers } from \"../../abstracts/GraphicsHelpers\";\r\nimport type { Instrument } from \"../../abstracts/Instrument\";\r\nimport { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport type { IEvent, ISequence } from \"../../schema\";\r\nimport type { ProjectUI } from \"../ProjectUI\";\r\nimport { MuteSoloButtons } from \"./MuteSoloButtons\";\r\n\r\nexport class PatternTrackInstrument extends SelectableElement {\r\n  readonly indicator: HTMLDivElement;\r\n  readonly muteSoloButtons: MuteSoloButtons;\r\n\r\n  constructor(readonly track: PatternTrack) {\r\n    console.assert(track, \"PatternTrackInstrument track is null or undefined\");\r\n\r\n    super(\"div\", \"pattern-track-instrument\");\r\n\r\n    this.domElement.classList.add(\"pattern-track-panel\");\r\n\r\n    const labelAndButtons = document.createElement(\"div\");\r\n    labelAndButtons.classList.add(\"pattern-track-label-and-buttons\");\r\n\r\n    const textLabel = document.createElement(\"div\");\r\n    textLabel.textContent = track.name;\r\n    labelAndButtons.appendChild(textLabel);\r\n\r\n    this.muteSoloButtons = new MuteSoloButtons();\r\n    this.muteSoloButtons.on(\"change\", () => {\r\n      track.mute = this.muteSoloButtons.mute;\r\n      track.solo = this.muteSoloButtons.solo;\r\n    });\r\n\r\n    labelAndButtons.appendChild(this.muteSoloButtons.domElement);\r\n\r\n    this.domElement.appendChild(labelAndButtons);\r\n\r\n    const edit = document.createElement(\"div\");\r\n    edit.classList.add(\"track-button\");\r\n    edit.classList.add(\"track-edit-button\");\r\n    edit.textContent = \"e\";\r\n\r\n    const win = this.track.window;\r\n\r\n    edit.addEventListener(\"pointerdown\", () => {\r\n      if (win.isVisible) {\r\n        win.close();\r\n      } else {\r\n        win.show();\r\n      }\r\n    });\r\n    win.on(\"close\", () => {\r\n      edit.classList.toggle(\"active\", false);\r\n    });\r\n    win.on(\"open\", () => {\r\n      edit.classList.toggle(\"active\", true);\r\n    });\r\n    this.muteSoloButtons.domElement.appendChild(edit);\r\n\r\n    this.indicator = document.createElement(\"div\");\r\n    this.indicator.classList.add(\"pattern-track-indicator\");\r\n    this.domElement.appendChild(this.indicator);\r\n  }\r\n}\r\n\r\nexport class PatternTrackPreview extends BaseElement {\r\n  private _canvas: HTMLCanvasElement;\r\n\r\n  get canvas() {\r\n    return this._canvas;\r\n  }\r\n\r\n  constructor(readonly track: PatternTrack) {\r\n    console.assert(track, \"PatternTrackPreview track is null or undefined\");\r\n\r\n    super(\"div\", \"pattern-track-preview\");\r\n    this._canvas = document.createElement(\"canvas\");\r\n    this._canvas.height = 60;\r\n    this._canvas.width = 1280;\r\n    this._canvas.classList.add(\"pattern-track-pattern\");\r\n\r\n    this.domElement.append(this._canvas);\r\n  }\r\n\r\n  update() {\r\n    GraphicsHelpers.renderSequence(\r\n      this._canvas,\r\n      this.track.events,\r\n      \"#bbaaff\",\r\n      this._canvas.width / 16,\r\n    );\r\n  }\r\n}\r\n\r\nexport class PatternTrack extends BaseElement implements ISequence {\r\n  readonly button: PatternTrackInstrument;\r\n  readonly preview: PatternTrackPreview;\r\n  port: number | null = null;\r\n  channel: number = 0;\r\n  private readonly _window: InstrumentWindow;\r\n\r\n  get window() {\r\n    return this._window;\r\n  }\r\n\r\n  get mute() {\r\n    return this.button.muteSoloButtons.mute;\r\n  }\r\n\r\n  set mute(value: boolean) {\r\n    this.button.muteSoloButtons.mute = value;\r\n  }\r\n\r\n  get solo() {\r\n    return this.button.muteSoloButtons.solo;\r\n  }\r\n\r\n  set solo(value: boolean) {\r\n    this.button.muteSoloButtons.solo = value;\r\n  }\r\n\r\n  get name() {\r\n    return this.instrument.name;\r\n  }\r\n\r\n  constructor(\r\n    readonly ui: ProjectUI,\r\n    public instrument: Instrument,\r\n    public events: IEvent[],\r\n    readonly buttonGroup: SelectableGroup,\r\n    readonly previewGroup: SelectableGroup\r\n  ) {\r\n    super(\"div\", \"pattern-track\");\r\n\r\n    this._window = new instrument.Window(ui, instrument);\r\n\r\n    this.button = new PatternTrackInstrument(this);\r\n    this.buttonGroup.addSelectable(this.button, false);\r\n    this.preview = new PatternTrackPreview(this);\r\n\r\n    console.log(\"New window\", this.window);\r\n\r\n    this.domElement.appendChild(this.button.domElement);\r\n    this.domElement.appendChild(this.preview.domElement);\r\n  }\r\n\r\n  trigger(\r\n    note: number,\r\n    beat: number = this.ui.project.audioClock.currentBeat,\r\n    velocity = 1.0\r\n  ) {\r\n    const source = this.instrument.trigger(note, beat, velocity);\r\n    if (beat > 0) {\r\n      this.ui.project.audioClock.scheduleEventAtBeat(() => {\r\n        triggerActive(this.button.indicator);\r\n      }, beat);\r\n    } else {\r\n      triggerActive(this.button.indicator);\r\n    }\r\n    return source;\r\n  }\r\n\r\n  release(note: number, beat: number = this.ui.project.audioClock.currentBeat) {\r\n    this.instrument.release(note, beat);\r\n  }\r\n\r\n  load(sequence: ISequence) {\r\n    this.events = sequence.events;\r\n    this.preview.update();\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { Instrument } from \"../../abstracts/Instrument\";\r\nimport { IEvent, IPattern } from \"../../schema\";\r\nimport { IProjectUpdateEvent, Project } from \"../Project\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"../components/AudioCursor\";\r\nimport {\r\n  PatternTrack,\r\n  PatternTrackInstrument,\r\n  PatternTrackPreview,\r\n} from \"../components/PatternTrack\";\r\n\r\nexport class PatternWindow\r\n  extends DraggableWindow<\"select\" | \"edit\">\r\n  implements ICursorTimeline\r\n{\r\n\r\n  readonly trackContainer: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLDivElement;\r\n  readonly tracks: PatternTrack[] = [];\r\n  readonly patternPreviews: SelectableGroup;\r\n  readonly buttons: SelectableGroup;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.ui.project.audioClock;\r\n  }\r\n\r\n  beatWidth = 20;\r\n\r\n  constructor(public ui: ProjectUI) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"pattern-track-container\");\r\n\r\n    super({\r\n      title: \"Pattern\",\r\n      persistent: true,\r\n      content: container,\r\n      width: 400,\r\n      height: 400,\r\n    });\r\n    this.trackContainer = container;\r\n\r\n    this.timeline = this.trackContainer;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.style.marginLeft = \"150px\";\r\n    this.timeline.appendChild(this.cursor.domElement);\r\n\r\n    const canvas = this.domElement.querySelector(\"canvas\");\r\n    if (canvas) this.beatWidth = canvas.width / 16;\r\n\r\n    this.on(\"resize\", () => {\r\n      this.beatWidth = this.domElement.clientWidth / 16;\r\n    });\r\n\r\n    ui.project.on(\"update\", (e) => {\r\n      const update = e as IProjectUpdateEvent;\r\n\r\n      if (update.type === \"project\") {\r\n        const project = update.value as Project;\r\n\r\n        for (const track of this.tracks) {\r\n          this.trackContainer.removeChild(track.domElement);\r\n        }\r\n\r\n        this.tracks.length = 0;\r\n\r\n        if (this.ui.project.patterns.length === 0) {\r\n          this.ui.project.patterns.push({\r\n            name: \"Pattern 1\",\r\n            tracks: [],\r\n          });\r\n        }\r\n\r\n        for (let i = 0; i < project.instruments.length; i++) {\r\n          if (!project.patterns[0].tracks[i]) {\r\n            project.patterns[0].tracks[i] = { events: [] };\r\n          }\r\n          const track = this.addTrack(\r\n            project.instruments[i],\r\n            project.patterns[0].tracks[i].events || []\r\n          );\r\n          if (!project.patterns[0].tracks[i])\r\n            track.load(project.patterns[0].tracks[i]);\r\n          if (i === 0) {\r\n            track.button.selected = true;\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    this.patternPreviews = new SelectableGroup();\r\n    this.buttons = new SelectableGroup<PatternTrackInstrument>();\r\n  }\r\n\r\n  loadPattern(pattern: IPattern) {\r\n    this.setTitle(pattern.name);\r\n    for (let i = 0; i < this.ui.project.instruments.length; i++) {\r\n      pattern.tracks[i] = pattern.tracks[i] || [];\r\n      this.tracks[i].load(pattern.tracks[i]);\r\n    }\r\n    if (!this.isVisible) this.show();\r\n  }\r\n\r\n  addTrack(instrument: Instrument, events: IEvent[]) {\r\n    console.log(\"Add track + instrument:\", instrument);\r\n\r\n    const track = new PatternTrack(\r\n      this.ui,\r\n      instrument,\r\n      events,\r\n      this.buttons,\r\n      this.patternPreviews\r\n    );\r\n\r\n    instrument.output.connect(this.ui.mixerWindow.mixer.channels[0].gainNode);\r\n\r\n    console.assert(\r\n      track.button instanceof PatternTrackInstrument,\r\n      \"button is not an instance of PatternTrackInstrument\"\r\n    );\r\n    console.assert(\r\n      track.preview instanceof PatternTrackPreview,\r\n      \"preview is not an instance of PatternTrackPreview\"\r\n    );\r\n\r\n    track.preview.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.ui.pianoRollWindow.loadTrack(track);\r\n      this.ui.pianoRollWindow.show();\r\n    });\r\n\r\n    this.tracks.push(track);\r\n    this.trackContainer.appendChild(track.domElement);\r\n\r\n    return track;\r\n  }\r\n\r\n  removeTrack(track: PatternTrack) {\r\n    const index = this.tracks.indexOf(track);\r\n    if (index !== -1) {\r\n      this.tracks.splice(index, 1);\r\n      this.trackContainer.removeChild(track.domElement);\r\n      this.buttons.removeSelectable(track.button);\r\n    }\r\n  }\r\n\r\n  trigger(\r\n    note: number,\r\n    beat: number = this.audioClock.currentBeat,\r\n    velocity = 1.0\r\n  ) {\r\n    for (const track of this.tracks) {\r\n      if (track.button.selected) {\r\n        track.trigger(note, beat, velocity);\r\n      }\r\n    }\r\n  }\r\n\r\n  release(note: number, beat: number = this.audioClock.currentBeat) {\r\n    for (const track of this.tracks) {\r\n      if (track.button.selected) {\r\n        track.release(note, beat);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class ScrollPanel<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"scroll\" | T> {\r\n  sensitivity = 50;\r\n  private linkedElements: HTMLElement[] = [];\r\n  private _scrollTop = 0;\r\n\r\n  get scrollTop() {\r\n    return this._scrollTop;\r\n  }\r\n\r\n  set scrollTop(value: number) {\r\n    const top = -value;\r\n    this._scrollTop = top;\r\n    this.scrollElement.style.transform = `translateY(${top}px)`;\r\n    for (const linkedElement of this.linkedElements) {\r\n      linkedElement.style.transform = `translateY(${top}px)`;\r\n    }\r\n  }\r\n\r\n  constructor(readonly scrollElement: HTMLElement) {\r\n    super(\"div\", \"scroll-panel\");\r\n    scrollElement.classList.add(\"scroll-panel-content\");\r\n\r\n    this.scrollElement.addEventListener(\"wheel\", (e) => {\r\n      e.preventDefault();\r\n      let top =\r\n        this._scrollTop + (e.deltaY > 0 ? -this.sensitivity : this.sensitivity);\r\n      const bottom = top + this.scrollElement.offsetHeight;\r\n      if (bottom < this.domElement.offsetHeight) {\r\n        top = this.domElement.offsetHeight - this.scrollElement.offsetHeight;\r\n      } else if (top > 0) {\r\n        top = 0;\r\n      }\r\n      this._scrollTop = top;\r\n      this.scrollElement.style.transform = `translateY(${top}px)`;\r\n      for (const linkedElement of this.linkedElements) {\r\n        linkedElement.style.transform = `translateY(${top}px)`;\r\n      }\r\n\r\n      this.emit(\"scroll\", e);\r\n    });\r\n  }\r\n\r\n  linkElement(element: HTMLElement) {\r\n    this.linkedElements.push(element);\r\n    element.classList.add(\"scroll-panel-content\");\r\n  }\r\n}\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\n\r\nexport class AudioCanvas {\r\n  domElement: HTMLDivElement;\r\n  canvas: HTMLCanvasElement;\r\n  ctx: CanvasRenderingContext2D;\r\n  buffer: AudioBuffer | null = null;\r\n\r\n  constructor(width = 800, height = 200, playOnClick = true) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-canvas\");\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n    this.domElement.appendChild(this.canvas);\r\n\r\n    if (playOnClick) {\r\n      this.canvas.addEventListener(\"click\", () => {\r\n        if (this.buffer) {\r\n          this.playBuffer(this.buffer);\r\n        }\r\n      });\r\n    }\r\n\r\n    this.ctx = this.canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; note: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.note,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n\r\n  playBuffer(audioBuffer: AudioBuffer) {\r\n    const ctx = getAudioContext();\r\n    const source = ctx.createBufferSource();\r\n    source.buffer = audioBuffer;\r\n    source.connect(ctx.destination);\r\n    source.start();\r\n  }\r\n\r\n  loadBuffer(audioBuffer: AudioBuffer) {\r\n    this.buffer = audioBuffer;\r\n\r\n    const channelData = audioBuffer.getChannelData(0);\r\n    const bufferLength = channelData.length;\r\n    const sliceWidth = this.canvas.width / bufferLength;\r\n\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.canvas.height / 2);\r\n\r\n    for (let i = 0; i < bufferLength; i++) {\r\n      const x = i * sliceWidth;\r\n      const y = ((channelData[i] + 1) * this.canvas.height) / 2;\r\n\r\n      this.ctx.lineTo(x, y);\r\n    }\r\n\r\n    this.ctx.lineTo(this.canvas.width, this.canvas.height / 2);\r\n    this.ctx.stroke();\r\n  }\r\n}\r\n","import { AudioCanvas } from \"../../../../elements/src/elements/AudioCanvas\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\n\r\nexport class LyricCanvas extends AudioCanvas {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; note: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.note,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class DialogPopup extends BaseElement<\"result\" | \"cancel\"> {  \r\n  closeButton: HTMLButtonElement;\r\n  okButton: HTMLButtonElement | undefined;\r\n  cancelButton: HTMLButtonElement | undefined;\r\n\r\n  get isVisibile() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    private readonly ok: string | HTMLButtonElement = \"OK\",\r\n    private readonly cancel: string | HTMLButtonElement = \"Cancel\"\r\n  ) {\r\n    super(\"div\", \"dialog-popup\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");    \r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"pointerdown\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    if (ok instanceof HTMLButtonElement) {\r\n      this.okButton = ok;\r\n    } else if (ok) {\r\n      this.okButton = document.createElement(\"button\");\r\n      this.okButton.textContent = ok;\r\n      this.domElement.appendChild(this.okButton);\r\n    }\r\n\r\n    if (this.okButton) {\r\n      this.okButton.addEventListener(\"click\", () => {\r\n        this.emit(\"result\", this);\r\n      });\r\n    }\r\n\r\n    if (cancel instanceof HTMLButtonElement) {\r\n      this.cancelButton = cancel;\r\n    } else if (cancel) {\r\n      this.cancelButton = document.createElement(\"button\");\r\n      this.cancelButton.textContent = cancel;\r\n      this.domElement.appendChild(this.cancelButton);\r\n    }\r\n\r\n    if (this.cancelButton) {\r\n      this.cancelButton.addEventListener(\"click\", () => {\r\n        this.emit(\"cancel\", this);\r\n      });\r\n    }\r\n  }\r\n\r\n  show(x: number, y: number, targetObject?: unknown) { /* eslint-disable-line @typescript-eslint/no-unused-vars */\r\n    this.domElement.style.display = \"block\";\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","import { LyricCanvas } from \"./components/LyricCanvas\";\r\nimport { DialogPopup } from \"../../../elements/src/elements/DialogPopup\";\r\nimport { IEvent } from \"../schema\";\r\n\r\nexport class PianoRollDialog extends DialogPopup {\r\n  domElement: HTMLDivElement;\r\n  closeButton: HTMLButtonElement;\r\n  saveButton: HTMLButtonElement;\r\n  note: IEvent | null = null;\r\n\r\n  constructor(public onsave: (note: IEvent) => void) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-dialog\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");\r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"click\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    this.saveButton = document.createElement(\"button\");\r\n    this.saveButton.textContent = \"Save\";\r\n    this.domElement.appendChild(this.saveButton);\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  override show(x: number, y: number, note: IEvent) {\r\n    super.show(x, y, note);\r\n    this.note = note;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class LyricEditorDialog extends PianoRollDialog {\r\n  textInput: HTMLInputElement;\r\n  audioCanvas: LyricCanvas;  \r\n  constructor(onsave: (note: IEvent) => void) {\r\n    super(onsave);\r\n    this.domElement.classList.add(\"grid-item-editor\");\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this.textInput = document.createElement(\"input\");\r\n    this.textInput.setAttribute(\"placeholder\", \"Note lyric\");\r\n    this.textInput.classList.add(\"lyric-editor-text\");\r\n    this.textInput.type = \"text\";\r\n    this.domElement.appendChild(this.textInput);\r\n\r\n    this.audioCanvas = new LyricCanvas();\r\n    this.domElement.appendChild(this.audioCanvas.domElement);\r\n\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.audioCanvas.domElement.style.display = \"block\";\r\n      // this.audioCanvas.generateAudio(this.note!, true).then((buffer) => {\r\n      //   this.note!.audio = buffer;\r\n      // });\r\n      // this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  show(x: number, y: number, event: IEvent) {\r\n    super.show(x, y, event);\r\n    this.textInput.value = this.note?._label || \"\";\r\n    // if (this.note?.audio) {\r\n    //   this.audioCanvas.loadBuffer(this.note.audio);\r\n    //   this.audioCanvas.domElement.style.display = \"block\";\r\n    // } else {\r\n    //   this.audioCanvas.domElement.style.display = \"none\";\r\n    // }\r\n  }\r\n}\r\n","import { ScrollPanel } from \"../../../../elements/src/elements/ScrollPanel\";\r\nimport { DEFAULT_NOTE_HEIGHT, NOTE_NAMES } from \"../../constants\";\r\nimport { LyricEditorDialog } from \"../audioDialogs\";\r\nimport { IEvent, ISequence } from \"../../schema\";\r\nimport { SelectableElement } from \"../../../../elements/src/elements/SelectableElement\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\n\r\nfunction getNoteNameFromPitch(pitch: number): string {\r\n  const note = NOTE_NAMES[pitch % NOTE_NAMES.length];\r\n  return `${note}${Math.floor(pitch / NOTE_NAMES.length)}`;\r\n}\r\n\r\nconst NOTE_HANDLE_WIDTH = 6;\r\n\r\nexport class GridItem extends SelectableElement implements IEvent {\r\n  labelElement: HTMLDivElement;\r\n  _label: string | \"\" = \"\";\r\n\r\n  get label() {\r\n    return this._label;\r\n  }\r\n\r\n  get note() {\r\n    return this.event.note || 0;\r\n  }\r\n\r\n  set note(value: number) {\r\n    this.event.note = value;\r\n  }\r\n\r\n  get start() {\r\n    return this.event.start;\r\n  }\r\n\r\n  set start(value: number) {\r\n    this.event.start = value;\r\n  }\r\n\r\n  get duration() {\r\n    return this.event.duration;\r\n  }\r\n\r\n  set duration(value: number) {\r\n    this.event.duration = value;\r\n  }\r\n\r\n  get velocity() {\r\n    return this.event.velocity || 0;\r\n  }\r\n\r\n  set velocity(value: number) {\r\n    this.event.velocity = value;\r\n  }\r\n\r\n  set label(value: string) {\r\n    this._label = value;\r\n    this.labelElement.textContent = value;\r\n  }\r\n\r\n  constructor(\r\n    private readonly grid: Grid,\r\n    readonly event: IEvent,\r\n    label?: string,\r\n    src?: string,\r\n    readonly value?: unknown\r\n  ) {\r\n    super(\"div\", \"grid-item\");\r\n    const noteItem = event as IEvent;\r\n\r\n    this.domElement.style.height = `${grid.rowHeight}px`;\r\n\r\n    this.labelElement = document.createElement(\"div\");\r\n    this.labelElement.classList.add(\"grid-item-label\");\r\n    this.domElement.appendChild(this.labelElement);\r\n\r\n    if (src) {\r\n      const image = document.createElement(\"div\");\r\n      image.classList.add(\"grid-item-image\");\r\n      console.log(\r\n        \"DEBUG Background image\",\r\n        src,\r\n        image.style.backgroundImage,\r\n        `url(${src})`\r\n      );\r\n      image.style.backgroundImage = `url(${src})`;\r\n      this.domElement.appendChild(image);\r\n      this.domElement.classList.add(\"has-image\");\r\n    }\r\n\r\n    if (noteItem.velocity) this.velocity = noteItem.velocity;\r\n    if (noteItem.note) {\r\n      this.note = noteItem.note;\r\n      this._label = label || getNoteNameFromPitch(this.note);\r\n      this.labelElement.textContent = this._label;\r\n    } else {\r\n      this.note = 0;\r\n    }\r\n\r\n    this.start = event.start;\r\n    this.duration = event.duration;\r\n\r\n    if (event._label) this.labelElement.textContent = event._label;\r\n\r\n    console.log(\"GridItem\", this);\r\n\r\n    grid.gridElement.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class Grid extends ScrollPanel<\r\n  \"select\" | \"update\" | \"release\" | \"add\" | \"remove\"\r\n> {\r\n  readonly gridElement: HTMLDivElement;\r\n  readonly previewCanvas: HTMLCanvasElement;\r\n  readonly noteEditor: LyricEditorDialog;\r\n  private _currentItem: GridItem | null = null;\r\n  private _dragMode: string | null = null;\r\n  private _dragOffset: number = 0;\r\n  private _sequence: ISequence | null = null;\r\n  private _items: Map<IEvent, GridItem> = new Map();\r\n  readonly scrollElement: HTMLDivElement;\r\n\r\n  public quantize: number = 0.25;\r\n  public drawingEnabled: boolean = true;\r\n  public drawingLabel: string | undefined = undefined;\r\n  public drawingImage: string | undefined = undefined;\r\n  public drawingValue: unknown | undefined = undefined;\r\n\r\n  constructor(\r\n    readonly rowCount = 88,\r\n    readonly beatWidth = 100,\r\n    readonly rowHeight = DEFAULT_NOTE_HEIGHT\r\n  ) {\r\n    const grid = new SelectableGroup<GridItem>();\r\n\r\n    super(grid.domElement);\r\n\r\n    this.scrollElement = grid.domElement;\r\n\r\n    this.gridElement = grid.domElement;\r\n\r\n    this.domElement.classList.add(\"grid-container\");\r\n    this.gridElement.classList.add(\"grid\");\r\n\r\n    this.gridElement.addEventListener(\"dragstart\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.previewCanvas = document.createElement(\"canvas\");\r\n    this.previewCanvas.style.imageRendering = \"pixelated\";\r\n\r\n    const rowBackgroundCanvas = document.createElement(\"canvas\");\r\n    rowBackgroundCanvas.style.imageRendering = \"pixelated\";\r\n    rowBackgroundCanvas.width = this.beatWidth * 4;\r\n    rowBackgroundCanvas.height = this.rowHeight;\r\n    console.log(\"debug\", rowBackgroundCanvas.width, rowBackgroundCanvas.height);\r\n    const ctx = rowBackgroundCanvas.getContext(\"2d\");\r\n    // disable anti-alias\r\n\r\n    if (ctx) {\r\n      ctx.clearRect(\r\n        0,\r\n        0,\r\n        rowBackgroundCanvas.width,\r\n        rowBackgroundCanvas.height\r\n      );\r\n      ctx.lineWidth = 1;\r\n      ctx.strokeStyle = \"#444\";\r\n      for (let j = 1; j < 4; j++) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(j * this.beatWidth, 0);\r\n        ctx.lineTo(j * this.beatWidth, this.rowHeight);\r\n        ctx.stroke();\r\n      }\r\n      ctx.strokeStyle = \"#999\";\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, 0);\r\n      ctx.lineTo(0, this.rowHeight);\r\n      ctx.stroke();\r\n    }\r\n    for (let i = 0; i < rowCount; i++) {\r\n      const row = document.createElement(\"div\");\r\n      row.classList.add(\"grid-row\");\r\n      row.style.height = `${this.rowHeight}px`;\r\n      this.gridElement.appendChild(row);\r\n      const base64 = rowBackgroundCanvas.toDataURL();\r\n      row.style.backgroundImage = `url(${base64})`;\r\n      row.style.backgroundRepeat = \"repeat\";\r\n    }\r\n    this.domElement.appendChild(this.gridElement);\r\n\r\n    this.noteEditor = new LyricEditorDialog((note) => {\r\n      const input = this.noteEditor.domElement.querySelector(\r\n        \".lyric-editor-text\"\r\n      ) as HTMLInputElement;\r\n      note._label = input?.value || \"\";\r\n    });\r\n\r\n    document.body.appendChild(this.noteEditor.domElement);\r\n\r\n    this.gridElement.addEventListener(\"pointerdown\", (e) => {\r\n      if (!this._sequence) throw new Error(\"No track\");\r\n\r\n      if (!this._sequence.events) throw new Error(\"No events\");\r\n\r\n      if (!this.drawingEnabled) return;\r\n\r\n      e.preventDefault();\r\n\r\n      this._dragOffset = e.layerX;\r\n\r\n      if (this.noteEditor.domElement.style.display === \"block\") {\r\n        this.noteEditor.domElement.style.display = \"none\";\r\n        return;\r\n      }\r\n\r\n      if (\r\n        e.target instanceof HTMLDivElement &&\r\n        e.target.classList.contains(\"grid-item\")\r\n      ) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const note = Array.from(this._items.values()).find(\r\n          (item: GridItem) => item.domElement === e.target\r\n        );\r\n\r\n        if (e.ctrlKey || e.button === 1) {\r\n          if (note) this.noteEditor.show(e.clientX + 20, e.clientY - 5, note);\r\n          else this.noteEditor.domElement.style.display = \"none\";\r\n        }\r\n\r\n        if (note) {\r\n          this._currentItem = note;\r\n\r\n          if (e.button === 2) {\r\n            this.remove(note.event);\r\n            this._currentItem = null;\r\n          } else {\r\n            note.domElement!.parentElement?.appendChild(note.domElement!);\r\n            note.domElement!.style.width =\r\n              note.duration * this.beatWidth + \"px\";\r\n            if (this._dragOffset < NOTE_HANDLE_WIDTH) {\r\n              this._dragMode = \"start\";\r\n            } else if (\r\n              note.domElement!.offsetWidth - this._dragOffset <\r\n              NOTE_HANDLE_WIDTH\r\n            ) {\r\n              this._dragMode = \"end\";\r\n            } else {\r\n              this._dragMode = \"move\";\r\n            }\r\n          }\r\n        }\r\n      } else if (e.button !== 0) return;\r\n      else if (e.target === this.gridElement) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const row = Math.floor(e.layerY / this.rowHeight);\r\n        const note = 87 - row;\r\n\r\n        let start = e.layerX / this.beatWidth;\r\n        start = Math.round(start / this.quantize) * this.quantize;\r\n        console.log(\"start\", start, e.layerX);\r\n\r\n        const item: IEvent = {\r\n          row: row,\r\n          note: note,\r\n          start: start,\r\n          velocity: 1,\r\n          duration: this.quantize,\r\n          _label: \"\",\r\n        };\r\n\r\n        this._currentItem = this.add(item);\r\n        this._currentItem.domElement!.style.top = `${\r\n          (87 - this._currentItem.note!) * this.rowHeight\r\n        }px`;\r\n        this._currentItem.domElement!.style.left = `${\r\n          this._currentItem.start * this.beatWidth\r\n        }px`;\r\n        this._dragMode = \"end\";\r\n\r\n        this.emit(\"select\", this._currentItem);\r\n      }\r\n\r\n      this.emit(\"update\", this);\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n\r\n      this.emit(\"update\", this);\r\n      this.emit(\"release\", this._currentItem);\r\n\r\n      this._currentItem = null;\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentItem) {\r\n        // this.remove(this._currentItem);\r\n        this._currentItem = null;\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"contextmenu\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointermove\", (event) => {\r\n      if (this._currentItem && event.buttons === 1) {\r\n        if (this._dragMode === \"start\") {\r\n          const start =\r\n            Math.round(event.layerX / this.beatWidth / this.quantize) *\r\n            this.quantize;\r\n\r\n          const oldStart = this._currentItem.start;\r\n\r\n          if (start >= this._currentItem.start + this._currentItem.duration) {\r\n            return;\r\n          }\r\n\r\n          this._currentItem.start = start;\r\n\r\n          this._currentItem.duration =\r\n            oldStart - this._currentItem.start + this._currentItem.duration;\r\n          this._currentItem.domElement!.style.left = `${\r\n            this._currentItem.start * this.beatWidth\r\n          }px`;\r\n          this._currentItem.domElement!.style.width = `${Math.max(\r\n            this.quantize,\r\n            this._currentItem.duration * this.beatWidth\r\n          )}px`;\r\n        } else if (this._dragMode === \"end\") {\r\n          this._currentItem.duration =\r\n            event.layerX / this.beatWidth - this._currentItem.start;\r\n\r\n          // quantize\r\n          this._currentItem.duration =\r\n            Math.round(this._currentItem.duration / this.quantize) *\r\n            this.quantize;\r\n\r\n          this._currentItem.domElement!.style.width = `${Math.max(\r\n            this.quantize,\r\n            this._currentItem.duration * this.beatWidth\r\n          )}px`;\r\n        } else if (this._dragMode === \"move\") {\r\n          this._currentItem.start =\r\n            Math.max(0, event.layerX - this._dragOffset) / this.beatWidth;\r\n          this._currentItem.start =\r\n            Math.round(this._currentItem.start / this.quantize) * this.quantize;\r\n          this._currentItem.domElement!.style.left = `${\r\n            this._currentItem.start * this.beatWidth\r\n          }px`;\r\n        } else {\r\n          return;\r\n        }\r\n\r\n        this.emit(\"update\", this);\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentItem) {\r\n        this._currentItem.domElement!.style.pointerEvents = \"auto\";\r\n      }\r\n      this._currentItem = null;\r\n    });\r\n\r\n    // this.gridElement.addEventListener(\"pointerleave\", () => {\r\n    //   this.gridElement.classList.remove(\"dragging\");\r\n    //   if (this._currentItem) {\r\n    //     this._currentItem.domElement!.style.pointerEvents = \"auto\";\r\n    //   }\r\n    //   this._currentItem = null;\r\n    // });\r\n  }\r\n\r\n  add(item: IEvent) {\r\n    if (!this._sequence) throw new Error(\"add() No sequence loaded!\");\r\n    const gridItem = new GridItem(\r\n      this,\r\n      item,\r\n      this.drawingLabel,\r\n      this.drawingImage,\r\n      this.drawingValue\r\n    );\r\n    this._sequence.events.push(item);\r\n    this._items.set(item, gridItem);\r\n    this.emit(\"add\", gridItem);\r\n    return gridItem;\r\n  }\r\n\r\n  remove(item: IEvent) {\r\n    if (!this._sequence) throw new Error(\"remove() No sequence loaded!\");\r\n    console.log(\"Grid: remove\", item);\r\n    const gridItem = this._items.get(item);\r\n    if (!gridItem) {\r\n      console.error(\"remove() Item not found!\", item, this._items);\r\n      return;\r\n    }\r\n    gridItem.domElement.remove();\r\n    this._items.delete(item);\r\n    this._sequence.events.splice(this._sequence.events.indexOf(item), 1);\r\n    this.emit(\"remove\", item);\r\n  }\r\n\r\n  load(sequence: ISequence) {\r\n    if (!sequence) {\r\n      throw new Error(\"load() No track!\");\r\n    }\r\n    console.log(\"Grid: load\", sequence.events);\r\n\r\n    this._items.clear();\r\n\r\n    const items = this.gridElement.querySelectorAll(\".grid-item\");\r\n    items.forEach((item) => item.remove());\r\n\r\n    this._sequence = sequence;\r\n\r\n    for (const event of sequence.events) {\r\n      this.add(event);\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport {\r\n  DEFAULT_NOTE_HEIGHT,\r\n  KEY_COLORS,\r\n  NOTE_NAMES,\r\n} from \"../../constants\";\r\nimport { IKeyboardEvent } from \"./Keyboard\";\r\n\r\nexport class SideKeyboard extends BaseElement<\"update\"> {  \r\n  keys: HTMLDivElement[] = [];\r\n  noteHeight = DEFAULT_NOTE_HEIGHT;\r\n\r\n  constructor() {\r\n\r\n    super(\"div\", \"piano-roll-keyboard\");\r\n\r\n    this.redraw();\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const key = e.target as HTMLDivElement;\r\n\r\n      if (key.classList.contains(\"piano-roll-keyboard-key\")) {\r\n        const note_index = this.keys.indexOf(key);\r\n        console.log(\"key\", key.textContent, note_index);        \r\n        key.classList.add(\"active\");\r\n        this.emit(\"update\", { type: \"press\", note: note_index } as IKeyboardEvent);\r\n        const pointerup = () => {\r\n          window.removeEventListener(\"pointerup\", pointerup);\r\n          key.classList.remove(\"active\");\r\n          this.emit(\"update\", { type: \"release\", note: note_index } as IKeyboardEvent);          \r\n        };\r\n\r\n        window.addEventListener(\"pointerup\", () => pointerup());\r\n      }\r\n    });\r\n  }\r\n\r\n  redraw() {\r\n    this.domElement.innerHTML = \"\";\r\n\r\n    for (let i = 87; i >= 0; i--) {\r\n      const key = document.createElement(\"div\");\r\n      key.classList.add(\"piano-roll-keyboard-key\");\r\n      key.style.height = `${this.noteHeight}px`;\r\n      // key.style.bottom = `${i * this.noteHeight}px`;\r\n      key.style.backgroundColor =\r\n        KEY_COLORS[i % 12] === \"white\" ? \"#fff\" : \"#000\";\r\n      key.style.color = KEY_COLORS[i % 12] === \"white\" ? \"#000\" : \"#fff\";\r\n      key.textContent = NOTE_NAMES[i % 12] + ((i / 12) | 0).toString();\r\n      this.domElement.appendChild(key);\r\n      this.keys.push(key);\r\n    }\r\n\r\n    this.keys.reverse();\r\n  }\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"./AudioCursor\";\r\nimport type { GridItem } from \"./Grid\";\r\nimport { Grid } from \"./Grid\";\r\nimport type { IKeyboardEvent } from \"./Keyboard\";\r\nimport type { PatternTrack } from \"./PatternTrack\";\r\nimport { SideKeyboard } from \"./SideKeyboard\";\r\n\r\nexport class PianoRoll\r\n  extends EventObject<\"update\">\r\n  implements ICursorTimeline\r\n{\r\n  readonly domElement: HTMLDivElement;\r\n  readonly grid: Grid;\r\n  readonly sideKeyboard: SideKeyboard;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLElement;\r\n  cursorUpdateInterval: number | object | null = null;\r\n  track: PatternTrack | null = null;\r\n  color = \"#7979ce\";\r\n  beatWidth = 100;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll\");\r\n\r\n    this.sideKeyboard = new SideKeyboard();\r\n    this.domElement.appendChild(this.sideKeyboard.domElement);\r\n    this.sideKeyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      if (e.type == \"press\") this.track!.trigger(e.note);\r\n      else if (e.type == \"release\") this.track!.release(e.note);\r\n    });\r\n\r\n    this.grid = new Grid();\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.on(\"select\", (item) => {\r\n      const note = item as GridItem;\r\n      this.track!.trigger(note.note);\r\n      this.track?.preview.update();\r\n    });\r\n    this.grid.on(\"update\", () => {\r\n      this.track?.preview.update();\r\n    });\r\n    this.grid.on(\"release\", (item) => {\r\n      if (item) this.track!.release((item as GridItem).note);\r\n    });\r\n    this.grid.linkElement(this.sideKeyboard.domElement);\r\n\r\n    this.timeline = this.grid.domElement;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.classList.add(\"audio-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor.domElement);\r\n    this.cursor.domElement.style.marginLeft =\r\n      this.sideKeyboard.domElement.offsetWidth + \"px\";\r\n\r\n    this.grid.scrollTop = 1000;\r\n  }\r\n\r\n  load(track: PatternTrack) {\r\n    if (!track) {\r\n      console.warn(\"No track provided!\");\r\n      return;\r\n    }\r\n    this.track = track;\r\n    this.grid.load(track);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { PatternTrack } from \"../components/PatternTrack\";\r\nimport { PianoRoll } from \"../components/PianoRoll\";\r\n\r\nexport class PianoRollWindow extends DraggableWindow {\r\n  pianoRoll: PianoRoll;\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    const pianoRoll = new PianoRoll(ui.project.audioClock);\r\n\r\n    super({\r\n      title: \"Piano Roll\",\r\n      persistent: true,\r\n      content: pianoRoll.domElement,\r\n      width: 900,\r\n      height: 400,\r\n      left: 100,\r\n      top: 100,\r\n    });\r\n    this.pianoRoll = pianoRoll;\r\n  }\r\n\r\n  loadTrack(track: PatternTrack) {\r\n    this.pianoRoll.load(track);\r\n    this.setTitle(`Piano Roll (${track.name})`);\r\n  }\r\n}\r\n","import EventObject from \"../EventObject\";\r\n\r\nexport class ContextMenu extends EventObject<\"shown\"> {\r\n  private readonly domElement: HTMLElement;\r\n  private readonly _submenus: ContextMenu[] = [];\r\n\r\n  constructor(\r\n    private readonly container?: HTMLElement,\r\n    private readonly attachedElement?: HTMLElement,\r\n    filter?: () => boolean\r\n  ) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"context-menu\");\r\n\r\n    if (container) container.appendChild(this.domElement);\r\n\r\n    if (this.attachedElement) {\r\n      this.hide();\r\n      this.attachedElement.addEventListener(\"contextmenu\", (event) => {\r\n        if (!event.ctrlKey) {\r\n          if (filter && !filter()) return;\r\n          event.preventDefault();\r\n          this.show(event.clientX + 10, event.clientY - 5);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  private _handlePointerDown() {\r\n    // only hide the main menu (others will follow using css rules)\r\n    if (!this.domElement.classList.contains(\"submenu\")) this.hide();\r\n  }\r\n\r\n  public isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  public addItem(label: string, callback: () => void, filter?: () => boolean) {\r\n    const item = document.createElement(\"div\");\r\n    item.classList.add(\"context-menu-item\");\r\n    item.textContent = label;\r\n    item.addEventListener(\"pointerdown\", () => {\r\n      callback();\r\n    });\r\n    this.domElement.appendChild(item);\r\n\r\n    this.on(\"shown\", () => {\r\n      if (filter && !filter()) item.style.display = \"none\";\r\n      else item.style.display = \"block\";\r\n    });\r\n\r\n    return item;\r\n  }\r\n\r\n  public addSubmenu(label: string, submenu: ContextMenu) {\r\n    const item = document.createElement(\"div\");\r\n    item.classList.add(\"context-menu-item\");\r\n    item.classList.add(\"submenu\");\r\n    item.textContent = label;\r\n    item.addEventListener(\"pointerdown\", () => {\r\n      submenu.show(\r\n        this.domElement.offsetLeft + this.domElement.offsetWidth - 5,\r\n        item.offsetTop\r\n      );\r\n      // const elt = e.target as HTMLElement;\r\n      // if (elt.classList.contains(\"context-menu-item\")) {\r\n      //   this.hide();\r\n      // }\r\n    });\r\n\r\n    submenu.domElement.classList.add(\"context-menu-submenu\");\r\n    this._submenus.push(submenu);\r\n\r\n    item.appendChild(submenu.domElement);\r\n    this.domElement.appendChild(item);\r\n  }\r\n\r\n  public show(x: number, y: number) {\r\n    if (!this.container) return;\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.display = \"flex\";\r\n    document.addEventListener(\"pointerup\", () => this._handlePointerDown());\r\n    this.emit(\"shown\");\r\n  }\r\n\r\n  public hide() {\r\n    if (!this.isVisible() || !this.container) return;\r\n    this.domElement.style.display = \"none\";\r\n    // for (let i = 0; i < this._submenus.length; i++) {\r\n    //   this._submenus[i].hide();\r\n    // }\r\n    document.removeEventListener(\"pointerup\", () => this._handlePointerDown());\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { ITrackOptions } from \"../../schema\";\r\nimport { MuteSoloButtons } from \"./MuteSoloButtons\";\r\n\r\nexport class PlaylistTrack\r\n  extends BaseElement<\"update\">\r\n  implements ITrackOptions\r\n{\r\n  private _track: ITrackOptions;\r\n  readonly muteSoloButtons: MuteSoloButtons;\r\n\r\n  get mute() {\r\n    return this._track.mute;\r\n  }\r\n\r\n  get solo() {\r\n    return this._track.solo;\r\n  }\r\n\r\n  get selected() {\r\n    return false;\r\n  }\r\n\r\n  get name() {\r\n    return this._track.name;\r\n  }\r\n\r\n  constructor(track: ITrackOptions) {\r\n    super(\"div\", \"playlist-track\");\r\n\r\n    this._track = track;\r\n\r\n    const settings = document.createElement(\"div\");\r\n    settings.classList.add(\"playlist-track-panel\");\r\n\r\n    const labelAndButtons = document.createElement(\"div\");\r\n    labelAndButtons.classList.add(\"playlist-track-label-and-buttons\");\r\n\r\n    const label = document.createElement(\"div\");    \r\n    label.textContent = track.name;\r\n\r\n    this.muteSoloButtons = new MuteSoloButtons();\r\n    this.muteSoloButtons.on(\"change\", () => {\r\n      this._track.mute = this.muteSoloButtons.mute;\r\n      this._track.solo = this.muteSoloButtons.solo;\r\n    });\r\n\r\n    labelAndButtons.appendChild(label);\r\n    labelAndButtons.appendChild(this.muteSoloButtons.domElement);\r\n    settings.appendChild(labelAndButtons);\r\n    this.domElement.appendChild(settings);\r\n  }\r\n\r\n  trigger(note: number, velocity: number) {\r\n    console.log(\"Trigger\", note, velocity);\r\n  }\r\n\r\n  release(note: number) {\r\n    console.log(\"Release\", note);\r\n  }\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport type {  \r\n  IProject,\r\n  ITrackOptions,\r\n} from \"../../schema\";\r\nimport { IProjectUpdateEvent, Project } from \"../Project\";\r\nimport type { AudioClock } from \"./AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"./AudioCursor\";\r\nimport { Grid } from \"./Grid\";\r\nimport { PlaylistTrack } from \"./PlaylistTrack\";\r\n\r\nexport class Playlist extends EventObject<\"update\"> implements ICursorTimeline {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly grid: Grid;\r\n  readonly _trackPanels: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLElement;\r\n  beatWidth = 20;  \r\n\r\n  get audioClock(): AudioClock {\r\n    return this.project.audioClock;\r\n  }\r\n\r\n  constructor(readonly project: Project) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"playlist\");\r\n\r\n    this._trackPanels = document.createElement(\"div\");\r\n    this._trackPanels.classList.add(\"playlist-tracks\");\r\n    this.domElement.appendChild(this._trackPanels);\r\n\r\n    this.grid = new Grid(16, this.beatWidth, 60);\r\n\r\n    this.grid.quantize = 1;\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.linkElement(this._trackPanels);\r\n    this.grid.load(this.project.playlist);\r\n\r\n    this.timeline = this.grid.domElement;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.classList.add(\"audio-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor.domElement);\r\n    this.cursor.domElement.style.marginLeft =\r\n      this._trackPanels.offsetWidth + \"px\";\r\n    this.grid.scrollTop = 0;\r\n\r\n    this.project.on(\"update\", (e) => {\r\n      const update = e as IProjectUpdateEvent;\r\n      console.log(\"ProjectUI project update\", update);\r\n\r\n      if (update.type === \"project\") {\r\n        if (!(update.value instanceof Project)) {\r\n          console.error(\r\n            \"ProjectUI project update value is not a Project\",\r\n            update\r\n          );\r\n          return;\r\n        }\r\n        console.log(\"Project\", update.value);\r\n        this._loadProject(update.value);\r\n      }\r\n    });\r\n  }\r\n\r\n  private _loadProject(project: IProject) {\r\n    let i = 0;\r\n\r\n    for (let i = 0; i < project.playlist.tracks.length; i++) {\r\n      const track = project.playlist.tracks[i];\r\n      const playlistTrack = new PlaylistTrack(track);\r\n      this._trackPanels.appendChild(playlistTrack.domElement);\r\n      i++;\r\n    }\r\n\r\n    for (; i < 16; i++) {\r\n      const track: ITrackOptions = {\r\n        name: `Track ${i + 1}`,\r\n        mute: false,\r\n        solo: false,\r\n        selected: false,\r\n      };\r\n      const playlistTrack = new PlaylistTrack(track);\r\n      project.playlist.tracks.push(track);\r\n      this._trackPanels.appendChild(playlistTrack.domElement);\r\n    }\r\n  }\r\n}\r\n","export abstract class UUID {\r\n  static random(): string {\r\n    return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, (c) => {\r\n      const r = Math.random() * 16 | 0;\r\n      const v = c === \"x\" ? r : (r & 0x3 | 0x8);\r\n      return v.toString(16);\r\n    });\r\n  }\r\n\r\n  static zero() {\r\n    return \"00000000-0000-0000-0000-000000000000\";\r\n  }\r\n}\r\n","import { UUID } from \"../UUID\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\ntype TreeViewItemType = \"file\" | \"folder\" | string;\r\n\r\ninterface ITreeViewItem {\r\n  type: TreeViewItemType;\r\n  name: string;\r\n  id: string;\r\n  parentId: string | null;\r\n  data?: unknown;\r\n  thumbnail?: string;\r\n}\r\n\r\nexport class TreeViewItem\r\n  extends BaseElement<\"add\" | \"change\">\r\n  implements ITreeViewItem\r\n{\r\n  protected _content: HTMLDivElement;\r\n  protected _label: HTMLDivElement;\r\n  protected _icon: HTMLDivElement;\r\n\r\n  get name() {\r\n    return this.item.name;\r\n  }\r\n\r\n  get id() {\r\n    return this.item.id;\r\n  }\r\n\r\n  get parentId() {\r\n    return this.item.parentId;\r\n  }\r\n\r\n  get type() {\r\n    return this.item.type;\r\n  }\r\n\r\n  get data() {\r\n    return this.item.data;\r\n  }\r\n\r\n  constructor(readonly item: ITreeViewItem) {\r\n    super(\"div\", \"treeview-item\");\r\n\r\n    this._content = document.createElement(\"div\");\r\n    this._content.classList.add(\"treeview-item-content\");\r\n\r\n    this._icon = document.createElement(\"div\");\r\n    this._icon.classList.add(\"treeview-icon\");\r\n    this._content.appendChild(this._icon);\r\n\r\n    this._label = document.createElement(\"div\");\r\n    this._label.textContent = item.name;\r\n    this._label.classList.add(\"treeview-item-label\");\r\n    this._content.appendChild(this._label);\r\n    this.domElement.id = item.id;\r\n    this.domElement.classList.add(item.type);\r\n\r\n    this.domElement.appendChild(this._content);\r\n  }\r\n\r\n  rename() {\r\n    const newName = prompt(\"Enter new name\", this.name);\r\n    if (newName) {\r\n      this.item.name = newName;\r\n      const data = this.item.data as object;\r\n      if (data && \"name\" in data) {\r\n        data.name = newName;\r\n      }\r\n      this._label.textContent = newName;\r\n      this.emit(\"change\", this);\r\n    }\r\n  }\r\n}\r\n\r\nexport class TreeViewFolder extends TreeViewItem {\r\n  private readonly _expander: HTMLDivElement;\r\n  private _childContainer?: HTMLDivElement;\r\n\r\n  get expanded() {\r\n    return this.domElement.classList.contains(\"expanded\");\r\n  }\r\n\r\n  constructor(readonly item: ITreeViewItem) {\r\n    super({ ...item, type: \"folder\" });\r\n\r\n    this._expander = document.createElement(\"div\");\r\n    this._expander.classList.add(\"treeview-expander\");\r\n    this._expander.textContent = \"+\";\r\n    this._content.insertBefore(this._expander, this._label);\r\n\r\n    this._expander.addEventListener(\"pointerdown\", () => this.toggle());\r\n\r\n    this.domElement.addEventListener(\"dragover\", (e) => {\r\n      e.preventDefault();\r\n    });\r\n\r\n    this.domElement.addEventListener(\"drop\", (e) => {\r\n      e.preventDefault();\r\n      const id = e.dataTransfer?.getData(\"text/plain\");\r\n      this.emit(\"change\", { id, parentId: this.id });\r\n    });\r\n\r\n    this._content.addEventListener(\"dblclick\", (e) => {\r\n      if (e.target != this._content) return;\r\n      this.toggle();\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    });\r\n  }\r\n\r\n  clear() {\r\n    this._childContainer?.remove();\r\n    this._childContainer = undefined;\r\n  }\r\n\r\n  toggle(expanded?: boolean) {\r\n    this.domElement.classList.toggle(\"expanded\", expanded);\r\n\r\n    if (this.domElement.classList.contains(\"expanded\")) {\r\n      this._expander.textContent = \"-\";\r\n    } else {\r\n      this._expander.textContent = \"+\";\r\n    }\r\n  }\r\n\r\n  add<T extends TreeViewItem>(\r\n    type: TreeViewItemType,\r\n    name: string,\r\n    id?: string,\r\n    data?: unknown\r\n  ): T {\r\n    const item = new (type == \"folder\" ? TreeViewFolder : TreeViewItem)({\r\n      type,\r\n      name,\r\n      id: id || UUID.random(),\r\n      parentId: this.id,\r\n    });\r\n    if (data) item.item.data = data;\r\n\r\n    if (id) {\r\n      console.log(\"Special item\", id);\r\n      item.domElement.classList.toggle(\"special\", true);\r\n    }\r\n\r\n    if (!this._childContainer) {\r\n      this._childContainer = document.createElement(\"div\");\r\n      this._childContainer.classList.add(\"treeview-children\");\r\n      this.domElement.appendChild(this._childContainer);\r\n    }\r\n\r\n    this._childContainer.appendChild(item.domElement);\r\n    this.emit(\"add\", item);\r\n    item.on(\"add\", (item) => this.emit(\"add\", item));\r\n    return item as T;\r\n  }\r\n\r\n  addItem(item: TreeViewItem) {\r\n    if (item.domElement.contains(this.domElement)) {\r\n      console.error(\"Cannot add parent to child\");\r\n      return;\r\n    }\r\n\r\n    if (!this._childContainer) {\r\n      this._childContainer = document.createElement(\"div\");\r\n      this._childContainer.classList.add(\"treeview-children\");\r\n      this.domElement.appendChild(this._childContainer);\r\n    }\r\n\r\n    this._childContainer.appendChild(item.domElement);\r\n  }\r\n}\r\n\r\nexport class TreeView extends BaseElement<\"select\" | \"change\"> {\r\n  readonly root: TreeViewFolder;\r\n  private readonly _items: Map<string, TreeViewItem> = new Map();\r\n  private _selectedItem: TreeViewItem | null = null;\r\n\r\n  get selectedItem() {\r\n    return this._selectedItem;\r\n  }\r\n\r\n  set selectedItem(value: TreeViewItem | null) {\r\n    this._selectedItem?.domElement.classList.toggle(\"selected\", false);\r\n    if (value) {\r\n      if (value.parentId) {\r\n        const parent = this.get(value.parentId);\r\n        if (parent instanceof TreeViewFolder) {\r\n          parent.toggle(true);\r\n        }\r\n      }\r\n      this._selectedItem = value;\r\n      value.domElement.classList.toggle(\"selected\", true);\r\n      this.emit(\"select\", value);\r\n    } else {\r\n      this._selectedItem = null;\r\n    }\r\n  }\r\n\r\n  constructor(rootName = \"/\") {\r\n    super(\"div\", \"treeview\");\r\n    this.root = new TreeViewFolder({\r\n      type: \"folder\",\r\n      name: rootName,\r\n      id: \"root\",\r\n      parentId: null,\r\n    });\r\n    this.root.domElement.classList.toggle(\"special\", true);\r\n    this._items.set(this.root.id, this.root);\r\n    this.root.toggle(true);\r\n    this.domElement.appendChild(this.root.domElement);\r\n\r\n    this.root.on(\"add\", (item) => {\r\n      const newItem = item as TreeViewItem;\r\n      this._items.set(newItem.id, newItem);\r\n      newItem.on(\"change\", (e) => {\r\n        const evt = e as { id: string; parentId: string };\r\n        const item = this._items.get(evt.id);\r\n        const parent = this._items.get(evt.parentId);\r\n        if (!item) {\r\n          throw new Error(\"Item not found: \" + evt.id);\r\n        }\r\n        if (!parent) {\r\n          throw new Error(\"Parent not found: \" + evt.parentId);\r\n        }\r\n        item.item.parentId = evt.parentId;\r\n        parent.domElement.appendChild(item.domElement);\r\n        this.emit(\"change\", e);\r\n      });\r\n    });\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      const target = e.target as HTMLElement;\r\n\r\n      if (!this.domElement.classList.contains(\"active\")) {\r\n        const onpointerdown = (e: PointerEvent) => {\r\n          if (\r\n            !this.domElement.contains(e.target as HTMLElement) &&\r\n            this.domElement.classList.contains(\"active\")\r\n          ) {\r\n            this.domElement.classList.toggle(\"active\", false);\r\n            window.removeEventListener(\"pointerdown\", onpointerdown);\r\n            window.removeEventListener(\"keydown\", onkeydown);\r\n            console.log(\"Treeview inactive\");\r\n            e.preventDefault();\r\n          }\r\n        };\r\n\r\n        const onkeydown = (e: Event) => {\r\n          const event = e as KeyboardEvent;\r\n          console.log(\"Keydown\", event.key);\r\n\r\n          if (\r\n            event.key === \"ArrowRight\" &&\r\n            this._selectedItem instanceof TreeViewFolder\r\n          ) {\r\n            this._selectedItem.toggle(true);\r\n          } else if (\r\n            event.key === \"ArrowLeft\" &&\r\n            this._selectedItem instanceof TreeViewFolder\r\n          ) {\r\n            this._selectedItem.toggle(false);\r\n          }\r\n        };\r\n\r\n        this.domElement.classList.toggle(\"active\", true);\r\n        window.addEventListener(\"pointerdown\", onpointerdown);\r\n        window.addEventListener(\"keydown\", onkeydown);\r\n        console.log(\"Treeview active\");\r\n      }\r\n\r\n      if (target == this.domElement) {\r\n        this.deselect();\r\n        return;\r\n      }\r\n\r\n      if (!target.classList.contains(\"treeview-item-content\")) {\r\n        return;\r\n      }\r\n\r\n      const item = this._items.get(target.parentElement!.id);\r\n\r\n      if (!item) {\r\n        throw new Error(\"Item not found: \" + target.parentElement!.id);\r\n      }\r\n\r\n      this.domElement.classList.toggle(\"dragging\", true);\r\n\r\n      if (item == this._selectedItem) {\r\n        return;\r\n      }\r\n\r\n      this._selectedItem?.domElement.classList.toggle(\"selected\", false);\r\n      this._selectedItem = item;\r\n      item.domElement.classList.toggle(\"selected\", true);\r\n\r\n      this.emit(\"select\", item);\r\n    });\r\n\r\n    this.domElement.addEventListener(\"pointerup\", (e) => {\r\n      this.domElement.classList.toggle(\"dragging\", false);\r\n\r\n      console.log(\"Selected Element\", this._selectedItem?.name);\r\n\r\n      const elt = (e.target as HTMLElement)?.parentElement; // we are actually dropping it on _content\r\n\r\n      if (this._selectedItem?.domElement.contains(elt)) {\r\n        console.log(\"Dropped on self\");\r\n        return;\r\n      }\r\n\r\n      if (!elt) {\r\n        console.error(\"No target element\");\r\n        return;\r\n      }\r\n\r\n      const target: TreeViewFolder = this.get(elt.id);\r\n\r\n      if (!(target instanceof TreeViewFolder)) {\r\n        console.error(\"Target is not a folder\");\r\n        return;\r\n      }\r\n\r\n      if (!target) {\r\n        console.error(\"Target item not found\");\r\n        return;\r\n      }\r\n\r\n      if (this._selectedItem) {\r\n        target.addItem(this._selectedItem);\r\n        target.toggle(true);\r\n\r\n        this.selectedItem = this._selectedItem;\r\n      }\r\n    });\r\n  }\r\n\r\n  get<T extends TreeViewItem>(id: string): T {\r\n    return this._items.get(id) as T;\r\n  }\r\n\r\n  select(id: string) {\r\n    const item = this._items.get(id);\r\n    if (!item) return;\r\n    this.selectedItem = item;\r\n  }\r\n\r\n  deselect() {\r\n    this._selectedItem?.domElement.classList.toggle(\"selected\", false);\r\n    this._selectedItem = null;\r\n  }\r\n\r\n  clear() {\r\n    this.root.clear();\r\n    this._items.clear();\r\n    this._items.set(this.root.id, this.root);\r\n  }\r\n\r\n  duplicateSelected() {\r\n    if (!this.selectedItem) {\r\n      throw new Error(\"No item selected\");\r\n    }\r\n\r\n    const parentId = this.selectedItem?.parentId;\r\n    if (!parentId) {\r\n      throw new Error(\"Selected item has no parent\");\r\n    }\r\n\r\n    const parent = this.get(parentId);\r\n\r\n    if (!parent) {\r\n      throw new Error(\"Parent not found\");\r\n    }\r\n    if (parent instanceof TreeViewFolder) {\r\n      const newItem = parent.add(\r\n        this.selectedItem.type,\r\n        this.selectedItem.name + \" Copy\",\r\n        undefined,\r\n        this.selectedItem.data\r\n          ? JSON.parse(JSON.stringify(this.selectedItem.data))\r\n          : undefined\r\n      );\r\n      const data = newItem.data as object;\r\n      if (\"name\" in data) {\r\n        data.name = newItem.name;\r\n      }\r\n      this.selectedItem = newItem;\r\n      return newItem;\r\n    }\r\n\r\n    throw new Error(\"Selected item is not a folder\");\r\n  }\r\n\r\n  newFolderInSelected() {\r\n    let folder: TreeViewFolder;\r\n    if (this.selectedItem) {\r\n      if (this.selectedItem instanceof TreeViewFolder) {\r\n        folder = this.selectedItem.add(\"folder\", \"New Folder\");\r\n        this.selectedItem.toggle(true);\r\n      } else if (this.selectedItem.parentId) {\r\n        const parent = this.get(this.selectedItem.parentId);\r\n        if (parent && parent instanceof TreeViewFolder) {\r\n          folder = parent.add(\"folder\", \"New Folder\");\r\n          parent.toggle(true);\r\n          this.selectedItem = folder;\r\n        } else {\r\n          throw new Error(\"Parent is not a folder\");\r\n        }\r\n      } else {\r\n        throw new Error(\"Parent is not a folder\");\r\n      }\r\n    } else {\r\n      folder = this.root.add(\"folder\", \"New Folder\");\r\n    }\r\n    folder.toggle(true);\r\n    return folder;\r\n  }\r\n}\r\n","export abstract class AudioImporter {\r\n  static decodeAudioData(\r\n    arrayBuffer: ArrayBuffer,\r\n    audioContext: AudioContext\r\n  ): Promise<AudioBuffer> {\r\n    return new Promise((resolve, reject) => {\r\n      audioContext.decodeAudioData(\r\n        arrayBuffer,\r\n        (buffer) => resolve(buffer),\r\n        (error) => reject(error)\r\n      );\r\n    });\r\n  }\r\n\r\n  static async loadUrl(url: string, audioContext: AudioContext) {\r\n    try {\r\n      const response = await fetch(url);\r\n      const arrayBuffer = await response.arrayBuffer();\r\n      return await AudioImporter.decodeAudioData(arrayBuffer, audioContext);\r\n    } catch (error) {\r\n      console.error(\"Error loading audio file:\", error);\r\n    }\r\n  }\r\n\r\n  static async loadFile(file: File, audioContext: AudioContext) {\r\n    try {\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      return await AudioImporter.decodeAudioData(arrayBuffer, audioContext);\r\n    } catch (error) {\r\n      console.error(\"Error loading audio file:\", error);\r\n    }\r\n  }\r\n\r\n  static loadBlob(\r\n    blob: Blob,\r\n    audioContext: AudioContext\r\n  ): Promise<AudioBuffer> {\r\n    return new Promise((resolve, reject) => {\r\n      const reader = new FileReader();\r\n      reader.onload = () => {\r\n        const arrayBuffer = reader.result as ArrayBuffer;\r\n        AudioImporter.decodeAudioData(arrayBuffer, audioContext)\r\n          .then((audioBuffer) => {\r\n            resolve(audioBuffer);\r\n          })\r\n          .catch((error) => {\r\n            reject(error);\r\n          });\r\n      };\r\n      reader.onerror = (error) => {\r\n        reject(error);\r\n      };\r\n      reader.readAsArrayBuffer(blob);\r\n    });\r\n  }\r\n}\r\n","export abstract class FileImporter {\r\n  static importFile(accept = \"*/*\"): Promise<File> {\r\n    return new Promise((resolve, reject) => {\r\n      const fileInput = document.createElement(\"input\");\r\n      fileInput.type = \"file\";\r\n      fileInput.accept = accept;\r\n      fileInput.addEventListener(\"change\", () => {\r\n        const file = fileInput.files?.[0];\r\n        if (file) {\r\n          resolve(file);\r\n        } else {\r\n          reject(new Error(\"No file selected\"));\r\n        }\r\n      });\r\n      fileInput.click();\r\n    });\r\n  }\r\n}\r\n","import { ContextMenu } from \"../../../elements/src/elements/ContextMenu\";\r\nimport {\r\n  TreeView,\r\n  TreeViewFolder,\r\n} from \"../../../elements/src/elements/TreeView\";\r\nimport { GraphicsHelpers } from \"../abstracts/GraphicsHelpers\";\r\nimport { AudioImporter } from \"../importers/AudioImporter\";\r\nimport { FileImporter } from \"../importers/FileImporter\";\r\nimport { IPattern } from \"../schema\";\r\nimport { IProjectUpdateEvent } from \"./Project\";\r\nimport type { ProjectUI } from \"./ProjectUI\";\r\n\r\nexport class ProjectTreeView extends TreeView {\r\n  constructor(readonly ui: ProjectUI) {\r\n    super(\"Project\");\r\n\r\n    const folderMenu = new ContextMenu(document.body, this.domElement, () => {\r\n      return (\r\n        this.selectedItem?.type === \"folder\" && this.selectedItem.id !== \"root\"\r\n      );\r\n    });\r\n\r\n    folderMenu.addItem(\"New Folder\", () => {\r\n      this.selectedItem = this.newFolderInSelected();\r\n    });\r\n\r\n    folderMenu.addItem(\r\n      \"Rename\",\r\n      () => {\r\n        this.selectedItem?.rename();\r\n      },\r\n      () => {\r\n        return this.selectedItem?.parentId !== this.root.id;\r\n      }\r\n    );\r\n\r\n    folderMenu.addItem(\r\n      \"Import Audio\",\r\n      () => {\r\n        folderMenu.hide();\r\n        FileImporter.importFile(\"audio/*\").then((file) => {\r\n          const folder = this.selectedItem! as TreeViewFolder;\r\n          AudioImporter.loadFile(file, this.ui.audioContext)\r\n            .then((buffer) => {\r\n              if (!buffer) {\r\n                throw new Error(\"Error loading audio file\");\r\n              }\r\n\r\n              const canvas = document.createElement(\"canvas\");\r\n              canvas.width = 1024;\r\n              canvas.height = 100;\r\n\r\n              GraphicsHelpers.renderWaveform(canvas, buffer);\r\n\r\n              this.selectedItem = folder.add(\"audio\", file.name, undefined, {\r\n                buffer,\r\n                image: canvas.toDataURL(),\r\n              });\r\n            })\r\n            .catch((error) => {\r\n              console.error(\"Error loading audio file\", error);\r\n              alert(\"Error loading audio file\");\r\n            });\r\n        });\r\n      },\r\n      () => {\r\n        return this.selectedItem?.id === \"audio\";\r\n      }\r\n    );\r\n\r\n    folderMenu.addItem(\r\n      \"Import Video\",\r\n      () => {\r\n        folderMenu.hide();\r\n        FileImporter.importFile(\"video/*\").then((file) => {\r\n          console.log(\"Imported file\", file);\r\n        });\r\n      },\r\n      () => {\r\n        return this.selectedItem?.id === \"video\";\r\n      }\r\n    );\r\n\r\n    folderMenu.addItem(\r\n      \"Import Image\",\r\n      () => {\r\n        folderMenu.hide();\r\n        FileImporter.importFile(\"image/*\").then((file) => {\r\n          const folder = this.selectedItem! as TreeViewFolder;\r\n          this.selectedItem = folder.add(\"image\", file.name, undefined, file);\r\n        });\r\n      },\r\n      () => {\r\n        return this.selectedItem?.id === \"images\";\r\n      }\r\n    );\r\n\r\n    folderMenu.addItem(\r\n      \"New Pattern\",\r\n      () => {\r\n        const folder = this.selectedItem! as TreeViewFolder;\r\n        const pattern: IPattern = {\r\n          name: \"New Pattern\",\r\n          image: \"\",\r\n          tracks: [],\r\n        };\r\n        this.ui.project.patterns.push(pattern);\r\n        this.selectedItem = folder.add(\r\n          \"pattern\",\r\n          pattern.name,\r\n          undefined,\r\n          pattern\r\n        );\r\n      },\r\n      () => {\r\n        return this.selectedItem?.id === \"patterns\";\r\n      }\r\n    );\r\n\r\n    const fileMenu = new ContextMenu(document.body, this.domElement, () => {\r\n      return this.selectedItem?.type !== \"folder\";\r\n    });\r\n\r\n    fileMenu.addItem(\r\n      \"Duplicate\",\r\n      () => {\r\n        this.selectedItem = this.duplicateSelected();\r\n      },\r\n      () => {\r\n        return Boolean(this.selectedItem);\r\n      }\r\n    );\r\n\r\n    fileMenu.addItem(\r\n      \"Rename\",\r\n      () => {\r\n        this.selectedItem?.rename();\r\n      },\r\n      () => {\r\n        return Boolean(this.selectedItem);\r\n      }\r\n    );\r\n\r\n    ui.project.on(\"update\", (e) => {\r\n      const update = e as IProjectUpdateEvent;\r\n      if (update.type === \"project\") {\r\n        console.log(\"ProjectTreeView.update\");\r\n        this.clear();\r\n        this.root.add(\"folder\", \"Audio\", \"audio\");\r\n        this.root.add(\"folder\", \"Images\", \"images\");\r\n        const patternsFolder: TreeViewFolder = this.root.add(\r\n          \"folder\",\r\n          \"Patterns\",\r\n          \"patterns\"\r\n        );\r\n        patternsFolder.toggle(true);\r\n        const presetsFolder: TreeViewFolder = this.root.add(\r\n          \"folder\",\r\n          \"Presets\",\r\n          \"presets\"\r\n        );\r\n        presetsFolder.toggle(true);\r\n        presetsFolder.add(\"folder\", \"FM Bass\");\r\n        presetsFolder.add(\"folder\", \"FM Piano\");\r\n        presetsFolder.add(\"folder\", \"Mixer\");\r\n        presetsFolder.add(\"folder\", \"Multisampler\");        \r\n        this.root.add(\"folder\", \"Samples\", \"samples\");\r\n        this.root.add(\"folder\", \"Video\", \"video\");\r\n        for (const pattern of ui.project.patterns) {\r\n          patternsFolder.add(\"pattern\", pattern.name, undefined, pattern);\r\n        }\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class ImagePreview extends BaseElement<\"change\"> {\r\n  private _img: HTMLImageElement;\r\n\r\n  constructor(src?: string | File) {\r\n    super(\"div\", \"image-preview\");\r\n\r\n    this._img = document.createElement(\"img\");\r\n    this._img.addEventListener(\"load\", () => {\r\n      this.emit(\"change\", this);\r\n    });\r\n\r\n    if (src instanceof File) {\r\n      this._img.src = URL.createObjectURL(src);\r\n    } else if (typeof src === \"string\") {\r\n      this._img.src = src;\r\n    }\r\n\r\n    this.domElement.appendChild(this._img);\r\n\r\n    // Add pinch-zoom and wheel zoom event listeners\r\n    this.domElement.addEventListener(\"wheel\", this.handleWheelZoom);\r\n    this.domElement.addEventListener(\"touchstart\", this.handlePinchZoom);\r\n    this.domElement.addEventListener(\"touchmove\", this.handlePinchZoom);\r\n  }\r\n\r\n  set src(value: string) {\r\n    this._img.src = value;\r\n  }\r\n\r\n  private handleWheelZoom = (event: WheelEvent) => {\r\n    this._img.style.transform = `scale(${1 + event.deltaY * 0.01})`;\r\n  };\r\n\r\n  private handlePinchZoom = (event: TouchEvent) => {\r\n    const touch1 = event.touches[0];\r\n    const touch2 = event.touches[1];\r\n    if (!touch1 || !touch2) {\r\n      return;\r\n    }\r\n    const distance = Math.hypot(\r\n      touch1.clientX - touch2.clientX,\r\n      touch1.clientY - touch2.clientY\r\n    );\r\n    this._img.style.transform = `scale(${distance * 0.01})`;\r\n  };\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ImagePreview } from \"../../../../elements/src/elements/ImagePreview\";\r\n\r\nexport class ImagePreviewWindow extends DraggableWindow {\r\n  imagePreview: ImagePreview;\r\n  constructor(file: File) {\r\n    super({ title: file.name });\r\n\r\n    this.imagePreview = new ImagePreview(file);\r\n    this.domElement.appendChild(this.imagePreview.domElement);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ContextMenu } from \"../../../../elements/src/elements/ContextMenu\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { IPattern } from \"../../schema\";\r\nimport { Playlist } from \"../components/Playlist\";\r\nimport { ProjectTreeView } from \"../ProjectTreeView\";\r\nimport { FileImporter } from \"../../importers/FileImporter\";\r\nimport { ImagePreviewWindow } from \"./ImagePreviewWindow\";\r\n\r\nexport class ProjectWindow extends DraggableWindow {\r\n  readonly playlist: Playlist;\r\n\r\n  beatWidth = 10;\r\n  treeView: ProjectTreeView;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.ui.project.audioClock;\r\n  }\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"project-container\");\r\n\r\n    super({\r\n      title: \"Project Timeline\",\r\n      persistent: true,\r\n      content: container,\r\n      width: 800,\r\n      height: 400,\r\n    });\r\n\r\n    this.playlist = new Playlist(this.ui.project);\r\n    this.playlist.grid.drawingEnabled = false;\r\n\r\n    const sourceContainer = document.createElement(\"div\");\r\n    sourceContainer.classList.add(\"project-source-container\");\r\n\r\n    this.treeView = new ProjectTreeView(this.ui);\r\n    this.treeView.on(\"select\", () => {\r\n      console.log(\r\n        \"ProjectTreeView.select\",\r\n        this.treeView.selectedItem?.type,\r\n        this.treeView.selectedItem?.name,\r\n        this.treeView.selectedItem?.data\r\n      );\r\n      if (this.treeView.selectedItem?.type === \"pattern\") {\r\n        const pattern = this.treeView.selectedItem.data as IPattern;\r\n        this.playlist.grid.drawingLabel = pattern.name;\r\n        this.playlist.grid.drawingImage = pattern.image;\r\n        this.playlist.grid.drawingValue = pattern;\r\n        this.playlist.grid.drawingEnabled = true;\r\n        this.ui.patternWindow.loadPattern(pattern);\r\n      } else if (this.treeView.selectedItem?.type === \"image\") {\r\n        const file = this.treeView.selectedItem.data as File;\r\n        this.playlist.grid.drawingImage = URL.createObjectURL(file);\r\n        this.playlist.grid.drawingLabel = file.name;\r\n        this.playlist.grid.drawingValue = undefined;\r\n        this.playlist.grid.drawingEnabled = true;\r\n        const window = new ImagePreviewWindow(file);\r\n        window.show();\r\n      } else if (this.treeView.selectedItem?.type === \"audio\") {\r\n        const item = this.treeView.selectedItem.data as {\r\n          buffer: AudioBuffer;\r\n          image: string;\r\n        };\r\n        this.playlist.grid.drawingImage = item.image;\r\n        this.playlist.grid.drawingLabel = this.treeView.selectedItem.name;\r\n        this.playlist.grid.drawingValue = item.buffer;\r\n        this.playlist.grid.drawingEnabled = true;\r\n      } else {\r\n        this.playlist.grid.drawingEnabled = false;\r\n      }\r\n    });\r\n\r\n    this.treeView.on(\"change\", (e) => {\r\n      console.log(\"ProjectTreeView.change\", e);\r\n    });\r\n\r\n    const addMenu = new ContextMenu(document.body);\r\n\r\n    addMenu.addItem(\"Import Audio\", () => {\r\n      FileImporter.importFile(\"audio/*\").then((file) => {\r\n        console.log(\"Imported file\", file);\r\n      });\r\n    });\r\n\r\n    const generateMenu = new ContextMenu();\r\n    generateMenu.addItem(\"Stable Audio\", () => {\r\n      console.log(\"Stable Audio\");\r\n    });\r\n    generateMenu.addItem(\"MusicGen\", () => {\r\n      console.log(\"MusicGen\");\r\n    });\r\n\r\n    addMenu.addSubmenu(\"Generate\", generateMenu);\r\n\r\n    sourceContainer.appendChild(this.treeView.domElement);\r\n\r\n    container.appendChild(sourceContainer);\r\n    container.appendChild(this.playlist.domElement);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport { WindowContainer } from \"../../../elements/src/elements/WindowContainer\";\r\nimport { Project } from \"./Project\";\r\nimport { IKeyboardEvent, Keyboard } from \"./components/Keyboard\";\r\nimport { MixerWindow } from \"./windows/MixerWindow\";\r\nimport { PatternWindow } from \"./windows/PatternWindow\";\r\nimport { PianoRollWindow } from \"./windows/PianoRollWindow\";\r\nimport { ProjectWindow } from \"./windows/ProjectWindow\";\r\n\r\nexport class ProjectUI extends BaseElement<\"update\"> {\r\n  container: WindowContainer;\r\n  readonly pianoRollWindow: PianoRollWindow;\r\n  readonly mixerWindow: MixerWindow;\r\n  patternWindow: PatternWindow;\r\n\r\n  get audioContext() {\r\n    return this.project.audioClock.audioContext;\r\n  }\r\n\r\n  constructor(readonly project: Project) {\r\n    super(\"div\", \"project-ui\");\r\n\r\n    this.container = new WindowContainer();\r\n    this.domElement.appendChild(this.container.domElement);\r\n\r\n    this.pianoRollWindow = new PianoRollWindow(this);\r\n    this.container.addWindow(this.pianoRollWindow);\r\n\r\n    this.patternWindow = new PatternWindow(this);\r\n    this.container.addWindow(this.patternWindow);\r\n    this.patternWindow.show(35, 100);\r\n\r\n    const playlistWindow = new ProjectWindow(this);\r\n    this.container.addWindow(playlistWindow);\r\n    playlistWindow.show(1000, 50);\r\n\r\n    this.mixerWindow = new MixerWindow(this);\r\n    this.container.addWindow(this.mixerWindow);\r\n    this.mixerWindow.show(1000, 470);\r\n\r\n    const keyboard = new Keyboard();\r\n    this.domElement.appendChild(keyboard.domElement);\r\n    keyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      console.log(\"Keyboard\", event);\r\n      if (e.type === \"press\") {\r\n        this.patternWindow.trigger(e.note + 24, 0, e.velocity);\r\n      } else if (e.type === \"release\") {\r\n        this.patternWindow.release(e.note + 24);\r\n      }\r\n    });\r\n  }\r\n}\r\n","import type { Project } from \"../elements/Project\";\r\nimport type { ISourceEvent } from \"../elements/components/SamplerSlot\";\r\nimport { Plugin } from \"../plugins/plugins\";\r\nimport { IInstrumentSettings } from \"../schema\";\r\n\r\nexport interface IInstrument extends IInstrumentSettings {  \r\n\r\n  trigger(\r\n    note: number,\r\n    when: number,\r\n    velocity: number\r\n  ): ISourceEvent | void;\r\n\r\n  release(note: number, when: number): void;\r\n}\r\n\r\nexport abstract class Instrument extends Plugin implements IInstrument {\r\n  \r\n  inputPort?: number | undefined;\r\n  inputChannel?: number | undefined;\r\n  transpose = 0;\r\n  output: GainNode;\r\n\r\n  constructor(project: Project, public mixerChannel = 0) {\r\n    super(project);\r\n    this.output = project.audioClock.audioContext.createGain();\r\n    this.output.connect(project.mixer.channels[mixerChannel].gainNode);\r\n  }\r\n\r\n  abstract trigger(\r\n    note: number,\r\n    when: number,\r\n    velocity?: number\r\n  ): ISourceEvent | void;\r\n\r\n  abstract release(note: number, when: number): void;\r\n\r\n}\r\n","import { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { ISourceEvent } from \"../elements/components/SamplerSlot\";\r\nimport { ISynthesizerVoiceSettings } from \"../schema\";\r\nimport { IInstrument } from \"./Instrument\";\r\n\r\nexport abstract class SynthesizerVoice implements ISynthesizerVoiceSettings, IInstrument {\r\n  _settings: ISynthesizerVoiceSettings | null = null;\r\n\r\n  abstract name: string;\r\n  abstract id: string;\r\n\r\n  get settings(): ISynthesizerVoiceSettings {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n    return this.settings;\r\n  }\r\n\r\n  private readonly _gain: GainNode;\r\n  private _note: number | null = null;\r\n  private _frequency: number | null = null;\r\n\r\n  get gain() {\r\n    return this._gain.gain.value;\r\n  }\r\n\r\n  get output() {\r\n    return this._gain;\r\n  }\r\n\r\n  get note() {\r\n    return this._note;\r\n  }\r\n\r\n  get lfoNumber() {\r\n    return this.settings.lfoNumber;\r\n  }\r\n\r\n  get envelopeNumber() {\r\n    return this.settings.envelopeNumber;\r\n  }\r\n\r\n  get frequency() {\r\n    return this._frequency;\r\n  }\r\n\r\n  get detune() {\r\n    return this.settings.detune;\r\n  }\r\n\r\n  get oscillators() {\r\n    return this.settings.oscillators;\r\n  }\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    this._gain = audioClock.audioContext.createGain();\r\n  }\r\n\r\n  loadSettings(settings: ISynthesizerVoiceSettings) {\r\n    this._settings = settings;\r\n  }\r\n\r\n  abstract trigger(\r\n    note: number,\r\n    velocity: number,\r\n    when: number\r\n  ): ISourceEvent | void;\r\n\r\n  abstract release(note: number, when: number): void;\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport { ControllerValue, IPluginControl } from \"../schema\";\r\n\r\nexport abstract class PluginControl\r\n  extends BaseElement<\"change\">\r\n{\r\n  protected _label: HTMLSpanElement;\r\n\r\n  abstract value: ControllerValue;\r\n\r\n  constructor(readonly settings: IPluginControl) {\r\n    super(\"div\", \"control\");\r\n    this._label = document.createElement(\"span\");\r\n    this._label.classList.add(\"label\");\r\n    this._label.textContent = settings.label;\r\n    this.domElement.appendChild(this._label);\r\n  }\r\n}\r\n","import { PluginControl } from \"../../abstracts/PluginControl\";\r\nimport { IPluginControl } from \"../../schema\";\r\n\r\nexport class Slider extends PluginControl {\r\n  private readonly _range: HTMLInputElement;\r\n\r\n  get value() {\r\n    return this.settings.value as number;\r\n  }\r\n\r\n  set value(value: number) {\r\n    this.settings.value = value;\r\n    this._range.value = value.toString();\r\n  }\r\n\r\n  get element() {\r\n    return this._range;\r\n  }\r\n\r\n  constructor(options: IPluginControl) {\r\n    super({ ...options, controlType: \"slider\" });\r\n\r\n    this._range = document.createElement(\"input\");\r\n    this._range.type = \"range\";\r\n    this._range.min = options.min.toString();\r\n    this._range.max = options.max.toString();\r\n    this._range.step = options.step.toString();\r\n    this._range.value = options.value.toString();\r\n\r\n    this._range.addEventListener(\"input\", () => {\r\n      this.settings.value = parseFloat(this._range.value);\r\n      this.emit(\"change\", this);\r\n    });\r\n\r\n    this._range.addEventListener(\"change\", () => {\r\n      this._range.blur();\r\n    });\r\n\r\n    this.domElement.appendChild(this._range);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { MathHelpers } from \"../../abstracts/MathHelpers\";\r\nimport { PluginControl } from \"../../abstracts/PluginControl\";\r\nimport { IEnvelope } from \"../../schema\";\r\nimport { Slider } from \"./Slider\";\r\n\r\nexport class Envelope extends BaseElement<\"update\"> {\r\n  readonly attack: PluginControl;\r\n  readonly hold: PluginControl;\r\n  readonly decay: PluginControl;\r\n  readonly sustain: PluginControl;\r\n  readonly release: PluginControl;\r\n  private _triggerTime: number = 0;\r\n\r\n  constructor(\r\n    readonly settings: IEnvelope = {\r\n      attack: 0.003,\r\n      hold: 0.0,\r\n      decay: 2.0,\r\n      sustain: 0.01,\r\n      release: 0.15,\r\n    }\r\n  ) {\r\n    super(\"div\", \"envelope\");\r\n\r\n    // \"attack\", \"A\", 0, 1, 0.01, attack\r\n    this.attack = new Slider({\r\n      controlType: \"slider\",\r\n      name: \"attack\",\r\n      label: \"A\",\r\n      min: 0,\r\n      max: 1,\r\n      step: 0.01,\r\n      value: settings.attack,\r\n      default: settings.attack,\r\n    });\r\n    this.hold = new Slider({\r\n      controlType: \"slider\",\r\n      name: \"hold\",\r\n      label: \"H\",\r\n      min: 0,\r\n      max: 1,\r\n      step: 0.01,\r\n      value: settings.hold,\r\n      default: settings.hold,\r\n    });\r\n    this.decay = new Slider({\r\n      controlType: \"slider\",\r\n      name: \"decay\",\r\n      label: \"D\",\r\n      min: 0,\r\n      max: 1,\r\n      step: 0.01,\r\n      value: settings.decay,\r\n      default: settings.decay,\r\n    });\r\n    this.sustain = new Slider({\r\n      controlType: \"slider\",\r\n      name: \"sustain\",\r\n      label: \"S\",\r\n      min: 0,\r\n      max: 1,\r\n      step: 0.01,\r\n      value: settings.sustain,\r\n      default: settings.sustain,\r\n    });\r\n    this.release = new Slider({\r\n      controlType: \"slider\",\r\n      name: \"release\",\r\n      label: \"R\",\r\n      min: 0,\r\n      max: 1,\r\n      step: 0.01,\r\n      value: settings.release,\r\n      default: settings.release,\r\n    });\r\n\r\n    this.domElement.appendChild(this.attack.domElement);\r\n    this.domElement.appendChild(this.decay.domElement);\r\n    this.domElement.appendChild(this.sustain.domElement);\r\n    this.domElement.appendChild(this.release.domElement);\r\n  }\r\n\r\n  trigger(param: AudioParam, when: number, target = 1.0, startValue = 0) {\r\n    console.log(\"trigger @ \" + when);\r\n    this._triggerTime = when;\r\n    const value = param.value;\r\n    param.cancelScheduledValues(when);\r\n    param.setValueAtTime(value, when);\r\n    param.exponentialRampToValueAtTime(Math.max(startValue, 0.015), when);\r\n    //param.setValueAtTime(0.015, when);\r\n    param.linearRampToValueAtTime(target, when + this.settings.attack);\r\n    //param.setValueAtTime(1, when + this.attack.value);\r\n    param.exponentialRampToValueAtTime(\r\n      this.settings.sustain || 0.01,\r\n      when + this.settings.attack + this.settings.decay\r\n    );\r\n  }\r\n\r\n  estimateValueAtTime(relativeWhen: number) {\r\n    const attack = this.settings.attack;\r\n    const decay = this.settings.decay;\r\n    const sustain = this.settings.sustain;\r\n    const release = this.settings.release;\r\n    const hold = this.settings.hold;\r\n\r\n    if (relativeWhen < attack) {\r\n      return MathHelpers.lerp(0, 1, relativeWhen / attack);\r\n    } else if (relativeWhen < attack + hold) {\r\n      return 1;\r\n    } else if (relativeWhen < attack + hold + decay) {\r\n      const timeSinceAttack = relativeWhen - attack - hold;\r\n      const decayValue = Math.exp(-timeSinceAttack / decay);\r\n      return 1 - (1 - sustain) * decayValue;\r\n    } else {\r\n      const timeSinceRelease = relativeWhen - attack - hold - decay;\r\n      const releaseValue = Math.exp(-timeSinceRelease / release);\r\n      return sustain * releaseValue;\r\n    }\r\n  }\r\n\r\n  triggerRelease(param: AudioParam, when: number) {\r\n    console.log(\"triggerRelease @ \" + when);\r\n    const value = param.value;\r\n    param.cancelScheduledValues(this._triggerTime);\r\n    param.setValueAtTime(value, when);\r\n    param.exponentialRampToValueAtTime(0.01, when + this.settings.release);\r\n    param.setValueAtTime(0, when + this.settings.release);\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class DraggableNumber extends BaseElement<\"change\"> {\r\n  private _value: number;\r\n  private _step: number;\r\n  private _hideZero: string | null;\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(value: number) {\r\n    this._value = value;\r\n    if (value === 0 && this._hideZero !== null) {\r\n      this.domElement.textContent = this._hideZero;\r\n    } else {\r\n      this.domElement.textContent = value.toString();\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    value: number,\r\n    min: number,\r\n    max: number,\r\n    step = 1,\r\n    sensitivity = 0.25,\r\n    hideZero: string | null = \"-\"\r\n  ) {\r\n    super(\"div\", \"draggable-number\");\r\n\r\n    this._hideZero = hideZero;\r\n    this._value = value;\r\n    this._step = step;\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const startY = e.clientY;\r\n      const startValue = this.value;\r\n      const onMouseMove = (event: PointerEvent) => {\r\n        const oldValue = this.value;\r\n        const dy = Math.round(-(event.clientY - startY) * sensitivity);\r\n        const newValue = startValue + dy * this._step;\r\n        this.value = Math.max(min, Math.min(max, newValue));\r\n        if (oldValue !== this.value) this.emit(\"change\", this.value);\r\n      };\r\n      const onMouseUp = () => {\r\n        document.removeEventListener(\"pointermove\", onMouseMove);\r\n        document.removeEventListener(\"pointerup\", onMouseUp);\r\n      };\r\n      document.addEventListener(\"pointermove\", onMouseMove);\r\n      document.addEventListener(\"pointerup\", onMouseUp);\r\n    });\r\n\r\n    this.value = value || 0;\r\n  }\r\n}\r\n","import { DraggableNumber } from \"../../../elements/src/elements/DraggableNumber\";\r\n\r\nimport {\r\n  DraggableWindow,\r\n  IWindowOptions,\r\n} from \"../../../elements/src/elements/DraggableWindow\";\r\nimport type { ProjectUI } from \"../elements/ProjectUI\";\r\nimport { Instrument } from \"./Instrument\";\r\n\r\nexport interface IInstrumentWindowOptions extends IWindowOptions {\r\n  mixerChannel: number;\r\n  instrument: Instrument;\r\n}\r\n\r\nexport class InstrumentWindow extends DraggableWindow {\r\n  private _settingsBar: HTMLDivElement;\r\n\r\n  constructor(\r\n    ui: ProjectUI,\r\n    readonly instrument: Instrument\r\n  ) {\r\n    super({\r\n      title: instrument.name,\r\n      width: 400,\r\n      height: 300,\r\n      persistent: true,\r\n    });\r\n\r\n    const mixerChannelSelector = new DraggableNumber(\r\n      instrument.mixerChannel,\r\n      0,\r\n      16\r\n    );\r\n    mixerChannelSelector.on(\"change\", (value) => {\r\n      this.instrument.mixerChannel = value as number;\r\n      console.assert(ui.project.mixer, \"instrument.mixer is undefined!\");\r\n      instrument.output.disconnect();\r\n      instrument.output.connect(\r\n        ui.project.mixer.channels[this.instrument.mixerChannel].gainNode\r\n      );\r\n    });\r\n\r\n    this._settingsBar = document.createElement(\"div\");\r\n    this._settingsBar.classList.add(\"window-settings-bar\");\r\n    this._settingsBar.appendChild(mixerChannelSelector.domElement);\r\n\r\n    this.domElement.insertBefore(this._settingsBar, this.content);\r\n\r\n    ui.container.addWindow(this);\r\n  }\r\n}\r\n","import { PluginControl } from \"../../abstracts/PluginControl\";\r\nimport { IPluginControl } from \"../../schema\";\r\n\r\nexport class Knob extends PluginControl {\r\n  private _value = 0;\r\n  private _handle: HTMLDivElement;\r\n  public sensitivity = 0.25;\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  constructor(readonly settings: IPluginControl) {\r\n    super({\r\n      ...settings,\r\n      controlType: \"knob\",\r\n    });\r\n\r\n    this.domElement.classList.add(\"knob\");\r\n\r\n    const indicator = document.createElement(\"div\");\r\n    indicator.classList.add(\"knob-indicator\");\r\n\r\n    this.sensitivity = (settings.max - settings.min / settings.step) * 0.01;\r\n\r\n    this._handle = document.createElement(\"div\");\r\n    this._handle.appendChild(indicator);\r\n    this._handle.classList.add(\"knob-handle\");\r\n    this._handle.addEventListener(\r\n      \"pointerdown\",\r\n      this._onPointerDown.bind(this)\r\n    );\r\n    this.domElement.insertBefore(this._handle, this._label);\r\n\r\n    this._setValue(settings.value as number);\r\n  }\r\n\r\n  private _onPointerDown(e: PointerEvent) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n\r\n    const startValue = this._value;\r\n    const startPosition = { x: e.clientX, y: e.clientY };\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      const offset = -(e.clientY - startPosition.y);\r\n      const step = e.ctrlKey ? this.settings.step * 0.01 : 1;\r\n      let value = startValue + offset * this.sensitivity * step;\r\n      value -= value % step;\r\n      this._setValue(value);\r\n      this.emit(\"change\", this._value);\r\n      return false;\r\n    };\r\n\r\n    const onrelease = (e: PointerEvent) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      window.removeEventListener(\"pointermove\", onmove);\r\n      window.removeEventListener(\"pointerup\", onrelease);\r\n      this._handle.releasePointerCapture(e.pointerId);\r\n      this._handle.classList.remove(\"active\");\r\n      return false;\r\n    };\r\n\r\n    window.addEventListener(\"pointermove\", onmove);\r\n    window.addEventListener(\"pointerup\", onrelease);\r\n\r\n    // this._handle.setPointerCapture(event.pointerId);\r\n    // this._handle.focus();\r\n    this.emit(\"change\", this._value);\r\n    this._handle.classList.add(\"active\");\r\n    return false;\r\n  }\r\n\r\n  private _setValue(value: number) {\r\n    this._value = Math.min(\r\n      this.settings.max,\r\n      Math.max(this.settings.min, value)\r\n    );\r\n    this._handle.style.transform = `rotate(${\r\n      (this._value * 280) / (this.settings.max - this.settings.min) - 50\r\n    }deg)`;\r\n  }\r\n}\r\n","import {\r\n  InstrumentWindow,\r\n} from \"../../abstracts/InstrumentWindow\";\r\nimport type { ProjectUI } from \"../../elements/ProjectUI\";\r\nimport { Knob } from \"../../elements/components/Knob\";\r\nimport { FMBass } from \"./FMBass\";\r\n\r\n\r\nexport class FMBassWindow extends InstrumentWindow {\r\n\r\n  instrument: FMBass;\r\n\r\n  constructor(\r\n    readonly ui: ProjectUI,\r\n    readonly fmbass: FMBass\r\n  ) {\r\n    super(ui, fmbass);\r\n\r\n    this.instrument = fmbass;\r\n\r\n    const fmGainKnob = new Knob({\r\n      controlType: \"knob\",\r\n      name: \"FM Gain\",\r\n      label: \"FM Gain\",\r\n      min: 0,\r\n      max: 300,\r\n      step: 1,\r\n      default: 100,\r\n      value: 100,\r\n    });\r\n\r\n    this.content.appendChild(fmGainKnob.domElement);\r\n    fmGainKnob.on(\"change\", () => {\r\n      console.log(\"FM Gain\", fmGainKnob.value);\r\n      this.instrument.modulatorGain.gain.value = fmGainKnob.value;\r\n    });\r\n\r\n    const fmRatioKnob = new Knob({\r\n      controlType: \"knob\",\r\n      name: \"FM Ratio\",\r\n      label: \"FM Ratio\",\r\n      min: 0,\r\n      max: 12,\r\n      step: 1,\r\n      default: this.instrument.fmRatio,\r\n      value: this.instrument.fmRatio,\r\n    });\r\n    fmRatioKnob.on(\"change\", () => {\r\n      console.log(\"FM Ratio\", fmRatioKnob.value);\r\n      this.instrument.fmRatio = fmRatioKnob.value;\r\n    });\r\n    this.content.appendChild(fmRatioKnob.domElement);\r\n  }\r\n}\r\n","import { Instrument } from \"../../abstracts/Instrument\";\r\nimport { SynthesizerVoice } from \"../../abstracts/SynthesizerVoice\";\r\nimport type { Project } from \"../../elements/Project\";\r\nimport type { AudioClock } from \"../../elements/components/AudioClock\";\r\nimport { Envelope } from \"../../elements/components/Envelope\";\r\nimport type { ControllerGroup } from \"../../schema\";\r\nimport { FMBassWindow } from \"./FMBassWindow\";\r\n\r\nfunction noteToFrequency(note: number) {\r\n  return 440 * Math.pow(2, (note - 69) / 12);\r\n}\r\n\r\nexport class FMBassVoice extends SynthesizerVoice {\r\n\r\n  readonly name = \"FM Bass Voice\";\r\n  readonly id = \"fm_bass_voice\";\r\n  \r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(audioClock);\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity?: number) {\r\n    console.log(\"FMBassVoice triggered\", note, when, velocity);\r\n  }\r\n\r\n  release(note: number) {\r\n    console.log(\"FMBassVoice released\", note);\r\n  }\r\n}\r\n\r\nexport class FMBass extends Instrument {\r\n  readonly name = \"FM Bass\";\r\n  readonly id = \"fm_bass\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple FM bass synthesizer\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly controllerGroups: ControllerGroup[] = [];\r\n  private _carrier?: OscillatorNode;\r\n  private _modulator?: OscillatorNode;\r\n  private readonly _gain: GainNode;\r\n  readonly modulatorGain: GainNode;\r\n  private readonly _filter: BiquadFilterNode;\r\n  readonly filterEnvelope: Envelope;\r\n  readonly gainEnvelope: Envelope;\r\n\r\n  readonly Window = FMBassWindow;\r\n\r\n  private _heldNote: number | undefined;\r\n\r\n  public fmRatio = 1;\r\n  private _window?: FMBassWindow;\r\n\r\n  constructor(project: Project, mixerChannel = 0) {\r\n    super(project, mixerChannel);\r\n\r\n    const audioContext = project.audioClock.audioContext;\r\n\r\n    this.modulatorGain = audioContext.createGain();\r\n    this.modulatorGain.gain.value = 100;\r\n\r\n    this._gain = audioContext.createGain();\r\n    this._gain.gain.value = 0;\r\n\r\n    const highpassFilter = audioContext.createBiquadFilter();\r\n    highpassFilter.type = \"highpass\";\r\n    highpassFilter.frequency.value = 20;\r\n    this._gain.connect(highpassFilter);\r\n    highpassFilter.connect(this.output);\r\n\r\n    this.output.gain.value = 0.5;\r\n\r\n    this._filter = audioContext.createBiquadFilter();\r\n    this._filter.type = \"lowpass\";\r\n    this._filter.frequency.value = 440;\r\n    this._filter.Q.value = 1;\r\n    this._filter.connect(this._gain);\r\n\r\n    this.filterEnvelope = new Envelope();\r\n    this.gainEnvelope = new Envelope();\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity = 1) {\r\n    console.log(\"FM Bass triggered\", when, \"velocity = \", velocity);\r\n\r\n    this._heldNote = note;\r\n\r\n    note += this.transpose;\r\n\r\n    if (this._carrier?.context.state === \"running\") {\r\n      const g = this._gain.gain.value;\r\n      this._gain.gain.cancelScheduledValues(when);\r\n      this._gain.gain.setValueAtTime(g, when);\r\n      this._gain.gain.exponentialRampToValueAtTime(velocity * 0.1, when + 0.01);\r\n\r\n      try {\r\n        this._carrier.stop(when + 0.02);\r\n        this._modulator?.stop(when + 0.02);\r\n      } catch (e) {\r\n        console.error(\"Error stopping carrier/modulator\", e);\r\n      }\r\n    }\r\n\r\n    const freq = noteToFrequency(note);\r\n\r\n    this._carrier = this.project.audioClock.audioContext.createOscillator();\r\n    this._carrier.frequency.value = freq;\r\n\r\n    this._modulator = this.project.audioClock.audioContext.createOscillator();\r\n    this._modulator.frequency.value = freq * this.fmRatio;\r\n\r\n    this._carrier.connect(this._gain);\r\n    this._modulator.connect(this.modulatorGain);\r\n    this.modulatorGain.connect(this._carrier.frequency);\r\n\r\n    this._carrier.type = \"sine\";\r\n\r\n    this._carrier.start(when);\r\n    this._modulator.start(when);\r\n\r\n    const time = when || this.project.audioClock.currentTime;\r\n\r\n    this.gainEnvelope.trigger(this._gain.gain, time);\r\n\r\n    //this.filterEnvelope.trigger(this.filter.frequency, time);\r\n\r\n    return undefined;\r\n  }\r\n\r\n  release(note: number, when: number) {\r\n    if (this._heldNote !== note) {\r\n      return;\r\n    }\r\n    console.log(\"FM Bass released\", note);\r\n    const time = when || this.project.audioClock.currentTime;\r\n    this.filterEnvelope.triggerRelease(this._filter.frequency, time);\r\n    this.gainEnvelope.triggerRelease(this._gain.gain, time);\r\n  }\r\n}\r\n","import { SynthesizerVoice } from \"./SynthesizerVoice\";\r\nimport { IKeyboardEvent } from \"../elements/components/Keyboard\";\r\nimport { Instrument } from \"./Instrument\";\r\nimport { Project } from \"../elements/Project\";\r\n\r\ninterface ISynthesizerEvent extends IKeyboardEvent {\r\n  voice: SynthesizerVoice;\r\n}\r\n\r\nexport abstract class Synthesizer\r\n  extends Instrument  \r\n{\r\n  readonly voices: SynthesizerVoice[] = [];\r\n  private _nextVoice = 0;\r\n  private _held: ISynthesizerEvent[] = [];\r\n\r\n  constructor(\r\n    project: Project,\r\n    voiceType: typeof SynthesizerVoice,\r\n    mixerChannel = 0,\r\n    maxPoly = 16\r\n  ) {\r\n    super(project, mixerChannel);\r\n\r\n    for (let i = 0; i < maxPoly; i++) {\r\n      const voice: SynthesizerVoice = new (voiceType as any)(\r\n        project.audioClock\r\n      );\r\n      this.voices.push(voice);\r\n      voice.output.connect(this.output);\r\n    }\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity = 1) {\r\n    console.log(this.name + \" triggered voice \" + this._nextVoice);\r\n\r\n    if (this._held.find((e) => e.note == note)) {\r\n      console.warn(this.name + \" already holding note \" + note);\r\n      return;\r\n    }\r\n\r\n    this._held.push({\r\n      note,\r\n      type: \"press\",\r\n      voice: this.voices[this._nextVoice],\r\n      channel: 0,\r\n      velocity: velocity || 1,\r\n    });\r\n\r\n    this.voices[this._nextVoice].trigger(note, when, velocity);\r\n\r\n    this._nextVoice++;\r\n    if (this._nextVoice >= this.voices.length) {\r\n      this._nextVoice = 0;\r\n    }\r\n  }\r\n\r\n  release(note: number, when: number) {\r\n    console.log(this.name + \" released voice \" + note);\r\n\r\n    const index = this._held.findIndex((e) => e.note == note);\r\n    if (index >= 0) {\r\n      this._held[index].voice.release(note, when);\r\n      this._held.splice(index, 1);\r\n    } else {\r\n      console.warn(this.name + \" not holding note \" + note);\r\n    }\r\n  }\r\n}\r\n","import { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport { Synthesizer } from \"../../abstracts/Synthesizer\";\r\nimport { SynthesizerVoice } from \"../../abstracts/SynthesizerVoice\";\r\nimport type { Project } from \"../../elements/Project\";\r\nimport { ProjectUI } from \"../../elements/ProjectUI\";\r\nimport type { AudioClock } from \"../../elements/components/AudioClock\";\r\nimport { Envelope } from \"../../elements/components/Envelope\";\r\nimport type { ControllerGroup } from \"../../schema\";\r\n\r\nfunction noteToFrequency(note: number) {\r\n  return 440 * Math.pow(2, (note - 69) / 12);\r\n}\r\n\r\nexport class FMPianoVoice extends SynthesizerVoice {\r\n  readonly name = \"FM Piano Voice\";\r\n  readonly id = \"fm_piano_voice\";\r\n\r\n  private _carrier1?: OscillatorNode;\r\n  private _modulator1?: OscillatorNode;\r\n  private readonly _gain1: GainNode;\r\n  readonly modulatorGain1: GainNode;\r\n  private readonly _filter: BiquadFilterNode;\r\n  readonly filterEnvelope: Envelope;\r\n  readonly gainEnvelope: Envelope;\r\n\r\n  public fmRatio = 1;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(audioClock);\r\n\r\n    const audioContext = audioClock.audioContext;\r\n\r\n    this.modulatorGain1 = audioContext.createGain();\r\n    this.modulatorGain1.gain.value = 100;\r\n\r\n    this._gain1 = audioContext.createGain();\r\n    this._gain1.gain.value = 0;\r\n\r\n    const highpassFilter = audioContext.createBiquadFilter();\r\n    highpassFilter.type = \"highpass\";\r\n    highpassFilter.frequency.value = 20;\r\n    this._gain1.connect(highpassFilter);\r\n    highpassFilter.connect(this.output);\r\n\r\n    this.output.gain.value = 0.5;\r\n\r\n    this._filter = audioContext.createBiquadFilter();\r\n    this._filter.type = \"lowpass\";\r\n    this._filter.frequency.value = 440;\r\n    this._filter.Q.value = 1;\r\n    this._filter.connect(this._gain1);\r\n\r\n    this.filterEnvelope = new Envelope();\r\n    this.gainEnvelope = new Envelope({\r\n      attack: 0,\r\n      hold: 0,\r\n      decay: 2,\r\n      sustain: 0,\r\n      release: 0.3,\r\n    });\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity: number) {\r\n    console.log(\"FMPianoVoice triggered\", note, when, velocity);\r\n\r\n    if (this._carrier1?.context.state === \"running\") {\r\n      const g = this._gain1.gain.value;\r\n      this._gain1.gain.cancelScheduledValues(when);\r\n      this._gain1.gain.setValueAtTime(g, when);\r\n      this._gain1.gain.exponentialRampToValueAtTime(1, when + 0.01);\r\n\r\n      try {\r\n        this._carrier1.stop(when + 0.02);\r\n        this._modulator1?.stop(when + 0.02);\r\n      } catch (e) {\r\n        console.error(\"Error stopping carrier/modulator\", e);\r\n      }\r\n    }\r\n\r\n    const freq = noteToFrequency(note);\r\n\r\n    this._carrier1 = this.audioClock.audioContext.createOscillator();\r\n    this._carrier1.frequency.value = freq;\r\n\r\n    this._modulator1 = this.audioClock.audioContext.createOscillator();\r\n    this._modulator1.frequency.value = freq * this.fmRatio;\r\n\r\n    this._carrier1.connect(this._gain1);\r\n    this._modulator1.connect(this.modulatorGain1);\r\n    this.modulatorGain1.connect(this._carrier1.frequency);\r\n\r\n    this._carrier1.type = \"sine\";\r\n\r\n    this.output.gain.cancelScheduledValues(when);\r\n    this.output.gain.setValueAtTime(velocity, when);\r\n    this._carrier1.start(when);\r\n    this._modulator1.start(when);\r\n\r\n    const time = when || this.audioClock.currentTime;\r\n\r\n    this.gainEnvelope.trigger(this._gain1.gain, time);\r\n\r\n    //this.filterEnvelope.trigger(this.filter.frequency, time);\r\n\r\n    return undefined;\r\n  }\r\n\r\n  release(note: number, when: number) {\r\n    console.log(\"FM Bass released\", note);\r\n    const time = when || this.audioClock.currentTime;\r\n    //this.filterEnvelope.triggerRelease(this._filter.frequency, time);\r\n    this.gainEnvelope.triggerRelease(this.output.gain, time);\r\n  }\r\n}\r\n\r\nexport class FMPiano extends Synthesizer {\r\n  readonly Window = InstrumentWindow;\r\n\r\n  readonly name = \"FM Piano\";\r\n  readonly id = \"fm_piano\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple FM piano synthesizer\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly controllerGroups: ControllerGroup[] = [];\r\n\r\n  private _window: InstrumentWindow | undefined;\r\n\r\n  constructor(project: Project, mixerChannel = 0) {\r\n    super(project, FMPianoVoice, mixerChannel);\r\n  }\r\n\r\n  getWindow(ui: ProjectUI) {\r\n    if (!this._window) {\r\n      this._window = new InstrumentWindow(ui, this);\r\n    }\r\n    return this._window;\r\n  }\r\n}\r\n","import { Instrument } from \"../../abstracts/Instrument\";\r\nimport { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport { Project } from \"../../elements/Project\";\r\nimport { Envelope } from \"../../elements/components/Envelope\";\r\nimport { AudioImporter } from \"../../importers/AudioImporter\";\r\nimport { ISamplerSettings } from \"../../schema\";\r\n\r\nexport class Sampler extends Instrument {\r\n  readonly name = \"Sampler\";\r\n  readonly id = \"sampler\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple sampler\";\r\n  private readonly _sources: {\r\n    source: AudioBufferSourceNode;\r\n    gain: GainNode;\r\n  }[] = [];\r\n  private readonly _gainEnvelope: Envelope;\r\n  private readonly _enableEnvelope = false;\r\n  private _cutBySelf = true;\r\n  private _volume = 0.9;\r\n  public cutGroup = 0;\r\n  public cutByGroups: number[] = [];\r\n  private _window?: InstrumentWindow;\r\n\r\n  readonly Window = InstrumentWindow;\r\n\r\n  constructor(\r\n    project: Project,\r\n    readonly settings: ISamplerSettings = {}\r\n  ) {\r\n    super(project, settings.mixerChannel);\r\n\r\n    this._gainEnvelope = new Envelope({\r\n      attack: settings.envelope?.attack ?? 0,\r\n      hold: settings.envelope?.hold ?? 0,\r\n      decay: settings.envelope?.decay ?? 0,\r\n      sustain: settings.envelope?.sustain ?? 1,\r\n      release: settings.envelope?.release ?? 0,\r\n    });\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity: number) {\r\n    if (!this.settings.buffer) {\r\n      console.warn(\"No buffer loaded\");\r\n      return;\r\n    }\r\n\r\n    if (this._cutBySelf) {\r\n      this.stop();\r\n    }\r\n\r\n    const gain = this.project.audioClock.audioContext.createGain();\r\n    gain.connect(this.output);\r\n    const source = this.project.audioClock.audioContext.createBufferSource();\r\n    source.buffer = this.settings.buffer;\r\n    source.connect(gain);\r\n    const item = { source, gain };\r\n    this._sources.push(item);\r\n    source.onended = () => {\r\n      item.gain.disconnect();\r\n      this._sources.splice(this._sources.indexOf(item), 1);\r\n    };\r\n    source.start(when);\r\n    if (this._enableEnvelope) {\r\n      this._gainEnvelope.trigger(gain.gain, when, velocity);\r\n    }\r\n  }\r\n\r\n  release(note: number, when: number): void {\r\n    if (this._enableEnvelope) {\r\n      for (const item of this._sources) {\r\n        this._gainEnvelope.triggerRelease(item.gain.gain, when);\r\n      }\r\n    }\r\n  }\r\n\r\n  stop(when = 0) {\r\n    for (const item of this._sources) {\r\n      item.source.stop(when);\r\n    }\r\n  }\r\n\r\n  loadUrl(url: string) {\r\n    AudioImporter.loadUrl(url, this.project.audioClock.audioContext).then(\r\n      (buffer) => {\r\n        this.settings.buffer = buffer;\r\n      }\r\n    );\r\n  }\r\n\r\n  loadFile(file: File) {\r\n    AudioImporter.loadFile(file, this.project.audioClock.audioContext).then(\r\n      (buffer) => {\r\n        this.settings.buffer = buffer;\r\n      }\r\n    );\r\n  }\r\n\r\n  loadBlob(blob: Blob) {\r\n    AudioImporter.loadBlob(blob, this.project.audioClock.audioContext).then(\r\n      (buffer) => {\r\n        this.settings.buffer = buffer;\r\n      }\r\n    );\r\n  }\r\n}\r\n","import {\r\n  IInstrumentWindowOptions,\r\n  InstrumentWindow,\r\n} from \"../../abstracts/InstrumentWindow\";\r\nimport type { ProjectUI } from \"../../elements/ProjectUI\";\r\nimport type { Multisampler } from \"./Multisampler\";\r\nimport { Sampler } from \"./Sampler\";\r\n\r\nexport interface IMultisamplerWindowOptions extends IInstrumentWindowOptions {\r\n  instrument: Multisampler;\r\n}\r\n\r\nexport class MultisamplerWindow extends InstrumentWindow {\r\n  private readonly _slotsContainer: HTMLDivElement;\r\n\r\n  constructor(\r\n    readonly ui: ProjectUI,\r\n    readonly instrument: Multisampler\r\n  ) {\r\n    super(ui, instrument);\r\n\r\n    // window.addEventListener(\"keydown\", (event) => this.onKeyDown(event));\r\n\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"sampler-slots-container\");\r\n    this._slotsContainer = container;\r\n\r\n    //keypad numbers 0-9\r\n    // then . / * + - Enter\r\n    const defaultSlots = [\r\n      { keyBinding: 96, name: \"0\" },\r\n      { keyBinding: 97, name: \"1\" },\r\n      { keyBinding: 98, name: \"2\" },\r\n      { keyBinding: 99, name: \"3\" },\r\n      { keyBinding: 100, name: \"4\" },\r\n      { keyBinding: 101, name: \"5\" },\r\n      { keyBinding: 102, name: \"6\", cutByGroups: [3, 6] },\r\n      { keyBinding: 103, name: \"7\" },\r\n      { keyBinding: 104, name: \"8\" },\r\n      { keyBinding: 105, name: \"9\" },\r\n      { keyBinding: 111, name: \"/\", cutByGroups: [0, 10] },\r\n      { keyBinding: 106, name: \"*\" },\r\n      { keyBinding: 109, name: \"-\" },\r\n      { keyBinding: 107, name: \"+\" },\r\n      { keyBinding: 13, name: \"Enter\" },\r\n    ];\r\n\r\n    for (let i = 0; i < defaultSlots.length; i++) {\r\n      const slot = new Sampler(this.ui.project, { name: defaultSlots[i].name });\r\n      instrument.samplers.push(slot);\r\n      slot.loadUrl(`./data/samples/kit1/${i}.wav`);\r\n    }\r\n\r\n    ui.project.audioClock.on(\"stop\", () => {\r\n      for (const slot of instrument.samplers) {\r\n        slot.stop();\r\n      }\r\n    });\r\n\r\n    this.content.appendChild(container);\r\n  }\r\n\r\n  // onKeyDown(event: KeyboardEvent) {\r\n  //   //console.log(event.key, event.keyCode);\r\n  //   const slot = this.options.instrument.samplers.find(\r\n  //     (slot) => slot.keyBinding === event.keyCode\r\n  //   );\r\n  //   if (slot) {\r\n  //     event.preventDefault();\r\n  //     const note = this.instrument.samplers.indexOf(slot);\r\n  //     this.instrument.trigger(note, null);\r\n  //   }\r\n  // }\r\n}\r\n","import { Instrument } from \"../../abstracts/Instrument\";\r\nimport type { Project } from \"../../elements/Project\";\r\nimport { MultisamplerWindow } from \"./MultisamplerWindow\";\r\nimport { Sampler } from \"./Sampler\";\r\n\r\nexport class Multisampler extends Instrument {\r\n  readonly name = \"Multisampler\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple multisampler\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly id = \"multisampler\";\r\n\r\n  readonly Window = MultisamplerWindow;\r\n\r\n  samplers: Sampler[] = [];\r\n  private _window?: MultisamplerWindow;\r\n\r\n  constructor(project: Project) {\r\n    super(project);\r\n\r\n    this.transpose = -24;\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity: number) {\r\n    note += this.transpose;\r\n    console.log(\"Sampler trigger\", note);\r\n    const slot = this.samplers[note];\r\n    if (slot) {\r\n      for (const sampler of this.samplers) {\r\n        if (sampler.cutByGroups.includes(slot.cutGroup)) {\r\n          sampler.release(note, when);\r\n        }\r\n      }\r\n      return slot.trigger(note, when, velocity);\r\n    }\r\n  }\r\n\r\n  release(note: number, when = 0): void {\r\n    note += this.transpose;\r\n    if (this.samplers[note]) {\r\n      this.samplers[note].release(note, when);\r\n    }\r\n  }\r\n}\r\n","import { AudioClock } from \"./elements/components/AudioClock\";\r\nimport { Project } from \"./elements/Project\";\r\nimport { ProjectUI } from \"./elements/ProjectUI\";\r\nimport { FMBass } from \"./plugins/fmbass/FMBass\";\r\nimport { FMPiano } from \"./plugins/fmpiano/FMPiano\";\r\nimport { Plugins } from \"./plugins/plugins\";\r\nimport { Multisampler } from \"./plugins/sampler/Multisampler\";\r\nimport { templates } from \"./schema\";\r\n\r\nPlugins.register(\"multisampler\", Multisampler);\r\nPlugins.register(\"fm_bass\", FMBass);\r\nPlugins.register(\"fm_piano\", FMPiano);\r\n\r\nconst domElement = document.createElement(\"div\");\r\ndomElement.classList.add(\"studio\");\r\n\r\nconst audioClock = new AudioClock();\r\nconst project = new Project(audioClock, templates.Basic);\r\nconst projectUI = new ProjectUI(project);\r\n\r\ndomElement.appendChild(audioClock.domElement);\r\ndomElement.appendChild(projectUI.domElement);\r\ndocument.body.appendChild(domElement);\r\n","export type ControllerGroup = { [key: string]: IPluginControl };\r\nexport type ControllerValue = number | string | boolean | AudioBuffer | object;\r\nexport type ControlType =\r\n  | \"knob\"\r\n  | \"slider\"\r\n  | \"string\"\r\n  | \"select\"\r\n  | \"audio\"\r\n  | \"object\";\r\n\r\nexport interface IEvent {\r\n  _label: string;\r\n  start: number;\r\n  duration: number;\r\n  note?: number;\r\n  row?: number;\r\n  velocity?: number;  \r\n  value?: unknown;\r\n}\r\n\r\nexport interface IPlaylistEvent extends IEvent {\r\n  type: \"pattern\" | \"audio\";\r\n  value: IPattern | AudioBuffer;\r\n  domElement?: HTMLElement;\r\n  start: number;\r\n  duration: number;\r\n}\r\n\r\nexport interface ISequence {\r\n  events: IEvent[];\r\n}\r\n\r\nexport interface IPattern {\r\n  name: string;\r\n  tracks: ISequence[];\r\n  image?: string;\r\n}\r\n\r\nexport interface ITrackOptions {\r\n  name: string;\r\n  mute: boolean;\r\n  solo: boolean;\r\n  selected: boolean;\r\n}\r\n\r\nexport interface IHasOwnEnvelope {\r\n  envelope: IEnvelope | null;\r\n}\r\n\r\nexport interface IHasOwnLFO {\r\n  lfo?: IOscillatorSettings;\r\n}\r\n\r\nexport interface IUseEnvelope {\r\n  envelopeNumber: number | null;\r\n}\r\n\r\nexport interface IUseLFO {\r\n  lfoNumber: number | null;\r\n}\r\n\r\nexport interface IInstrumentSettings {\r\n  name: string;\r\n  id: string;\r\n  inputPort?: number;\r\n  inputChannel?: number;\r\n}\r\n\r\nexport interface IPlaylist extends ISequence {\r\n  tracks: ITrackOptions[];\r\n  events: IPlaylistEvent[];\r\n}\r\n\r\nexport interface IMixer {\r\n  channels: IMixerChannel[];\r\n}\r\n\r\nexport interface IEffect {\r\n  plugin: string;\r\n}\r\n\r\nexport interface IMixerChannel {\r\n  label: string;\r\n  gain: number;\r\n  mute: boolean;\r\n  solo: boolean;\r\n  outputs: number[];\r\n  effects: IEffect[];\r\n}\r\n\r\nexport interface IProject {\r\n  title: string;\r\n  description: string;\r\n  tempo: number;\r\n  instruments: IInstrumentSettings[];\r\n  patterns: IPattern[];\r\n  playlist: IPlaylist;\r\n  mixer: IMixer;\r\n}\r\n\r\nexport interface ISamplerSlot {\r\n  name: string;\r\n  buffer: AudioBuffer | null;\r\n  keyBinding: number | null;\r\n  velocity: number;\r\n  pan: number;\r\n  pitch: number;\r\n  randomPitch: number;\r\n  randomVelocity: number;\r\n  startPosition: number;\r\n  endPosition: number;\r\n  loop: boolean;\r\n  loopStart: number;\r\n  loopEnd: number;\r\n  cutGroup: number;\r\n  cutByGroups: number[];\r\n}\r\n\r\nexport interface ISamplerSettings {\r\n  name?: string;\r\n  buffer?: AudioBuffer;\r\n  envelope?: IEnvelope;\r\n  loop?: boolean;\r\n  loopStart?: number;\r\n  loopEnd?: number;\r\n  mixerChannel?: number;\r\n}\r\n\r\nexport interface IPluginControl {\r\n  controlType: ControlType;\r\n  name: string;\r\n  label: string;\r\n  default: ControllerValue;\r\n  value: ControllerValue;\r\n  min: number;\r\n  max: number;\r\n  step: number;\r\n}\r\n\r\nexport interface IEnvelope {\r\n  attack: number;\r\n  hold: number;\r\n  decay: number;\r\n  sustain: number;\r\n  release: number;\r\n}\r\n\r\nexport interface IOscillatorSettings extends IHasOwnEnvelope {\r\n  shape: \"sine\" | \"square\" | \"sawtooth\" | \"triangle\";\r\n  detune: number;\r\n  gain?: number;\r\n  route?: number;\r\n  feedback?: number;\r\n}\r\n\r\nexport interface IFilter extends IHasOwnEnvelope {\r\n  type:\r\n    | \"lowpass\"\r\n    | \"highpass\"\r\n    | \"bandpass\"\r\n    | \"lowshelf\"\r\n    | \"highshelf\"\r\n    | \"peaking\"\r\n    | \"notch\"\r\n    | \"allpass\";\r\n  frequency: number;\r\n  detune: number;\r\n  Q: number;\r\n  gain: number;\r\n}\r\n\r\nexport interface ISynthesizerVoiceSettings extends IUseEnvelope, IUseLFO {\r\n  gain: number;\r\n  frequency: number | null;\r\n  detune: number | null;\r\n  oscillators: IOscillatorSettings[];\r\n  note: number | null;\r\n}\r\n\r\nexport const templates: { [key: string]: IProject } = {\r\n  Basic: {\r\n    title: \"Basic\",\r\n    description: \"Basic project template with Sampler and Synthesizer\",\r\n    tempo: 120,\r\n    instruments: [\r\n      { name: \"Multisampler\", id: \"multisampler\" },\r\n      {\r\n        name: \"FM Bass\",\r\n        id: \"fm_bass\",\r\n      },\r\n      {\r\n        name: \"FM Piano\",\r\n        id: \"fm_piano\",\r\n      },\r\n    ],\r\n    patterns: [\r\n      {\r\n        name: \"Pattern 1\",\r\n        tracks: [],\r\n      },\r\n    ],\r\n\r\n    playlist: { tracks: [], events: [] },\r\n    mixer: {\r\n      channels: [\r\n        {\r\n          label: \"Master\",\r\n          gain: 1,\r\n          mute: false,\r\n          solo: false,\r\n          outputs: [],\r\n          effects: [],\r\n        },\r\n        {\r\n          label: \"Drums\",\r\n          gain: 1,\r\n          mute: false,\r\n          solo: false,\r\n          outputs: [0],\r\n          effects: [],\r\n        },\r\n        {\r\n          label: \"Bass\",\r\n          gain: 1,\r\n          mute: false,\r\n          solo: false,\r\n          outputs: [0],\r\n          effects: [],\r\n        },\r\n      ],\r\n    },\r\n  },\r\n};\r\n"],"names":["exports","Symbol","toStringTag","Object","defineProperty","value","_events","_onceEvents","on","eventName","callback","this","push","once","emit","eventData","onceCallbacks","error","console","undefined","callbacks","removeAllListeners","audioContext","AudioContext","window","webkitAudioContext","getAudioContext","state","resume","latencyHint","sampleRate","prototype","navigator","mediaDevices","enumerateDevices","getAudioDevices","then","devices","log","_playbackMode","_audioContext","_bpm","_scheduledEvents","_startTime","domElement","document","createElement","classList","add","playPauseButton","addEventListener","isPlaying","stop","playPause","appendChild","stopButton","textContent","bpmInput","type","parseFloat","currentTimeDisplay","currentTime","getBeatTime","beat","bpm","start","requestAnimationFrame","_render","bind","_update","currentBeat","source","disconnect","remove","restart","buffer","createBuffer","createBufferSource","connect","destination","toggle","bars","Math","floor","beats","timeString","toString","padStart","scheduleEventAtTime","time","emptyBuffer","onended","scheduleEventAtBeat","project","assert","audioClock","mixer","_project","register","name","plugin","_plugins","warn","get","instantiate","id","linearToGain","linearValue","dBValue","max","min","pow","lerp","a","b","t","label","gain","outputs","mute","solo","effects","gainNode","createGain","MathHelpers","channels","master","MixerChannel","i","channel","title","description","tempo","instruments","patterns","playlist","tracks","events","Mixer","AudioBuffer","duration","setTimeout","load","serialize","JSON","stringify","map","instrument","timeline","deserialize","data","parse","Plugins","instance","tagName","className","dispose","child","removeChild","container","_isOpen","open","close","BaseElement","_activeWindow","windows","_draggingWindow","topRow","bottomRow","_leftPanel","WindowSnapPanel","_workspace","_rightPanel","_bottomPanel","_handleWindowDrag","e","elt","target","workspaceWidth","getBoundingClientRect","width","parentElement","leftPanelWidth","event","clientX","panelWidth","style","height","rightPanelWidth","left","win","resetDragOffset","setSize","options","_handleWindowResize","addWindow","includes","activateWindow","w","zIndex","display","titleElt","messageElt","_closeButton","onclick","removeEventListener","body","BOTTOM_ROW","TOP_ROW","KEY_COLORS","NOTE_NAMES","midiAccess","keyToNote","keyCode","note","indexOf","requestMIDIAccess","midi","inputs","forEach","entry","onmidimessage","handleMIDI","catch","PopupNotification","message","pressedKeys","ctrlKey","altKey","shiftKey","update","velocity","splice","length","statusByte","eventType","dataByte1","dataByte2","control","_resizing","_startX","_startY","_startWidth","_startHeight","_startTop","_startLeft","_resizeDirection","handle","getCurrentHandle","cursor","onmove","dx","dy","clientY","top","offsetWidth","offsetHeight","button","startResize","preventDefault","onrelease","stopResize","direction","offsetTop","offsetLeft","rect","offsetX","offsetY","_isDragging","_dragOffsetX","_dragOffsetY","_top","_left","persistent","titlebar","scrollTop","ondrag","newTop","newLeft","deltaX","deltaY","_title","content","show","x","y","innerWidth","innerHeight","setPosition","setTitle","SizableElement","items","item","addSelectable","selectable","addToDom","selected","f","find","end","removeSelectable","index","clear","contains","_mute","_solo","_muteButton","_soloButton","group","isMaster","_channel","_label","volume","step","_volume","muteSoloButtons","MuteSoloButtons","valueAsNumber","SelectableElement","ui","SelectableGroup","channelsContainer","effectsContainer","MixerChannelStrip","DraggableWindow","clock","transform","beatWidth","hide","triggerActive","timeout","renderWaveform","canvas","channelData","getChannelData","bufferLength","sliceWidth","ctx","getContext","clearRect","beginPath","moveTo","lineTo","stroke","renderSequence","color","clearFirst","lowestNote","highestNote","Error","paddedScale","fillStyle","fillRect","renderPattern","pattern","concat","sequence","GraphicsHelpers","track","labelAndButtons","textLabel","edit","isVisible","indicator","_canvas","append","buttonGroup","previewGroup","port","_window","Window","PatternTrackInstrument","preview","PatternTrackPreview","trigger","release","trackContainer","AudioCursor","marginLeft","querySelector","clientWidth","addTrack","patternPreviews","buttons","loadPattern","PatternTrack","output","mixerWindow","pianoRollWindow","loadTrack","removeTrack","scrollElement","sensitivity","linkedElements","_scrollTop","linkElement","element","playOnClick","playBuffer","generateAudio","Promise","resolve","reject","req","text","pitch","rate","fetch","method","headers","res","arrayBuffer","decodeAudioData","audioBuffer","loadBuffer","AudioCanvas","ok","cancel","closeButton","HTMLButtonElement","okButton","cancelButton","targetObject","onsave","textInput","setAttribute","audioCanvas","LyricCanvas","saveButton","DialogPopup","grid","src","noteItem","rowHeight","labelElement","image","backgroundImage","gridElement","rowCount","_currentItem","_dragMode","_dragOffset","_sequence","_items","Map","quantize","drawingEnabled","drawingLabel","drawingImage","drawingValue","previewCanvas","imageRendering","rowBackgroundCanvas","lineWidth","strokeStyle","j","row","base64","toDataURL","backgroundRepeat","noteEditor","LyricEditorDialog","input","layerX","HTMLDivElement","Array","from","values","layerY","round","oldStart","pointerEvents","gridItem","GridItem","set","delete","querySelectorAll","ScrollPanel","keys","noteHeight","redraw","key","innerHTML","backgroundColor","reverse","cursorUpdateInterval","sideKeyboard","SideKeyboard","Grid","pianoRoll","PianoRoll","attachedElement","filter","_submenus","_handlePointerDown","addItem","addSubmenu","submenu","_track","settings","_trackPanels","Project","_loadProject","playlistTrack","PlaylistTrack","random","replace","c","r","zero","_content","_icon","parentId","rename","newName","prompt","_expander","insertBefore","dataTransfer","getData","stopPropagation","_childContainer","expanded","TreeViewFolder","TreeViewItem","UUID","rootName","_selectedItem","root","newItem","evt","parent","deselect","selectedItem","select","duplicateSelected","newFolderInSelected","folder","loadUrl","url","AudioImporter","loadFile","file","loadBlob","blob","reader","FileReader","onload","result","onerror","readAsArrayBuffer","importFile","accept","fileInput","files","click","folderMenu","ContextMenu","FileImporter","alert","fileMenu","Boolean","patternsFolder","presetsFolder","TreeView","handleWheelZoom","_img","handlePinchZoom","touch1","touches","touch2","distance","hypot","File","URL","createObjectURL","imagePreview","ImagePreview","Playlist","sourceContainer","treeView","ProjectTreeView","patternWindow","ImagePreviewWindow","addMenu","generateMenu","WindowContainer","PianoRollWindow","PatternWindow","playlistWindow","ProjectWindow","MixerWindow","keyboard","Keyboard","mixerChannel","transpose","Plugin","_settings","_note","_frequency","_gain","lfoNumber","envelopeNumber","detune","oscillators","loadSettings","controlType","_range","blur","PluginControl","attack","hold","decay","sustain","_triggerTime","Slider","default","param","when","startValue","cancelScheduledValues","setValueAtTime","exponentialRampToValueAtTime","linearRampToValueAtTime","estimateValueAtTime","relativeWhen","timeSinceAttack","exp","timeSinceRelease","triggerRelease","hideZero","_hideZero","_value","_step","startY","onMouseMove","oldValue","newValue","onMouseUp","mixerChannelSelector","DraggableNumber","_settingsBar","_handle","_onPointerDown","_setValue","startPosition","offset","releasePointerCapture","pointerId","fmbass","fmGainKnob","Knob","modulatorGain","fmRatioKnob","fmRatio","InstrumentWindow","SynthesizerVoice","version","author","controllerGroups","FMBassWindow","highpassFilter","createBiquadFilter","frequency","_filter","Q","filterEnvelope","Envelope","gainEnvelope","_heldNote","_carrier","context","g","_modulator","freq","noteToFrequency","createOscillator","Instrument","voiceType","maxPoly","voices","_nextVoice","_held","voice","findIndex","modulatorGain1","_gain1","_carrier1","_modulator1","FMPianoVoice","getWindow","Synthesizer","_sources","_enableEnvelope","_cutBySelf","cutGroup","cutByGroups","_gainEnvelope","envelope","_slotsContainer","defaultSlots","keyBinding","slot","Sampler","samplers","MultisamplerWindow","sampler","Multisampler","FMBass","FMPiano","AudioClock","projectUI","ProjectUI"],"sourceRoot":""}