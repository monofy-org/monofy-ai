{"version":3,"file":"monofy-studio.js","mappings":"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","sources":["webpack://monofy/webpack/bootstrap","webpack://monofy/webpack/runtime/make namespace object","webpack://monofy/../elements/src/EventObject.ts","webpack://monofy/../elements/src/managers/AudioManager.ts","webpack://monofy/./src/elements/components/AudioClock.ts","webpack://monofy/../elements/src/elements/WindowContainer.ts","webpack://monofy/../elements/src/elements/BaseElement.ts","webpack://monofy/../elements/src/elements/SizableElement.ts","webpack://monofy/../elements/src/elements/DraggableWindow.ts","webpack://monofy/./src/elements/components/AudioCursor.ts","webpack://monofy/../elements/src/animation.ts","webpack://monofy/./src/elements/components/SharedComponents.ts","webpack://monofy/./src/elements/components/PatternTrack.ts","webpack://monofy/./src/elements/windows/PatternWindow.ts","webpack://monofy/./src/elements/components/PlaylistTrack.ts","webpack://monofy/./src/elements/windows/PlaylistWindow.ts","webpack://monofy/./src/elements/Composition.ts","webpack://monofy/../elements/src/elements/ScrollPanel.ts","webpack://monofy/./src/constants.ts","webpack://monofy/../elements/src/elements/AudioCanvas.ts","webpack://monofy/./src/elements/components/LyricCanvas.ts","webpack://monofy/../elements/src/DialogPopup.ts","webpack://monofy/./src/elements/audioDialogs.ts","webpack://monofy/./src/elements/components/Grid.ts","webpack://monofy/./src/elements/components/SideKeyboard.ts","webpack://monofy/./src/elements/components/PianoRoll.ts","webpack://monofy/./src/elements/windows/PianoRollWindow.ts","webpack://monofy/./src/elements/components/SamplerSlot.ts","webpack://monofy/./src/elements/windows/SamplerWindow.ts","webpack://monofy/./src/elements/components/Keyboard.ts","webpack://monofy/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export interface EventDataMap {\r\n  cancel: unknown;\r\n  start: unknown;\r\n  stop: unknown;\r\n  pause: unknown;\r\n  result: unknown;\r\n  update: unknown;\r\n  open: unknown;\r\n  close: unknown;\r\n  resize: unknown;\r\n  select: unknown;\r\n  scroll: unknown;\r\n}\r\n\r\nexport type BaseEvent = keyof EventDataMap;\r\n\r\nexport default abstract class EventObject<E extends BaseEvent = BaseEvent> {\r\n  private _events: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n  private _onceEvents: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n\r\n  on(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._events[eventName]) {\r\n      this._events[eventName] = [];\r\n    }\r\n    this._events[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  once(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._onceEvents[eventName]) {\r\n      this._onceEvents[eventName] = [];\r\n    }\r\n    this._onceEvents[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  emit(eventName: E, eventData?: EventDataMap[E]) {\r\n    const onceCallbacks = this._onceEvents[eventName];\r\n    if (onceCallbacks) {\r\n      for (const callback of onceCallbacks) {\r\n        try {\r\n          callback(eventData);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .once callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n      this._onceEvents[eventName] = undefined;\r\n    }\r\n\r\n    const callbacks = this._events[eventName];\r\n    if (callbacks) {\r\n      for (const callback of callbacks) {\r\n        try {\r\n          callback(eventData);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .on callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","let audioContext: AudioContext | null = null;\r\n\r\nconst AudioContext = window.AudioContext || (window as any).webkitAudioContext;\r\n\r\nexport function getAudioContext() {\r\n  if (!audioContext) {\r\n    audioContext = new AudioContext();\r\n    console.log(\"Audio context created\");\r\n    return audioContext;\r\n  }\r\n  return audioContext;\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\n\r\n/**\r\n * Represents an audio clock that provides functionality for controlling audio playback and scheduling events.\r\n */\r\nexport class AudioClock extends EventObject<\r\n  \"start\" | \"stop\" | \"pause\" | \"update\"\r\n> {\r\n  domElement: HTMLDivElement;\r\n  bpmInput: HTMLInputElement;\r\n  playPauseButton: HTMLButtonElement;\r\n  stopButton: HTMLButtonElement;\r\n  currentTimeDisplay: HTMLSpanElement;\r\n  private _isPlaying: boolean = false;\r\n  private _bpm: number = 100;\r\n  private _scheduledEvents: {\r\n    source: AudioBufferSourceNode;\r\n    time: number;\r\n    callback: () => void;\r\n  }[] = [];\r\n  private _startTime: number | null = null;\r\n\r\n  get startTime(): number | null {\r\n    return this._startTime;\r\n  }\r\n\r\n  get currentBeat(): number {\r\n    const elapsedTime =\r\n      this._startTime !== null\r\n        ? getAudioContext().currentTime - this._startTime\r\n        : 0;\r\n    return elapsedTime * (this._bpm / 60);\r\n  }\r\n\r\n  get isPlaying(): boolean {\r\n    return this._isPlaying;\r\n  }\r\n\r\n  get bpm(): number {\r\n    return this._bpm;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-clock\");\r\n\r\n    this.playPauseButton = document.createElement(\"button\");\r\n    this.playPauseButton.classList.add(\"audio-clock-play-pause\");\r\n    this.playPauseButton.textContent = \"Play\";\r\n\r\n    this.playPauseButton.addEventListener(\"click\", () => {\r\n      if (this._isPlaying) {\r\n        this.stop();\r\n      } else {\r\n        getAudioContext();\r\n        this.playPause();\r\n      }\r\n    });\r\n    this.domElement.appendChild(this.playPauseButton);\r\n    this.stopButton = document.createElement(\"button\");\r\n    this.stopButton.classList.add(\"audio-clock-stop\");\r\n    this.stopButton.textContent = \"Stop\";\r\n\r\n    this.stopButton.addEventListener(\"click\", () => {\r\n      this.stop();\r\n    });\r\n    this.domElement.appendChild(this.stopButton);\r\n\r\n    this.bpmInput = document.createElement(\"input\");\r\n    this.bpmInput.classList.add(\"audio-clock-bpm\");\r\n    this.bpmInput.type = \"number\";\r\n    this.bpmInput.value = \"120\";\r\n\r\n    this.bpmInput.addEventListener(\"input\", () => {\r\n      this._bpm = parseFloat(this.bpmInput.value);\r\n    });\r\n    this.domElement.appendChild(this.bpmInput);\r\n\r\n    this.currentTimeDisplay = document.createElement(\"span\");\r\n    this.currentTimeDisplay.classList.add(\"audio-clock-time\");\r\n    this.currentTimeDisplay.textContent = \"01:1\";\r\n\r\n    this.domElement.appendChild(this.currentTimeDisplay);\r\n  }\r\n\r\n  start(): void {    \r\n    this._startTime = getAudioContext().currentTime;    \r\n    console.log(\"Started at\", this._startTime);\r\n    requestAnimationFrame(this._render.bind(this));\r\n    this.emit(\"start\");\r\n  }\r\n\r\n  private _render(): void {\r\n    this._update(this.currentBeat);\r\n    this.emit(\"update\");\r\n    if (this._isPlaying) requestAnimationFrame(this._render.bind(this));\r\n  }\r\n\r\n  stop(): void {\r\n    this.emit(\"stop\");\r\n    this._isPlaying = false;\r\n    this._startTime = null;\r\n\r\n    for (const { source } of this._scheduledEvents) {\r\n      source.stop();\r\n      source.disconnect();\r\n    }\r\n    this._scheduledEvents = [];\r\n\r\n    this._update(this.currentBeat);\r\n    this.playPauseButton.textContent = \"Play\";\r\n  }\r\n\r\n  playPause(): void {\r\n    if (this._isPlaying) {\r\n      this.stop(); // TODO: This should be a pause\r\n    } else {\r\n      const audioContext = getAudioContext();\r\n\r\n      const buffer = audioContext.createBuffer(1, 1, audioContext.sampleRate);\r\n      const source = audioContext.createBufferSource();\r\n      source.buffer = buffer;\r\n      source.connect(audioContext.destination);\r\n      source.start();\r\n\r\n      this.start();\r\n    }\r\n    this._isPlaying = !this._isPlaying;\r\n    this.playPauseButton.textContent = this._isPlaying ? \"Pause\" : \"Play\";\r\n  }\r\n\r\n  private _update(beat: number): void {\r\n    const bars = Math.floor(beat / 4) + 1;\r\n    const beats = Math.floor(beat % 4) + 1;\r\n    const timeString = `${bars\r\n      .toString()\r\n      .padStart(2, \"0\")}:${beats.toString()}`;\r\n    this.currentTimeDisplay.textContent = timeString;\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtTime(callback: () => void, time: number): void {\r\n    const audioContext = getAudioContext();\r\n    const emptyBuffer = audioContext.createBuffer(\r\n      1,\r\n      1,\r\n      audioContext.sampleRate\r\n    );\r\n    const source = audioContext.createBufferSource();\r\n    source.buffer = emptyBuffer;\r\n    source.connect(audioContext.destination);\r\n    source.onended = () => callback;\r\n    source.start(time);\r\n    this._scheduledEvents.push({ source, time, callback });\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtBeat(callback: () => void, beat: number): void {\r\n    const time = this._startTime! + (beat / this._bpm) * 60;\r\n    this.scheduleEventAtTime(callback, time);\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { DraggableWindow } from \"./DraggableWindow\";\r\n\r\nexport class WindowContainer {\r\n  readonly domElement: HTMLDivElement;\r\n\r\n  windows: DraggableWindow<keyof EventDataMap>[] = [];\r\n  _draggingWindow: DraggableWindow<keyof EventDataMap> | null = null;\r\n\r\n  constructor() {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.className = \"window-container\";\r\n    this.domElement.addEventListener(\"pointerdown\", () => {});\r\n  }\r\n\r\n  addWindow<T extends DraggableWindow<keyof EventDataMap>>(window: T) {\r\n    this.windows.push(window);\r\n    this.domElement.appendChild(window.domElement);\r\n  }\r\n}\r\n","import EventObject, { EventDataMap } from \"../EventObject\";\r\n\r\nexport abstract class BaseElement<\r\n  T extends keyof EventDataMap,\r\n> extends EventObject<T> {\r\n  domElement: HTMLElement;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super();\r\n    this.domElement = document.createElement(tagName);\r\n    if (className) {\r\n      this.domElement.classList.add(className);\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class SizableElement<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"resize\" | T> {\r\n  private _resizing = false;\r\n  private _startX = 0;\r\n  private _startY = 0;\r\n  private _startWidth = 0;\r\n  private _startHeight = 0;\r\n  private _startTop = 0;\r\n  private _startLeft = 0;\r\n\r\n  private _resizeDirection: \"top\" | \"right\" | \"bottom\" | \"left\" | null = null;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super(tagName, className);\r\n\r\n    this.domElement.addEventListener(\"pointermove\", (e) => {\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle === \"top\" || handle === \"bottom\") {\r\n        this.domElement.style.cursor = \"ns-resize\";\r\n      } else if (handle === \"left\" || handle === \"right\") {\r\n        this.domElement.style.cursor = \"ew-resize\";\r\n      } else {\r\n        this.domElement.style.cursor = \"auto\";\r\n      }\r\n    });\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      if (this._resizing) {\r\n        console.log(this._resizeDirection);\r\n\r\n        const dx = e.clientX - this._startX;\r\n        const dy = e.clientY - this._startY;\r\n\r\n        if (this._resizeDirection === \"right\") {\r\n          this.domElement.style.width = `${this._startWidth + dx}px`;\r\n        } else if (this._resizeDirection === \"bottom\") {\r\n          this.domElement.style.height = `${this._startHeight + dy}px`;\r\n        } else if (this._resizeDirection === \"left\") {\r\n          this.domElement.style.width = `${this._startWidth - dx}px`;\r\n          this.domElement.style.left = `${this._startLeft + dx}px`;\r\n        } else if (this._resizeDirection === \"top\") {\r\n          this.domElement.style.height = `${this._startHeight - dy}px`;\r\n          this.domElement.style.top = `${this._startTop + dy}px`;\r\n        }\r\n\r\n        this.emit(\"resize\", {\r\n          width: this.domElement.offsetWidth,\r\n          height: this.domElement.offsetHeight,\r\n        });\r\n      }\r\n    };\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle) {\r\n        window.addEventListener(\"pointermove\", onmove);\r\n        this.startResize(e, handle);\r\n      }\r\n      const onrelease = () => {\r\n        this.stopResize();\r\n        window.removeEventListener(\"pointermove\", onmove);\r\n        window.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      window.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n  }\r\n\r\n  protected startResize(\r\n    e: PointerEvent,\r\n    direction: \"top\" | \"right\" | \"bottom\" | \"left\"\r\n  ) {\r\n    console.log(\"startResize\", direction);\r\n    this._resizing = true;\r\n    this._startX = e.clientX;\r\n    this._startY = e.clientY;\r\n    this._startWidth = this.domElement.offsetWidth;\r\n    this._startHeight = this.domElement.offsetHeight;\r\n    this._startTop = this.domElement.offsetTop;\r\n    this._startLeft = this.domElement.offsetLeft;\r\n    this._resizeDirection = direction;\r\n  }\r\n\r\n  protected stopResize() {\r\n    this._resizing = false;\r\n    this._resizeDirection = null;\r\n  }\r\n\r\n  getCurrentHandle(e: PointerEvent) {\r\n    const rect = this.domElement.getBoundingClientRect();\r\n    const offsetX = e.clientX - rect.left;\r\n    const offsetY = e.clientY - rect.top;\r\n\r\n    if (offsetX > 0 && offsetX < 10) {\r\n      return \"left\";\r\n    } else if (rect.width - offsetX < 10) {\r\n      return \"right\";\r\n    } else if (offsetY > 0 && offsetY < 10) {\r\n      return \"top\";\r\n    } else if (rect.height - offsetY < 10) {\r\n      return \"bottom\";\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { SizableElement } from \"./SizableElement\";\r\n\r\nexport class DraggableWindow<\r\n  T extends keyof EventDataMap,\r\n> extends SizableElement<\"update\" | \"resize\" | \"open\" | \"close\" | T> {\r\n  readonly titlebar: HTMLElement;\r\n  readonly content: HTMLElement;\r\n  private readonly _title: HTMLElement;\r\n  private readonly _closeButton: HTMLButtonElement;\r\n  private _isDragging = false;\r\n  private _dragOffsetX = 0;\r\n  private _dragOffsetY = 0;\r\n  private _top = 0;\r\n  private _left = 0;\r\n\r\n  get isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    title: string,\r\n    private readonly persistent = false,\r\n    private innerContent: HTMLElement\r\n  ) {\r\n    super(\"div\", \"draggable-window\");\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.domElement.parentElement!.appendChild(this.domElement);\r\n    });\r\n\r\n    this.titlebar = document.createElement(\"div\");\r\n    this.titlebar.className = \"window-titlebar\";\r\n    this.domElement.appendChild(this.titlebar);\r\n\r\n    this.titlebar.addEventListener(\"pointerdown\", (e) => {\r\n      this._isDragging = true;\r\n      this._dragOffsetX =\r\n        e.clientX - this.domElement.getBoundingClientRect().left;\r\n      this._dragOffsetY =\r\n        e.clientY -\r\n        this.domElement.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.scrollTop;\r\n\r\n      const ondrag = (e: PointerEvent) => {\r\n        if (this._isDragging) {\r\n          console.log(\"Dragging\");\r\n\r\n          let newTop = e.clientY - this._dragOffsetY;\r\n          let newLeft = e.clientX - this._dragOffsetX;\r\n\r\n          if (newTop < 0) {\r\n            newTop = 0;\r\n          }\r\n\r\n          if (newLeft < 0) {\r\n            newLeft = 0;\r\n          }\r\n\r\n          this.domElement.style.top = `${newTop}px`;\r\n          this.domElement.style.left = `${newLeft}px`;\r\n\r\n          this._top = newTop;\r\n          this._left = newLeft;\r\n        }\r\n      };\r\n\r\n      const onrelease = () => {\r\n        this._isDragging = false;\r\n        document.body.removeEventListener(\"pointermove\", ondrag);\r\n        document.body.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      document.body.addEventListener(\"pointermove\", ondrag);\r\n      document.body.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n\r\n    this._title = document.createElement(\"div\");\r\n    this._title.className = \"window-titlebar-title\";\r\n    this._title.textContent = title;\r\n    this.titlebar.appendChild(this._title);\r\n\r\n    this.content = document.createElement(\"div\");\r\n    this.content.className = \"window-content\";\r\n    this.domElement.appendChild(this.content);\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.className = \"window-close-button\";    \r\n    this._closeButton.addEventListener(\"click\", (e) => {\r\n      if (e.button === 0) this.close();\r\n    });\r\n\r\n    this.titlebar.appendChild(this._closeButton);\r\n\r\n    this.content.appendChild(this.innerContent);\r\n  }\r\n\r\n  show(x?: number, y?: number) {\r\n    this.domElement.style.display = \"flex\";\r\n    if (y) this.domElement.style.top = `${y}px`;\r\n    if (x) this.domElement.style.left = `${x}px`;\r\n    setTimeout(() => {\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n      this.emit(\"open\");\r\n    }, 1);    \r\n  }\r\n\r\n  close() {\r\n    this.domElement.style.display = \"none\";\r\n    this.emit(\"close\");\r\n    if (!this.persistent) {\r\n      this.domElement.remove();\r\n    }\r\n  }\r\n\r\n  setSize(width: number, height: number) {\r\n    this.domElement.style.width = `${width}px`;\r\n    this.domElement.style.height = `${height}px`;\r\n  }\r\n\r\n  setPosition(x: number, y: number) {\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this._title.textContent = title;\r\n  }\r\n}\r\n","import { AudioClock } from \"./AudioClock\";\r\n\r\nexport interface ICursorTimeline {\r\n  domElement: HTMLElement;\r\n  timeline: HTMLElement;\r\n  cursor: AudioCursor;\r\n  audioClock: AudioClock;\r\n  beatWidth: number;\r\n}\r\n\r\nexport class AudioCursor {\r\n  readonly domElement: HTMLDivElement;\r\n\r\n  constructor(readonly timeline: ICursorTimeline) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-cursor\");\r\n\r\n    const clock = timeline.audioClock;\r\n\r\n    clock.on(\"update\", () => {\r\n      this.update();\r\n    });\r\n\r\n    clock.on(\"start\", () => {\r\n      this.domElement.style.transform = \"translateX(0)\";\r\n      this.domElement.style.display = \"block\";\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n    });\r\n\r\n    clock.on(\"stop\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n  }\r\n\r\n  update() {\r\n    this.domElement.style.transform = `translateX(${\r\n      this.timeline.audioClock.currentBeat * this.timeline.beatWidth\r\n    }px)`;    \r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","export async function triggerActive(elt: HTMLElement, timeout = 100) {  \r\n  elt.classList.toggle(\"active\", true);\r\n  setTimeout(() => {\r\n    elt.classList.toggle(\"active\", false);\r\n  }, timeout);\r\n}\r\n","import { EventDataMap } from \"../../../../elements/src/EventObject\";\r\nimport { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\n\r\nexport class SharedComponents {\r\n  static _components: { [name: string]: BaseElement<keyof EventDataMap> } = {};\r\n\r\n  static getComponent<T extends BaseElement<keyof EventDataMap>>(name: string): T {\r\n    return this._components[name] as T;\r\n  }\r\n\r\n  static add(name: string, component: BaseElement<keyof EventDataMap>) {\r\n    this._components[name] = component;\r\n  }  \r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { triggerActive } from \"../../../../elements/src/animation\";\r\nimport { ISequence } from \"../../schema\";\r\nimport { SamplerWindow } from \"../windows/SamplerWindow\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { GridItem } from \"./Grid\";\r\nimport { SharedComponents } from \"./SharedComponents\";\r\n\r\nexport class PatternTrack\r\n  extends BaseElement<\"update\" | \"select\">\r\n  implements ISequence\r\n{\r\n  private _canvas: HTMLCanvasElement;\r\n  private _name: string = \"\";\r\n  private readonly _instrumentPanel: HTMLDivElement;\r\n  private readonly _indicator: HTMLDivElement;\r\n  output: \"sampler\" | \"synth\" | \"midi\" = \"sampler\";\r\n  port: number | null = null;\r\n  channel: number | null = null;\r\n\r\n  get canvas() {\r\n    return this._canvas;\r\n  }\r\n\r\n  get name() {\r\n    return this._name;\r\n  }\r\n\r\n  private _selected: boolean = false;\r\n  get selected() {\r\n    return this._selected;\r\n  }\r\n  set selected(value: boolean) {\r\n    console.log(\"PatternTrack set selected\", value);\r\n    this._selected = value;\r\n    this._instrumentPanel.classList.toggle(\"selected\", value);\r\n  }\r\n\r\n  constructor(\r\n    name: string,\r\n    readonly audioClock: AudioClock,\r\n    readonly events: GridItem[]\r\n  ) {\r\n    super(\"div\", \"pattern-track\");\r\n\r\n    this._name = name;\r\n\r\n    this._instrumentPanel = document.createElement(\"div\");\r\n    this._instrumentPanel.classList.add(\"pattern-track-panel\");\r\n\r\n    const label = document.createElement(\"div\");\r\n    this._instrumentPanel.appendChild(label);\r\n    label.textContent = name;\r\n\r\n    const buttons = document.createElement(\"div\");\r\n    buttons.classList.add(\"pattern-track-buttons\");\r\n    this._instrumentPanel.appendChild(buttons);\r\n\r\n    const edit = document.createElement(\"button\");\r\n    edit.textContent = \"e\";\r\n    buttons.appendChild(edit);\r\n\r\n    const mute = document.createElement(\"button\");\r\n    mute.textContent = \"M\";\r\n    buttons.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"button\");\r\n    solo.textContent = \"S\";\r\n    buttons.appendChild(solo);\r\n\r\n    this._indicator = document.createElement(\"div\");\r\n    this._indicator.classList.add(\"pattern-track-indicator\");\r\n    buttons.appendChild(this._indicator);\r\n\r\n    buttons.appendChild(mute);\r\n    buttons.appendChild(solo);\r\n\r\n    this._canvas = document.createElement(\"canvas\");\r\n    this._canvas.height = 100;\r\n    this._canvas.width = 1600;\r\n    this._canvas.classList.add(\"pattern-track-pattern\");\r\n\r\n    this._canvas.addEventListener(\"pointerdown\", () => {\r\n      this.emit(\"select\", this);\r\n    });\r\n\r\n    this.domElement.appendChild(this._instrumentPanel);\r\n    this.domElement.appendChild(this._indicator);\r\n    this.domElement.appendChild(this._canvas);\r\n  }\r\n\r\n  trigger(note: number, beat = 0) {\r\n    if (this.output === \"sampler\") {\r\n      const sampler: SamplerWindow = SharedComponents.getComponent(\"sampler\");\r\n      sampler.trigger(note, this.channel, beat);\r\n      if (beat > 0) {        \r\n        this.audioClock.scheduleEventAtBeat(() => {\r\n          triggerActive(this._indicator);\r\n        }, beat);\r\n      } else {\r\n        triggerActive(this._indicator);\r\n      }\r\n    }\r\n  }\r\n\r\n  release(note: number, beat = 0) {\r\n    console.warn(\"TODO: PatternTrack release\", note, beat);\r\n  }\r\n\r\n  playback() {\r\n    for (const event of this.events) {\r\n      this.trigger(event.note, event.start);\r\n    }\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { Composition } from \"../Composition\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"../components/AudioCursor\";\r\nimport { GridItem } from \"../components/Grid\";\r\nimport { PatternTrack } from \"../components/PatternTrack\";\r\n\r\nexport class PatternWindow\r\n  extends DraggableWindow<\"select\">\r\n  implements ICursorTimeline\r\n{\r\n  readonly trackContainer: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  readonly tracks: PatternTrack[] = [];\r\n  readonly timeline: HTMLDivElement;\r\n  beatWidth = 20;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    readonly composition: Composition\r\n  ) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"pattern-track-container\");\r\n\r\n    super(\"Pattern\", true, container);\r\n    this.trackContainer = container;\r\n    this.setSize(800, 400);\r\n\r\n    this.timeline = document.createElement(\"div\");\r\n    this.timeline.style.position = \"absolute\";\r\n    this.timeline.style.width = \"calc(100% - 88px)\";\r\n    this.timeline.style.height = \"100%\";\r\n    this.timeline.style.left = \"88px\";\r\n    this.timeline.style.pointerEvents = \"none\";\r\n    this.timeline.style.overflow = \"hidden\";\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.timeline.appendChild(this.cursor.domElement);\r\n\r\n    const canvas = this.domElement.querySelector(\"canvas\");\r\n    if (canvas) this.beatWidth = canvas.width / 16;\r\n\r\n    this.on(\"resize\", () => {\r\n      this.beatWidth = this.domElement.clientWidth / 16;\r\n    });\r\n\r\n    audioClock.on(\"start\", () => {\r\n      if (!audioClock.startTime) {\r\n        throw new Error(\"Audio clock start time is not set\");\r\n      }      \r\n      for (const track of this.tracks) {\r\n        track.playback();\r\n      }\r\n    });\r\n    \r\n    // container.appendChild(this.cursor.domElement);\r\n  }\r\n\r\n  addTrack(name: string, events: GridItem[] = []) {\r\n    const track = new PatternTrack(name, this.audioClock, events);\r\n\r\n    if (this.tracks.length === 0) {\r\n      track.selected = true;\r\n      track.domElement.appendChild(this.timeline);\r\n    }\r\n\r\n    track.on(\"select\", (selectedTrack) => {\r\n      this.emit(\"select\", selectedTrack);\r\n    });\r\n    this.tracks.push(track);\r\n    this.trackContainer.appendChild(track.domElement);\r\n\r\n    return track;\r\n  }\r\n\r\n  removeTrack(track: PatternTrack) {\r\n    const index = this.tracks.indexOf(track);\r\n    if (index !== -1) {\r\n      this.tracks.splice(index, 1);\r\n      this.trackContainer.removeChild(track.domElement);\r\n    }\r\n  }\r\n\r\n  trigger(note: number) {\r\n    for (const track of this.tracks) {\r\n      if (track.selected) track.trigger(note);\r\n    }\r\n  }\r\n\r\n  play() {\r\n    if (this.audioClock.startTime == null) {\r\n      throw new Error(\"Audio clock start time is not set\");\r\n    }\r\n    for (const track of this.tracks) {\r\n      for (const event of track.events) {\r\n        track.trigger(event.note, this.audioClock.startTime + event.start * 60 / this.audioClock.bpm);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\n\r\nexport class PlaylistTrack extends BaseElement<\"update\"> {\r\n  constructor(name: string) {\r\n    super(\"div\", \"playlist-track\");\r\n\r\n    const settings = document.createElement(\"div\");\r\n    settings.classList.add(\"instrument-panel\");\r\n\r\n    const label = document.createElement(\"div\");\r\n    settings.appendChild(label);\r\n    label.textContent = name;\r\n\r\n    const buttons = document.createElement(\"div\");\r\n    buttons.classList.add(\"playlist-track-selector\");\r\n    settings.appendChild(buttons);\r\n\r\n    const mute = document.createElement(\"button\");\r\n    mute.textContent = \"M\";\r\n    buttons.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"button\");\r\n    solo.textContent = \"S\";\r\n    buttons.appendChild(solo);\r\n\r\n    const track = document.createElement(\"div\");\r\n    track.classList.add(\"pattern-panel\");\r\n\r\n    this.domElement.appendChild(settings);\r\n    this.domElement.appendChild(track);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { Composition } from \"../Composition\";\r\nimport { PlaylistTrack } from \"../components/PlaylistTrack\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"../components/AudioCursor\";\r\n\r\nexport class PlaylistWindow\r\n  extends DraggableWindow<\"update\" | \"select\">\r\n  implements ICursorTimeline\r\n{\r\n  private _tracks: PlaylistTrack[] = [];\r\n  readonly timeline: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  beatWidth = 100;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    readonly composition: Composition\r\n  ) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"playlist-track-container\");\r\n\r\n    super(\"Playlist\", true, container);\r\n    this.timeline = container;\r\n    this.setSize(800, 400);\r\n\r\n    this.cursor = new AudioCursor(this);\r\n\r\n    audioClock.on(\"update\", () => {\r\n      this.cursor.update();\r\n    });\r\n  }\r\n\r\n  addTrack(name: string) {\r\n    const track = new PlaylistTrack(name);\r\n    this._tracks.push(track);\r\n    this.timeline.appendChild(track.domElement);\r\n    this.timeline.appendChild(this.cursor.domElement);\r\n  }\r\n}\r\n","import { IPattern, IProject, ITimelineSequence } from \"../schema\";\r\n\r\nexport class Composition implements IProject {\r\n  title: string;\r\n  description: string;\r\n  tempo: number;\r\n  patterns: IPattern[] = [];\r\n  timeline: ITimelineSequence[] = [];\r\n\r\n  constructor(title = \"Untitled\", description = \"\") {\r\n    this.title = title;\r\n    this.description = description;\r\n    this.tempo = 120;\r\n  }\r\n\r\n  serialize(): string {\r\n    return JSON.stringify(this);\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class ScrollPanel<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"scroll\" | T> {\r\n  sensitivity = 50;\r\n  private linkedElements: HTMLElement[] = [];\r\n  private _scrollTop = 0;\r\n\r\n  get scrollTop() {\r\n    return this._scrollTop;\r\n  }\r\n\r\n  set scrollTop(value: number) {\r\n    const top = -value;\r\n    this._scrollTop = top;\r\n    this.scrollElement.style.transform = `translateY(${top}px)`;\r\n    for (const linkedElement of this.linkedElements) {\r\n      linkedElement.style.transform = `translateY(${top}px)`;\r\n    }\r\n  }\r\n\r\n  constructor(readonly scrollElement: HTMLElement) {\r\n    super(\"div\", \"scroll-panel\");\r\n    scrollElement.classList.add(\"scroll-panel-content\");\r\n\r\n    this.scrollElement.addEventListener(\"wheel\", (e) => {\r\n      e.preventDefault();\r\n      console.log(e.deltaY);\r\n      let top =\r\n        this._scrollTop + (e.deltaY > 0 ? -this.sensitivity : this.sensitivity);\r\n      const bottom = top + this.scrollElement.offsetHeight;\r\n      if (bottom < this.domElement.offsetHeight) {\r\n        top = this.domElement.offsetHeight - this.scrollElement.offsetHeight;\r\n      } else if (top > 0) {\r\n        top = 0;\r\n      }\r\n      this._scrollTop = top;\r\n      this.scrollElement.style.transform = `translateY(${top}px)`;\r\n      for (const linkedElement of this.linkedElements) {\r\n        linkedElement.style.transform = `translateY(${top}px)`;\r\n      }\r\n\r\n      this.emit(\"scroll\", e);\r\n    });\r\n  }\r\n\r\n  linkElement(element: HTMLElement) {\r\n    this.linkedElements.push(element);\r\n    element.classList.add(\"scroll-panel-content\");\r\n  }\r\n}\r\n","export const DEFAULT_NOTE_HEIGHT = 20;\r\n\r\nexport const BOTTOM_ROW = [\r\n  90, 83, 88, 68, 67, 86, 71, 66, 72, 78, 74, 77, 188, 76, 190, 59, 191,\r\n];\r\n\r\nexport const TOP_ROW = [\r\n  81, 50, 87, 51, 69, 82, 53, 84, 54, 89, 55, 85, 73, 57, 79, 48, 80, 219, 61,\r\n  221,\r\n];\r\n\r\nexport const KEY_COLORS = [\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n];\r\n\r\nexport const NOTE_NAMES = [\r\n  \"A\",\r\n  \"A#\",\r\n  \"B\",\r\n  \"C\",\r\n  \"C#\",\r\n  \"D\",\r\n  \"D#\",\r\n  \"E\",\r\n  \"F\",\r\n  \"F#\",\r\n  \"G\",\r\n  \"G#\",\r\n];\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\n\r\nexport class AudioCanvas {\r\n  domElement: HTMLDivElement;\r\n  canvas: HTMLCanvasElement;\r\n  ctx: CanvasRenderingContext2D;\r\n  buffer: AudioBuffer | null = null;\r\n\r\n  constructor(width = 800, height = 200, playOnClick = true) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-canvas\");\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n    this.domElement.appendChild(this.canvas);\r\n\r\n    if (playOnClick) {\r\n      this.canvas.addEventListener(\"click\", () => {\r\n        if (this.buffer) {\r\n          this.playBuffer(this.buffer);\r\n        }\r\n      });\r\n    }\r\n\r\n    this.ctx = this.canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; note: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.note,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n\r\n  playBuffer(audioBuffer: AudioBuffer) {\r\n    const ctx = getAudioContext();\r\n    const source = ctx.createBufferSource();\r\n    source.buffer = audioBuffer;\r\n    source.connect(ctx.destination);\r\n    source.start();\r\n  }\r\n\r\n  loadBuffer(audioBuffer: AudioBuffer) {\r\n    this.buffer = audioBuffer;\r\n\r\n    const channelData = audioBuffer.getChannelData(0);\r\n    const bufferLength = channelData.length;\r\n    const sliceWidth = this.canvas.width / bufferLength;\r\n\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.canvas.height / 2);\r\n\r\n    for (let i = 0; i < bufferLength; i++) {\r\n      const x = i * sliceWidth;\r\n      const y = ((channelData[i] + 1) * this.canvas.height) / 2;\r\n\r\n      this.ctx.lineTo(x, y);\r\n    }\r\n\r\n    this.ctx.lineTo(this.canvas.width, this.canvas.height / 2);\r\n    this.ctx.stroke();\r\n  }\r\n}\r\n","import { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\nimport { AudioCanvas } from \"../../../../elements/src/elements/AudioCanvas\";\r\n\r\nexport class LyricCanvas extends AudioCanvas {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; note: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.note,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n}\r\n","import { BaseElement } from \"./elements/BaseElement\";\r\n\r\nexport class DialogPopup extends BaseElement<\"result\" | \"cancel\"> {  \r\n  closeButton: HTMLButtonElement;\r\n  okButton: HTMLButtonElement | undefined;\r\n  cancelButton: HTMLButtonElement | undefined;\r\n\r\n  get isVisibile() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    private readonly ok: string | HTMLButtonElement = \"OK\",\r\n    private readonly cancel: string | HTMLButtonElement = \"Cancel\"\r\n  ) {\r\n    super(\"div\", \"dialog-popup\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");    \r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"click\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    if (ok instanceof HTMLButtonElement) {\r\n      this.okButton = ok;\r\n    } else if (ok) {\r\n      this.okButton = document.createElement(\"button\");\r\n      this.okButton.textContent = ok;\r\n      this.domElement.appendChild(this.okButton);\r\n    }\r\n\r\n    if (this.okButton) {\r\n      this.okButton.addEventListener(\"click\", () => {\r\n        this.emit(\"result\", this);\r\n      });\r\n    }\r\n\r\n    if (cancel instanceof HTMLButtonElement) {\r\n      this.cancelButton = cancel;\r\n    } else if (cancel) {\r\n      this.cancelButton = document.createElement(\"button\");\r\n      this.cancelButton.textContent = cancel;\r\n      this.domElement.appendChild(this.cancelButton);\r\n    }\r\n\r\n    if (this.cancelButton) {\r\n      this.cancelButton.addEventListener(\"click\", () => {\r\n        this.emit(\"cancel\", this);\r\n      });\r\n    }\r\n  }\r\n\r\n  show(x: number, y: number, targetObject?: unknown) { /* eslint-disable-line @typescript-eslint/no-unused-vars */\r\n    this.domElement.style.display = \"block\";\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","import { LyricCanvas } from \"./components/LyricCanvas\";\r\nimport { GridItem } from \"./components/Grid\";\r\nimport { DialogPopup } from \"../../../elements/src/DialogPopup\";\r\n\r\nexport class PianoRollDialog extends DialogPopup {\r\n  domElement: HTMLDivElement;\r\n  closeButton: HTMLButtonElement;\r\n  saveButton: HTMLButtonElement;\r\n  note: GridItem | null = null;\r\n\r\n  constructor(public onsave: (note: GridItem) => void) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-dialog\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");\r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"click\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    this.saveButton = document.createElement(\"button\");\r\n    this.saveButton.textContent = \"Save\";\r\n    this.domElement.appendChild(this.saveButton);\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  override show(x: number, y: number, note: GridItem) {\r\n    super.show(x, y, note);\r\n    this.note = note;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class LyricEditorDialog extends PianoRollDialog {\r\n  textInput: HTMLInputElement;\r\n  audioCanvas: LyricCanvas;\r\n  pitchSlider: HTMLInputElement;\r\n  constructor(onsave: (note: GridItem) => void) {\r\n    super(onsave);\r\n    this.domElement.classList.add(\"piano-roll-note-editor\");\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this.textInput = document.createElement(\"input\");\r\n    this.textInput.setAttribute(\"placeholder\", \"Note lyric\");\r\n    this.textInput.classList.add(\"lyric-editor-text\");\r\n    this.textInput.type = \"text\";\r\n    this.domElement.appendChild(this.textInput);\r\n\r\n    this.pitchSlider = document.createElement(\"input\");\r\n    this.pitchSlider.classList.add(\"lyric-editor-pitch\");\r\n    this.pitchSlider.type = \"range\";\r\n    this.pitchSlider.min = \"-0.5\";\r\n    this.pitchSlider.max = \"0.5\";\r\n    this.pitchSlider.step = \"0.01\";\r\n    this.pitchSlider.value = \"0\";\r\n    this.pitchSlider.addEventListener(\"input\", () => {\r\n      this.note!.note = parseFloat(this.pitchSlider.value);\r\n    });\r\n    this.domElement.appendChild(this.pitchSlider);\r\n\r\n    this.audioCanvas = new LyricCanvas();\r\n    this.domElement.appendChild(this.audioCanvas.domElement);\r\n\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.audioCanvas.domElement.style.display = \"block\";\r\n      this.audioCanvas.generateAudio(this.note!, true).then((buffer) => {\r\n        this.note!.audio = buffer;\r\n      });\r\n      this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  show(x: number, y: number, note: GridItem) {\r\n    super.show(x, y, note);\r\n    this.textInput.value = this.note?.label || \"\";\r\n    if (this.note?.audio) {\r\n      this.audioCanvas.loadBuffer(this.note.audio);\r\n      this.audioCanvas.domElement.style.display = \"block\";\r\n    } else {\r\n      this.audioCanvas.domElement.style.display = \"none\";\r\n    }\r\n  }\r\n}\r\n","import { ScrollPanel } from \"../../../../elements/src/elements/ScrollPanel\";\r\nimport { DEFAULT_NOTE_HEIGHT, NOTE_NAMES } from \"../../constants\";\r\nimport { PatternTrack } from \"./PatternTrack\";\r\nimport { LyricEditorDialog } from \"../audioDialogs\";\r\nimport { IEventItem } from \"../../schema\";\r\n\r\nfunction getNoteNameFromPitch(pitch: number): string {\r\n  const note = NOTE_NAMES[pitch % NOTE_NAMES.length];\r\n  return `${note}${Math.floor(pitch / NOTE_NAMES.length)}`;\r\n}\r\n\r\nconst NOTE_HANDLE_WIDTH = 6;\r\n\r\nexport class GridItem {\r\n  note: number;\r\n  start: number;\r\n  duration: number;\r\n  velocity: number = 100;\r\n  label: string | \"\" = \"\";\r\n  domElement: HTMLDivElement;\r\n  noteLabel: HTMLDivElement;\r\n  lyricLabel: HTMLDivElement;\r\n  audio: AudioBuffer | null = null;\r\n\r\n  constructor(\r\n    private readonly grid: Grid,\r\n    item: IEventItem\r\n  ) {\r\n    this.note = item.note;\r\n    this.start = item.start;\r\n    this.duration = item.duration;\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-note\");\r\n    this.domElement.style.height = `${grid.noteHeight}px`;\r\n\r\n    this.noteLabel = document.createElement(\"div\");\r\n    this.noteLabel.classList.add(\"piano-roll-note-label\");\r\n    this.noteLabel.textContent = getNoteNameFromPitch(this.note);\r\n    this.domElement.appendChild(this.noteLabel);\r\n\r\n    this.lyricLabel = document.createElement(\"div\");\r\n    this.lyricLabel.classList.add(\"piano-roll-note-lyric\");\r\n    this.domElement.appendChild(this.lyricLabel);\r\n\r\n    if (item.label) this.lyricLabel.textContent = item.label;\r\n\r\n    console.log(\"GridItem\", this);\r\n\r\n    grid.gridElement.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class Grid extends ScrollPanel<\"select\" | \"update\"> {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly gridElement: HTMLDivElement;\r\n  readonly previewCanvas: HTMLCanvasElement;\r\n  readonly noteHeight = DEFAULT_NOTE_HEIGHT;\r\n  readonly beatWidth = 100;\r\n  readonly noteEditor: LyricEditorDialog;\r\n  private _currentNote: GridItem | null = null;\r\n  private _dragMode: string | null = null;\r\n  private _quantize: number = 0.25;\r\n  private _dragOffset: number = 0;\r\n  private _track: PatternTrack | null = null;\r\n  readonly scrollElement: HTMLDivElement;\r\n\r\n  constructor() {\r\n    const gridElement = document.createElement(\"div\");\r\n\r\n    super(gridElement);\r\n\r\n    this.scrollElement = gridElement;\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n\r\n    this.gridElement = gridElement;\r\n\r\n    this.domElement.classList.add(\"piano-roll-grid-container\");\r\n    this.gridElement.classList.add(\"piano-roll-grid\");\r\n\r\n    this.gridElement.addEventListener(\"dragstart\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.previewCanvas = document.createElement(\"canvas\");\r\n    this.previewCanvas.style.imageRendering = \"pixelated\";\r\n\r\n    const rowBackgroundCanvas = document.createElement(\"canvas\");\r\n    rowBackgroundCanvas.style.imageRendering = \"pixelated\";\r\n    rowBackgroundCanvas.width = this.beatWidth * 4;\r\n    rowBackgroundCanvas.height = this.noteHeight;\r\n    console.log(\"debug\", rowBackgroundCanvas.width, rowBackgroundCanvas.height);\r\n    const ctx = rowBackgroundCanvas.getContext(\"2d\");\r\n    // disable anti-alias\r\n\r\n    if (ctx) {\r\n      ctx.strokeStyle = \"#666\";\r\n      ctx.lineWidth = 0.5;\r\n      for (let j = 1; j < 4; j++) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(j * this.beatWidth, 0);\r\n        ctx.lineTo(j * this.beatWidth, this.noteHeight);\r\n        ctx.stroke();\r\n      }\r\n      ctx.lineWidth = 1;\r\n      ctx.strokeStyle = \"white\";\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, 0);\r\n      ctx.lineTo(0, this.noteHeight);\r\n      ctx.stroke();\r\n    }\r\n    for (let i = 0; i < 88; i++) {\r\n      const row = document.createElement(\"div\");\r\n      row.classList.add(\"piano-roll-grid-row\");\r\n      row.style.height = `${this.noteHeight}px`;\r\n      this.gridElement.appendChild(row);\r\n      const base64 = rowBackgroundCanvas.toDataURL();\r\n      row.style.backgroundImage = `url(${base64})`;\r\n      row.style.backgroundRepeat = \"repeat\";\r\n    }\r\n    this.domElement.appendChild(this.gridElement);\r\n\r\n    this.noteEditor = new LyricEditorDialog((note) => {\r\n      const input = this.noteEditor.domElement.querySelector(\r\n        \".lyric-editor-text\"\r\n      ) as HTMLInputElement;\r\n      note.label = input?.value || \"\";\r\n    });\r\n\r\n    document.body.appendChild(this.noteEditor.domElement);\r\n\r\n    this.gridElement.addEventListener(\"pointerdown\", (event) => {\r\n      if (!this._track) throw new Error(\"No track\");\r\n\r\n      if (!this._track.events) throw new Error(\"No events\");\r\n\r\n      event.preventDefault();\r\n\r\n      this._dragOffset = event.layerX;\r\n\r\n      if (this.noteEditor.domElement.style.display === \"block\") {\r\n        this.noteEditor.domElement.style.display = \"none\";\r\n        return;\r\n      }\r\n\r\n      if (\r\n        event.target instanceof HTMLDivElement &&\r\n        event.target.classList.contains(\"piano-roll-note\")\r\n      ) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const note = this._track.events.find(\r\n          (n) => n.domElement === event.target\r\n        );\r\n\r\n        if (event.ctrlKey || event.button === 1) {\r\n          if (note)\r\n            this.noteEditor.show(event.clientX + 20, event.clientY - 5, note);\r\n          else this.noteEditor.domElement.style.display = \"none\";\r\n        }\r\n\r\n        if (note) {\r\n          this._currentNote = note;\r\n\r\n          if (event.button === 2) {\r\n            this.remove(note);\r\n            this._currentNote = null;\r\n          } else {\r\n            note.domElement.parentElement?.appendChild(note.domElement);\r\n            if (this._dragOffset < NOTE_HANDLE_WIDTH) {\r\n              this._dragMode = \"start\";\r\n            } else if (\r\n              note.domElement.offsetWidth - this._dragOffset <\r\n              NOTE_HANDLE_WIDTH\r\n            ) {\r\n              this._dragMode = \"end\";\r\n            } else {\r\n              this._dragMode = \"move\";\r\n            }\r\n          }\r\n        }\r\n      } else if (event.button !== 0) return;\r\n      else if (event.target === this.gridElement) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const pitch = 87 - Math.floor(event.layerY / this.noteHeight);\r\n\r\n        let start = event.layerX / this.beatWidth;\r\n        start = Math.round(start / this._quantize) * this._quantize;\r\n        console.log(\"start\", start, event.layerX);\r\n\r\n        const item = {\r\n          note: pitch,\r\n          start: start,\r\n          velocity: 100,\r\n          duration: 0.25,\r\n          label: \"\",\r\n        };\r\n\r\n        this._currentNote = this.add(new GridItem(this, item));\r\n        this._currentNote.domElement.style.top = `${\r\n          (87 - this._currentNote.note) * this.noteHeight\r\n        }px`;\r\n        this._currentNote.domElement.style.left = `${\r\n          this._currentNote.start * this.beatWidth\r\n        }px`;\r\n        this._dragMode = \"end\";\r\n\r\n        this.emit(\"select\", this._currentNote);\r\n      }\r\n\r\n      this.emit(\"update\", this);\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      this._currentNote = null;\r\n\r\n      this.emit(\"update\", this);\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentNote) {\r\n        this.remove(this._currentNote);\r\n        this._currentNote = null;\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"contextmenu\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointermove\", (event) => {\r\n      if (this._currentNote && event.buttons === 1) {\r\n        if (this._dragMode === \"start\") {\r\n          const oldStart = this._currentNote.start;\r\n          this._currentNote.start = event.layerX / this.beatWidth;\r\n          this._currentNote.start =\r\n            Math.round(this._currentNote.start / this._quantize) *\r\n            this._quantize;\r\n          this._currentNote.duration =\r\n            oldStart - this._currentNote.start + this._currentNote.duration;\r\n          this._currentNote.domElement.style.left = `${\r\n            this._currentNote.start * this.beatWidth\r\n          }px`;\r\n          this._currentNote.domElement.style.width = `${\r\n            this._currentNote.duration * this.beatWidth\r\n          }px`;\r\n        } else if (this._dragMode === \"end\") {\r\n          this._currentNote.duration =\r\n            event.layerX / this.beatWidth - this._currentNote.start;\r\n\r\n          // quantize\r\n          this._currentNote.duration =\r\n            Math.round(this._currentNote.duration / this._quantize) *\r\n            this._quantize;\r\n\r\n          this._currentNote.domElement.style.width = `${\r\n            this._currentNote.duration * this.beatWidth\r\n          }px`;\r\n        } else if (this._dragMode === \"move\") {\r\n          this._currentNote.start =\r\n            (event.layerX - this._dragOffset) / this.beatWidth;\r\n          this._currentNote.start =\r\n            Math.round(this._currentNote.start / this._quantize) *\r\n            this._quantize;\r\n          this._currentNote.domElement.style.left = `${\r\n            this._currentNote.start * this.beatWidth\r\n          }px`;\r\n        } else {\r\n          return;\r\n        }\r\n\r\n        this.emit(\"update\", this);\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentNote) {\r\n        this._currentNote.domElement.style.pointerEvents = \"auto\";\r\n      }\r\n      this._currentNote = null;\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentNote) {\r\n        this._currentNote.domElement.style.pointerEvents = \"auto\";\r\n      }\r\n      this._currentNote = null;\r\n    });\r\n  }\r\n\r\n  add(event: GridItem) {\r\n    if (!this._track) throw new Error(\"add() No track!\");\r\n    this._track.events.push(event);\r\n    console.log(\"Grid: add\", event);\r\n    return event;\r\n  }\r\n\r\n  remove(event: GridItem) {\r\n    if (!this._track) throw new Error(\"remove() No track!\");\r\n    this._track.events.splice(this._track.events.indexOf(event), 1);\r\n    this.gridElement.removeChild(event.domElement);\r\n  }\r\n\r\n  load(track: PatternTrack) {\r\n    console.log(\"Grid: load\", track.events);\r\n    this._track?.events.forEach((event) => event.domElement.remove());\r\n    this._track = track;\r\n    track.events.forEach((event) => {\r\n      this.gridElement.appendChild(event.domElement);\r\n    });\r\n  }\r\n\r\n  renderToCanvas(canvas: HTMLCanvasElement, color: string) {\r\n    if (!this._track) throw new Error(\"renderToCanvas() No track!\");\r\n\r\n    // find lowest note\r\n    let lowestNote = 88;\r\n    this._track.events.forEach((note) => {\r\n      if (note.note < lowestNote) lowestNote = note.note;\r\n    });\r\n\r\n    // find highest note\r\n    let highestNote = 0;\r\n    this._track.events.forEach((note) => {\r\n      if (note.note > highestNote) highestNote = note.note;\r\n    });\r\n\r\n    highestNote += 12;\r\n    lowestNote -= 12;\r\n\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    let padded_scale = canvas.height / (highestNote - lowestNote + 1);\r\n\r\n    if (padded_scale > 2) {\r\n      padded_scale = 2;\r\n    }\r\n\r\n    this._track.events.forEach((note) => {\r\n      const y = canvas.height - (note.note - lowestNote + 1) * padded_scale;\r\n      const x = note.start * this.beatWidth;\r\n      const width = note.duration * this.beatWidth;\r\n      ctx.fillStyle = color;\r\n      ctx.fillRect(x, y, width, padded_scale);\r\n    });\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport {\r\n  DEFAULT_NOTE_HEIGHT,\r\n  KEY_COLORS,\r\n  NOTE_NAMES,\r\n} from \"../../constants\";\r\nimport { IKeyboardEvent } from \"./Keyboard\";\r\n\r\nexport class SideKeyboard extends BaseElement<\"update\"> {  \r\n  keys: HTMLDivElement[] = [];\r\n  noteHeight = DEFAULT_NOTE_HEIGHT;\r\n\r\n  constructor() {\r\n\r\n    super(\"div\", \"piano-roll-keyboard\");\r\n\r\n    this.redraw();\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const key = e.target as HTMLDivElement;\r\n\r\n      if (key.classList.contains(\"piano-roll-keyboard-key\")) {\r\n        const note_index = this.keys.indexOf(key);\r\n        console.log(\"key\", key.textContent, note_index);        \r\n        key.classList.add(\"active\");\r\n        this.emit(\"update\", { type: \"press\", note: note_index } as IKeyboardEvent);\r\n        const pointerup = () => {\r\n          key.classList.remove(\"active\");\r\n          this.emit(\"update\", { type: \"release\", note: note_index } as IKeyboardEvent);\r\n          window.removeEventListener(\"pointerup\", pointerup);\r\n        };\r\n\r\n        window.addEventListener(\"pointerup\", () => pointerup());\r\n      }\r\n    });\r\n  }\r\n\r\n  redraw() {\r\n    this.domElement.innerHTML = \"\";\r\n\r\n    for (let i = 87; i >= 0; i--) {\r\n      const key = document.createElement(\"div\");\r\n      key.classList.add(\"piano-roll-keyboard-key\");\r\n      key.style.height = `${this.noteHeight}px`;\r\n      // key.style.bottom = `${i * this.noteHeight}px`;\r\n      key.style.backgroundColor =\r\n        KEY_COLORS[i % 12] === \"white\" ? \"#fff\" : \"#000\";\r\n      key.style.color = KEY_COLORS[i % 12] === \"white\" ? \"#000\" : \"#fff\";\r\n      key.textContent = NOTE_NAMES[i % 12] + ((i / 12) | 0).toString();\r\n      this.domElement.appendChild(key);\r\n      this.keys.push(key);\r\n    }\r\n\r\n    this.keys.reverse();\r\n  }\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"./AudioCursor\";\r\nimport { Grid, GridItem } from \"./Grid\";\r\nimport { IKeyboardEvent } from \"./Keyboard\";\r\nimport { PatternTrack } from \"./PatternTrack\";\r\nimport { SideKeyboard } from \"./SideKeyboard\";\r\n\r\nexport class PianoRoll\r\n  extends EventObject<\"update\">\r\n  implements ICursorTimeline\r\n{\r\n  readonly domElement: HTMLDivElement;\r\n  readonly grid: Grid;\r\n  readonly sideKeyboard: SideKeyboard;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLElement;\r\n  cursorUpdateInterval: number | object | null = null;\r\n  track: PatternTrack | null = null;\r\n  color = \"#7979ce\";\r\n  beatWidth = 100;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll\");\r\n\r\n    this.sideKeyboard = new SideKeyboard();\r\n    this.domElement.appendChild(this.sideKeyboard.domElement);\r\n    this.sideKeyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      if (e.type == \"press\") this.track!.trigger(e.note);\r\n      else if (e.type == \"release\") this.track!.release(e.note);\r\n    });\r\n\r\n    this.grid = new Grid();\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.on(\"select\", (item) => {\r\n      const note = item as GridItem;\r\n      this.track!.trigger(note.note);\r\n      if (this.track) {\r\n        this.grid.renderToCanvas(this.track.canvas, this.color);\r\n      }\r\n    });\r\n    this.grid.on(\"update\", () => {\r\n      if (this.track) {\r\n        this.grid.renderToCanvas(this.track.canvas, this.color);\r\n      }\r\n    });\r\n    this.grid.linkElement(this.sideKeyboard.domElement);\r\n\r\n    this.timeline = this.grid.domElement;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.classList.add(\"audio-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor.domElement);\r\n\r\n    this.grid.scrollTop = 1000;\r\n  }\r\n\r\n  load(track: PatternTrack) {\r\n    this.track = track;\r\n    this.grid.load(track);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { PatternTrack } from \"../components/PatternTrack\";\r\nimport { PianoRoll } from \"../components/PianoRoll\";\r\n\r\nexport class PianoRollWindow extends DraggableWindow<\"update\"> {\r\n  pianoRoll: PianoRoll;\r\n\r\n  constructor(readonly clock: AudioClock) {\r\n    const pianoRoll = new PianoRoll(clock);\r\n\r\n    super(\"Piano Roll\", true, pianoRoll.domElement);\r\n    this.pianoRoll = pianoRoll;\r\n\r\n    this.setSize(800, 400);\r\n  }\r\n\r\n  loadTrack(track: PatternTrack) {\r\n    this.pianoRoll.load(track);\r\n    this.setTitle(`Piano Roll (${track.name})`);\r\n  }\r\n}\r\n","import { triggerActive } from \"../../../../elements/src/animation\";\r\nimport { AudioCanvas } from \"../../../../elements/src/elements/AudioCanvas\";\r\nimport { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\nimport { ISamplerSlot } from \"../../schema\";\r\nimport { IInstrument } from \"../IInstrument\";\r\nimport { AudioClock } from \"./AudioClock\";\r\n\r\ninterface ISourceEvent {\r\n  source: AudioBufferSourceNode;\r\n  gain: GainNode;\r\n  cutByGroups: number[];\r\n  time: number;\r\n}\r\n\r\nexport class SamplerSlot\r\n  extends BaseElement<\"update\">\r\n  implements ISamplerSlot, IInstrument\r\n{\r\n  private _nameElement;\r\n\r\n  name: string;\r\n  buffer: AudioBuffer | null = null;\r\n  keyBinding: number | null = null;\r\n  velocity: number;\r\n  pan: number;\r\n  pitch: number;\r\n  randomPitch: number;\r\n  randomVelocity: number;\r\n  startPosition: number;\r\n  endPosition: number;\r\n  loop: boolean;\r\n  loopStart: number;\r\n  loopEnd: number;\r\n  cutGroup: number;\r\n  cutByGroups: number[];\r\n  protected _sources: ISourceEvent[] = [];\r\n  private _previewCanvas: AudioCanvas;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    name = \"\",\r\n    keyBinding: number | null = null,\r\n    cutGroup = -1,\r\n    cutByGroups: number[] = []\r\n  ) {\r\n    super(\"div\", \"sampler-slot\");\r\n\r\n    this.name = name;\r\n    this.buffer = null;\r\n    this.keyBinding = keyBinding || null;\r\n    this.velocity = 1;\r\n    this.pan = 1;\r\n    this.pitch = 1;\r\n    this.randomPitch = 0;\r\n    this.randomVelocity = 0.05;\r\n    this.startPosition = 0;\r\n    this.endPosition = 0;\r\n    this.loop = false;\r\n    this.loopStart = 0;\r\n    this.loopEnd = 0;\r\n    this.cutGroup = cutGroup;\r\n    this.cutByGroups = cutByGroups;\r\n\r\n    this._previewCanvas = new AudioCanvas(200, 60);\r\n    this.domElement.appendChild(this._previewCanvas.domElement);\r\n\r\n    this._nameElement = document.createElement(\"div\");\r\n    this._nameElement.classList.add(\"sampler-slot-name\");\r\n    this.domElement.appendChild(this._nameElement);\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => this.trigger());\r\n  }\r\n\r\n  async loadSample(name: string, url: string) {\r\n    const audioContext = getAudioContext();\r\n\r\n    this._nameElement.textContent = \"(Loading)\";\r\n\r\n    const response = await fetch(url);\r\n    if (!response.ok) {\r\n      this._nameElement.textContent = \"(Empty)\";\r\n      console.error(`Error loading sample: ${url}`, response.statusText);\r\n      return;\r\n    }\r\n\r\n    response\r\n      .arrayBuffer()\r\n      .then((buffer) => audioContext.decodeAudioData(buffer))\r\n      .then((audioBuffer) => {\r\n        this._nameElement.textContent = name;\r\n        this.buffer = audioBuffer;\r\n        this.emit(\"update\");\r\n        setTimeout(() => {\r\n          this._previewCanvas.loadBuffer(audioBuffer);\r\n        }, 1);\r\n      })\r\n      .catch((error) => {\r\n        this._nameElement.textContent = \"(Empty)\";\r\n        console.error(`Error loading sample: ${url}`, error);\r\n      });\r\n  }\r\n\r\n  trigger(beat = 0) {\r\n    if (!this.buffer) {\r\n      console.error(\"No buffer loaded for sample\", this.name);\r\n      return;\r\n    }\r\n\r\n    const audioContext = getAudioContext();\r\n    const source = audioContext.createBufferSource();\r\n    source.buffer = this.buffer;\r\n    source.playbackRate.value = this.pitch + Math.random() * this.randomPitch;\r\n    source.connect(audioContext.destination);\r\n\r\n    const gain = audioContext.createGain();\r\n    gain.gain.value = this.velocity + Math.random() * this.randomVelocity;\r\n    gain.connect(audioContext.destination);\r\n\r\n    source.connect(gain);\r\n\r\n    if (this.pan !== 1) {\r\n      const pan = audioContext.createStereoPanner();\r\n      pan.pan.value = this.pan;\r\n      source.connect(pan);\r\n      pan.connect(gain);\r\n    }\r\n\r\n    const time =\r\n      (this.audioClock.startTime || audioContext.currentTime) +\r\n      (beat * 60) / this.audioClock.bpm;\r\n\r\n    const entry: ISourceEvent = {\r\n      source,\r\n      gain,\r\n      cutByGroups: this.cutByGroups,\r\n      time,\r\n    };\r\n\r\n    this._sources.push(entry);\r\n\r\n    source.onended = () => {\r\n      source.disconnect();\r\n      gain.disconnect();\r\n      const index = this._sources.indexOf(entry);\r\n      if (index >= 0) this._sources.splice(index, 1);\r\n    };\r\n\r\n    console.log(beat, audioContext.currentTime, time);\r\n\r\n    if (this.startPosition >= 0) {\r\n      source.start(\r\n        time,\r\n        this.startPosition,\r\n        (this.endPosition || this.buffer.duration) - this.startPosition\r\n      );\r\n    } else {\r\n      source.start(time);\r\n    }\r\n\r\n    if (time === 0 || !this.audioClock.isPlaying) {\r\n      triggerActive(this.domElement);\r\n    } else {\r\n      this.audioClock.scheduleEventAtTime(\r\n        () => triggerActive(this.domElement),\r\n        time\r\n      );\r\n    }\r\n\r\n    if (this.loop) {\r\n      source.loop = true;\r\n      source.loopStart = this.loopStart;\r\n      source.loopEnd = this.loopEnd || this.buffer.duration;\r\n    }\r\n  }\r\n\r\n  release(time: number) {\r\n    for (const entry of this._sources) {\r\n      if (time >= entry.time) this.cut(entry, time);\r\n    }\r\n  }\r\n\r\n  cut(entry: ISourceEvent, time = 0) {\r\n    const currentValue = entry.gain.gain.value;\r\n    entry.gain.gain.cancelScheduledValues(time);\r\n    entry.gain.gain.setValueAtTime(currentValue, time);\r\n    entry.gain.gain.exponentialRampToValueAtTime(0.0001, time + 0.1);\r\n    entry.source.stop(time + 0.1);\r\n  }\r\n}\r\n","import { EventDataMap } from \"../../../../elements/src/EventObject\";\r\nimport { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { IInstrument } from \"../IInstrument\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { SamplerSlot } from \"../components/SamplerSlot\";\r\n\r\nexport class SamplerWindow\r\n  extends DraggableWindow<keyof EventDataMap>\r\n  implements IInstrument\r\n{\r\n  slots: SamplerSlot[] = [];\r\n  private _slotsContainer: HTMLDivElement;\r\n\r\n  name = \"sampler\";\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"sampler-slots-container\");\r\n\r\n    super(\"Sampler\", true, container);\r\n    this._slotsContainer = container;\r\n\r\n    this.setSize(400, 400);\r\n\r\n    //keypad numbers 0-9\r\n    // then . / * + - Enter\r\n    const defaultSlots = [\r\n      { keyBinding: 96, name: \"0\" },\r\n      { keyBinding: 97, name: \"1\" },\r\n      { keyBinding: 98, name: \"2\" },\r\n      { keyBinding: 99, name: \"3\" },\r\n      { keyBinding: 100, name: \"4\" },\r\n      { keyBinding: 101, name: \"5\" },\r\n      { keyBinding: 102, name: \"6\" },\r\n      { keyBinding: 103, name: \"7\" },\r\n      { keyBinding: 104, name: \"8\" },\r\n      { keyBinding: 105, name: \"9\" },\r\n      { keyBinding: 111, name: \"/\" },\r\n      { keyBinding: 106, name: \"*\" },\r\n      { keyBinding: 109, name: \"-\" },\r\n      { keyBinding: 107, name: \"+\" },\r\n      { keyBinding: 13, name: \"Enter\" },\r\n    ];\r\n\r\n    for (let i = 0; i < 14; i++) {\r\n      const slot = new SamplerSlot(\r\n        this.audioClock,\r\n        defaultSlots[i].name,\r\n        defaultSlots[i].keyBinding,\r\n        i,\r\n        [i]\r\n      );\r\n      this.slots.push(slot);\r\n      this._slotsContainer.appendChild(slot.domElement);\r\n      slot.loadSample(\"Sample\", `./data/samples/kit1/${i}.wav`);\r\n    }\r\n\r\n    this.slots[6].cutByGroups.push(3);\r\n    this.slots[10].cutByGroups.push(0);\r\n\r\n    audioClock.on(\"stop\", () => {\r\n      for (const slot of this.slots) {\r\n        slot.release(0);\r\n      }\r\n    });\r\n\r\n    window.addEventListener(\"keydown\", (event) => this.onKeyDown(event));\r\n  }\r\n\r\n  onKeyDown(event: KeyboardEvent) {\r\n    //console.log(event.key, event.keyCode);\r\n    const slot = this.slots.find((slot) => slot.keyBinding === event.keyCode);\r\n    if (slot) {\r\n      event.preventDefault();\r\n      const note = this.slots.indexOf(slot);\r\n      this.trigger(note, null);\r\n    }\r\n  }\r\n\r\n  trigger(note: number, channel: number | null, beat = 0) {\r\n    if (channel === null) {\r\n      const slot = this.slots[note];\r\n      if (slot) {\r\n        for (const each of this.slots) {\r\n          if (each.cutByGroups.includes(slot.cutGroup)) {\r\n            each.release(beat);\r\n          }\r\n        }\r\n        slot.trigger(beat);\r\n      }\r\n    } else {\r\n      if (this.slots[channel]) {\r\n        this.slots[channel].trigger(beat);\r\n        // TODO: Set pitch in trigger function\r\n      }\r\n    }\r\n  }\r\n\r\n  release(note: number, time = 0): void {\r\n    if (this.slots[note]) {\r\n      this.slots[note].release(time);\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { BOTTOM_ROW, TOP_ROW } from \"../../constants\";\r\n\r\nexport interface IKeyboardEvent {\r\n  type: \"press\" | \"release\";\r\n  note: number;\r\n}\r\n\r\nfunction keyToNote(keyCode: number) {\r\n  let note = -1;\r\n\r\n  if (BOTTOM_ROW.includes(keyCode)) {\r\n    note = BOTTOM_ROW.indexOf(keyCode);\r\n  } else if (TOP_ROW.includes(keyCode)) {\r\n    note = TOP_ROW.indexOf(keyCode) + 12;\r\n  }\r\n\r\n  return note;\r\n}\r\n\r\nexport class Keyboard extends BaseElement<\"update\"> {\r\n  constructor() {\r\n    super(\"div\", \"keyboard\");\r\n\r\n    const pressedKeys: number[] = [];\r\n\r\n    window.addEventListener(\"keydown\", (event) => {\r\n      //console.log(event.key, event.keyCode);\r\n\r\n      if (event.ctrlKey || event.altKey || event.shiftKey) return;\r\n\r\n      const target = event.target as HTMLElement;\r\n      if (target.tagName == \"INPUT\") return;\r\n\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || pressedKeys.includes(note)) return;\r\n\r\n      pressedKeys.push(note);\r\n      this.emit(\"update\", { type: \"press\", note });\r\n    });\r\n\r\n    window.addEventListener(\"keyup\", (event) => {\r\n\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || !pressedKeys.includes(note)) return;      \r\n\r\n      pressedKeys.splice(pressedKeys.indexOf(note), 1);\r\n      this.emit(\"update\", { type: \"release\", note });\r\n    });\r\n  }\r\n}\r\n","import { AudioClock } from \"./elements/components/AudioClock\";\r\nimport { WindowContainer } from \"../../elements/src/elements/WindowContainer\";\r\nimport { PatternWindow } from \"./elements/windows/PatternWindow\";\r\nimport { PlaylistWindow } from \"./elements/windows/PlaylistWindow\";\r\nimport { Composition } from \"./elements/Composition\";\r\nimport { PatternTrack } from \"./elements/components/PatternTrack\";\r\nimport { PianoRollWindow } from \"./elements/windows/PianoRollWindow\";\r\nimport { SamplerWindow } from \"./elements/windows/SamplerWindow\";\r\nimport { IKeyboardEvent, Keyboard } from \"./elements/components/Keyboard\";\r\nimport { SharedComponents } from \"./elements/components/SharedComponents\";\r\n\r\nconst composition = new Composition();\r\n\r\nconst domElement = document.createElement(\"div\");\r\ndomElement.style.display = \"flex\";\r\ndomElement.style.flexDirection = \"column\";\r\ndomElement.style.width = \"100%\";\r\ndomElement.style.height = \"100%\";\r\n\r\nconst audioClock = new AudioClock();\r\ndomElement.appendChild(audioClock.domElement);\r\n\r\nconst container = new WindowContainer();\r\ndomElement.appendChild(container.domElement);\r\n\r\nconst pianoRollWindow = new PianoRollWindow(audioClock);\r\ncontainer.addWindow(pianoRollWindow);\r\npianoRollWindow.setSize(900, 400);\r\npianoRollWindow.setPosition(500, 100);\r\n\r\nconst patternWindow = new PatternWindow(audioClock, composition);\r\npianoRollWindow.loadTrack(patternWindow.addTrack(\"Sampler\"));\r\npatternWindow.addTrack(\"Test 1\");\r\npatternWindow.addTrack(\"Test 2\");\r\npatternWindow.setSize(400, 400);\r\npatternWindow.show(35, 100);\r\ncontainer.addWindow(patternWindow);\r\n\r\npatternWindow.on(\"select\", (selectedTrack) => {\r\n  console.log(\"select\", selectedTrack);\r\n  pianoRollWindow.loadTrack(selectedTrack as PatternTrack);\r\n  pianoRollWindow.show();\r\n});\r\n\r\nconst playlistWindow = new PlaylistWindow(audioClock, composition);\r\ncontainer.addWindow(playlistWindow);\r\nfor (let i = 1; i <= 9; i++) {\r\n  playlistWindow.addTrack(`Pattern ${i}`);\r\n}\r\n// playlistWindow.show(600, 100);\r\n\r\nconst samplerWindow = new SamplerWindow(audioClock);\r\ncontainer.addWindow(samplerWindow);\r\nsamplerWindow.setSize(400, 400);\r\nsamplerWindow.show(1465, 100);\r\n\r\nconst keyboard = new Keyboard();\r\ndomElement.appendChild(keyboard.domElement);\r\nkeyboard.on(\"update\", (event) => {\r\n  const e = event as IKeyboardEvent;\r\n  console.log(\"Keyboard\", event);\r\n  if (e.type === \"press\") {\r\n    patternWindow.trigger(e.note);\r\n  } else if (e.type === \"release\") {\r\n    console.log(\"Release\", e.note);\r\n  }\r\n});\r\n\r\nSharedComponents.add(\"sampler\", samplerWindow);\r\n\r\ndocument.body.appendChild(domElement);\r\n\r\nconsole.log(\"Serialized\", composition.serialize());\r\n"],"names":["exports","Symbol","toStringTag","Object","defineProperty","value","_events","_onceEvents","on","eventName","callback","this","push","once","emit","eventData","onceCallbacks","error","console","undefined","callbacks","audioContext","AudioContext","window","webkitAudioContext","getAudioContext","log","_isPlaying","_bpm","_scheduledEvents","_startTime","domElement","document","createElement","classList","add","playPauseButton","textContent","addEventListener","stop","playPause","appendChild","stopButton","bpmInput","type","parseFloat","currentTimeDisplay","currentTime","start","requestAnimationFrame","_render","bind","_update","currentBeat","source","disconnect","buffer","createBuffer","sampleRate","createBufferSource","connect","destination","beat","bars","Math","floor","beats","timeString","toString","padStart","scheduleEventAtTime","time","emptyBuffer","onended","scheduleEventAtBeat","windows","_draggingWindow","className","addWindow","tagName","_resizing","_startX","_startY","_startWidth","_startHeight","_startTop","_startLeft","_resizeDirection","e","handle","getCurrentHandle","style","cursor","onmove","dx","clientX","dy","clientY","width","height","left","top","offsetWidth","offsetHeight","preventDefault","startResize","onrelease","stopResize","removeEventListener","direction","offsetTop","offsetLeft","rect","getBoundingClientRect","offsetX","offsetY","BaseElement","title","persistent","innerContent","_isDragging","_dragOffsetX","_dragOffsetY","_top","_left","parentElement","titlebar","scrollTop","ondrag","newTop","newLeft","body","_title","content","_closeButton","button","close","display","show","x","y","setTimeout","remove","setSize","setPosition","setTitle","SizableElement","timeline","clock","audioClock","update","transform","beatWidth","hide","triggerActive","elt","timeout","toggle","getComponent","name","_components","component","events","_name","output","port","channel","_selected","_instrumentPanel","label","buttons","edit","mute","solo","_indicator","_canvas","trigger","note","SharedComponents","release","warn","playback","composition","container","tracks","trackContainer","position","pointerEvents","overflow","AudioCursor","canvas","querySelector","clientWidth","startTime","Error","addTrack","track","PatternTrack","length","selected","selectedTrack","removeTrack","index","indexOf","splice","removeChild","play","bpm","DraggableWindow","settings","_tracks","PlaylistTrack","description","patterns","tempo","serialize","JSON","stringify","scrollElement","sensitivity","linkedElements","_scrollTop","deltaY","linkElement","element","BOTTOM_ROW","TOP_ROW","KEY_COLORS","NOTE_NAMES","playOnClick","playBuffer","ctx","getContext","generateAudio","preview","Promise","resolve","reject","req","text","pitch","rate","fetch","method","headers","then","res","arrayBuffer","data","decodeAudioData","audioBuffer","catch","loadBuffer","channelData","getChannelData","bufferLength","sliceWidth","clearRect","beginPath","moveTo","i","lineTo","stroke","AudioCanvas","ok","cancel","closeButton","HTMLButtonElement","okButton","cancelButton","targetObject","onsave","textInput","setAttribute","pitchSlider","min","max","step","audioCanvas","LyricCanvas","saveButton","audio","DialogPopup","grid","item","velocity","duration","noteHeight","noteLabel","lyricLabel","gridElement","_currentNote","_dragMode","_quantize","_dragOffset","_track","event","previewCanvas","imageRendering","rowBackgroundCanvas","strokeStyle","lineWidth","j","row","base64","toDataURL","backgroundImage","backgroundRepeat","noteEditor","LyricEditorDialog","input","layerX","target","HTMLDivElement","contains","find","n","ctrlKey","layerY","round","GridItem","oldStart","load","forEach","renderToCanvas","color","lowestNote","highestNote","padded_scale","fillStyle","fillRect","ScrollPanel","keys","redraw","key","innerHTML","backgroundColor","reverse","cursorUpdateInterval","sideKeyboard","SideKeyboard","Grid","pianoRoll","PianoRoll","loadTrack","keyBinding","cutGroup","cutByGroups","_sources","pan","randomPitch","randomVelocity","startPosition","endPosition","loop","loopStart","loopEnd","_previewCanvas","_nameElement","loadSample","url","response","statusText","playbackRate","random","gain","createGain","createStereoPanner","entry","isPlaying","cut","currentValue","cancelScheduledValues","setValueAtTime","exponentialRampToValueAtTime","slots","_slotsContainer","defaultSlots","slot","SamplerSlot","onKeyDown","keyCode","each","includes","keyToNote","pressedKeys","altKey","shiftKey","Composition","flexDirection","AudioClock","WindowContainer","pianoRollWindow","PianoRollWindow","patternWindow","PatternWindow","playlistWindow","PlaylistWindow","samplerWindow","SamplerWindow","keyboard","Keyboard"],"sourceRoot":""}