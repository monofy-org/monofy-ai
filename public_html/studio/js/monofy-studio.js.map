{"version":3,"file":"monofy-studio.js","mappings":"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","sources":["webpack://monofy/webpack/bootstrap","webpack://monofy/webpack/runtime/make namespace object","webpack://monofy/../elements/src/EventObject.ts","webpack://monofy/../elements/src/managers/AudioManager.ts","webpack://monofy/./src/elements/components/AudioClock.ts","webpack://monofy/../elements/src/elements/BaseElement.ts","webpack://monofy/./src/plugins/plugins.ts","webpack://monofy/./src/abstracts/MathHelpers.ts","webpack://monofy/./src/elements/Mixer.ts","webpack://monofy/./src/elements/Project.ts","webpack://monofy/../elements/src/elements/WindowSnapPanel.ts","webpack://monofy/../elements/src/elements/WindowContainer.ts","webpack://monofy/../elements/src/elements/PopupNotification.ts","webpack://monofy/./src/constants.ts","webpack://monofy/./src/elements/components/Keyboard.ts","webpack://monofy/../elements/src/elements/SizableElement.ts","webpack://monofy/../elements/src/elements/DraggableWindow.ts","webpack://monofy/../elements/src/elements/SelectableGroup.ts","webpack://monofy/../elements/src/elements/SelectableElement.ts","webpack://monofy/./src/elements/components/MuteSoloButtons.ts","webpack://monofy/./src/elements/components/MixerChannelStrip.ts","webpack://monofy/./src/elements/windows/MixerWindow.ts","webpack://monofy/./src/elements/components/AudioCursor.ts","webpack://monofy/../elements/src/animation.ts","webpack://monofy/./src/elements/components/PatternTrack.ts","webpack://monofy/./src/elements/windows/PatternWindow.ts","webpack://monofy/./src/abstracts/GraphicsHelpers.ts","webpack://monofy/../elements/src/elements/ScrollPanel.ts","webpack://monofy/../elements/src/elements/AudioCanvas.ts","webpack://monofy/./src/elements/components/LyricCanvas.ts","webpack://monofy/../elements/src/elements/DialogPopup.ts","webpack://monofy/./src/elements/audioDialogs.ts","webpack://monofy/./src/elements/components/Grid.ts","webpack://monofy/./src/elements/components/SideKeyboard.ts","webpack://monofy/./src/elements/components/PianoRoll.ts","webpack://monofy/./src/elements/windows/PianoRollWindow.ts","webpack://monofy/../elements/src/elements/ContextMenu.ts","webpack://monofy/./src/elements/PlaylistSourceItem.ts","webpack://monofy/./src/elements/components/PlaylistTrack.ts","webpack://monofy/./src/elements/components/Playlist.ts","webpack://monofy/./src/elements/windows/PlaylistWindow.ts","webpack://monofy/./src/elements/ProjectUI.ts","webpack://monofy/../elements/src/elements/DraggableNumber.ts","webpack://monofy/./src/abstracts/InstrumentWindow.ts","webpack://monofy/./src/abstracts/Instrument.ts","webpack://monofy/./src/abstracts/Synthesizer.ts","webpack://monofy/./src/abstracts/SynthesizerVoice.ts","webpack://monofy/./src/elements/components/Slider.ts","webpack://monofy/./src/elements/components/Envelope.ts","webpack://monofy/./src/plugins/fmbass/FMBass.ts","webpack://monofy/./src/elements/components/SamplerSlot.ts","webpack://monofy/./src/plugins/sampler/Sampler.ts","webpack://monofy/./src/index.ts","webpack://monofy/./src/schema.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { BaseElement } from \"./elements/BaseElement\";\r\n\r\nexport interface IBaseEvent {\r\n  target: BaseElement;\r\n  event: PointerEvent;\r\n}\r\n\r\nexport interface IDragEvent extends IBaseEvent {\r\n  top: number;\r\n  left: number;\r\n  deltaX: number;\r\n  deltaY: number;\r\n}\r\n\r\nexport interface IResizeEvent extends IBaseEvent {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface EventDataMap {\r\n  cancel: unknown;\r\n  start: unknown;\r\n  stop: unknown;\r\n  pause: unknown;\r\n  result: unknown;\r\n  update: unknown;\r\n  open: unknown;\r\n  close: unknown;\r\n  edit: unknown;\r\n  release: unknown;\r\n  resize: IResizeEvent;\r\n  select: IBaseEvent;\r\n  scroll: WheelEvent;\r\n  add: unknown;\r\n  remove: unknown;\r\n  change: unknown;\r\n  drag: IDragEvent;\r\n}\r\n\r\nexport type BaseEvent = keyof EventDataMap;\r\n\r\nexport default abstract class EventObject<E extends BaseEvent = BaseEvent> {\r\n  private _events: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n  private _onceEvents: {\r\n    [eventName in E]?: ((e: EventDataMap[eventName]) => void)[];\r\n  } = {};\r\n\r\n  on(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._events[eventName]) {\r\n      this._events[eventName] = [];\r\n    }\r\n    this._events[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  once(eventName: E, callback: (e: EventDataMap[E]) => void) {\r\n    if (!this._onceEvents[eventName]) {\r\n      this._onceEvents[eventName] = [];\r\n    }\r\n    this._onceEvents[eventName]!.push(callback);\r\n\r\n    return this;\r\n  }\r\n\r\n  emit(eventName: E, eventData?: unknown) {\r\n    const onceCallbacks = this._onceEvents[eventName];\r\n    if (onceCallbacks) {\r\n      for (const callback of onceCallbacks) {\r\n        try {\r\n          callback(eventData as EventDataMap[E]);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .once callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n      this._onceEvents[eventName] = undefined;\r\n    }\r\n\r\n    const callbacks = this._events[eventName];\r\n    if (callbacks) {\r\n      for (const callback of callbacks) {\r\n        try {\r\n          callback(eventData as EventDataMap[E]);\r\n        } catch (error) {\r\n          console.error(\r\n            `Error executing .on callback for event: ${eventName}`,\r\n            error\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  removeAllListeners() {\r\n    this._events = {};\r\n    this._onceEvents = {};\r\n  }\r\n}\r\n","let audioContext: AudioContext | null = null;\r\n\r\nconst AudioContext = window.AudioContext || (window as any).webkitAudioContext;\r\n\r\nexport function getAudioContext() {\r\n  if (!audioContext) {\r\n    audioContext = new AudioContext({\r\n      latencyHint: \"interactive\",\r\n      sampleRate: 44100,\r\n    });\r\n    getAudioDevices().then((devices) => {\r\n      console.log(\"Audio devices\", devices);\r\n    });\r\n    console.log(\"Audio context created\");    \r\n\r\n    return audioContext;\r\n  }\r\n\r\n  if (audioContext.state === \"suspended\") {\r\n    audioContext.resume();\r\n  }\r\n\r\n  return audioContext;\r\n}\r\n\r\nexport async function getAudioDevices() {\r\n  if (\"setSinkId\" in AudioContext.prototype) {\r\n    const devices = await navigator.mediaDevices.enumerateDevices();\r\n    return devices;\r\n  }\r\n  return null;\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\n\r\n/**\r\n * Represents an audio clock that provides functionality for controlling audio playback and scheduling events.\r\n */\r\nexport class AudioClock extends EventObject<\r\n  \"start\" | \"stop\" | \"pause\" | \"update\"\r\n> {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly bpmInput: HTMLInputElement;\r\n  readonly playPauseButton: HTMLButtonElement;\r\n  readonly stopButton: HTMLButtonElement;\r\n  readonly currentTimeDisplay: HTMLSpanElement;\r\n  private _playbackMode: \"pattern\" | \"playlist\" = \"pattern\";\r\n  private _audioContext: AudioContext | null = null;\r\n  private _bpm: number = 100;\r\n  private _scheduledEvents: {\r\n    source: AudioBufferSourceNode;\r\n    time: number;\r\n    callback: () => void;\r\n  }[] = [];\r\n  private _startTime: number | null = null;\r\n\r\n  get startTime(): number | null {\r\n    return this._startTime;\r\n  }\r\n\r\n  get currentTime(): number {\r\n    return this.audioContext.currentTime;\r\n  }\r\n\r\n  get audioContext(): AudioContext {\r\n    if (!this._audioContext) {\r\n      this._audioContext = getAudioContext();\r\n    }\r\n    return this._audioContext;\r\n  }\r\n\r\n  get currentBeat(): number {\r\n    const elapsedTime =\r\n      this._startTime !== null\r\n        ? this.audioContext.currentTime - this._startTime\r\n        : 0;\r\n    return elapsedTime * (this._bpm / 60);\r\n  }\r\n\r\n  get isPlaying(): boolean {\r\n    return this._startTime != null && this._startTime >= 0;\r\n  }\r\n\r\n  get bpm(): number {\r\n    return this._bpm;\r\n  }\r\n\r\n  get playbackMode(): \"pattern\" | \"playlist\" {\r\n    return this._playbackMode;\r\n  }\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-clock\");\r\n\r\n    this.playPauseButton = document.createElement(\"button\");\r\n    this.playPauseButton.classList.add(\"audio-clock-play-pause\");\r\n\r\n    this.playPauseButton.addEventListener(\"click\", () => {\r\n      if (this.isPlaying) {\r\n        this.stop();\r\n      } else {\r\n        getAudioContext();\r\n        this.playPause();\r\n      }\r\n    });\r\n    this.domElement.appendChild(this.playPauseButton);\r\n    this.stopButton = document.createElement(\"button\");\r\n    this.stopButton.classList.add(\"audio-clock-stop\");\r\n    this.stopButton.textContent = \"\\u25A0\";\r\n\r\n    this.stopButton.addEventListener(\"click\", () => {\r\n      this.stop();\r\n    });\r\n    this.domElement.appendChild(this.stopButton);\r\n\r\n    this.bpmInput = document.createElement(\"input\");\r\n    this.bpmInput.classList.add(\"audio-clock-bpm\");\r\n    this.bpmInput.type = \"number\";\r\n    this.bpmInput.value = \"120\";\r\n\r\n    this.bpmInput.addEventListener(\"input\", () => {\r\n      this._bpm = parseFloat(this.bpmInput.value);\r\n    });\r\n    this.domElement.appendChild(this.bpmInput);\r\n\r\n    this.currentTimeDisplay = document.createElement(\"span\");\r\n    this.currentTimeDisplay.classList.add(\"audio-clock-time\");\r\n    this.currentTimeDisplay.textContent = \"01:1\";\r\n\r\n    this.domElement.appendChild(this.currentTimeDisplay);\r\n  }\r\n\r\n  start(): void {\r\n    this._startTime = this.audioContext.currentTime;\r\n    console.log(\"Started at\", this._startTime);\r\n    requestAnimationFrame(this._render.bind(this));\r\n    this.emit(\"start\");\r\n  }\r\n\r\n  private _render(): void {\r\n    this._update(this.currentBeat);\r\n    this.emit(\"update\");\r\n    if (this.isPlaying) requestAnimationFrame(this._render.bind(this));\r\n  }\r\n\r\n  stop(): void {\r\n    this.emit(\"stop\");\r\n    this._startTime = null;\r\n\r\n    for (const { source } of this._scheduledEvents) {\r\n      source.stop();\r\n      source.disconnect();\r\n    }\r\n    this._scheduledEvents = [];\r\n\r\n    this.playPauseButton.classList.remove(\"active\");\r\n\r\n    this._update(this.currentBeat);\r\n  }\r\n\r\n  restart() {\r\n    if (this.isPlaying) {\r\n      this._startTime = this.audioContext.currentTime;\r\n    }\r\n  }\r\n\r\n  playPause(): void {\r\n    if (this.isPlaying) {\r\n      this.stop(); // TODO: This should be a pause\r\n    } else {\r\n      const buffer = this.audioContext.createBuffer(\r\n        1,\r\n        1,\r\n        this.audioContext.sampleRate\r\n      );\r\n      const source = this.audioContext.createBufferSource();\r\n      source.buffer = buffer;\r\n      source.connect(this.audioContext.destination);\r\n      source.start();\r\n\r\n      this.start();\r\n    }\r\n    this.playPauseButton.classList.toggle(\"active\", this.isPlaying);\r\n  }\r\n\r\n  private _update(beat: number): void {\r\n    const bars = Math.floor(beat / 4) + 1;\r\n    const beats = Math.floor(beat % 4) + 1;\r\n    const timeString = `${bars\r\n      .toString()\r\n      .padStart(2, \"0\")}:${beats.toString()}`;\r\n    this.currentTimeDisplay.textContent = timeString;\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtTime(callback: () => void, time: number): void {\r\n    const emptyBuffer = this.audioContext.createBuffer(\r\n      1,\r\n      1,\r\n      this.audioContext.sampleRate\r\n    );\r\n    const source = this.audioContext.createBufferSource();\r\n    source.buffer = emptyBuffer;\r\n    source.connect(this.audioContext.destination);\r\n    source.onended = () => callback();\r\n    source.start(time);\r\n    this._scheduledEvents.push({ source, time, callback });\r\n  }\r\n\r\n  /**\r\n   * Schedules UI event to occur at a specific time during audio playback. This should not be used for scheduling audio events.\r\n   */\r\n  scheduleEventAtBeat(callback: () => void, beat: number): void {\r\n    const time = this._startTime! + (beat / this._bpm) * 60;\r\n    this.scheduleEventAtTime(callback, time);\r\n  }\r\n}\r\n","import EventObject, { EventDataMap } from \"../EventObject\";\r\n\r\nexport abstract class BaseElement<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n> extends EventObject<T> {\r\n  readonly domElement: HTMLElement;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super();\r\n    this.domElement = document.createElement(tagName);\r\n    if (className) {\r\n      this.domElement.classList.add(className);\r\n    }\r\n  }\r\n\r\n  dispose() {    \r\n    this.removeAllListeners();\r\n    this.domElement.remove();\r\n  }  \r\n\r\n  appendChild(child: BaseElement<keyof EventDataMap>) {\r\n    this.domElement.appendChild(child.domElement);\r\n    return this;\r\n  }\r\n\r\n  removeChild(child: BaseElement<keyof EventDataMap>) {\r\n    this.domElement.removeChild(child.domElement);\r\n    return this;\r\n  }\r\n}\r\n","import type { EventDataMap } from \"../../../elements/src/EventObject\";\r\nimport { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport type { DraggableWindow } from \"../../../elements/src/elements/DraggableWindow\";\r\nimport type { Mixer } from \"../elements/Mixer\";\r\nimport type { AudioClock } from \"../elements/components/AudioClock\";\r\nimport type { ControllerGroup, IHasControls } from \"../schema\";\r\n\r\nexport abstract class Plugin\r\n  extends BaseElement<\"update\">\r\n  implements IHasControls\r\n{\r\n  abstract id: string;\r\n  abstract name: string;\r\n  abstract version: string;\r\n  abstract description: string;\r\n  abstract author: string;\r\n  abstract controllerGroups: ControllerGroup[];\r\n  abstract window?: DraggableWindow<\"update\" | keyof EventDataMap>;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    readonly mixer: Mixer\r\n  ) {\r\n    console.assert(audioClock, \"audioClock is required\");\r\n    console.assert(mixer, \"mixer is required\");\r\n    super(\"div\", \"plugin-container\");\r\n  }\r\n}\r\n\r\nexport class Plugins {\r\n  private static readonly _plugins: { [key: string]: typeof Plugin } = {};\r\n\r\n  static register(name: string, plugin: typeof Plugin) {\r\n    if (this._plugins[name]) {\r\n      console.warn(\"Plugin already registered:\", plugin);\r\n      return;\r\n    }\r\n    this._plugins[name] = plugin;\r\n  }\r\n\r\n  static get<T extends Plugin>(name: string): T {\r\n    return this._plugins[name] as any as T;\r\n  }\r\n\r\n  static instantiate<T extends Plugin>(\r\n    id: string,\r\n    audioClock: AudioClock,\r\n    mixer: Mixer\r\n  ) {\r\n    return new (this.get(id) as any)(audioClock, mixer) as T;\r\n  }\r\n}\r\n","export abstract class MathHelpers {\r\n  static linearToGain(linearValue: number): number {\r\n    const clampedValue = Math.max(0, Math.min(1, linearValue));\r\n    const dBValue = clampedValue * 80 - 80;\r\n    const gain = Math.pow(10, dBValue / 20);\r\n\r\n    return gain;\r\n  }\r\n}\r\n","import { MathHelpers } from \"../abstracts/MathHelpers\";\r\nimport { IMixer, IMixerChannel } from \"../schema\";\r\nimport { Effect } from \"./components/Effect\";\r\n\r\nexport class MixerChannel implements IMixerChannel {\r\n  gainNode: GainNode;\r\n  mute = false;\r\n  solo = false;\r\n  effects: Effect[] = [];\r\n\r\n  get gain() {\r\n    return this.gainNode.gain.value;\r\n  }\r\n\r\n  constructor(\r\n    readonly audioContext: AudioContext,\r\n    public label: string,\r\n    gain = 1,\r\n    readonly outputs: number[] = [0]\r\n  ) {\r\n    this.gainNode = audioContext.createGain();\r\n    this.gainNode.gain.value = MathHelpers.linearToGain(gain);\r\n  }\r\n}\r\n\r\nexport class Mixer implements IMixer {\r\n  channels: MixerChannel[] = [];\r\n\r\n  constructor(readonly audioContext: AudioContext) {\r\n    const master = new MixerChannel(audioContext, \"Master\", 1);\r\n    master.gainNode.connect(audioContext.destination);\r\n    this.channels.push(master);\r\n    for (let i = 1; i <= 16; i++) {\r\n      const channel = new MixerChannel(audioContext, i.toString());\r\n      channel.gainNode.connect(master.gainNode);\r\n      this.channels.push(channel);\r\n    }\r\n  }\r\n}\r\n","import EventObject from \"../../../elements/src/EventObject\";\r\nimport { Instrument } from \"../abstracts/Instrument\";\r\nimport { Plugins } from \"../plugins/plugins\";\r\nimport { IPattern, IPlaylist, IProject, ITrackOptions } from \"../schema\";\r\nimport { IInstrument } from \"./IInstrument\";\r\nimport { Mixer } from \"./Mixer\";\r\nimport { AudioClock } from \"./components/AudioClock\";\r\n\r\nexport class Project extends EventObject<\"update\"> implements IProject {\r\n  title = \"Untitled\";\r\n  description = \"\";\r\n  tempo = 120;\r\n  instruments: Instrument[] = [];\r\n  patterns: IPattern[] = [];\r\n  tracks: ITrackOptions[] = [];\r\n  playlist: IPlaylist = { events: [] };\r\n  readonly mixer: Mixer;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    project?: IProject\r\n  ) {\r\n    super();\r\n    if (project) {\r\n      setTimeout(() => {\r\n        this.load(project);\r\n      }, 0);\r\n    }\r\n\r\n    this.mixer = new Mixer(audioClock.audioContext);\r\n\r\n    audioClock.on(\"start\", () => {\r\n      console.log(\"DEBUG START\", this.playlist);\r\n      for (const event of this.playlist.events) {        \r\n        // const e = event.value as IPattern;\r\n        console.log(\"DEBUG ITEM\", event.start, event);\r\n      }\r\n    });\r\n  }\r\n\r\n  serialize(): string {\r\n    return JSON.stringify({\r\n      title: this.title,\r\n      description: this.description,\r\n      tempo: this.tempo,\r\n      instruments: this.instruments.map((instrument) => {\r\n        return {\r\n          name: instrument.name,\r\n          controllerGroups: instrument.controllerGroups,\r\n        };\r\n      }),\r\n      patterns: this.patterns,\r\n      timeline: this.playlist,\r\n    });\r\n  }\r\n\r\n  deserialize(data: string): void {\r\n    console.log(\"Project deserialize\", data);\r\n    const project = JSON.parse(data) as IProject;\r\n\r\n    // TODO error checking\r\n\r\n    this.load(project);\r\n  }\r\n\r\n  load(project: IProject): void {\r\n    console.log(\"Project load\", project);\r\n\r\n    this.title = project.title;\r\n    this.description = project.description;\r\n    this.tempo = project.tempo;\r\n    this.patterns = project.patterns;\r\n    this.playlist = project.playlist;\r\n    this.instruments = [];\r\n\r\n    for (const instrument of project.instruments as IInstrument[]) {\r\n      console.log(\"loading instrument\", instrument);\r\n      const T = Plugins.get(instrument.id);\r\n      const instance: typeof T = Plugins.instantiate<typeof T>(\r\n        instrument.id,\r\n        this.audioClock,\r\n        this.mixer\r\n      );\r\n      this.instruments.push(instance as Instrument);\r\n    }\r\n\r\n    console.log(\"emitting update...\");\r\n    this.emit(\"update\", { type: \"project\", value: this });\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\nimport type { WindowContainer } from \"./WindowContainer\";\r\n\r\nexport class WindowSnapPanel extends BaseElement<\"open\" | \"close\"> {\r\n  private _isOpen = false;\r\n\r\n  get isOpen() {\r\n    return this._isOpen;\r\n  }\r\n\r\n  constructor(readonly container: WindowContainer) {\r\n    super(\"div\", \"window-snap-panel\");\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.toggle();\r\n    });\r\n  }\r\n\r\n  open() {\r\n    if (!this._isOpen) {\r\n      this.domElement.classList.toggle(\"open\", true);\r\n      this._isOpen = true;\r\n      this.emit(\"open\");\r\n    }\r\n  }\r\n\r\n  close() {\r\n    if (this._isOpen) {\r\n      this.domElement.classList.toggle(\"open\", false);\r\n      this._isOpen = false;\r\n      this.emit(\"close\");\r\n    }\r\n  }\r\n\r\n  toggle() {\r\n    if (this._isOpen) {\r\n      this.close();\r\n    } else {\r\n      this.open();\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap, IDragEvent, IResizeEvent } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\nimport { DraggableWindow } from \"./DraggableWindow\";\r\nimport { WindowSnapPanel } from \"./WindowSnapPanel\";\r\n\r\nexport class WindowContainer extends BaseElement<\"update\"> {\r\n  private _activeWindow: DraggableWindow | null = null;\r\n\r\n  readonly windows: DraggableWindow<keyof EventDataMap>[] = [];\r\n  private _draggingWindow: DraggableWindow | null = null;\r\n  private _bottomPanel: WindowSnapPanel;\r\n  private _leftPanel: WindowSnapPanel;\r\n  private _rightPanel: WindowSnapPanel;\r\n  private _workspace: HTMLElement;\r\n\r\n  constructor() {\r\n    super(\"div\", \"window-container\");\r\n    //this.domElement.addEventListener(\"pointerdown\", () => {});\r\n\r\n    const topRow = document.createElement(\"div\");\r\n    topRow.classList.add(\"window-snap-row\");\r\n    this.domElement.appendChild(topRow);\r\n\r\n    const bottomRow = document.createElement(\"div\");\r\n    bottomRow.classList.add(\"window-snap-row\");\r\n    bottomRow.classList.add(\"bottom-row\");\r\n    this.domElement.appendChild(bottomRow);\r\n\r\n    this._leftPanel = new WindowSnapPanel(this);\r\n    topRow.appendChild(this._leftPanel.domElement);\r\n\r\n    this._workspace = document.createElement(\"div\");\r\n    this._workspace.classList.add(\"window-container-workspace\");\r\n    topRow.appendChild(this._workspace);\r\n\r\n    this._rightPanel = new WindowSnapPanel(this);\r\n    topRow.appendChild(this._rightPanel.domElement);\r\n\r\n    this._bottomPanel = new WindowSnapPanel(this);\r\n    bottomRow.appendChild(this._bottomPanel.domElement);\r\n  }\r\n\r\n  private _handleWindowDrag(e: IDragEvent) {\r\n    // console.log(\"drag\", e);\r\n    const elt = e.target.domElement;\r\n    const workspaceWidth = this._workspace.getBoundingClientRect().width;\r\n    if (elt.parentElement === this._workspace) {\r\n      const leftPanelWidth =\r\n        this._leftPanel.domElement.getBoundingClientRect().width;\r\n      if (e.event.clientX <= Math.max(0, leftPanelWidth)) {\r\n        const panelWidth = leftPanelWidth || 300;\r\n        this._leftPanel.domElement.appendChild(elt);\r\n        elt.style.width = `${panelWidth}px`;\r\n        elt.style.height = \"unset\";\r\n        elt.classList.toggle(\"snap\", true);\r\n      } else {\r\n        const rightPanelWidth =\r\n          this._rightPanel.domElement.getBoundingClientRect().width;\r\n        if (\r\n          e.event.clientX + Math.max(250, rightPanelWidth) >\r\n          workspaceWidth + rightPanelWidth + leftPanelWidth\r\n        ) {\r\n          const panelWidth = rightPanelWidth || 300;\r\n          this._rightPanel.domElement.appendChild(elt);\r\n          elt.style.width = `${panelWidth}px`;\r\n          elt.style.height = \"unset\";\r\n          elt.classList.toggle(\"snap\", true);\r\n        }\r\n      }\r\n    } else {\r\n      if (\r\n        elt.parentElement === this._leftPanel.domElement &&\r\n        (e.event.target as HTMLElement) === this._workspace\r\n      ) {\r\n        this._workspace.appendChild(elt);\r\n        elt.classList.toggle(\"snap\", false);\r\n        elt.style.left = e.event.clientX + \"px\";\r\n        const win = e.target as DraggableWindow;\r\n        win.resetDragOffset();\r\n        win.setSize(win.options.width!, win.options.height!);\r\n      } else if (\r\n        elt.parentElement === this._rightPanel.domElement &&\r\n        (e.event.target as HTMLElement) === this._workspace\r\n      ) {\r\n        this._workspace.appendChild(elt);\r\n        elt.classList.toggle(\"snap\", false);\r\n        elt.style.left = workspaceWidth + \"px\";\r\n        const win = e.target as DraggableWindow;\r\n        win.resetDragOffset();\r\n        win.setSize(win.options.width!, win.options.height!);\r\n      }\r\n    }\r\n  }\r\n\r\n  private _handleWindowResize(e: IResizeEvent) {\r\n    for (const win of this.windows) {\r\n      if (\r\n        win.domElement !== e.target.domElement &&\r\n        win.domElement.parentElement !== this._workspace &&\r\n        win.domElement.parentElement === e.target.domElement.parentElement\r\n      ) {\r\n        win.domElement.style.width = `${e.width}px`;\r\n      }\r\n    }\r\n  }\r\n\r\n  addWindow<T extends DraggableWindow>(window: T) {\r\n    if (this.windows.includes(window)) {\r\n      console.warn(\"Window already added\", window);\r\n      return;\r\n    }\r\n    window.on(\"drag\", (e) => this._handleWindowDrag(e as IDragEvent));\r\n    window.on(\"resize\", (e) => this._handleWindowResize(e as IResizeEvent));\r\n    this.windows.push(window);\r\n    this._workspace.appendChild(window.domElement);\r\n    if (!this._activeWindow) {\r\n      this._activeWindow = window;\r\n      this.activateWindow(window);\r\n    }\r\n\r\n    window.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.activateWindow(window);\r\n    });\r\n\r\n    window.on(\"open\", () => {\r\n      this.activateWindow(window);\r\n    });\r\n\r\n    window.on(\"close\", () => {\r\n      if (this._activeWindow === window) {\r\n        this._activeWindow = null;\r\n      }\r\n    });\r\n  }\r\n\r\n  activateWindow(window: DraggableWindow) {\r\n    if (this._activeWindow === window) {\r\n      return;\r\n    }\r\n\r\n    this._activeWindow = window;\r\n\r\n    for (const w of this.windows) {\r\n      w.domElement.classList.toggle(\"active\", w === window);\r\n      w.domElement.style.zIndex = w === window ? \"1\" : \"0\";\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class PopupNotification extends BaseElement<\"close\"> {\r\n  private readonly _closeButton: HTMLButtonElement;\r\n\r\n  constructor(title: string, options?: NotificationOptions | undefined) {\r\n    super(\"div\", \"notification\");\r\n\r\n    this.domElement.style.display = \"hidden\";\r\n\r\n    const titleElt = document.createElement(\"h1\");\r\n    const messageElt = document.createElement(\"p\");\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.textContent = \"\";\r\n    const onclick = () => {\r\n      this._closeButton.removeEventListener(\"click\", onclick);\r\n      this.dispose();\r\n      this.emit(\"close\");\r\n    };\r\n    this._closeButton.addEventListener(\"click\", onclick);\r\n\r\n    if (options?.body) {\r\n      messageElt.textContent = options.body;\r\n    }\r\n\r\n    titleElt.textContent = title;\r\n\r\n    this.domElement.appendChild(titleElt);\r\n    this.domElement.appendChild(messageElt);\r\n    this.domElement.appendChild(this._closeButton);\r\n\r\n    document.body.appendChild(this.domElement);\r\n  }\r\n}\r\n","export const DEFAULT_NOTE_HEIGHT = 20;\r\n\r\nexport const BOTTOM_ROW = [\r\n  90, 83, 88, 68, 67, 86, 71, 66, 72, 78, 74, 77, 188, 76, 190, 59, 191,\r\n];\r\n\r\nexport const TOP_ROW = [\r\n  81, 50, 87, 51, 69, 82, 53, 84, 54, 89, 55, 85, 73, 57, 79, 48, 80, 219, 61,\r\n  221,\r\n];\r\n\r\nexport const KEY_COLORS = [\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"white\",\r\n  \"black\",\r\n  \"white\",\r\n  \"black\",\r\n];\r\n\r\nexport const NOTE_NAMES = [\r\n  \"A\",\r\n  \"A#\",\r\n  \"B\",\r\n  \"C\",\r\n  \"C#\",\r\n  \"D\",\r\n  \"D#\",\r\n  \"E\",\r\n  \"F\",\r\n  \"F#\",\r\n  \"G\",\r\n  \"G#\",\r\n];\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { PopupNotification } from \"../../../../elements/src/elements/PopupNotification\";\r\nimport { BOTTOM_ROW, TOP_ROW } from \"../../constants\";\r\n\r\nlet midiAccess: MIDIAccess | null = null;\r\n\r\nexport interface IKeyboardEvent {\r\n  type: \"press\" | \"release\";\r\n  note: number;\r\n}\r\n\r\nfunction keyToNote(keyCode: number) {\r\n  let note = -1;\r\n\r\n  if (BOTTOM_ROW.includes(keyCode)) {\r\n    note = BOTTOM_ROW.indexOf(keyCode);\r\n  } else if (TOP_ROW.includes(keyCode)) {\r\n    note = TOP_ROW.indexOf(keyCode) + 12;\r\n  }\r\n\r\n  return note;\r\n}\r\n\r\nexport class Keyboard extends BaseElement<\"update\"> {\r\n  constructor() {\r\n    super(\"div\", \"keyboard\");\r\n\r\n    if (!midiAccess) {\r\n      navigator\r\n        .requestMIDIAccess()\r\n        .then((midi) => {\r\n          console.log(\"MIDI Access\", midi);\r\n          midiAccess = midi;\r\n          midi.inputs.forEach((entry) => {\r\n            entry.onmidimessage = (e) => this.handleMIDI(e);\r\n          });\r\n        })\r\n        .catch((e) => {\r\n          console.error(\"MIDI Access error\", e);\r\n          new PopupNotification(\"MIDI Access error\", { body: e.message });\r\n        });\r\n    }\r\n\r\n    const pressedKeys: number[] = [];\r\n\r\n    window.addEventListener(\"keydown\", (event) => {\r\n      //console.log(event.key, event.keyCode);\r\n\r\n      if (event.ctrlKey || event.altKey || event.shiftKey) return;\r\n\r\n      const target = event.target as HTMLElement;\r\n      if (target.tagName == \"INPUT\") return;\r\n\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || pressedKeys.includes(note)) return;\r\n\r\n      pressedKeys.push(note);\r\n      this.emit(\"update\", { type: \"press\", note });\r\n    });\r\n\r\n    window.addEventListener(\"keyup\", (event) => {\r\n      const note = keyToNote(event.keyCode);\r\n      if (note === -1 || !pressedKeys.includes(note)) return;\r\n\r\n      pressedKeys.splice(pressedKeys.indexOf(note), 1);\r\n      this.emit(\"update\", { type: \"release\", note });\r\n    });\r\n  }\r\n\r\n  private handleMIDI(event: MIDIMessageEvent) {\r\n    console.log(\"MIDI\", event.data?.length, \"bytes\", event.data);\r\n    if (event.data === null || event.data.length < 3) return;\r\n\r\n    // event.data is a uint8array\r\n\r\n    const statusByte = event.data[0];\r\n    const eventType = statusByte & 0xf0;\r\n    const channel = statusByte & 0x0f;\r\n\r\n    const dataByte1 = event.data[1];\r\n    const dataByte2 = event.data[2];\r\n\r\n    if (eventType === 0x90 && dataByte2 !== 0) {\r\n      // Note On event\r\n      const note = dataByte1 - 36;\r\n      const velocity = dataByte2;\r\n      this.emit(\"update\", { type: \"press\", note, velocity });\r\n    } else if (eventType === 0x80 || (eventType === 0x90 && dataByte2 === 0)) {\r\n      // Note Off event\r\n      const note = dataByte1 - 36;\r\n      this.emit(\"update\", { type: \"release\", note });\r\n    } else if (eventType === 0xb0) {\r\n      // Control Change event\r\n      const control = dataByte1;\r\n      const value = dataByte2;\r\n      // Process the control change event\r\n      console.log(\"Control Change\", control, value);\r\n    }\r\n  }\r\n}\r\n","import { EventDataMap, IResizeEvent } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class SizableElement<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"resize\" | T> {\r\n  private _resizing = false;\r\n  private _startX = 0;\r\n  private _startY = 0;\r\n  private _startWidth = 0;\r\n  private _startHeight = 0;\r\n  private _startTop = 0;\r\n  private _startLeft = 0;\r\n\r\n  private _resizeDirection: \"top\" | \"right\" | \"bottom\" | \"left\" | null = null;\r\n\r\n  constructor(tagName: string, className?: string) {\r\n    super(tagName, className);\r\n\r\n    this.domElement.addEventListener(\"pointermove\", (e) => {\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle === \"top\" || handle === \"bottom\") {\r\n        this.domElement.style.cursor = \"ns-resize\";\r\n      } else if (handle === \"left\" || handle === \"right\") {\r\n        this.domElement.style.cursor = \"ew-resize\";\r\n      } else {\r\n        this.domElement.style.cursor = \"auto\";\r\n      }\r\n    });\r\n\r\n    const onmove = (e: PointerEvent) => {\r\n      if (this._resizing) {\r\n        console.log(this._resizeDirection);\r\n\r\n        const dx = e.clientX - this._startX;\r\n        const dy = e.clientY - this._startY;\r\n\r\n        if (this._resizeDirection === \"right\") {\r\n          this.domElement.style.width = `${this._startWidth + dx}px`;\r\n        } else if (this._resizeDirection === \"bottom\") {\r\n          this.domElement.style.height = `${this._startHeight + dy}px`;\r\n        } else if (this._resizeDirection === \"left\") {\r\n          this.domElement.style.width = `${this._startWidth - dx}px`;\r\n          this.domElement.style.left = `${this._startLeft + dx}px`;\r\n        } else if (this._resizeDirection === \"top\") {\r\n          this.domElement.style.height = `${this._startHeight - dy}px`;\r\n          this.domElement.style.top = `${this._startTop + dy}px`;\r\n        }\r\n\r\n        const event: IResizeEvent = {\r\n          target: this,\r\n          width: this.domElement.offsetWidth,\r\n          height: this.domElement.offsetHeight,\r\n          event: e,\r\n        };\r\n        this.emit(\"resize\", event);\r\n      }\r\n    };\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      if (e.button !== 0) return;\r\n      //if (e.target !== this.domElement) return;\r\n      const handle = this.getCurrentHandle(e);\r\n      if (handle) {\r\n        window.addEventListener(\"pointermove\", onmove);\r\n        this.startResize(e, handle);\r\n        e.preventDefault();\r\n      }\r\n      const onrelease = () => {\r\n        this.stopResize();\r\n        window.removeEventListener(\"pointermove\", onmove);\r\n        window.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      window.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n  }\r\n\r\n  protected startResize(\r\n    e: PointerEvent,\r\n    direction: \"top\" | \"right\" | \"bottom\" | \"left\"\r\n  ) {\r\n    console.log(\"startResize\", direction);\r\n    this._resizing = true;\r\n    this._startX = e.clientX;\r\n    this._startY = e.clientY;\r\n    this._startWidth = this.domElement.offsetWidth;\r\n    this._startHeight = this.domElement.offsetHeight;\r\n    this._startTop = this.domElement.offsetTop;\r\n    this._startLeft = this.domElement.offsetLeft;\r\n    this._resizeDirection = direction;\r\n  }\r\n\r\n  protected stopResize() {\r\n    this._resizing = false;\r\n    this._resizeDirection = null;\r\n  }\r\n\r\n  getCurrentHandle(e: PointerEvent) {\r\n    const rect = this.domElement.getBoundingClientRect();\r\n    const offsetX = e.clientX - rect.left;\r\n    const offsetY = e.clientY - rect.top;\r\n\r\n    if (offsetX > 0 && offsetX < 8) {\r\n      return \"left\";\r\n    } else if (rect.width - offsetX < 8) {\r\n      return \"right\";\r\n    } else if (offsetY > 0 && offsetY < 8) {\r\n      return \"top\";\r\n    } else if (rect.height - offsetY < 8) {\r\n      return \"bottom\";\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","import { EventDataMap, IDragEvent, IResizeEvent } from \"../EventObject\";\r\nimport { SizableElement } from \"./SizableElement\";\r\n\r\nexport interface IWindowOptions {\r\n  title: string;\r\n  content?: HTMLElement;\r\n  persistent?: boolean;\r\n  width?: number;\r\n  height?: number;\r\n  top?: number;\r\n  left?: number;\r\n}\r\n\r\ntype WindowEvents = \"update\" | \"resize\" | \"open\" | \"close\" | \"drag\";\r\n\r\nexport class DraggableWindow<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n> extends SizableElement<WindowEvents | T> {\r\n  readonly titlebar: HTMLElement;\r\n  readonly content: HTMLElement;\r\n  private readonly persistent;\r\n  private readonly _title: HTMLElement;\r\n  private readonly _closeButton: HTMLButtonElement;\r\n  private _isDragging = false;\r\n  private _dragOffsetX = 0;\r\n  private _dragOffsetY = 0;\r\n  private _top = 0;\r\n  private _left = 0;\r\n\r\n  get isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(readonly options: IWindowOptions) {\r\n    super(\"div\", \"draggable-window\");\r\n\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this._top = options.top || 0;\r\n    this._left = options.left || 0;\r\n\r\n    this.persistent = options.persistent || false;\r\n\r\n    this.titlebar = document.createElement(\"div\");\r\n    this.titlebar.className = \"window-titlebar\";\r\n    this.domElement.appendChild(this.titlebar);\r\n\r\n    this.on(\"resize\", (e) => {\r\n      const event = e as IResizeEvent;\r\n      this.options.width = event.width;\r\n      this.options.height = event.height;\r\n    });\r\n\r\n    this.titlebar.addEventListener(\"pointerdown\", (e) => {\r\n      this._isDragging = true;\r\n      this._dragOffsetX =\r\n        e.clientX -\r\n        this.domElement.getBoundingClientRect().left +\r\n        this.domElement.parentElement!.getBoundingClientRect().left;\r\n      this._dragOffsetY =\r\n        e.clientY -\r\n        this.domElement.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.getBoundingClientRect().top +\r\n        this.domElement.parentElement!.scrollTop;\r\n\r\n      const ondrag = (e: PointerEvent) => {\r\n        if (this._isDragging) {\r\n          let newTop = e.clientY - this._dragOffsetY;\r\n          const newLeft = e.clientX - this._dragOffsetX;\r\n\r\n          const deltaX = newLeft - this._left;\r\n          const deltaY = newTop - this._top;\r\n\r\n          if (newTop < 0) {\r\n            newTop = 0;\r\n          }\r\n\r\n          // if (newLeft < 0) {\r\n          //   newLeft = 0;\r\n          // }\r\n\r\n          this.domElement.style.top = `${newTop}px`;\r\n          this.domElement.style.left = `${newLeft}px`;\r\n\r\n          this._top = newTop;\r\n          this._left = newLeft;\r\n\r\n          const event: IDragEvent = {\r\n            target: this,\r\n            event: e,\r\n            top: newTop,\r\n            left: newLeft,\r\n            deltaX: deltaX,\r\n            deltaY: deltaY,\r\n          };\r\n\r\n          this.emit(\"drag\", event);\r\n        }\r\n      };\r\n\r\n      const onrelease = () => {\r\n        this._isDragging = false;\r\n        document.body.removeEventListener(\"pointermove\", ondrag);\r\n        document.body.removeEventListener(\"pointerup\", onrelease);\r\n      };\r\n\r\n      document.body.addEventListener(\"pointermove\", ondrag);\r\n      document.body.addEventListener(\"pointerup\", onrelease);\r\n    });\r\n\r\n    this._title = document.createElement(\"div\");\r\n    this._title.className = \"window-titlebar-title\";\r\n    this._title.textContent = options.title;\r\n    this.titlebar.appendChild(this._title);\r\n\r\n    this.content = document.createElement(\"div\");\r\n    this.content.className = \"window-content\";\r\n    this.domElement.appendChild(this.content);\r\n\r\n    this._closeButton = document.createElement(\"button\");\r\n    this._closeButton.className = \"window-close-button\";\r\n    this._closeButton.addEventListener(\"pointerdown\", (e) => {\r\n      if (e.button === 0) this.close();\r\n    });\r\n\r\n    this.titlebar.appendChild(this._closeButton);\r\n\r\n    const width = options.width || 640;\r\n    const height = options.height || 400;\r\n    this.setSize(width, height);\r\n\r\n    if (options.content) this.content.appendChild(options.content);\r\n  }\r\n\r\n  resetDragOffset() {\r\n    const rect = this.domElement.parentElement!.getBoundingClientRect();\r\n    this._dragOffsetX = rect.left + 100;\r\n    this._dragOffsetY = rect.top + 10;\r\n  }\r\n\r\n  show(x?: number, y?: number) {\r\n    if (x === undefined) x = this._left;\r\n    if (y === undefined) y = this._top;\r\n\r\n    this._top = y;\r\n    this._left = x;\r\n\r\n    if (this._top === 0 && this._left === 0) {\r\n      x = window.innerWidth / 2 - 200;\r\n      y = window.innerHeight / 4;\r\n    }\r\n\r\n    this.domElement.style.display = \"flex\";\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n\r\n    setTimeout(() => {\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n      this.emit(\"open\");\r\n    }, 1);\r\n  }\r\n\r\n  close() {\r\n    this.domElement.style.display = \"none\";\r\n    this.emit(\"close\");\r\n    if (!this.persistent) {\r\n      console.log(\"Removing window\", this);\r\n      this.domElement.remove();\r\n    }\r\n  }\r\n\r\n  setSize(width: number, height: number) {\r\n    this.options.width = width;\r\n    this.options.height = height;\r\n    this.domElement.style.width = `${width}px`;\r\n    this.domElement.style.height = `${height}px`;\r\n  }\r\n\r\n  setPosition(x: number, y: number) {\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.left = `${x}px`;\r\n  }\r\n\r\n  setTitle(title: string) {\r\n    this._title.textContent = title;\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\nimport { SelectableElement } from \"./SelectableElement\";\r\n\r\nexport class SelectableGroup<\r\n  T extends SelectableElement = SelectableElement,\r\n> extends BaseElement<\"select\"> {\r\n  constructor(readonly items: T[] = []) {\r\n    super(\"div\", \"selectable-group\");\r\n    for (const item of items) {\r\n      this.addSelectable(item, false);\r\n    }\r\n  }\r\n\r\n  addSelectable(selectable: T, addToDom = true) {\r\n    if (this.items.indexOf(selectable) !== -1) {\r\n      console.warn(\"Already added\", selectable);\r\n    } else {\r\n      this.items.push(selectable);\r\n      selectable.on(\"select\", () => {\r\n        this.emit(\"select\", this);\r\n      });\r\n      if (addToDom) this.domElement.appendChild(selectable.domElement);\r\n\r\n      selectable.domElement.addEventListener(\"pointerdown\", (e) => {        \r\n        if (!e.ctrlKey && !e.shiftKey) {\r\n          for (const item of this.items) {\r\n            item.selected = item === selectable;\r\n          }\r\n        } else if (e.ctrlKey) {\r\n          selectable.selected = !selectable.selected;\r\n        } else if (e.shiftKey) {\r\n          const f = this.items.find((t) => t.selected);\r\n          if (!f) {\r\n            selectable.selected = true;\r\n            return;\r\n          }\r\n          const start = this.items.indexOf(f);\r\n          const end = this.items.indexOf(selectable);\r\n          const min = Math.min(start, end);\r\n          const max = Math.max(start, end);\r\n          for (let i = min; i <= max; i++) {\r\n            this.items[i].selected = true;\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  removeSelectable(selectable: T) {\r\n    const index = this.items.indexOf(selectable);\r\n    if (index !== -1) {\r\n      this.items.splice(index, 1);\r\n      this.domElement.removeChild(selectable.domElement);\r\n    }\r\n  }\r\n\r\n  clear() {\r\n    for (const item of this.items) {\r\n      this.domElement.removeChild(item.domElement);\r\n    }\r\n    this.items.length = 0;\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\nimport { SelectableGroup } from \"./SelectableGroup\";\r\n\r\nexport class SelectableElement<\r\n  T extends keyof EventDataMap = keyof EventDataMap,\r\n> extends BaseElement<\"select\" | T> {\r\n  get selected() {\r\n    return this.domElement.classList.contains(\"selected\");\r\n  }\r\n\r\n  set selected(value: boolean) {\r\n    if (value === this.selected) return;\r\n    this.domElement.classList.toggle(\"selected\", value);\r\n    this.emit(\"select\", this);\r\n  }\r\n\r\n  constructor(\r\n    readonly group: SelectableGroup<SelectableElement>,\r\n    tagName: string,\r\n    className?: string\r\n  ) {\r\n    super(tagName, className);\r\n    this.group.addSelectable(this);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\n\r\nexport class MuteSoloButtons extends BaseElement<\"change\"> {\r\n  private _mute: boolean = false;\r\n  private _solo: boolean = false;\r\n  private _muteButton: HTMLDivElement;\r\n  private _soloButton: HTMLDivElement;\r\n\r\n  get mute() {\r\n    return this._mute;\r\n  }\r\n\r\n  set mute(value: boolean) {\r\n    this._mute = value;\r\n    this._muteButton.classList.toggle(\"active\", this._mute);\r\n  }\r\n\r\n  get solo() {\r\n    return this._solo;\r\n  }\r\n\r\n  set solo(value: boolean) {\r\n    this._solo = value;\r\n    this._soloButton.classList.toggle(\"active\", this._solo);\r\n  }\r\n\r\n  constructor() {\r\n    super(\"div\", \"track-buttons\");\r\n\r\n    const mute = document.createElement(\"div\");\r\n    this._muteButton = mute;\r\n    mute.classList.add(\"track-button\");\r\n    mute.classList.add(\"track-mute-button\");\r\n    mute.textContent = \"M\";\r\n    mute.addEventListener(\"pointerdown\", () => {\r\n      this._mute = !this._mute;\r\n      mute.classList.toggle(\"active\", this._mute);\r\n      this.emit(\"change\");\r\n    });\r\n    this.domElement.appendChild(mute);\r\n\r\n    const solo = document.createElement(\"div\");\r\n    this._soloButton = solo;\r\n    solo.classList.add(\"track-button\");\r\n    solo.classList.add(\"track-solo-button\");\r\n    solo.textContent = \"S\";\r\n    solo.addEventListener(\"pointerdown\", () => {\r\n      this._solo = !this._solo;\r\n      solo.classList.toggle(\"active\", this._solo);\r\n      this.emit(\"change\");\r\n    });\r\n    this.domElement.appendChild(solo);\r\n  }\r\n}\r\n","import { SelectableElement } from \"../../../../elements/src/elements/SelectableElement\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { IMixerChannel } from \"../../schema\";\r\nimport { Effect } from \"./Effect\";\r\nimport { MuteSoloButtons } from \"./MuteSoloButtons\";\r\n\r\nexport class MixerChannelStrip extends SelectableElement<\"change\"> {\r\n  private readonly _channel: IMixerChannel;\r\n  private readonly _volume: HTMLInputElement;\r\n  private readonly _label: HTMLSpanElement;\r\n  readonly muteSoloButtons: MuteSoloButtons;\r\n  readonly effects: Effect[] = [];\r\n\r\n  get channel() {\r\n    return this._channel;\r\n  }\r\n\r\n  get volume() {\r\n    return this._volume.valueAsNumber;\r\n  }\r\n\r\n  set volume(value: number) {\r\n    this._volume.value = value.toString();\r\n  }\r\n\r\n  get mute() {\r\n    return this.muteSoloButtons.mute;\r\n  }\r\n\r\n  set mute(value: boolean) {\r\n    if (value !== this.muteSoloButtons.mute) {\r\n      this.muteSoloButtons.mute = value;\r\n      this.channel.mute = value;\r\n    }\r\n  }\r\n\r\n  get solo() {\r\n    return this.muteSoloButtons.solo;\r\n  }\r\n\r\n  set solo(value: boolean) {\r\n    if (value !== this.muteSoloButtons.solo) {\r\n      this.muteSoloButtons.solo = value;\r\n      this.channel.solo = value;\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    group: SelectableGroup,\r\n    channel: IMixerChannel,\r\n    readonly isMaster = false\r\n  ) {\r\n    super(group, \"div\", \"mixer-channel\");\r\n\r\n    this._channel = channel;\r\n\r\n    this._label = document.createElement(\"span\");\r\n    this._label.textContent = channel.label;\r\n    this.domElement.appendChild(this._label);\r\n\r\n    const volume = document.createElement(\"input\");\r\n    volume.type = \"range\";\r\n    volume.min = \"0\";\r\n    volume.max = \"1.2\";\r\n    volume.step = \"0.01\";\r\n    volume.value = \"1\";\r\n\r\n    this._volume = volume;\r\n\r\n    this.domElement.appendChild(volume);\r\n\r\n    this.muteSoloButtons = new MuteSoloButtons();\r\n    this.domElement.appendChild(this.muteSoloButtons.domElement);\r\n\r\n    volume.addEventListener(\"input\", () => {\r\n      this.emit(\"change\");\r\n    });\r\n\r\n    this.muteSoloButtons.on(\"change\", () => {\r\n      this.emit(\"change\");\r\n    });\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport type { ProjectUI } from \"../ProjectUI\";\r\nimport { MixerChannelStrip } from \"../components/MixerChannelStrip\";\r\n\r\nexport class MixerWindow extends DraggableWindow {\r\n\r\n  readonly channels: SelectableGroup<MixerChannelStrip> = new SelectableGroup();\r\n\r\n  get mixer() {\r\n    return this.ui.project.mixer;\r\n  }\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    super({\r\n      title: \"Mixer\",\r\n      persistent: true,\r\n      content: document.createElement(\"div\"),\r\n      width: 500,\r\n      height: 300,\r\n    });\r\n\r\n    this.domElement.classList.add(\"mixer-window\");\r\n\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"mixer-container\");\r\n\r\n    const channelsContainer = document.createElement(\"div\");\r\n    channelsContainer.classList.add(\"mixer-channels-container\");\r\n\r\n    const effectsContainer = document.createElement(\"div\");\r\n    effectsContainer.classList.add(\"mixer-effects-container\");\r\n\r\n    container.appendChild(channelsContainer);\r\n    container.appendChild(effectsContainer);\r\n\r\n    this.content.appendChild(container);\r\n\r\n    console.log(\"MIXER CHANNELS DEBUG\", this.mixer.channels);\r\n\r\n    for (let i = 0; i < this.mixer.channels.length; i++) {\r\n      const channel = new MixerChannelStrip(this.channels, this.mixer.channels[i], i === 0);\r\n      this.mixer.channels[i].gainNode.gain.value = channel.volume;\r\n      channel.on(\"change\", () => {\r\n        this.mixer.channels[i].gainNode.gain.value = channel.volume;\r\n      });\r\n      channelsContainer.appendChild(channel.domElement);\r\n    }\r\n\r\n    this.channels.items[0].selected = true;\r\n  }\r\n}\r\n","import { AudioClock } from \"./AudioClock\";\r\n\r\nexport interface ICursorTimeline {\r\n  domElement: HTMLElement;\r\n  timeline: HTMLElement;\r\n  cursor: AudioCursor;\r\n  audioClock: AudioClock;\r\n  beatWidth: number;\r\n}\r\n\r\nexport class AudioCursor {\r\n  readonly domElement: HTMLDivElement;\r\n\r\n  constructor(readonly timeline: ICursorTimeline) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-cursor\");\r\n\r\n    const clock = timeline.audioClock;\r\n\r\n    clock.on(\"update\", () => {\r\n      this.update();\r\n    });\r\n\r\n    clock.on(\"start\", () => {\r\n      this.domElement.style.transform = \"translateX(0)\";\r\n      this.domElement.style.display = \"block\";\r\n      this.domElement.parentElement?.appendChild(this.domElement);\r\n    });\r\n\r\n    clock.on(\"stop\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n  }\r\n\r\n  update() {\r\n    this.domElement.style.transform = `translateX(${\r\n      this.timeline.audioClock.currentBeat * this.timeline.beatWidth\r\n    }px)`;\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","export async function triggerActive(elt: HTMLElement, timeout = 100) {  \r\n  elt.classList.toggle(\"active\", true);\r\n  setTimeout(() => {\r\n    elt.classList.toggle(\"active\", false);\r\n  }, timeout);\r\n}\r\n","import { triggerActive } from \"../../../../elements/src/animation\";\r\nimport { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { SelectableElement } from \"../../../../elements/src/elements/SelectableElement\";\r\nimport type { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport type { Instrument } from \"../../abstracts/Instrument\";\r\nimport type { IEvent, ISequence } from \"../../schema\";\r\nimport type { Project } from \"../Project\";\r\nimport { MuteSoloButtons } from \"./MuteSoloButtons\";\r\nimport type { ISourceEvent } from \"./SamplerSlot\";\r\n\r\nexport class PatternTrackInstrument extends SelectableElement {\r\n  readonly indicator: HTMLDivElement;\r\n  readonly muteSoloButtons: MuteSoloButtons;\r\n\r\n  constructor(\r\n    readonly track: PatternTrack,\r\n    buttonGroup: SelectableGroup\r\n  ) {\r\n    console.assert(track, \"PatternTrackInstrument track is null or undefined\");\r\n\r\n    super(buttonGroup, \"div\", \"pattern-track-instrument\");\r\n\r\n    this.domElement.classList.add(\"pattern-track-panel\");\r\n\r\n    const labelAndButtons = document.createElement(\"div\");\r\n    labelAndButtons.classList.add(\"pattern-track-label-and-buttons\");\r\n\r\n    const textLabel = document.createElement(\"div\");\r\n    textLabel.textContent = track.name;\r\n    labelAndButtons.appendChild(textLabel);\r\n\r\n    this.muteSoloButtons = new MuteSoloButtons();\r\n    this.muteSoloButtons.on(\"change\", () => {\r\n      track.mute = this.muteSoloButtons.mute;\r\n      track.solo = this.muteSoloButtons.solo;\r\n    });\r\n\r\n    labelAndButtons.appendChild(this.muteSoloButtons.domElement);\r\n\r\n    this.domElement.appendChild(labelAndButtons);\r\n\r\n    const edit = document.createElement(\"div\");\r\n    edit.classList.add(\"track-button\");\r\n    edit.classList.add(\"track-edit-button\");\r\n    edit.textContent = \"e\";\r\n\r\n    const win = this.track.instrument.window!;\r\n\r\n    edit.addEventListener(\"pointerdown\", () => {\r\n      if (win.isVisible) {\r\n        win.close();\r\n      } else {\r\n        win.show();\r\n      }\r\n    });\r\n    win.on(\"close\", () => {\r\n      edit.classList.toggle(\"active\", false);\r\n    });\r\n    win.on(\"open\", () => {\r\n      edit.classList.toggle(\"active\", true);\r\n    });\r\n    this.muteSoloButtons.domElement.appendChild(edit);\r\n\r\n    this.indicator = document.createElement(\"div\");\r\n    this.indicator.classList.add(\"pattern-track-indicator\");\r\n    this.domElement.appendChild(this.indicator);\r\n  }\r\n}\r\n\r\nexport class PatternTrackPreview extends BaseElement {\r\n  private _canvas: HTMLCanvasElement;\r\n\r\n  get canvas() {\r\n    return this._canvas;\r\n  }\r\n\r\n  constructor(readonly track: PatternTrack) {\r\n    console.assert(track, \"PatternTrackPreview track is null or undefined\");\r\n\r\n    super(\"div\", \"pattern-track-preview\");\r\n    this._canvas = document.createElement(\"canvas\");\r\n    this._canvas.height = 60;\r\n    this._canvas.width = 1280;\r\n    this._canvas.classList.add(\"pattern-track-pattern\");\r\n\r\n    this.domElement.append(this._canvas);\r\n  }\r\n}\r\n\r\nexport class PatternTrack extends BaseElement implements ISequence {\r\n  readonly button: PatternTrackInstrument;\r\n  readonly preview: PatternTrackPreview;\r\n  port: number | null = null;\r\n  channel: number = 0;\r\n\r\n  get mute() {\r\n    return this.button.muteSoloButtons.mute;\r\n  }\r\n\r\n  set mute(value: boolean) {\r\n    this.button.muteSoloButtons.mute = value;\r\n  }\r\n\r\n  get solo() {\r\n    return this.button.muteSoloButtons.solo;\r\n  }\r\n\r\n  set solo(value: boolean) {\r\n    this.button.muteSoloButtons.solo = value;\r\n  }\r\n\r\n  get name() {\r\n    return this.instrument.name;\r\n  }\r\n\r\n  constructor(\r\n    readonly project: Project,\r\n    public instrument: Instrument,\r\n    public events: IEvent[],\r\n    readonly buttonGroup: SelectableGroup,\r\n    readonly previewGroup: SelectableGroup\r\n  ) {\r\n    super(\"div\", \"pattern-track\");\r\n\r\n    this.button = new PatternTrackInstrument(this, this.buttonGroup);\r\n    this.preview = new PatternTrackPreview(this);\r\n\r\n    this.domElement.appendChild(this.button.domElement);\r\n    this.domElement.appendChild(this.preview.domElement);\r\n  }\r\n\r\n  trigger(note: number, beat: number = this.project.audioClock.currentBeat) {\r\n    const source = this.instrument.trigger(note, this.channel, beat);\r\n    if (beat > 0) {\r\n      this.project.audioClock.scheduleEventAtBeat(() => {\r\n        triggerActive(this.button.indicator);\r\n      }, beat);\r\n    } else {\r\n      triggerActive(this.button.indicator);\r\n    }\r\n    return source;\r\n  }\r\n\r\n  release(note: number, beat: number = this.project.audioClock.currentBeat) {\r\n    this.instrument.release(note, beat);\r\n  }\r\n\r\n  load(sequence: ISequence) {\r\n    this.events = sequence.events;\r\n  }\r\n\r\n  playback() {\r\n    if (!this.project.audioClock.isPlaying) {\r\n      console.warn(\"Playback cancelled\");\r\n      return;\r\n    }\r\n\r\n    let sourceEvent: ISourceEvent | undefined = undefined;\r\n\r\n    for (const event of this.events) {\r\n      if (!(event.note || event.note === 0)) {\r\n        console.warn(\"Missing note property in event object\");\r\n        continue;\r\n      }\r\n\r\n      sourceEvent = this.trigger(event.note, event.start);\r\n      if (event.domElement) {\r\n        this.project.audioClock.scheduleEventAtBeat(\r\n          () => event.domElement!.classList.toggle(\"active\", true),\r\n          event.start\r\n        );\r\n        this.project.audioClock.scheduleEventAtBeat(\r\n          () => event.domElement!.classList.toggle(\"active\", false),\r\n          event.start + event.duration\r\n        );\r\n      }\r\n    }\r\n\r\n    if (typeof sourceEvent !== \"undefined\" && \"source\" in sourceEvent) {\r\n      sourceEvent.source.onended = () => {\r\n        const nextLoop =\r\n          this.project.audioClock.currentBeat +\r\n          (4 - (this.project.audioClock.currentBeat % 4));\r\n        this.project.audioClock.scheduleEventAtBeat(() => {\r\n          this.project.audioClock.restart();\r\n          this.playback();\r\n        }, nextLoop);\r\n      };\r\n    }\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { Instrument } from \"../../abstracts/Instrument\";\r\nimport { IEvent, IPattern } from \"../../schema\";\r\nimport { Project } from \"../Project\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"../components/AudioCursor\";\r\nimport {\r\n  PatternTrack,\r\n  PatternTrackInstrument,\r\n  PatternTrackPreview,\r\n} from \"../components/PatternTrack\";\r\n\r\nexport class PatternWindow\r\n  extends DraggableWindow<\"select\" | \"edit\">\r\n  implements ICursorTimeline\r\n{\r\n  readonly trackContainer: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLDivElement;\r\n  readonly tracks: PatternTrack[] = [];\r\n  readonly patternPreviews: SelectableGroup;\r\n  readonly buttons: SelectableGroup;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.ui.project.audioClock;\r\n  }\r\n\r\n  beatWidth = 20;\r\n\r\n  constructor(public ui: ProjectUI) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"pattern-track-container\");\r\n\r\n    super({\r\n      title: \"Pattern\",\r\n      persistent: true,\r\n      content: container,\r\n      width: 400,\r\n      height: 400,\r\n    });\r\n    this.trackContainer = container;\r\n\r\n    this.timeline = this.trackContainer;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.style.marginLeft = \"150px\";\r\n    this.timeline.appendChild(this.cursor.domElement);\r\n\r\n    const canvas = this.domElement.querySelector(\"canvas\");\r\n    if (canvas) this.beatWidth = canvas.width / 16;\r\n\r\n    this.on(\"resize\", () => {\r\n      this.beatWidth = this.domElement.clientWidth / 16;\r\n    });\r\n\r\n    this.addPattern(\"Pattern 1\");\r\n\r\n    this.patternPreviews = new SelectableGroup();\r\n    this.buttons = new SelectableGroup<PatternTrackInstrument>();\r\n  }\r\n\r\n  loadProject(project: Project) {\r\n    for (const track of this.tracks) {\r\n      this.trackContainer.removeChild(track.domElement);\r\n    }\r\n    this.tracks.length = 0;\r\n    for (let i = 0; i < project.instruments.length; i++) {\r\n      const track = this.addTrack(\r\n        project.instruments[i],\r\n        project.patterns[0]?.tracks[i].events || []\r\n      );\r\n      track.load(project.patterns[0].tracks[i]);\r\n      if (i === 0) {\r\n        track.button.selected = true;\r\n      }\r\n    }\r\n  }\r\n\r\n  addPattern(name: string) {\r\n    console.log(\"Created pattern:\", name);\r\n    const pattern: IPattern = { name, tracks: [] };\r\n    this.ui.project.patterns.push(pattern);\r\n  }\r\n\r\n  addTrack(instrument: Instrument, events: IEvent[]) {\r\n    console.log(\"Add track + instrument:\", instrument);\r\n\r\n    const track = new PatternTrack(\r\n      this.ui.project,\r\n      instrument,\r\n      events,\r\n      this.buttons,\r\n      this.patternPreviews\r\n    );\r\n\r\n    instrument.output.connect(this.ui.mixerWindow.mixer.channels[0].gainNode);\r\n\r\n    console.assert(\r\n      track.button instanceof PatternTrackInstrument,\r\n      \"button is not an instance of PatternTrackInstrument\"\r\n    );\r\n    console.assert(\r\n      track.preview instanceof PatternTrackPreview,\r\n      \"preview is not an instance of PatternTrackPreview\"\r\n    );\r\n\r\n    track.preview.domElement.addEventListener(\"pointerdown\", () => {\r\n      this.ui.pianoRollWindow.loadTrack(track);\r\n      this.ui.pianoRollWindow.show();\r\n    });\r\n\r\n    this.tracks.push(track);\r\n    this.trackContainer.appendChild(track.domElement);\r\n\r\n    return track;\r\n  }\r\n\r\n  removeTrack(track: PatternTrack) {\r\n    const index = this.tracks.indexOf(track);\r\n    if (index !== -1) {\r\n      this.tracks.splice(index, 1);\r\n      this.trackContainer.removeChild(track.domElement);      \r\n      this.buttons.removeSelectable(track.button);\r\n    }\r\n  }\r\n\r\n  trigger(note: number, beat: number = this.audioClock.currentBeat) {\r\n    for (const track of this.tracks) {\r\n      if (track.button.selected) {\r\n        track.trigger(note, beat);\r\n      }\r\n    }\r\n  }\r\n\r\n  release(note: number, beat: number = this.audioClock.currentBeat) {\r\n    for (const track of this.tracks) {\r\n      if (track.button.selected) {\r\n        track.release(note, beat);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { IEvent, IPattern } from \"../schema\";\r\n\r\nexport abstract class GraphicsHelpers {\r\n  static renderSequence(\r\n    canvas: HTMLCanvasElement,\r\n    events: IEvent[],\r\n    color: string,\r\n    beatWidth: number,\r\n    clearFirst = true\r\n  ) {\r\n    // find lowest note\r\n    let lowestNote = 88;\r\n    let highestNote = 0;\r\n    for (const event of events) {\r\n      if (!(event.note || event.note === 0)) {\r\n        console.log(\"event\", event);\r\n        throw new Error(\"renderToCanvas() No note!\");\r\n      }\r\n      if (event.note < lowestNote) lowestNote = event.note;\r\n      if (event.note > highestNote) highestNote = event.note;\r\n    }\r\n\r\n    highestNote += 12;\r\n    lowestNote -= 12;\r\n\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n\r\n    if (clearFirst) ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    const paddedScale = Math.min(\r\n      canvas.height / (highestNote - lowestNote + 1),\r\n      2\r\n    );\r\n\r\n    for (const note of events) {\r\n      const y = canvas.height - (note.note! - lowestNote + 1) * paddedScale;\r\n      const x = note.start * beatWidth;\r\n      const width = note.duration * beatWidth;\r\n      ctx.fillStyle = color;\r\n      ctx.fillRect(x, y, width, paddedScale);\r\n    }\r\n  }\r\n\r\n  static renderPattern(\r\n    canvas: HTMLCanvasElement,\r\n    pattern: IPattern,\r\n    color: string,\r\n    beatWidth: number\r\n  ) {\r\n    const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    const concat: IEvent[] = [];\r\n\r\n    for (const sequence of pattern.tracks) {\r\n      concat.push(...sequence.events);\r\n    }\r\n\r\n    GraphicsHelpers.renderSequence(canvas, concat, color, beatWidth, false);\r\n  }\r\n}\r\n","import { EventDataMap } from \"../EventObject\";\r\nimport { BaseElement } from \"./BaseElement\";\r\n\r\nexport abstract class ScrollPanel<\r\n  T extends keyof EventDataMap,\r\n> extends BaseElement<\"scroll\" | T> {\r\n  sensitivity = 50;\r\n  private linkedElements: HTMLElement[] = [];\r\n  private _scrollTop = 0;\r\n\r\n  get scrollTop() {\r\n    return this._scrollTop;\r\n  }\r\n\r\n  set scrollTop(value: number) {\r\n    const top = -value;\r\n    this._scrollTop = top;\r\n    this.scrollElement.style.transform = `translateY(${top}px)`;\r\n    for (const linkedElement of this.linkedElements) {\r\n      linkedElement.style.transform = `translateY(${top}px)`;\r\n    }\r\n  }\r\n\r\n  constructor(readonly scrollElement: HTMLElement) {\r\n    super(\"div\", \"scroll-panel\");\r\n    scrollElement.classList.add(\"scroll-panel-content\");\r\n\r\n    this.scrollElement.addEventListener(\"wheel\", (e) => {\r\n      e.preventDefault();\r\n      let top =\r\n        this._scrollTop + (e.deltaY > 0 ? -this.sensitivity : this.sensitivity);\r\n      const bottom = top + this.scrollElement.offsetHeight;\r\n      if (bottom < this.domElement.offsetHeight) {\r\n        top = this.domElement.offsetHeight - this.scrollElement.offsetHeight;\r\n      } else if (top > 0) {\r\n        top = 0;\r\n      }\r\n      this._scrollTop = top;\r\n      this.scrollElement.style.transform = `translateY(${top}px)`;\r\n      for (const linkedElement of this.linkedElements) {\r\n        linkedElement.style.transform = `translateY(${top}px)`;\r\n      }\r\n\r\n      this.emit(\"scroll\", e);\r\n    });\r\n  }\r\n\r\n  linkElement(element: HTMLElement) {\r\n    this.linkedElements.push(element);\r\n    element.classList.add(\"scroll-panel-content\");\r\n  }\r\n}\r\n","import { getAudioContext } from \"../../../elements/src/managers/AudioManager\";\r\n\r\nexport class AudioCanvas {\r\n  domElement: HTMLDivElement;\r\n  canvas: HTMLCanvasElement;\r\n  ctx: CanvasRenderingContext2D;\r\n  buffer: AudioBuffer | null = null;\r\n\r\n  constructor(width = 800, height = 200, playOnClick = true) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"audio-canvas\");\r\n\r\n    this.canvas = document.createElement(\"canvas\");\r\n    this.canvas.width = width;\r\n    this.canvas.height = height;\r\n    this.domElement.appendChild(this.canvas);\r\n\r\n    if (playOnClick) {\r\n      this.canvas.addEventListener(\"click\", () => {\r\n        if (this.buffer) {\r\n          this.playBuffer(this.buffer);\r\n        }\r\n      });\r\n    }\r\n\r\n    this.ctx = this.canvas.getContext(\"2d\") as CanvasRenderingContext2D;\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; note: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.note,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n\r\n  playBuffer(audioBuffer: AudioBuffer) {\r\n    const ctx = getAudioContext();\r\n    const source = ctx.createBufferSource();\r\n    source.buffer = audioBuffer;\r\n    source.connect(ctx.destination);\r\n    source.start();\r\n  }\r\n\r\n  loadBuffer(audioBuffer: AudioBuffer) {\r\n    this.buffer = audioBuffer;\r\n\r\n    const channelData = audioBuffer.getChannelData(0);\r\n    const bufferLength = channelData.length;\r\n    const sliceWidth = this.canvas.width / bufferLength;\r\n\r\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    this.ctx.beginPath();\r\n    this.ctx.moveTo(0, this.canvas.height / 2);\r\n\r\n    for (let i = 0; i < bufferLength; i++) {\r\n      const x = i * sliceWidth;\r\n      const y = ((channelData[i] + 1) * this.canvas.height) / 2;\r\n\r\n      this.ctx.lineTo(x, y);\r\n    }\r\n\r\n    this.ctx.lineTo(this.canvas.width, this.canvas.height / 2);\r\n    this.ctx.stroke();\r\n  }\r\n}\r\n","import { AudioCanvas } from \"../../../../elements/src/elements/AudioCanvas\";\r\nimport { getAudioContext } from \"../../../../elements/src/managers/AudioManager\";\r\n\r\nexport class LyricCanvas extends AudioCanvas {\r\n  constructor() {\r\n    super();\r\n  }\r\n\r\n  async generateAudio(\r\n    note: { label: string; note: number },\r\n    preview: boolean = false\r\n  ): Promise<AudioBuffer> {\r\n    const buffer: AudioBuffer = await new Promise((resolve, reject) => {\r\n      const req = {\r\n        text: note.label,\r\n        pitch: note.note,\r\n        rate: 0.9,\r\n      };\r\n      fetch(\"/api/tts/edge\", {\r\n        method: \"POST\",\r\n        body: JSON.stringify(req),\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n      })\r\n        .then((res) => res.arrayBuffer())\r\n        .then((data) => {\r\n          console.log(\"Audio buffer downloaded\", data);\r\n          getAudioContext().decodeAudioData(\r\n            data,\r\n            (audioBuffer: AudioBuffer) => {\r\n              this.buffer = audioBuffer;\r\n              if (preview) {\r\n                this.playBuffer(audioBuffer);\r\n              }\r\n\r\n              resolve(audioBuffer);\r\n            }\r\n          );\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"Error downloading audio buffer\", error);\r\n          reject(error);\r\n        });\r\n    });\r\n\r\n    this.loadBuffer(buffer);\r\n\r\n    return buffer;\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class DialogPopup extends BaseElement<\"result\" | \"cancel\"> {  \r\n  closeButton: HTMLButtonElement;\r\n  okButton: HTMLButtonElement | undefined;\r\n  cancelButton: HTMLButtonElement | undefined;\r\n\r\n  get isVisibile() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  constructor(\r\n    private readonly ok: string | HTMLButtonElement = \"OK\",\r\n    private readonly cancel: string | HTMLButtonElement = \"Cancel\"\r\n  ) {\r\n    super(\"div\", \"dialog-popup\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");    \r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"pointerdown\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    if (ok instanceof HTMLButtonElement) {\r\n      this.okButton = ok;\r\n    } else if (ok) {\r\n      this.okButton = document.createElement(\"button\");\r\n      this.okButton.textContent = ok;\r\n      this.domElement.appendChild(this.okButton);\r\n    }\r\n\r\n    if (this.okButton) {\r\n      this.okButton.addEventListener(\"click\", () => {\r\n        this.emit(\"result\", this);\r\n      });\r\n    }\r\n\r\n    if (cancel instanceof HTMLButtonElement) {\r\n      this.cancelButton = cancel;\r\n    } else if (cancel) {\r\n      this.cancelButton = document.createElement(\"button\");\r\n      this.cancelButton.textContent = cancel;\r\n      this.domElement.appendChild(this.cancelButton);\r\n    }\r\n\r\n    if (this.cancelButton) {\r\n      this.cancelButton.addEventListener(\"click\", () => {\r\n        this.emit(\"cancel\", this);\r\n      });\r\n    }\r\n  }\r\n\r\n  show(x: number, y: number, targetObject?: unknown) { /* eslint-disable-line @typescript-eslint/no-unused-vars */\r\n    this.domElement.style.display = \"block\";\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n\r\n  hide() {\r\n    this.domElement.style.display = \"none\";\r\n  }\r\n}\r\n","import { LyricCanvas } from \"./components/LyricCanvas\";\r\nimport { DialogPopup } from \"../../../elements/src/elements/DialogPopup\";\r\nimport { IEvent } from \"../schema\";\r\n\r\nexport class PianoRollDialog extends DialogPopup {\r\n  domElement: HTMLDivElement;\r\n  closeButton: HTMLButtonElement;\r\n  saveButton: HTMLButtonElement;\r\n  note: IEvent | null = null;\r\n\r\n  constructor(public onsave: (note: IEvent) => void) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll-dialog\");\r\n\r\n    this.closeButton = document.createElement(\"button\");\r\n    this.closeButton.classList.add(\"window-close-button\");\r\n    this.domElement.appendChild(this.closeButton);\r\n    this.closeButton.addEventListener(\"click\", () => {\r\n      this.domElement.style.display = \"none\";\r\n    });\r\n\r\n    this.saveButton = document.createElement(\"button\");\r\n    this.saveButton.textContent = \"Save\";\r\n    this.domElement.appendChild(this.saveButton);\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  override show(x: number, y: number, note: IEvent) {\r\n    super.show(x, y, note);\r\n    this.note = note;\r\n    this.domElement.parentElement?.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class LyricEditorDialog extends PianoRollDialog {\r\n  textInput: HTMLInputElement;\r\n  audioCanvas: LyricCanvas;  \r\n  constructor(onsave: (note: IEvent) => void) {\r\n    super(onsave);\r\n    this.domElement.classList.add(\"grid-item-editor\");\r\n    this.domElement.style.display = \"none\";\r\n\r\n    this.textInput = document.createElement(\"input\");\r\n    this.textInput.setAttribute(\"placeholder\", \"Note lyric\");\r\n    this.textInput.classList.add(\"lyric-editor-text\");\r\n    this.textInput.type = \"text\";\r\n    this.domElement.appendChild(this.textInput);\r\n\r\n    this.audioCanvas = new LyricCanvas();\r\n    this.domElement.appendChild(this.audioCanvas.domElement);\r\n\r\n    this.saveButton.addEventListener(\"click\", () => {\r\n      this.audioCanvas.domElement.style.display = \"block\";\r\n      // this.audioCanvas.generateAudio(this.note!, true).then((buffer) => {\r\n      //   this.note!.audio = buffer;\r\n      // });\r\n      // this.onsave(this.note!);\r\n    });\r\n  }\r\n\r\n  show(x: number, y: number, event: IEvent) {\r\n    super.show(x, y, event);\r\n    this.textInput.value = this.note?.label || \"\";\r\n    // if (this.note?.audio) {\r\n    //   this.audioCanvas.loadBuffer(this.note.audio);\r\n    //   this.audioCanvas.domElement.style.display = \"block\";\r\n    // } else {\r\n    //   this.audioCanvas.domElement.style.display = \"none\";\r\n    // }\r\n  }\r\n}\r\n","import { ScrollPanel } from \"../../../../elements/src/elements/ScrollPanel\";\r\nimport { DEFAULT_NOTE_HEIGHT, NOTE_NAMES } from \"../../constants\";\r\nimport { LyricEditorDialog } from \"../audioDialogs\";\r\nimport { IEvent, ISequence } from \"../../schema\";\r\n\r\nfunction getNoteNameFromPitch(pitch: number): string {\r\n  const note = NOTE_NAMES[pitch % NOTE_NAMES.length];\r\n  return `${note}${Math.floor(pitch / NOTE_NAMES.length)}`;\r\n}\r\n\r\nconst NOTE_HANDLE_WIDTH = 6;\r\n\r\nexport class GridItem implements IEvent {\r\n  note: number;\r\n  start: number;\r\n  duration: number;\r\n  velocity: number = 0.8;\r\n  labelElement: HTMLDivElement;\r\n  label: string | \"\" = \"\";\r\n  audio: AudioBuffer | null = null;\r\n  domElement: HTMLDivElement;\r\n\r\n  constructor(\r\n    private readonly grid: Grid,\r\n    readonly item: IEvent,\r\n    label?: string,\r\n    image?: string\r\n  ) {\r\n    const noteItem = item as IEvent;\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"grid-item\");\r\n    this.domElement.style.height = `${grid.rowHeight}px`;\r\n\r\n    this.labelElement = document.createElement(\"div\");\r\n    this.labelElement.classList.add(\"grid-item-label\");\r\n    this.domElement.appendChild(this.labelElement);\r\n\r\n    if (image) {\r\n      const image = document.createElement(\"div\");\r\n      image.classList.add(\"grid-item-image\");\r\n      image.style.backgroundImage = `url(${image})`;\r\n      this.domElement.appendChild(image);\r\n      this.domElement.classList.add(\"has-image\");\r\n    }\r\n\r\n    if (noteItem.velocity) this.velocity = noteItem.velocity;\r\n    if (noteItem.note) {\r\n      this.note = noteItem.note;\r\n      this.label = label || getNoteNameFromPitch(this.note);\r\n      this.labelElement.textContent = this.label;\r\n    } else {\r\n      this.note = 0;\r\n    }\r\n\r\n    this.start = item.start;\r\n    this.duration = item.duration;\r\n\r\n    if (item.label) this.labelElement.textContent = item.label;\r\n\r\n    console.log(\"GridItem\", this);\r\n\r\n    grid.gridElement.appendChild(this.domElement);\r\n  }\r\n}\r\n\r\nexport class Grid extends ScrollPanel<\r\n  \"select\" | \"update\" | \"release\" | \"add\" | \"remove\"\r\n> {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly gridElement: HTMLDivElement;\r\n  readonly previewCanvas: HTMLCanvasElement;\r\n  readonly noteEditor: LyricEditorDialog;\r\n  private _currentItem: IEvent | null = null;\r\n  private _dragMode: string | null = null;\r\n  private _dragOffset: number = 0;\r\n  private _sequence: ISequence | null = null;\r\n  readonly scrollElement: HTMLDivElement;\r\n\r\n  public quantize: number = 0.25;\r\n  public drawingEnabled: boolean = true;\r\n  public drawingLabel: string | undefined = undefined;\r\n  public drawingImage: string | undefined = undefined;\r\n\r\n  constructor(\r\n    readonly rowCount = 88,\r\n    readonly beatWidth = 100,\r\n    readonly rowHeight = DEFAULT_NOTE_HEIGHT\r\n  ) {\r\n    const gridElement = document.createElement(\"div\");\r\n\r\n    super(gridElement);\r\n\r\n    this.scrollElement = gridElement;\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n\r\n    this.gridElement = gridElement;\r\n\r\n    this.domElement.classList.add(\"grid-container\");\r\n    this.gridElement.classList.add(\"grid\");\r\n\r\n    this.gridElement.addEventListener(\"dragstart\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.previewCanvas = document.createElement(\"canvas\");\r\n    this.previewCanvas.style.imageRendering = \"pixelated\";\r\n\r\n    const rowBackgroundCanvas = document.createElement(\"canvas\");\r\n    rowBackgroundCanvas.style.imageRendering = \"pixelated\";\r\n    rowBackgroundCanvas.width = this.beatWidth * 4;\r\n    rowBackgroundCanvas.height = this.rowHeight;\r\n    console.log(\"debug\", rowBackgroundCanvas.width, rowBackgroundCanvas.height);\r\n    const ctx = rowBackgroundCanvas.getContext(\"2d\");\r\n    // disable anti-alias\r\n\r\n    if (ctx) {\r\n      ctx.clearRect(\r\n        0,\r\n        0,\r\n        rowBackgroundCanvas.width,\r\n        rowBackgroundCanvas.height\r\n      );\r\n      ctx.lineWidth = 1;\r\n      ctx.strokeStyle = \"#444\";\r\n      for (let j = 1; j < 4; j++) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(j * this.beatWidth, 0);\r\n        ctx.lineTo(j * this.beatWidth, this.rowHeight);\r\n        ctx.stroke();\r\n      }\r\n      ctx.strokeStyle = \"#999\";\r\n      ctx.beginPath();\r\n      ctx.moveTo(0, 0);\r\n      ctx.lineTo(0, this.rowHeight);\r\n      ctx.stroke();\r\n    }\r\n    for (let i = 0; i < rowCount; i++) {\r\n      const row = document.createElement(\"div\");\r\n      row.classList.add(\"grid-row\");\r\n      row.style.height = `${this.rowHeight}px`;\r\n      this.gridElement.appendChild(row);\r\n      const base64 = rowBackgroundCanvas.toDataURL();\r\n      row.style.backgroundImage = `url(${base64})`;\r\n      row.style.backgroundRepeat = \"repeat\";\r\n    }\r\n    this.domElement.appendChild(this.gridElement);\r\n\r\n    this.noteEditor = new LyricEditorDialog((note) => {\r\n      const input = this.noteEditor.domElement.querySelector(\r\n        \".lyric-editor-text\"\r\n      ) as HTMLInputElement;\r\n      note.label = input?.value || \"\";\r\n    });\r\n\r\n    document.body.appendChild(this.noteEditor.domElement);\r\n\r\n    this.gridElement.addEventListener(\"pointerdown\", (event) => {\r\n      if (!this._sequence) throw new Error(\"No track\");\r\n\r\n      if (!this._sequence.events) throw new Error(\"No events\");\r\n\r\n      if (!this.drawingEnabled) return;\r\n\r\n      event.preventDefault();\r\n\r\n      this._dragOffset = event.layerX;\r\n\r\n      if (this.noteEditor.domElement.style.display === \"block\") {\r\n        this.noteEditor.domElement.style.display = \"none\";\r\n        return;\r\n      }\r\n\r\n      if (\r\n        event.target instanceof HTMLDivElement &&\r\n        event.target.classList.contains(\"grid-item\")\r\n      ) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const note = this._sequence.events.find(\r\n          (n) => n.domElement === event.target\r\n        );\r\n\r\n        if (event.ctrlKey || event.button === 1) {\r\n          if (note)\r\n            this.noteEditor.show(event.clientX + 20, event.clientY - 5, note);\r\n          else this.noteEditor.domElement.style.display = \"none\";\r\n        }\r\n\r\n        if (note) {\r\n          this._currentItem = note;\r\n\r\n          if (event.button === 2) {\r\n            this.remove(note);\r\n            this._currentItem = null;\r\n          } else {\r\n            note.domElement!.parentElement?.appendChild(note.domElement!);\r\n            note.domElement!.style.width =\r\n              note.duration * this.beatWidth + \"px\";\r\n            if (this._dragOffset < NOTE_HANDLE_WIDTH) {\r\n              this._dragMode = \"start\";\r\n            } else if (\r\n              note.domElement!.offsetWidth - this._dragOffset <\r\n              NOTE_HANDLE_WIDTH\r\n            ) {\r\n              this._dragMode = \"end\";\r\n            } else {\r\n              this._dragMode = \"move\";\r\n            }\r\n          }\r\n        }\r\n      } else if (event.button !== 0) return;\r\n      else if (event.target === this.gridElement) {\r\n        this.gridElement.classList.add(\"dragging\");\r\n        const row = Math.floor(event.layerY / this.rowHeight);\r\n        const note = 87 - row;\r\n\r\n        let start = event.layerX / this.beatWidth;\r\n        start = Math.round(start / this.quantize) * this.quantize;\r\n        console.log(\"start\", start, event.layerX);\r\n\r\n        const item: IEvent = {\r\n          row: row,\r\n          note: note,\r\n          start: start,\r\n          velocity: 100,\r\n          duration: this.quantize,\r\n          label: \"\",\r\n          domElement: undefined,\r\n        };\r\n\r\n        this._currentItem = this.add(item);\r\n        this._currentItem.domElement!.style.top = `${\r\n          (87 - this._currentItem.note!) * this.rowHeight\r\n        }px`;\r\n        this._currentItem.domElement!.style.left = `${\r\n          this._currentItem.start * this.beatWidth\r\n        }px`;\r\n        this._dragMode = \"end\";\r\n\r\n        this.emit(\"select\", this._currentItem);\r\n      }\r\n\r\n      this.emit(\"update\", this);\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n\r\n      this.emit(\"update\", this);\r\n      this.emit(\"release\", this._currentItem);\r\n\r\n      this._currentItem = null;\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerleave\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentItem) {\r\n        // this.remove(this._currentItem);\r\n        this._currentItem = null;\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"contextmenu\", (event) => {\r\n      event.preventDefault();\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointermove\", (event) => {\r\n      if (this._currentItem && event.buttons === 1) {\r\n        if (this._dragMode === \"start\") {\r\n          const start =\r\n            Math.round(event.layerX / this.beatWidth / this.quantize) *\r\n            this.quantize;\r\n\r\n          const oldStart = this._currentItem.start;\r\n\r\n          if (start >= this._currentItem.start + this._currentItem.duration) {\r\n            return;\r\n          }\r\n\r\n          this._currentItem.start = start;\r\n\r\n          this._currentItem.duration =\r\n            oldStart - this._currentItem.start + this._currentItem.duration;\r\n          this._currentItem.domElement!.style.left = `${\r\n            this._currentItem.start * this.beatWidth\r\n          }px`;\r\n          this._currentItem.domElement!.style.width = `${Math.max(\r\n            this.quantize,\r\n            this._currentItem.duration * this.beatWidth\r\n          )}px`;\r\n        } else if (this._dragMode === \"end\") {\r\n          this._currentItem.duration =\r\n            event.layerX / this.beatWidth - this._currentItem.start;\r\n\r\n          // quantize\r\n          this._currentItem.duration =\r\n            Math.round(this._currentItem.duration / this.quantize) *\r\n            this.quantize;\r\n\r\n          this._currentItem.domElement!.style.width = `${Math.max(\r\n            this.quantize,\r\n            this._currentItem.duration * this.beatWidth\r\n          )}px`;\r\n        } else if (this._dragMode === \"move\") {\r\n          this._currentItem.start =\r\n            Math.max(0, event.layerX - this._dragOffset) / this.beatWidth;\r\n          this._currentItem.start =\r\n            Math.round(this._currentItem.start / this.quantize) * this.quantize;\r\n          this._currentItem.domElement!.style.left = `${\r\n            this._currentItem.start * this.beatWidth\r\n          }px`;\r\n        } else {\r\n          return;\r\n        }\r\n\r\n        this.emit(\"update\", this);\r\n      }\r\n    });\r\n\r\n    this.gridElement.addEventListener(\"pointerup\", () => {\r\n      this.gridElement.classList.remove(\"dragging\");\r\n      if (this._currentItem) {\r\n        this._currentItem.domElement!.style.pointerEvents = \"auto\";\r\n      }\r\n      this._currentItem = null;\r\n    });\r\n\r\n    // this.gridElement.addEventListener(\"pointerleave\", () => {\r\n    //   this.gridElement.classList.remove(\"dragging\");\r\n    //   if (this._currentItem) {\r\n    //     this._currentItem.domElement!.style.pointerEvents = \"auto\";\r\n    //   }\r\n    //   this._currentItem = null;\r\n    // });\r\n  }\r\n\r\n  add(event: IEvent) {\r\n    if (!this._sequence) throw new Error(\"add() No sequence loaded!\");\r\n    const item = new GridItem(\r\n      this,\r\n      event,\r\n      this.drawingLabel,\r\n      this.drawingImage\r\n    );\r\n    this._sequence.events.push(item);\r\n    event.domElement = item.domElement;\r\n    this.emit(\"add\", item);\r\n    return item;\r\n  }\r\n\r\n  remove(item: IEvent) {\r\n    if (!this._sequence) throw new Error(\"remove() No sequence loaded!\");\r\n    this._sequence.events.splice(this._sequence.events.indexOf(item), 1);\r\n    this.emit(\"remove\", item);\r\n    this.gridElement.removeChild(item.domElement!);\r\n  }\r\n\r\n  load(track: ISequence) {\r\n    if (!track) {\r\n      throw new Error(\"load() No track!\");\r\n    }\r\n    console.log(\"Grid: load\", track.events);\r\n    for (const event of this._sequence?.events || []) {\r\n      event.domElement?.remove();\r\n    }\r\n    this._sequence = track;\r\n    for (const event of track.events) {\r\n      this.gridElement.appendChild(event.domElement!);\r\n    }\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport {\r\n  DEFAULT_NOTE_HEIGHT,\r\n  KEY_COLORS,\r\n  NOTE_NAMES,\r\n} from \"../../constants\";\r\nimport { IKeyboardEvent } from \"./Keyboard\";\r\n\r\nexport class SideKeyboard extends BaseElement<\"update\"> {  \r\n  keys: HTMLDivElement[] = [];\r\n  noteHeight = DEFAULT_NOTE_HEIGHT;\r\n\r\n  constructor() {\r\n\r\n    super(\"div\", \"piano-roll-keyboard\");\r\n\r\n    this.redraw();\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const key = e.target as HTMLDivElement;\r\n\r\n      if (key.classList.contains(\"piano-roll-keyboard-key\")) {\r\n        const note_index = this.keys.indexOf(key);\r\n        console.log(\"key\", key.textContent, note_index);        \r\n        key.classList.add(\"active\");\r\n        this.emit(\"update\", { type: \"press\", note: note_index } as IKeyboardEvent);\r\n        const pointerup = () => {\r\n          window.removeEventListener(\"pointerup\", pointerup);\r\n          key.classList.remove(\"active\");\r\n          this.emit(\"update\", { type: \"release\", note: note_index } as IKeyboardEvent);          \r\n        };\r\n\r\n        window.addEventListener(\"pointerup\", () => pointerup());\r\n      }\r\n    });\r\n  }\r\n\r\n  redraw() {\r\n    this.domElement.innerHTML = \"\";\r\n\r\n    for (let i = 87; i >= 0; i--) {\r\n      const key = document.createElement(\"div\");\r\n      key.classList.add(\"piano-roll-keyboard-key\");\r\n      key.style.height = `${this.noteHeight}px`;\r\n      // key.style.bottom = `${i * this.noteHeight}px`;\r\n      key.style.backgroundColor =\r\n        KEY_COLORS[i % 12] === \"white\" ? \"#fff\" : \"#000\";\r\n      key.style.color = KEY_COLORS[i % 12] === \"white\" ? \"#000\" : \"#fff\";\r\n      key.textContent = NOTE_NAMES[i % 12] + ((i / 12) | 0).toString();\r\n      this.domElement.appendChild(key);\r\n      this.keys.push(key);\r\n    }\r\n\r\n    this.keys.reverse();\r\n  }\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { GraphicsHelpers } from \"../../abstracts/GraphicsHelpers\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"./AudioCursor\";\r\nimport type { GridItem } from \"./Grid\";\r\nimport { Grid } from \"./Grid\";\r\nimport type { IKeyboardEvent } from \"./Keyboard\";\r\nimport type { PatternTrack } from \"./PatternTrack\";\r\nimport { SideKeyboard } from \"./SideKeyboard\";\r\n\r\nexport class PianoRoll\r\n  extends EventObject<\"update\">\r\n  implements ICursorTimeline\r\n{\r\n  readonly domElement: HTMLDivElement;\r\n  readonly grid: Grid;\r\n  readonly sideKeyboard: SideKeyboard;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLElement;\r\n  cursorUpdateInterval: number | object | null = null;\r\n  track: PatternTrack | null = null;\r\n  color = \"#7979ce\";\r\n  beatWidth = 100;\r\n\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"piano-roll\");\r\n\r\n    this.sideKeyboard = new SideKeyboard();\r\n    this.domElement.appendChild(this.sideKeyboard.domElement);\r\n    this.sideKeyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      if (e.type == \"press\") this.track!.trigger(e.note);\r\n      else if (e.type == \"release\") this.track!.release(e.note);\r\n    });\r\n\r\n    this.grid = new Grid();\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.on(\"select\", (item) => {\r\n      const note = item as GridItem;\r\n      this.track!.trigger(note.note);\r\n      if (this.track) {\r\n        GraphicsHelpers.renderSequence(\r\n          this.track.preview.canvas,\r\n          this.track.events,\r\n          this.color,\r\n          this.beatWidth\r\n        );\r\n      } else {\r\n        console.warn(\"No track loaded!\");\r\n      }\r\n    });\r\n    this.grid.on(\"update\", () => {\r\n      if (this.track) {\r\n        GraphicsHelpers.renderSequence(\r\n          this.track.preview.canvas,\r\n          this.track.events,\r\n          this.color,\r\n          this.beatWidth\r\n        );\r\n      }\r\n    });\r\n    this.grid.on(\"release\", (item) => {\r\n      if (item) this.track!.release((item as GridItem).note);\r\n    });\r\n    this.grid.linkElement(this.sideKeyboard.domElement);\r\n\r\n    this.timeline = this.grid.domElement;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.classList.add(\"audio-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor.domElement);\r\n    this.cursor.domElement.style.marginLeft =\r\n      this.sideKeyboard.domElement.offsetWidth + \"px\";\r\n\r\n    this.grid.scrollTop = 1000;\r\n  }\r\n\r\n  load(track: PatternTrack) {\r\n    if (!track) {\r\n      console.warn(\"No track provided!\");\r\n      return;\r\n    }\r\n    this.track = track;\r\n    this.grid.load(track);\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { PatternTrack } from \"../components/PatternTrack\";\r\nimport { PianoRoll } from \"../components/PianoRoll\";\r\n\r\nexport class PianoRollWindow extends DraggableWindow {\r\n  pianoRoll: PianoRoll;\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    const pianoRoll = new PianoRoll(ui.project.audioClock);\r\n\r\n    super({\r\n      title: \"Piano Roll\",\r\n      persistent: true,\r\n      content: pianoRoll.domElement,\r\n      width: 900,\r\n      height: 400,\r\n      left: 100,\r\n      top: 100,\r\n    });\r\n    this.pianoRoll = pianoRoll;\r\n  }\r\n\r\n  loadTrack(track: PatternTrack) {\r\n    this.pianoRoll.load(track);\r\n    this.setTitle(`Piano Roll (${track.name})`);\r\n  }\r\n}\r\n","export class ContextMenu {\r\n  private readonly domElement: HTMLElement;\r\n  private readonly _submenus: ContextMenu[] = [];\r\n\r\n  constructor(\r\n    private readonly container?: HTMLElement,\r\n    private readonly attachedElement?: HTMLElement\r\n  ) {\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"context-menu\");\r\n\r\n    if (container) container.appendChild(this.domElement);\r\n\r\n    if (attachedElement) {\r\n      this.hide();\r\n      attachedElement.addEventListener(\"contextmenu\", (event) => {\r\n        event.preventDefault();\r\n        this.show(event.clientX + 10, event.clientY - 5);\r\n      });\r\n    }\r\n    \r\n  }\r\n\r\n  private _handlePointerDown(e: MouseEvent) {\r\n    if (\r\n      e.target !== this.domElement &&\r\n      !this.domElement.contains(e.target as Node)\r\n    )\r\n      this.hide();\r\n  }\r\n\r\n  public isVisible() {\r\n    return this.domElement.style.display !== \"none\";\r\n  }\r\n\r\n  public addItem(label: string, callback: () => void) {\r\n    const item = document.createElement(\"div\");\r\n    item.classList.add(\"context-menu-item\");\r\n    item.textContent = label;\r\n    item.addEventListener(\"click\", () => {\r\n      callback();\r\n      this.hide();\r\n    });\r\n    this.domElement.appendChild(item);\r\n\r\n    return item;\r\n  }\r\n\r\n  public addSubmenu(label: string, submenu: ContextMenu) {\r\n    const item = document.createElement(\"div\");\r\n    item.classList.add(\"context-menu-item\");\r\n    item.textContent = label;\r\n    item.addEventListener(\"click\", (e) => {\r\n      submenu.show(\r\n        this.domElement.offsetLeft + this.domElement.offsetWidth - 5,\r\n        item.offsetTop\r\n      );\r\n      const elt = e.target as HTMLElement;\r\n      if (elt.classList.contains(\"context-menu-item\")) {\r\n        this.hide();\r\n      }\r\n    });\r\n\r\n    submenu.domElement.classList.add(\"context-menu-submenu\");\r\n    this._submenus.push(submenu);\r\n\r\n    item.appendChild(submenu.domElement);\r\n    this.domElement.appendChild(item);\r\n  }\r\n\r\n  public show(x: number, y: number) {\r\n    if (!this.container) return;\r\n    this.domElement.style.left = `${x}px`;\r\n    this.domElement.style.top = `${y}px`;\r\n    this.domElement.style.display = \"block\";\r\n    document.addEventListener(\"pointerdown\", (e) => this._handlePointerDown(e));\r\n  }\r\n\r\n  public hide() {\r\n    if (!this.isVisible() || !this.container) return;\r\n    this.domElement.style.display = \"none\";\r\n    for (let i = 0; i < this._submenus.length; i++) {\r\n      this._submenus[i].hide();      \r\n    }\r\n    document.removeEventListener(\"pointerdown\", (e) => this._handlePointerDown(e));\r\n  }\r\n}\r\n","import { SelectableElement } from \"../../../elements/src/elements/SelectableElement\";\r\nimport { SelectableGroup } from \"../../../elements/src/elements/SelectableGroup\";\r\nimport { IPattern } from \"../schema\";\r\n\r\nexport class PlaylistSourceItem extends SelectableElement {\r\n  constructor(group: SelectableGroup<PlaylistSourceItem>, readonly item: IPattern) {\r\n    super(group, \"div\", \"playlist-source-item\");\r\n\r\n    this.domElement.innerText = item.name;\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { ITrackOptions } from \"../../schema\";\r\nimport { MuteSoloButtons } from \"./MuteSoloButtons\";\r\n\r\nexport class PlaylistTrack\r\n  extends BaseElement<\"update\">\r\n  implements ITrackOptions\r\n{\r\n  private _track: ITrackOptions;\r\n  readonly muteSoloButtons: MuteSoloButtons;\r\n\r\n  get mute() {\r\n    return this._track.mute;\r\n  }\r\n\r\n  get solo() {\r\n    return this._track.solo;\r\n  }\r\n\r\n  get selected() {\r\n    return false;\r\n  }\r\n\r\n  get name() {\r\n    return this._track.name;\r\n  }\r\n\r\n  constructor(track: ITrackOptions) {\r\n    super(\"div\", \"playlist-track\");\r\n\r\n    this._track = track;\r\n\r\n    const settings = document.createElement(\"div\");\r\n    settings.classList.add(\"playlist-track-panel\");\r\n\r\n    const labelAndButtons = document.createElement(\"div\");\r\n    labelAndButtons.classList.add(\"playlist-track-label-and-buttons\");\r\n\r\n    const label = document.createElement(\"div\");    \r\n    label.textContent = track.name;\r\n\r\n    this.muteSoloButtons = new MuteSoloButtons();\r\n    this.muteSoloButtons.on(\"change\", () => {\r\n      this._track.mute = this.muteSoloButtons.mute;\r\n      this._track.solo = this.muteSoloButtons.solo;\r\n    });\r\n\r\n    labelAndButtons.appendChild(label);\r\n    labelAndButtons.appendChild(this.muteSoloButtons.domElement);\r\n    settings.appendChild(labelAndButtons);\r\n    this.domElement.appendChild(settings);\r\n  }\r\n\r\n  trigger(note: number, velocity: number) {\r\n    console.log(\"Trigger\", note, velocity);\r\n  }\r\n\r\n  release(note: number) {\r\n    console.log(\"Release\", note);\r\n  }\r\n}\r\n","import EventObject from \"../../../../elements/src/EventObject\";\r\nimport { IEvent, IPlaylistEvent, IProject, ITrackOptions } from \"../../schema\";\r\nimport { Project } from \"../Project\";\r\nimport { AudioClock } from \"./AudioClock\";\r\nimport { AudioCursor, ICursorTimeline } from \"./AudioCursor\";\r\nimport { Grid } from \"./Grid\";\r\nimport { PlaylistTrack } from \"./PlaylistTrack\";\r\n\r\nexport class Playlist extends EventObject<\"update\"> implements ICursorTimeline {\r\n  readonly domElement: HTMLDivElement;\r\n  readonly grid: Grid;\r\n  readonly _trackPanels: HTMLDivElement;\r\n  readonly cursor: AudioCursor;\r\n  readonly timeline: HTMLElement;\r\n  beatWidth = 20;\r\n  readonly _items: Map<IEvent, IPlaylistEvent> = new Map();\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.project.audioClock;\r\n  }\r\n\r\n  constructor(readonly project: Project) {\r\n    super();\r\n\r\n    this.domElement = document.createElement(\"div\");\r\n    this.domElement.classList.add(\"playlist\");\r\n\r\n    this._trackPanels = document.createElement(\"div\");\r\n    this._trackPanels.classList.add(\"playlist-tracks\");\r\n    this.domElement.appendChild(this._trackPanels);\r\n\r\n    this.grid = new Grid(16, this.beatWidth, 60);\r\n    this.grid.on(\"add\", (e) => {\r\n      const event = e as IEvent;\r\n      const playlistEvent = e as IPlaylistEvent;\r\n      if (!this.project.playlist.events.includes(playlistEvent)) {\r\n        this.project.playlist.events.push(playlistEvent);\r\n      }\r\n      this._items.set(event, playlistEvent);\r\n      this.emit(\"update\");\r\n      console.log(\"Added event\", e);\r\n    });\r\n\r\n    this.grid.on(\"remove\", (e) => {      \r\n      const event = e as IEvent;\r\n      if (this._items.has(event)) {\r\n        const playlistEvent = e as IPlaylistEvent;\r\n        const index = this.project.playlist.events.indexOf(playlistEvent);\r\n        if (index >= 0) {\r\n          this.project.playlist.events.splice(index, 1);\r\n          console.log(\"Removed event\", e);\r\n        }\r\n        this._items.delete(event);\r\n      }\r\n      this.emit(\"update\");\r\n    });\r\n\r\n    this.grid.quantize = 1;\r\n    this.domElement.appendChild(this.grid.domElement);\r\n    this.grid.linkElement(this._trackPanels);\r\n    this.grid.load(this.project.playlist);\r\n\r\n    this.timeline = this.grid.domElement;\r\n\r\n    this.cursor = new AudioCursor(this);\r\n    this.cursor.domElement.classList.add(\"audio-cursor\");\r\n    this.grid.domElement.appendChild(this.cursor.domElement);\r\n    this.cursor.domElement.style.marginLeft =\r\n      this._trackPanels.offsetWidth + \"px\";\r\n    this.grid.scrollTop = 0;\r\n  }\r\n\r\n  loadProject(project: IProject) {\r\n    let i = 0;\r\n\r\n    for (const track of project.tracks) {\r\n      const playlistTrack = new PlaylistTrack(track);\r\n      this._trackPanels.appendChild(playlistTrack.domElement);\r\n      i++;\r\n    }\r\n\r\n    for (; i < 16; i++) {\r\n      const track: ITrackOptions = {\r\n        name: `Track ${i + 1}`,\r\n        mute: false,\r\n        solo: false,\r\n        selected: false,\r\n      };\r\n      const playlistTrack = new PlaylistTrack(track);\r\n      project.tracks.push(track);\r\n      this._trackPanels.appendChild(playlistTrack.domElement);\r\n    }\r\n  }\r\n}\r\n","import { DraggableWindow } from \"../../../../elements/src/elements/DraggableWindow\";\r\nimport { ContextMenu } from \"../../../../elements/src/elements/ContextMenu\";\r\nimport { AudioClock } from \"../components/AudioClock\";\r\nimport { ProjectUI } from \"../ProjectUI\";\r\nimport { IProject } from \"../../schema\";\r\nimport { SelectableGroup } from \"../../../../elements/src/elements/SelectableGroup\";\r\nimport { PlaylistSourceItem } from \"../PlaylistSourceItem\";\r\nimport { Playlist } from \"../components/Playlist\";\r\n\r\nexport class PlaylistWindow extends DraggableWindow {\r\n  readonly bucket: SelectableGroup<PlaylistSourceItem>;\r\n  readonly playlist: Playlist;\r\n\r\n  beatWidth = 10;\r\n\r\n  get audioClock(): AudioClock {\r\n    return this.ui.project.audioClock;\r\n  }\r\n\r\n  constructor(readonly ui: ProjectUI) {\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"playlist-container\");\r\n\r\n    super({\r\n      title: \"Playlist\",\r\n      persistent: true,\r\n      content: container,\r\n      width: 800,\r\n      height: 400,\r\n    });\r\n\r\n    this.playlist = new Playlist(this.ui.project);\r\n\r\n    const sourceContainer = document.createElement(\"div\");\r\n    sourceContainer.classList.add(\"playlist-source-container\");\r\n\r\n    this.bucket = new SelectableGroup<PlaylistSourceItem>();\r\n    this.bucket.domElement.classList.add(\"playlist-source-bucket\");\r\n    this.refresh();\r\n\r\n    const addMenu = new ContextMenu(document.body);\r\n\r\n    addMenu.addItem(\"Import Audio\", () => {\r\n      const fileInput = document.createElement(\"input\");\r\n      fileInput.type = \"file\";\r\n      fileInput.accept = \"audio/*\";\r\n      fileInput.addEventListener(\"change\", () => {\r\n        const file = fileInput.files?.[0];\r\n        if (file) {\r\n          console.log(\"Importing audio file\", file);\r\n        }\r\n      });\r\n      fileInput.click();\r\n    });\r\n\r\n\r\n    addMenu.addItem(\"Generate (Stable Audio)\", () => {\r\n      console.log(\"Add Audio\");\r\n    });\r\n\r\n    addMenu.addItem(\"Generate (MusicGen)\", () => {\r\n      console.log(\"Add Audio\");\r\n    });\r\n\r\n    const addButton = document.createElement(\"button\");\r\n    addButton.classList.add(\"bucket-add-button\");\r\n    addButton.textContent = \"+\";\r\n    addButton.addEventListener(\"click\", (e) => {\r\n      addMenu.show(e.clientX, e.clientY);\r\n    });\r\n\r\n    sourceContainer.appendChild(this.bucket.domElement);\r\n    sourceContainer.appendChild(addButton);\r\n\r\n    container.appendChild(sourceContainer);\r\n    container.appendChild(this.playlist.domElement);\r\n  }\r\n\r\n  refresh() {\r\n    this.bucket.clear();\r\n\r\n    for (const pattern of this.ui.project.patterns) {\r\n      const item = new PlaylistSourceItem(this.bucket, pattern);\r\n      this.bucket.addSelectable(item);\r\n    }\r\n\r\n    if (this.bucket.items.length > 0) {\r\n      this.bucket.items[0].selected = true;\r\n      this.playlist.grid.drawingEnabled = true;\r\n      this.playlist.grid.drawingLabel = this.bucket.items[0].item.name;\r\n      this.playlist.grid.drawingImage = this.bucket.items[0].item.name;\r\n    } else {\r\n      this.playlist.grid.drawingEnabled = false;\r\n    }\r\n  }\r\n\r\n  loadProject(project: IProject) {\r\n    this.playlist.loadProject(project);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../elements/src/elements/BaseElement\";\r\nimport { WindowContainer } from \"../../../elements/src/elements/WindowContainer\";\r\nimport { Project } from \"./Project\";\r\nimport { IKeyboardEvent, Keyboard } from \"./components/Keyboard\";\r\nimport { MixerWindow } from \"./windows/MixerWindow\";\r\nimport { PatternWindow } from \"./windows/PatternWindow\";\r\nimport { PianoRollWindow } from \"./windows/PianoRollWindow\";\r\nimport { PlaylistWindow } from \"./windows/PlaylistWindow\";\r\n\r\nexport class ProjectUI extends BaseElement<\"update\"> {\r\n  container: WindowContainer;\r\n  readonly pianoRollWindow: PianoRollWindow;\r\n  readonly mixerWindow: MixerWindow;\r\n\r\n  get audioContext() {\r\n    return this.project.audioClock.audioContext;\r\n  }\r\n\r\n  constructor(readonly project: Project) {\r\n    super(\"div\", \"project-ui\");\r\n\r\n    this.container = new WindowContainer();\r\n    this.domElement.appendChild(this.container.domElement);\r\n\r\n    this.pianoRollWindow = new PianoRollWindow(this);\r\n    this.container.addWindow(this.pianoRollWindow);\r\n\r\n    const patternWindow = new PatternWindow(this);\r\n    this.container.addWindow(patternWindow);\r\n    patternWindow.show(35, 100);\r\n\r\n    const playlistWindow = new PlaylistWindow(this);\r\n    this.container.addWindow(playlistWindow);\r\n    playlistWindow.show(1000, 50);\r\n\r\n    this.mixerWindow = new MixerWindow(this);\r\n    this.container.addWindow(this.mixerWindow);\r\n    this.mixerWindow.show(1000, 470);\r\n\r\n    const keyboard = new Keyboard();\r\n    this.domElement.appendChild(keyboard.domElement);\r\n    keyboard.on(\"update\", (event) => {\r\n      const e = event as IKeyboardEvent;\r\n      console.log(\"Keyboard\", event);\r\n      if (e.type === \"press\") {\r\n        patternWindow.trigger(e.note);\r\n      } else if (e.type === \"release\") {\r\n        patternWindow.release(e.note);\r\n      }\r\n    });\r\n\r\n    this.project.on(\"update\", (event) => {\r\n      console.log(\"ProjectUI project update\", event);\r\n\r\n      if (!(event instanceof Object)) {\r\n        throw new Error(\"Invalid event\");\r\n      }\r\n\r\n      if (!(\"type\" in event)) {\r\n        throw new Error(\"Invalid event\");\r\n      }\r\n\r\n      const e = event as { type: string; value: unknown };\r\n\r\n      if (e.type === \"project\") {\r\n        const project = e.value as Project;\r\n        console.log(\"Project\", project);\r\n        patternWindow.loadProject(project);\r\n        playlistWindow.loadProject(project);\r\n        for (const instrument of project.instruments) {\r\n          this.container.addWindow(instrument.window!);\r\n        }\r\n      }\r\n    });\r\n  }\r\n  loadProject(project: Project) {\r\n    this.project.load(project);\r\n  }\r\n}\r\n","import { BaseElement } from \"./BaseElement\";\r\n\r\nexport class DraggableNumber extends BaseElement<\"change\"> {\r\n  private _value: number;\r\n  private _step: number;\r\n  private _hideZero: string | null;\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(value: number) {\r\n    this._value = value;\r\n    if (value === 0 && this._hideZero !== null) {\r\n      this.domElement.textContent = this._hideZero;\r\n    } else {\r\n      this.domElement.textContent = value.toString();\r\n    }\r\n  }\r\n\r\n  constructor(\r\n    value: number,\r\n    min: number,\r\n    max: number,\r\n    step = 1,\r\n    sensitivity = 0.25,\r\n    hideZero: string | null = \"-\"\r\n  ) {\r\n    super(\"div\", \"draggable-number\");\r\n\r\n    this._hideZero = hideZero;\r\n    this._value = value;\r\n    this._step = step;\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", (e) => {\r\n      e.preventDefault();\r\n      const startY = e.clientY;\r\n      const startValue = this.value;\r\n      const onMouseMove = (event: PointerEvent) => {\r\n        const oldValue = this.value;\r\n        const dy = Math.round(-(event.clientY - startY) * sensitivity);\r\n        const newValue = startValue + dy * this._step;\r\n        this.value = Math.max(min, Math.min(max, newValue));\r\n        if (oldValue !== this.value) this.emit(\"change\", this.value);\r\n      };\r\n      const onMouseUp = () => {\r\n        document.removeEventListener(\"pointermove\", onMouseMove);\r\n        document.removeEventListener(\"pointerup\", onMouseUp);\r\n      };\r\n      document.addEventListener(\"pointermove\", onMouseMove);\r\n      document.addEventListener(\"pointerup\", onMouseUp);\r\n    });\r\n\r\n    this.value = value || 0;\r\n  }\r\n}\r\n","import { DraggableNumber } from \"../../../elements/src/elements/DraggableNumber\";\r\n\r\nimport {\r\n  DraggableWindow,\r\n  IWindowOptions,\r\n} from \"../../../elements/src/elements/DraggableWindow\";\r\nimport { Instrument } from \"./Instrument\";\r\n\r\nexport interface IInstrumentWindowOptions extends IWindowOptions {\r\n  mixerChannel: number;\r\n}\r\n\r\nexport class InstrumentWindow extends DraggableWindow {\r\n  private _settingsBar: HTMLDivElement;\r\n\r\n  get mixerChannel() {\r\n    return this.options.mixerChannel;\r\n  }\r\n\r\n  set mixerChannel(value: number) {\r\n    this.options.mixerChannel = value;\r\n  }\r\n\r\n  constructor(\r\n    readonly options: IInstrumentWindowOptions,\r\n    readonly instrument: Instrument,    \r\n  ) {\r\n    super(options);\r\n\r\n    const mixerChannelSelector = new DraggableNumber(\r\n      options.mixerChannel,\r\n      0,\r\n      16\r\n    );\r\n    mixerChannelSelector.on(\"change\", (value) => {\r\n      this.mixerChannel = value as number;\r\n      console.assert(instrument.mixer, \"instrument.mixer is undefined!\");\r\n      instrument.output.disconnect();\r\n      instrument.output.connect(\r\n        instrument.mixer.channels[this.mixerChannel].gainNode\r\n      );\r\n    });\r\n\r\n    this._settingsBar = document.createElement(\"div\");\r\n    this._settingsBar.classList.add(\"window-settings-bar\");\r\n    this._settingsBar.appendChild(mixerChannelSelector.domElement);\r\n\r\n    this.domElement.insertBefore(this._settingsBar, this.content);\r\n  }\r\n}\r\n","import { IInstrument } from \"../elements/IInstrument\";\r\nimport { Mixer } from \"../elements/Mixer\";\r\nimport { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { ISourceEvent } from \"../elements/components/SamplerSlot\";\r\nimport { Plugin } from \"../plugins/plugins\";\r\n\r\nexport abstract class Instrument extends Plugin implements IInstrument {\r\n  inputPort?: number | undefined;\r\n  inputChannel?: number | undefined;\r\n  output: GainNode;\r\n\r\n  constructor(audioClock: AudioClock, mixer: Mixer, mixerChannel = 0) {\r\n    super(audioClock, mixer);\r\n    this.output = audioClock.audioContext.createGain();\r\n    this.output.connect(mixer.channels[mixerChannel].gainNode);\r\n  }\r\n\r\n  abstract trigger(\r\n    note: number,\r\n    when: number,\r\n    velocity?: number\r\n  ): ISourceEvent | undefined;\r\n\r\n  abstract release(note: number, when: number): void;\r\n}\r\n","import { SynthesizerVoice } from \"./SynthesizerVoice\";\r\nimport { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { IKeyboardEvent } from \"../elements/components/Keyboard\";\r\nimport { ISynthesizerSettings } from \"../schema\";\r\nimport { Instrument } from \"./Instrument\";\r\nimport { InstrumentWindow } from \"./InstrumentWindow\";\r\nimport { Mixer } from \"../elements/Mixer\";\r\n\r\ninterface ISynthesizerEvent extends IKeyboardEvent {\r\n  voice: SynthesizerVoice;\r\n}\r\n\r\nexport abstract class Synthesizer<T extends SynthesizerVoice>\r\n  extends Instrument\r\n  implements ISynthesizerSettings\r\n{\r\n  abstract readonly window: InstrumentWindow;\r\n  readonly voices: SynthesizerVoice[] = [];\r\n  private _nextVoice = 0;  \r\n  private _held: ISynthesizerEvent[] = [];\r\n  public transpose = 24;\r\n\r\n  constructor(audioClock: AudioClock, mixer: Mixer) {\r\n    super(audioClock, mixer);\r\n  }\r\n\r\n  addVoice(voice: T) {\r\n    this.voices.push(voice);\r\n  }\r\n\r\n  handleEvent(event: IKeyboardEvent) {\r\n    if (event.type == \"press\") {\r\n      console.log(this.name + \" triggered voice \" + this._nextVoice);\r\n\r\n      this._held.push({ ...event, voice: this.voices[this._nextVoice] });\r\n\r\n      this._nextVoice++;\r\n      if (this._nextVoice >= this.voices.length) {\r\n        this._nextVoice = 0;\r\n      }\r\n    } else if (event.type == \"release\") {\r\n      console.log(this.name + \" released voice \" + event);\r\n\r\n      const index = this._held.findIndex((e) => e.note == event.note);\r\n      if (index >= 0) {\r\n        this._held.splice(index, 1);\r\n      }\r\n\r\n      this.voices.forEach((voice) => {\r\n        voice.release(event.note);\r\n      });\r\n    } else {\r\n      console.error(this.name + \": Invalid event passed to trigger()\", event);\r\n    }\r\n  }\r\n}\r\n","import { AudioClock } from \"../elements/components/AudioClock\";\r\nimport { ISynthesizerVoiceSettings } from \"../schema\";\r\n\r\nexport abstract class SynthesizerVoice implements ISynthesizerVoiceSettings {\r\n  _settings: ISynthesizerVoiceSettings | null = null;\r\n\r\n  get settings(): ISynthesizerVoiceSettings {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n    return this.settings;\r\n  }\r\n\r\n  private readonly _gain: GainNode;\r\n  private _note: number | null = null;\r\n  private _frequency: number | null = null;  \r\n\r\n  get gain() {\r\n    return this._gain.gain.value;\r\n  }\r\n\r\n  get note() {\r\n    return this._note;\r\n  }\r\n\r\n  get lfoNumber() {\r\n    return this.settings.lfoNumber;\r\n  }\r\n\r\n  get envelopeNumber() {\r\n    return this.settings.envelopeNumber;\r\n  }\r\n\r\n  get frequency() {\r\n    return this._frequency;\r\n  }\r\n\r\n  get detune() {\r\n    return this.settings.detune;\r\n  }\r\n\r\n  get oscillators() {\r\n    return this.settings.oscillators;\r\n  }\r\n\r\n  constructor(readonly audioClock: AudioClock) {    \r\n    this._gain = audioClock.audioContext.createGain();\r\n  }\r\n\r\n  loadSettings(settings: ISynthesizerVoiceSettings) {\r\n    this._settings = settings;\r\n    this._gain.gain.value = settings.gain;\r\n  }\r\n\r\n  trigger(note: number, velocity: number, time = 0) {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n\r\n    this._note = note;\r\n    this._frequency = 440 * Math.pow(2, (note - 69) / 12);\r\n    this._gain.gain.value = this.settings.gain * velocity;\r\n\r\n    // TODO\r\n  }\r\n\r\n  release(time = 0) {\r\n    if (!this.settings) throw new Error(\"Voice not initialized\");\r\n\r\n    this._note = null;\r\n    this._frequency = null;\r\n\r\n    // TODO\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { ControlType, IPluginControl } from \"../../schema\";\r\n\r\nexport class Slider extends BaseElement<\"update\"> implements IPluginControl {\r\n  private readonly _name: string;\r\n  private readonly _label: string;\r\n  private readonly _type: ControlType = \"slider\";\r\n  private readonly _default: number;\r\n  private readonly _min: number;\r\n  private readonly _max: number;\r\n  private readonly _step: number;\r\n  private readonly _range: HTMLInputElement;\r\n  private _value: number;\r\n\r\n  get name() {\r\n    return this._name;\r\n  }\r\n\r\n  get label() {\r\n    return this._label;\r\n  }\r\n\r\n  get type() {\r\n    return this._type;\r\n  }\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  get default() {\r\n    return this._default;\r\n  }\r\n\r\n  get min() {\r\n    return this._min;\r\n  }\r\n\r\n  get max() {\r\n    return this._max;\r\n  }\r\n\r\n  get step() {\r\n    return this._step;\r\n  }\r\n\r\n  set value(value: number) {\r\n    this._value = value;\r\n    this._range.value = value.toString();\r\n  }\r\n\r\n  get element() {\r\n    return this._range;\r\n  }\r\n\r\n  constructor(\r\n    name: string,\r\n    label: string,\r\n    min: number,\r\n    max: number,\r\n    step: number,\r\n    value: number\r\n  ) {\r\n    super(\"div\", \"slider\");\r\n\r\n    this._name = name;\r\n    this._label = label;\r\n    this._min = min;\r\n    this._max = max;\r\n    this._step = step;\r\n    this._value = value;\r\n    this._default = value;\r\n\r\n    this._range = document.createElement(\"input\");\r\n    this._range.type = \"range\";\r\n    this._range.min = min.toString();\r\n    this._range.max = max.toString();\r\n    this._range.step = step.toString();\r\n    this._range.value = value.toString();\r\n\r\n    this._range.addEventListener(\"input\", () => {\r\n      this._value = parseFloat(this._range.value);\r\n      this.emit(\"update\", this);\r\n    });\r\n\r\n    this._range.addEventListener(\"change\", () => {\r\n      this._range.blur();\r\n    });\r\n\r\n    this.domElement.appendChild(this._range);\r\n  }\r\n}\r\n","import { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { IEnvelope } from \"../../schema\";\r\nimport { Slider } from \"./Slider\";\r\n\r\nexport class Envelope extends BaseElement<\"update\"> implements IEnvelope {\r\n  readonly attack: Slider;\r\n  readonly hold: Slider;\r\n  readonly decay: Slider;\r\n  readonly sustain: Slider;\r\n  readonly release: Slider;\r\n\r\n  constructor(\r\n    attack = 0.003,\r\n    hold = 0.0,\r\n    decay = 2.0,\r\n    sustain = 0.01,\r\n    release = 0.05\r\n  ) {\r\n    super(\"div\", \"envelope\");\r\n\r\n    this.attack = new Slider(\"attack\", \"A\", 0, 1, 0.01, attack);\r\n    this.hold = new Slider(\"hold\", \"H\", 0, 1, 0.01, hold);\r\n    this.decay = new Slider(\"decay\", \"D\", 0, 1, 0.01, decay);\r\n    this.sustain = new Slider(\"sustain\", \"S\", 0, 1, 0.01, sustain);\r\n    this.release = new Slider(\"release\", \"R\", 0, 1, 0.01, release);\r\n\r\n    this.domElement.appendChild(this.attack.domElement);\r\n    this.domElement.appendChild(this.decay.domElement);\r\n    this.domElement.appendChild(this.sustain.domElement);\r\n    this.domElement.appendChild(this.release.domElement);\r\n  }\r\n\r\n  trigger(param: AudioParam, when: number) {\r\n    console.log(\"trigger @ \" + when);\r\n    const value = param.value;\r\n    param.cancelScheduledValues(when);\r\n    param.setValueAtTime(value, when);\r\n    param.exponentialRampToValueAtTime(0.015, when);\r\n    //param.setValueAtTime(0.015, when);\r\n    param.linearRampToValueAtTime(1, when + this.attack.value);\r\n    //param.setValueAtTime(1, when + this.attack.value);\r\n    param.exponentialRampToValueAtTime(\r\n      this.sustain.value,\r\n      when + this.attack.value + this.decay.value\r\n    );\r\n  }\r\n\r\n  triggerRelease(param: AudioParam, when: number) {\r\n    console.log(\"triggerRelease @ \" + when);\r\n    param.setValueAtTime(param.value, when);\r\n    param.setTargetAtTime(0.0001, when + 0.01, this.release.value);\r\n    param.cancelScheduledValues(when + 0.01 + this.release.value);\r\n  }\r\n}\r\n","import { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport { Synthesizer } from \"../../abstracts/Synthesizer\";\r\nimport { SynthesizerVoice } from \"../../abstracts/SynthesizerVoice\";\r\nimport type { Mixer } from \"../../elements/Mixer\";\r\nimport type { AudioClock } from \"../../elements/components/AudioClock\";\r\nimport { Envelope } from \"../../elements/components/Envelope\";\r\nimport type { ISourceEvent } from \"../../elements/components/SamplerSlot\";\r\nimport { Slider } from \"../../elements/components/Slider\";\r\nimport type { ControllerGroup } from \"../../schema\";\r\n\r\nfunction noteToFrequency(note: number) {\r\n  return 440 * Math.pow(2, (note - 69) / 12);\r\n}\r\n\r\nexport class FMBassVoice extends SynthesizerVoice {\r\n  constructor(readonly audioClock: AudioClock) {\r\n    super(audioClock);\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity: number | undefined) {\r\n    console.log(\"FMBassVoice triggered\", note, when, velocity);\r\n  }\r\n\r\n  release(note: number) {\r\n    console.log(\"FMBassVoice released\", note);\r\n  }\r\n}\r\n\r\nexport class FMBass extends Synthesizer<FMBassVoice> {\r\n  readonly name = \"FM Bass\";\r\n  readonly id = \"fm_bass\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple FM bass synthesizer\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly controllerGroups: ControllerGroup[] = [];\r\n  readonly window: InstrumentWindow;\r\n  private _carrier?: OscillatorNode;\r\n  private _modulator?: OscillatorNode;\r\n  readonly modulatorGain: GainNode;\r\n  readonly filter: BiquadFilterNode;\r\n  readonly gain: GainNode;\r\n  readonly filterEnvelope: Envelope;\r\n  readonly gainEnvelope: Envelope;\r\n  private _heldNote: number | undefined;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    mixer: Mixer,\r\n    mixerChannel = 0\r\n  ) {\r\n    super(audioClock, mixer);\r\n\r\n    this.window = new InstrumentWindow(\r\n      {\r\n        title: \"FM Bass\",\r\n        persistent: true,\r\n        content: this.domElement,\r\n        mixerChannel,\r\n      },\r\n      this\r\n    );\r\n\r\n    const audioContext = this.audioClock.audioContext;\r\n\r\n    this.modulatorGain = audioContext.createGain();\r\n    this.modulatorGain.gain.value = 100;\r\n\r\n    this.gain = audioContext.createGain();\r\n    this.gain.gain.value = 0;\r\n\r\n    const highpassFilter = audioContext.createBiquadFilter();\r\n    highpassFilter.type = \"highpass\";\r\n    highpassFilter.frequency.value = 20;\r\n    this.gain.connect(highpassFilter);\r\n    highpassFilter.connect(this.output);\r\n\r\n    this.output.gain.value = 0.5;\r\n\r\n    this.filter = audioContext.createBiquadFilter();\r\n    this.filter.type = \"lowpass\";\r\n    this.filter.frequency.value = 440;\r\n    this.filter.Q.value = 1;\r\n    this.filter.connect(this.gain);\r\n\r\n    this.filterEnvelope = new Envelope(0);\r\n    this.gainEnvelope = new Envelope(0.015);\r\n\r\n    const fmGainSlider = new Slider(\"FM Gain\", \"FM Gain\", 0, 1000, 1, 100);\r\n    this.window.content.appendChild(fmGainSlider.domElement);\r\n    fmGainSlider.on(\"update\", () => {\r\n      console.log(\"FM Gain\", fmGainSlider.value);\r\n      this.modulatorGain.gain.value = fmGainSlider.value;\r\n    });\r\n    // const container = this.window.content.appendChild();\r\n  }\r\n\r\n  trigger(note: number, when: number, velocity = 1): ISourceEvent | undefined {\r\n    console.log(\"FM Bass triggered\", when);\r\n\r\n    this._heldNote = note;\r\n\r\n    note += this.transpose;\r\n\r\n    if (this._carrier?.context.state === \"running\") {\r\n      const g = this.gain.gain.value;\r\n      this.gain.gain.cancelScheduledValues(when);\r\n      this.gain.gain.setValueAtTime(g, when);\r\n      this.gain.gain.setTargetAtTime(0.01, when, 0.01);\r\n\r\n      try {\r\n        this._carrier.stop(when + 0.02);\r\n        this._modulator?.stop(when + 0.02);\r\n      } catch (e) {\r\n        console.error(\"Error stopping carrier/modulator\", e);\r\n      }\r\n    }\r\n\r\n    this._carrier = this.audioClock.audioContext.createOscillator();\r\n    this._carrier.frequency.value = 220;\r\n\r\n    this._modulator = this.audioClock.audioContext.createOscillator();\r\n    this._modulator.frequency.value = 220;\r\n\r\n    this._carrier.connect(this.gain);\r\n    this._modulator.connect(this.modulatorGain);\r\n    this.modulatorGain.connect(this._carrier.frequency);\r\n\r\n    this._carrier.type = \"sine\";\r\n\r\n    this._carrier.start(when);\r\n    this._modulator.start(when);\r\n\r\n    const freq = noteToFrequency(note);\r\n    let time = when || this.audioClock.currentTime;\r\n\r\n    this.gainEnvelope.trigger(this.gain.gain, time);\r\n\r\n    const value = this._carrier.frequency.value;\r\n\r\n    time += 0.001;\r\n\r\n    this._carrier.frequency.cancelScheduledValues(time);\r\n    this._modulator.frequency.cancelScheduledValues(time);\r\n\r\n    this._carrier.frequency.setValueAtTime(value, time);\r\n    this._modulator.frequency.setValueAtTime(value * 2, time);\r\n\r\n    this._carrier.frequency.setTargetAtTime(freq, time, 0.001);\r\n    this._modulator.frequency.setTargetAtTime(freq * 2, time, 0.001);\r\n    //this.filterEnvelope.trigger(this.filter.frequency, time);\r\n\r\n    return undefined;\r\n  }\r\n\r\n  release(note: number, when: number) {\r\n    if (this._heldNote !== note) {\r\n      return;\r\n    }\r\n    console.log(\"FM Bass released\", note);\r\n    const time = when || this.audioClock.currentTime;\r\n    this.filterEnvelope.triggerRelease(this.filter.frequency, time);\r\n    this.gainEnvelope.triggerRelease(this.gain.gain, time);\r\n  }\r\n}\r\n","import { triggerActive } from \"../../../../elements/src/animation\";\r\nimport { AudioCanvas } from \"../../../../elements/src/elements/AudioCanvas\";\r\nimport { BaseElement } from \"../../../../elements/src/elements/BaseElement\";\r\nimport { ControllerGroup, ISamplerSlot } from \"../../schema\";\r\nimport { AudioClock } from \"./AudioClock\";\r\n\r\nexport interface ISourceEvent {\r\n  source: AudioBufferSourceNode;\r\n  gain: GainNode;\r\n  cutByGroups: number[];\r\n  time: number;\r\n}\r\n\r\nexport class SamplerSlot extends BaseElement<\"update\"> implements ISamplerSlot {\r\n  private _nameElement;\r\n  controllerGroups: ControllerGroup[] = [];\r\n  buffer: AudioBuffer | null = null;\r\n  velocity: number;\r\n  pan: number;\r\n  pitch: number;\r\n  randomPitch: number;\r\n  randomVelocity: number;\r\n  startPosition: number;\r\n  endPosition: number;\r\n  loop: boolean;\r\n  loopStart: number;\r\n  loopEnd: number;\r\n  protected _sources: ISourceEvent[] = [];\r\n  private _previewCanvas: AudioCanvas;\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    protected output: AudioNode,\r\n    public name = \"\",\r\n    public keyBinding: number | null = null,\r\n    public cutGroup = -1,\r\n    readonly cutByGroups: number[] = []\r\n  ) {\r\n    super(\"div\", \"sampler-slot\");\r\n\r\n    this.name = name;\r\n    this.buffer = null;\r\n    this.keyBinding = keyBinding || null;\r\n    this.velocity = 1;\r\n    this.pan = 1;\r\n    this.pitch = 1;\r\n    this.randomPitch = 0;\r\n    this.randomVelocity = 0.05;\r\n    this.startPosition = 0;\r\n    this.endPosition = 0;\r\n    this.loop = false;\r\n    this.loopStart = 0;\r\n    this.loopEnd = 0;\r\n    this.cutGroup = cutGroup;\r\n    this.cutByGroups = cutByGroups;\r\n\r\n    this._previewCanvas = new AudioCanvas(200, 60);\r\n    this.domElement.appendChild(this._previewCanvas.domElement);\r\n\r\n    this._nameElement = document.createElement(\"div\");\r\n    this._nameElement.classList.add(\"sampler-slot-name\");\r\n    this.domElement.appendChild(this._nameElement);\r\n\r\n    this.domElement.addEventListener(\"pointerdown\", () => this.trigger());\r\n  }\r\n\r\n  async loadSample(name: string, url: string) {\r\n    this._nameElement.textContent = \"(Loading)\";\r\n\r\n    const response = await fetch(url);\r\n    if (!response.ok) {\r\n      this._nameElement.textContent = \"(Empty)\";\r\n      console.error(`Error loading sample: ${url}`, response.statusText);\r\n      return;\r\n    }\r\n\r\n    response\r\n      .arrayBuffer()\r\n      .then((buffer) => this.audioClock.audioContext.decodeAudioData(buffer))\r\n      .then((audioBuffer) => {\r\n        this._nameElement.textContent = name;\r\n        this.buffer = audioBuffer;\r\n        this.emit(\"update\");\r\n        setTimeout(() => {\r\n          this._previewCanvas.loadBuffer(audioBuffer);\r\n        }, 1);\r\n      })\r\n      .catch((error) => {\r\n        this._nameElement.textContent = \"(Empty)\";\r\n        console.error(`Error loading sample: ${url}`, error);\r\n      });\r\n  }\r\n\r\n  trigger(beat = 0) {\r\n    if (!this.buffer) {\r\n      console.error(\"No buffer loaded for sample\", this.name);\r\n      return;\r\n    }\r\n\r\n    const audioContext = this.audioClock.audioContext;\r\n    const source = audioContext.createBufferSource();\r\n    source.buffer = this.buffer;\r\n    source.playbackRate.value = this.pitch + Math.random() * this.randomPitch;    \r\n\r\n    const gain = audioContext.createGain();\r\n    gain.gain.value = this.velocity + Math.random() * this.randomVelocity;\r\n    gain.connect(this.output);\r\n\r\n    source.connect(gain);\r\n\r\n    if (this.pan !== 1) {\r\n      const pan = audioContext.createStereoPanner();\r\n      pan.pan.value = this.pan;\r\n      source.connect(pan);\r\n      pan.connect(gain);\r\n    }\r\n\r\n    const time =\r\n      (this.audioClock.startTime || audioContext.currentTime) +\r\n      (beat * 60) / this.audioClock.bpm;\r\n\r\n    const entry: ISourceEvent = {\r\n      source,\r\n      gain,\r\n      cutByGroups: this.cutByGroups,\r\n      time,\r\n    };\r\n\r\n    this._sources.push(entry);\r\n\r\n    source.onended = () => {\r\n      source.disconnect();\r\n      gain.disconnect();\r\n      const index = this._sources.indexOf(entry);\r\n      if (index >= 0) this._sources.splice(index, 1);\r\n    };\r\n\r\n    console.log(beat, audioContext.currentTime, time);\r\n\r\n    if (this.startPosition >= 0) {\r\n      source.start(\r\n        time,\r\n        this.startPosition,\r\n        (this.endPosition || this.buffer.duration) - this.startPosition\r\n      );\r\n    } else {\r\n      source.start(time);\r\n    }\r\n\r\n    if (time === 0 || !this.audioClock.isPlaying) {\r\n      triggerActive(this.domElement);\r\n    } else {\r\n      this.audioClock.scheduleEventAtTime(\r\n        () => triggerActive(this.domElement),\r\n        time\r\n      );\r\n    }\r\n\r\n    if (this.loop) {\r\n      source.loop = true;\r\n      source.loopStart = this.loopStart;\r\n      source.loopEnd = this.loopEnd || this.buffer.duration;\r\n    }\r\n\r\n    return entry;\r\n  }\r\n\r\n  release(time: number) {\r\n    for (const entry of this._sources) {\r\n      if (time >= entry.time) this.cut(entry, time);\r\n    }\r\n  }\r\n\r\n  cut(entry: ISourceEvent, time = 0) {\r\n    const currentValue = entry.gain.gain.value;\r\n    entry.gain.gain.cancelScheduledValues(time);\r\n    entry.gain.gain.setValueAtTime(currentValue, time);\r\n    entry.gain.gain.exponentialRampToValueAtTime(0.0001, time + 0.1);\r\n    entry.source.stop(time + 0.1);\r\n  }\r\n}\r\n","import { Instrument } from \"../../abstracts/Instrument\";\r\nimport { InstrumentWindow } from \"../../abstracts/InstrumentWindow\";\r\nimport { Mixer } from \"../../elements/Mixer\";\r\nimport { AudioClock } from \"../../elements/components/AudioClock\";\r\nimport { SamplerSlot } from \"../../elements/components/SamplerSlot\";\r\nimport { ControllerGroup } from \"../../schema\";\r\n\r\nexport class Sampler extends Instrument {\r\n  readonly name = \"Sampler\";\r\n  readonly version = \"0.0.1\";\r\n  readonly description = \"A simple sampler\";\r\n  readonly author = \"Johnny Street\";\r\n  readonly id = \"sampler\";\r\n  readonly window: InstrumentWindow;  \r\n\r\n  private readonly _slotsContainer: HTMLDivElement;\r\n\r\n  slots: SamplerSlot[] = [];\r\n  controllerGroups: ControllerGroup[] = [];\r\n\r\n  constructor(\r\n    readonly audioClock: AudioClock,\r\n    mixer: Mixer,\r\n    mixerChannel = 0,    \r\n  ) {\r\n    super(audioClock, mixer, mixerChannel);\r\n\r\n    this.output = this.audioClock.audioContext.createGain();\r\n\r\n    window.addEventListener(\"keydown\", (event) => this.onKeyDown(event));\r\n\r\n    const container = document.createElement(\"div\");\r\n    container.classList.add(\"sampler-slots-container\");\r\n    this._slotsContainer = container;\r\n\r\n    //keypad numbers 0-9\r\n    // then . / * + - Enter\r\n    const defaultSlots = [\r\n      { keyBinding: 96, name: \"0\" },\r\n      { keyBinding: 97, name: \"1\" },\r\n      { keyBinding: 98, name: \"2\" },\r\n      { keyBinding: 99, name: \"3\" },\r\n      { keyBinding: 100, name: \"4\" },\r\n      { keyBinding: 101, name: \"5\" },\r\n      { keyBinding: 102, name: \"6\", cutByGroups: [3, 6] },\r\n      { keyBinding: 103, name: \"7\" },\r\n      { keyBinding: 104, name: \"8\" },\r\n      { keyBinding: 105, name: \"9\" },\r\n      { keyBinding: 111, name: \"/\", cutByGroups: [0, 10] },\r\n      { keyBinding: 106, name: \"*\" },\r\n      { keyBinding: 109, name: \"-\" },\r\n      { keyBinding: 107, name: \"+\" },\r\n      { keyBinding: 13, name: \"Enter\" },\r\n    ];\r\n\r\n    for (let i = 0; i < 14; i++) {\r\n      const slot = new SamplerSlot(\r\n        this.audioClock,\r\n        this.output,\r\n        defaultSlots[i].name,\r\n        defaultSlots[i].keyBinding,\r\n        i,\r\n        defaultSlots[i].cutByGroups\r\n      );\r\n      this.slots.push(slot);\r\n      container.appendChild(slot.domElement);\r\n      slot.loadSample(\"Sample\", `./data/samples/kit1/${i}.wav`);\r\n    }\r\n\r\n    audioClock.on(\"stop\", () => {\r\n      for (const slot of this.slots) {\r\n        slot.release(0);\r\n      }\r\n    });\r\n\r\n    this.domElement.appendChild(container);\r\n\r\n    this.window = new InstrumentWindow({\r\n      title: \"Sampler\",\r\n      persistent: true,\r\n      content: this.domElement,\r\n      mixerChannel,\r\n    }, this);\r\n  }\r\n\r\n  trigger(note: number, channel: number | null, beat = 0) {\r\n    console.log(\"Sampler trigger\", note);\r\n    const slot = this.slots[note];\r\n    if (slot) {\r\n      for (const each of this.slots) {\r\n        if (each.cutByGroups.includes(slot.cutGroup)) {\r\n          each.release(beat);\r\n        }\r\n      }\r\n      return slot.trigger(beat);\r\n    }\r\n  }\r\n\r\n  release(note: number, time = 0): void {\r\n    if (this.slots[note]) {\r\n      this.slots[note].release(time);\r\n    }\r\n  }\r\n\r\n  onKeyDown(event: KeyboardEvent) {\r\n    //console.log(event.key, event.keyCode);\r\n    const slot = this.slots.find((slot) => slot.keyBinding === event.keyCode);\r\n    if (slot) {\r\n      event.preventDefault();\r\n      const note = this.slots.indexOf(slot);\r\n      this.trigger(note, null);\r\n    }\r\n  }\r\n}\r\n","import { AudioClock } from \"./elements/components/AudioClock\";\r\nimport { Project } from \"./elements/Project\";\r\nimport { ProjectUI } from \"./elements/ProjectUI\";\r\nimport { FMBass } from \"./plugins/fmbass/FMBass\";\r\nimport { Plugins } from \"./plugins/plugins\";\r\nimport { Sampler } from \"./plugins/sampler/Sampler\";\r\nimport { templates } from \"./schema\";\r\n\r\nPlugins.register(\"sampler\", Sampler);\r\nPlugins.register(\"fm_bass\", FMBass);\r\n\r\nconst domElement = document.createElement(\"div\");\r\ndomElement.classList.add(\"studio\");\r\n\r\nconst audioClock = new AudioClock();\r\nconst project = new Project(audioClock, templates.Basic);\r\nconst projectUI = new ProjectUI(project);\r\n\r\ndomElement.appendChild(audioClock.domElement);\r\ndomElement.appendChild(projectUI.domElement);\r\ndocument.body.appendChild(domElement);\r\n","export type ControllerGroup = { [key: string]: IPluginControl };\r\nexport type ControllerValue = number | string | boolean | AudioBuffer | object;\r\nexport type ControlType =\r\n  | \"knob\"\r\n  | \"slider\"\r\n  | \"string\"\r\n  | \"select\"\r\n  | \"audio\"\r\n  | \"object\";\r\n\r\nexport interface IEvent {\r\n  label: string;\r\n  start: number;\r\n  duration: number;\r\n  note?: number;\r\n  row?: number;\r\n  velocity?: number;\r\n  domElement?: HTMLElement;\r\n}\r\n\r\nexport interface IPlaylistEvent extends IEvent {\r\n  type: \"pattern\" | \"audio\";\r\n  value: IPattern | AudioBuffer;\r\n  domElement?: HTMLElement;\r\n  start: number;\r\n  duration: number;\r\n}\r\n\r\nexport interface ISequence {\r\n  events: IEvent[];\r\n}\r\n\r\nexport interface IPattern {\r\n  name: string;\r\n  tracks: ISequence[];\r\n  image?: string;\r\n}\r\n\r\nexport interface ITrackOptions {\r\n  name: string;\r\n  mute: boolean;\r\n  solo: boolean;\r\n  selected: boolean;\r\n}\r\n\r\nexport interface IHasOwnEnvelope {\r\n  envelope: IEnvelope | null;\r\n}\r\n\r\nexport interface IHasOwnLFO {\r\n  lfo?: IOscillatorSettings;\r\n}\r\n\r\nexport interface IUseEnvelope {\r\n  envelopeNumber: number | null;\r\n}\r\n\r\nexport interface IUseLFO {\r\n  lfoNumber: number | null;\r\n}\r\n\r\nexport interface IHasControls {\r\n  controllerGroups: ControllerGroup[];\r\n}\r\n\r\nexport interface IInstrumentSettings extends IHasControls {\r\n  name: string;\r\n  id: string;\r\n  inputPort?: number;\r\n  inputChannel?: number;\r\n}\r\n\r\nexport interface IPlaylist {\r\n  events: IPlaylistEvent[];\r\n}\r\n\r\nexport interface IMixer {\r\n  channels: IMixerChannel[];\r\n}\r\n\r\nexport interface IEffect extends IHasControls {\r\n  plugin: string;\r\n}\r\n\r\nexport interface IMixerChannel {\r\n  label: string;\r\n  gain: number;\r\n  mute: boolean;\r\n  solo: boolean;\r\n  outputs: number[];\r\n  effects: IEffect[];\r\n}\r\n\r\nexport interface IProject {\r\n  title: string;\r\n  description: string;\r\n  tempo: number;\r\n  instruments: IInstrumentSettings[];\r\n  patterns: IPattern[];\r\n  tracks: ITrackOptions[];\r\n  playlist: IPlaylist;\r\n  mixer: IMixer;\r\n}\r\n\r\nexport interface ISamplerSlot {\r\n  name: string;\r\n  buffer: AudioBuffer | null;\r\n  keyBinding: number | null;\r\n  velocity: number;\r\n  pan: number;\r\n  pitch: number;\r\n  randomPitch: number;\r\n  randomVelocity: number;\r\n  startPosition: number;\r\n  endPosition: number;\r\n  loop: boolean;\r\n  loopStart: number;\r\n  loopEnd: number;\r\n  cutGroup: number;\r\n  cutByGroups: number[];\r\n}\r\n\r\nexport interface ISamplerSettings {\r\n  name: string;\r\n  slots: ISamplerSlot[];\r\n}\r\n\r\nexport interface IPluginControl {\r\n  type: ControlType;\r\n  name: string;\r\n  label: string;\r\n  default: ControllerValue;\r\n  value: ControllerValue;\r\n  min?: number;\r\n  max?: number;\r\n  step?: number;\r\n}\r\n\r\nexport interface IEnvelope {\r\n  attack: IPluginControl;\r\n  hold: IPluginControl;\r\n  decay: IPluginControl;\r\n  sustain: IPluginControl;\r\n  release: IPluginControl;\r\n}\r\n\r\nexport interface IOscillatorSettings extends IHasOwnEnvelope {\r\n  shape: \"sine\" | \"square\" | \"sawtooth\" | \"triangle\";\r\n  detune: number;\r\n  gain?: number;\r\n  route?: number;\r\n  feedback?: number;\r\n}\r\n\r\nexport interface IFilter extends IHasOwnEnvelope {\r\n  type:\r\n    | \"lowpass\"\r\n    | \"highpass\"\r\n    | \"bandpass\"\r\n    | \"lowshelf\"\r\n    | \"highshelf\"\r\n    | \"peaking\"\r\n    | \"notch\"\r\n    | \"allpass\";\r\n  frequency: number;\r\n  detune: number;\r\n  Q: number;\r\n  gain: number;\r\n}\r\n\r\nexport interface ISynthesizerSettings {\r\n  name: string;\r\n  voices: ISynthesizerVoiceSettings[];\r\n}\r\n\r\nexport interface ISynthesizerVoiceSettings extends IUseEnvelope, IUseLFO {\r\n  gain: number;\r\n  frequency: number | null;\r\n  detune: number | null;\r\n  oscillators: IOscillatorSettings[];\r\n  note: number | null;\r\n}\r\n\r\nexport const templates: { [key: string]: IProject } = {\r\n  Basic: {\r\n    title: \"Basic\",\r\n    description: \"Basic project template with Sampler and Synthesizer\",\r\n    tempo: 120,\r\n    instruments: [\r\n      { name: \"Sampler\", id: \"sampler\", controllerGroups: [] },\r\n      {\r\n        name: \"FM Bass\",\r\n        id: \"fm_bass\",\r\n        controllerGroups: [],\r\n      },\r\n    ],\r\n    patterns: [\r\n      {\r\n        name: \"Pattern 1\",\r\n        tracks: [\r\n          {\r\n            events: [],\r\n          },\r\n          {\r\n            events: [],\r\n          },\r\n        ],\r\n      },\r\n    ],\r\n    tracks: [],\r\n    playlist: { events: [] },\r\n    mixer: {\r\n      channels: [\r\n        {\r\n          label: \"Master\",\r\n          gain: 1,\r\n          mute: false,\r\n          solo: false,\r\n          outputs: [],\r\n          effects: [],\r\n        },\r\n        {\r\n          label: \"Drums\",\r\n          gain: 1,\r\n          mute: false,\r\n          solo: false,\r\n          outputs: [0],\r\n          effects: [],\r\n        },\r\n        {\r\n          label: \"Bass\",\r\n          gain: 1,\r\n          mute: false,\r\n          solo: false,\r\n          outputs: [0],\r\n          effects: [],\r\n        },\r\n      ],\r\n    },\r\n  },\r\n};\r\n"],"names":["exports","Symbol","toStringTag","Object","defineProperty","value","_events","_onceEvents","on","eventName","callback","this","push","once","emit","eventData","onceCallbacks","error","console","undefined","callbacks","removeAllListeners","audioContext","AudioContext","window","webkitAudioContext","getAudioContext","state","resume","latencyHint","sampleRate","prototype","navigator","mediaDevices","enumerateDevices","getAudioDevices","then","devices","log","_playbackMode","_audioContext","_bpm","_scheduledEvents","_startTime","domElement","document","createElement","classList","add","playPauseButton","addEventListener","isPlaying","stop","playPause","appendChild","stopButton","textContent","bpmInput","type","parseFloat","currentTimeDisplay","currentTime","start","requestAnimationFrame","_render","bind","_update","currentBeat","source","disconnect","remove","restart","buffer","createBuffer","createBufferSource","connect","destination","toggle","beat","bars","Math","floor","beats","timeString","toString","padStart","scheduleEventAtTime","time","emptyBuffer","onended","scheduleEventAtBeat","tagName","className","dispose","child","removeChild","audioClock","mixer","assert","BaseElement","register","name","plugin","_plugins","warn","get","instantiate","id","linearToGain","linearValue","dBValue","max","min","pow","label","gain","outputs","mute","solo","effects","gainNode","createGain","MathHelpers","channels","master","MixerChannel","i","channel","project","title","description","tempo","instruments","patterns","tracks","playlist","events","setTimeout","load","Mixer","serialize","JSON","stringify","map","instrument","controllerGroups","timeline","deserialize","data","parse","Plugins","instance","container","_isOpen","open","close","_activeWindow","windows","_draggingWindow","topRow","bottomRow","_leftPanel","WindowSnapPanel","_workspace","_rightPanel","_bottomPanel","_handleWindowDrag","e","elt","target","workspaceWidth","getBoundingClientRect","width","parentElement","leftPanelWidth","event","clientX","panelWidth","style","height","rightPanelWidth","left","win","resetDragOffset","setSize","options","_handleWindowResize","addWindow","includes","activateWindow","w","zIndex","display","titleElt","messageElt","_closeButton","onclick","removeEventListener","body","BOTTOM_ROW","TOP_ROW","KEY_COLORS","NOTE_NAMES","midiAccess","keyToNote","keyCode","note","indexOf","requestMIDIAccess","midi","inputs","forEach","entry","onmidimessage","handleMIDI","catch","PopupNotification","message","pressedKeys","ctrlKey","altKey","shiftKey","splice","length","eventType","dataByte1","dataByte2","velocity","control","_resizing","_startX","_startY","_startWidth","_startHeight","_startTop","_startLeft","_resizeDirection","handle","getCurrentHandle","cursor","onmove","dx","dy","clientY","top","offsetWidth","offsetHeight","button","startResize","preventDefault","onrelease","stopResize","direction","offsetTop","offsetLeft","rect","offsetX","offsetY","_isDragging","_dragOffsetX","_dragOffsetY","_top","_left","persistent","titlebar","scrollTop","ondrag","newTop","newLeft","deltaX","deltaY","_title","content","show","x","y","innerWidth","innerHeight","setPosition","setTitle","SizableElement","items","item","addSelectable","selectable","addToDom","selected","f","find","t","end","removeSelectable","index","clear","group","contains","_mute","_solo","_muteButton","_soloButton","isMaster","_channel","_label","volume","step","_volume","muteSoloButtons","MuteSoloButtons","valueAsNumber","SelectableElement","ui","SelectableGroup","channelsContainer","effectsContainer","MixerChannelStrip","DraggableWindow","clock","update","transform","beatWidth","hide","triggerActive","timeout","track","buttonGroup","labelAndButtons","textLabel","edit","isVisible","indicator","_canvas","append","previewGroup","port","PatternTrackInstrument","preview","PatternTrackPreview","trigger","release","sequence","playback","sourceEvent","duration","nextLoop","trackContainer","AudioCursor","marginLeft","canvas","querySelector","clientWidth","addPattern","patternPreviews","buttons","loadProject","addTrack","pattern","PatternTrack","output","mixerWindow","pianoRollWindow","loadTrack","removeTrack","renderSequence","color","clearFirst","lowestNote","highestNote","Error","ctx","getContext","clearRect","paddedScale","fillStyle","fillRect","renderPattern","concat","GraphicsHelpers","scrollElement","sensitivity","linkedElements","_scrollTop","linkElement","element","playOnClick","playBuffer","generateAudio","Promise","resolve","reject","req","text","pitch","rate","fetch","method","headers","res","arrayBuffer","decodeAudioData","audioBuffer","loadBuffer","channelData","getChannelData","bufferLength","sliceWidth","beginPath","moveTo","lineTo","stroke","AudioCanvas","ok","cancel","closeButton","HTMLButtonElement","okButton","cancelButton","targetObject","onsave","textInput","setAttribute","audioCanvas","LyricCanvas","saveButton","DialogPopup","grid","image","audio","noteItem","rowHeight","labelElement","backgroundImage","gridElement","rowCount","_currentItem","_dragMode","_dragOffset","_sequence","quantize","drawingEnabled","drawingLabel","drawingImage","previewCanvas","imageRendering","rowBackgroundCanvas","lineWidth","strokeStyle","j","row","base64","toDataURL","backgroundRepeat","noteEditor","LyricEditorDialog","input","layerX","HTMLDivElement","n","layerY","round","oldStart","pointerEvents","GridItem","ScrollPanel","keys","noteHeight","redraw","key","innerHTML","backgroundColor","reverse","cursorUpdateInterval","sideKeyboard","SideKeyboard","Grid","pianoRoll","PianoRoll","attachedElement","_submenus","_handlePointerDown","addItem","addSubmenu","submenu","innerText","_track","settings","_items","Map","_trackPanels","playlistEvent","set","has","delete","playlistTrack","PlaylistTrack","Playlist","sourceContainer","bucket","refresh","addMenu","ContextMenu","fileInput","accept","file","files","click","addButton","PlaylistSourceItem","WindowContainer","PianoRollWindow","patternWindow","PatternWindow","playlistWindow","PlaylistWindow","MixerWindow","keyboard","Keyboard","hideZero","_hideZero","_value","_step","startY","startValue","onMouseMove","oldValue","newValue","onMouseUp","mixerChannelSelector","DraggableNumber","mixerChannel","_settingsBar","insertBefore","Plugin","voices","_nextVoice","_held","transpose","addVoice","voice","handleEvent","findIndex","Instrument","_settings","_note","_frequency","_gain","lfoNumber","envelopeNumber","detune","oscillators","loadSettings","_type","_name","_min","_max","_default","_range","blur","attack","hold","decay","sustain","Slider","param","when","cancelScheduledValues","setValueAtTime","exponentialRampToValueAtTime","linearRampToValueAtTime","triggerRelease","setTargetAtTime","SynthesizerVoice","version","author","InstrumentWindow","modulatorGain","highpassFilter","createBiquadFilter","frequency","filter","Q","filterEnvelope","Envelope","gainEnvelope","fmGainSlider","_heldNote","_carrier","context","g","_modulator","createOscillator","freq","noteToFrequency","Synthesizer","keyBinding","cutGroup","cutByGroups","_sources","pan","randomPitch","randomVelocity","startPosition","endPosition","loop","loopStart","loopEnd","_previewCanvas","_nameElement","loadSample","url","response","statusText","playbackRate","random","createStereoPanner","startTime","bpm","cut","currentValue","slots","onKeyDown","_slotsContainer","defaultSlots","slot","SamplerSlot","each","Sampler","FMBass","AudioClock","projectUI","ProjectUI","Project"],"sourceRoot":""}